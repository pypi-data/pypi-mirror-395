const i="/api";class o extends Error{status;detail;constructor(r,t,a){super(t),this.name="ApiError",this.status=r,this.detail=a}}async function s(e,r){const t=await fetch(`${i}${e}`,{headers:{"Content-Type":"application/json",...r?.headers},...r});if(!t.ok){let a;try{const n=await t.json();typeof n=="object"&&n!==null&&"detail"in n&&(a=String(n.detail))}catch{}throw new o(t.status,`HTTP ${t.status}: ${t.statusText}`,a)}return t.json()}function u(e){const r=new URLSearchParams;for(const[t,a]of Object.entries(e))if(a!==void 0)if(Array.isArray(a))for(const n of a)r.append(t,n);else r.append(t,String(a));return r}const c={getDashboardSummary:()=>s("/dashboard/summary"),getTasks:(e,r=50,t=0)=>{const a=u({status:e?.status,queue:e?.queue,worker_id:e?.worker_id,search:e?.search,from_date:e?.from_date,to_date:e?.to_date,tags:e?.tags,limit:r,offset:t});return s(`/tasks?${a.toString()}`)},getTaskById:e=>e?s(`/tasks/${e}`):Promise.reject(new o(400,"Task ID is required")),retryTask:async e=>{if(!e)throw new o(400,"Task ID is required");await s(`/tasks/${e}/retry`,{method:"POST"})},deleteTask:async e=>{if(!e)throw new o(400,"Task ID is required");await s(`/tasks/${e}`,{method:"DELETE"})},bulkRetryTasks:async e=>{await s("/tasks/bulk/retry",{method:"POST",body:JSON.stringify({task_ids:e})})},bulkDeleteTasks:async e=>{await s("/tasks/bulk/delete",{method:"POST",body:JSON.stringify({task_ids:e})})},getWorkers:e=>{const t=u({status:e?.status,queue:e?.queue,search:e?.search,is_paused:e?.is_paused,has_current_task:e?.has_current_task}).toString();return s(`/workers${t?`?${t}`:""}`)},getWorkerById:e=>e?s(`/workers/${e}`):Promise.reject(new o(400,"Worker ID is required")),getWorkerDetail:e=>e?s(`/workers/${e}/detail`):Promise.reject(new o(400,"Worker ID is required")),performWorkerAction:(e,r,t=!1)=>e?s(`/workers/${e}/action`,{method:"POST",body:JSON.stringify({action:r,force:t})}):Promise.reject(new o(400,"Worker ID is required")),pauseWorker:async e=>{if(!e)throw new o(400,"Worker ID is required");return s(`/workers/${e}/pause`,{method:"POST"})},resumeWorker:async e=>{if(!e)throw new o(400,"Worker ID is required");return s(`/workers/${e}/resume`,{method:"POST"})},shutdownWorker:async e=>{if(!e)throw new o(400,"Worker ID is required");return s(`/workers/${e}/shutdown`,{method:"POST"})},killWorker:async(e,r=!1)=>{if(!e)throw new o(400,"Worker ID is required");const t=u({force:r});return s(`/workers/${e}/kill?${t.toString()}`,{method:"POST"})},getWorkerLogs:(e,r)=>{if(!e)return Promise.reject(new o(400,"Worker ID is required"));const a=u({level:r?.level,search:r?.search,limit:r?.limit,offset:r?.offset}).toString();return s(`/workers/${e}/logs${a?`?${a}`:""}`)},getQueues:e=>{const t=u({status:e?.status,search:e?.search,min_depth:e?.min_depth,alert_level:e?.alert_level}).toString();return s(`/queues${t?`?${t}`:""}`)},getQueueByName:e=>s(`/queues/${e}`),pauseQueue:async(e,r)=>{const t={method:"POST"};return r&&(t.body=JSON.stringify({reason:r})),s(`/queues/${e}/pause`,t)},resumeQueue:async e=>s(`/queues/${e}/resume`,{method:"POST"}),clearQueue:async e=>s(`/queues/${e}`,{method:"DELETE"}),getMetricsSummary:e=>s(`/metrics/summary?time_range=${encodeURIComponent(e)}`),getThroughputMetrics:e=>{const r=u({from:e.from,to:e.to,interval:e.interval});return s(`/metrics/throughput?${r.toString()}`)},getDurationMetrics:e=>{const r=u({from:e.from,to:e.to,queue:e.queue});return s(`/metrics/duration?${r.toString()}`)}};export{c as a};
