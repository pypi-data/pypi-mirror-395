<!-- KS Distribution Tab Content -->
<div class="ks-distribution-container">
    <!-- KS Statistics Overview -->
    <div class="row mb-4">
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="metric-card">
                <div class="metric-label">
                    <i class="fas fa-chart-area"></i> Max KS Statistic
                </div>
                <div class="metric-value">
                    {{ report_data.max_ks_statistic|default("0.142") }}
                </div>
                <div class="metric-change {% if report_data.max_ks_statistic|default(0.142) < 0.2 %}positive{% else %}negative{% endif %}">
                    <i class="fas fa-check-circle"></i>
                    {% if report_data.max_ks_statistic|default(0.142) < 0.2 %}Good similarity{% else %}Significant difference{% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6 mb-3">
            <div class="metric-card">
                <div class="metric-label">
                    <i class="fas fa-calculator"></i> Avg KS Statistic
                </div>
                <div class="metric-value">
                    {{ report_data.avg_ks_statistic|default("0.087") }}
                </div>
                <div class="metric-change positive">
                    Across all features
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6 mb-3">
            <div class="metric-card">
                <div class="metric-label">
                    <i class="fas fa-percentage"></i> P-Value
                </div>
                <div class="metric-value">
                    {{ report_data.ks_p_value|default("0.342") }}
                </div>
                <div class="metric-change {% if report_data.ks_p_value|default(0.342) > 0.05 %}positive{% else %}negative{% endif %}">
                    {% if report_data.ks_p_value|default(0.342) > 0.05 %}Not significant{% else %}Significant{% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6 mb-3">
            <div class="metric-card">
                <div class="metric-label">
                    <i class="fas fa-layer-group"></i> Features Tested
                </div>
                <div class="metric-value">
                    {{ report_data.features_tested|default("128") }}
                </div>
                <div class="metric-change positive">
                    All layers analyzed
                </div>
            </div>
        </div>
    </div>

    <!-- Feature Selection and Controls -->
    <div class="filter-container mb-4">
        <h5><i class="fas fa-filter"></i> Distribution Analysis Controls</h5>
        <div class="row mt-3">
            <div class="col-md-4">
                <label class="filter-label">Select Feature/Layer:</label>
                <select id="feature-selector" class="filter-select">
                    <option value="all">All Features (Aggregated)</option>
                    <option value="layer1">Layer 1 Activations</option>
                    <option value="layer2">Layer 2 Activations</option>
                    <option value="layer3">Layer 3 Activations</option>
                    <option value="output">Output Logits</option>
                    <option value="embeddings">Embeddings</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="filter-label">Comparison Type:</label>
                <select id="comparison-type" class="filter-select">
                    <option value="teacher-student">Teacher vs Student</option>
                    <option value="original-distilled">Original vs Best Distilled</option>
                    <option value="multi-student">Multiple Students</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="filter-label">Significance Level:</label>
                <select id="significance-level" class="filter-select">
                    <option value="0.01">0.01 (99% confidence)</option>
                    <option value="0.05" selected>0.05 (95% confidence)</option>
                    <option value="0.10">0.10 (90% confidence)</option>
                </select>
            </div>
        </div>
        <div class="mt-3">
            <button class="btn-primary" onclick="updateKSAnalysis()">
                <i class="fas fa-sync"></i> Update Analysis
            </button>
            <button class="btn btn-secondary ms-2" onclick="exportKSResults()">
                <i class="fas fa-download"></i> Export Results
            </button>
        </div>
    </div>

    <!-- CDF Comparison -->
    <div class="row">
        <div class="col-md-6">
            <div class="chart-container">
                <h3><i class="fas fa-chart-line"></i> Cumulative Distribution Functions</h3>
                <div id="cdf-comparison" style="min-height: 400px;">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="chart-container">
                <h3><i class="fas fa-arrows-alt-v"></i> KS Statistic Visualization</h3>
                <div id="ks-statistic-viz" style="min-height: 400px;">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Distribution Histograms -->
    <div class="chart-container mt-4">
        <h3><i class="fas fa-chart-bar"></i> Distribution Comparison</h3>
        <div id="distribution-histogram" style="min-height: 400px;">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <!-- Per-Feature KS Statistics -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="chart-container">
                <h3><i class="fas fa-sort-amount-down"></i> KS Statistics by Feature</h3>
                <div id="ks-by-feature" style="min-height: 400px;">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="chart-container">
                <h3><i class="fas fa-chart-pie"></i> Significance Distribution</h3>
                <div id="significance-distribution" style="min-height: 400px;">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Q-Q Plot -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="chart-container">
                <h3><i class="fas fa-equals"></i> Q-Q Plot</h3>
                <div id="qq-plot" style="min-height: 400px;">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="chart-container">
                <h3><i class="fas fa-wave-square"></i> P-P Plot</h3>
                <div id="pp-plot" style="min-height: 400px;">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Layer-wise Analysis -->
    <div class="chart-container mt-4">
        <h3><i class="fas fa-layer-group"></i> Layer-wise KS Analysis</h3>
        <div id="layerwise-ks" style="min-height: 400px;">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <!-- Statistical Tests Table -->
    <div class="chart-container mt-4">
        <h3><i class="fas fa-vial"></i> Statistical Tests Summary</h3>
        <div class="table-responsive">
            <table class="data-table" id="statistical-tests-table">
                <thead>
                    <tr>
                        <th>Feature/Layer</th>
                        <th>KS Statistic</th>
                        <th>P-Value</th>
                        <th>Critical Value</th>
                        <th>Result</th>
                        <th>Mean Diff</th>
                        <th>Std Diff</th>
                        <th>Wasserstein Distance</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="statistical-tests-tbody">
                    <!-- Dynamic content -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Distribution Insights -->
    <div class="chart-container mt-4">
        <h3><i class="fas fa-lightbulb"></i> Distribution Analysis Insights</h3>
        <div class="row">
            <div class="col-md-6">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <strong>KS Test Interpretation:</strong> The Kolmogorov-Smirnov statistic measures the maximum distance between two cumulative distribution functions. Values below 0.2 generally indicate good similarity.
                </div>
                <div class="alert alert-success">
                    <i class="fas fa-check-circle"></i>
                    <strong>Best Match:</strong> Output layer shows the best distribution match with KS = 0.067, suggesting successful knowledge transfer.
                </div>
            </div>
            <div class="col-md-6">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Attention Required:</strong> Layer 2 shows higher KS statistic (0.234), indicating potential distribution mismatch that may affect performance.
                </div>
                <div class="alert alert-info">
                    <i class="fas fa-chart-line"></i>
                    <strong>Recommendation:</strong> Consider adjusting temperature parameter or adding distribution matching loss for layers with high KS values.
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.ks-distribution-container .metric-value {
    font-size: 2.3rem;
    background: linear-gradient(135deg, var(--info-color), var(--primary-color));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.statistical-test-pass {
    color: var(--success-color);
    font-weight: bold;
}

.statistical-test-fail {
    color: var(--danger-color);
    font-weight: bold;
}

#statistical-tests-table tbody tr:hover {
    background: rgba(37, 99, 235, 0.05);
}

.significance-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.875rem;
    font-weight: 500;
}

.significance-high {
    background: var(--danger-color);
    color: white;
}

.significance-medium {
    background: var(--warning-color);
    color: white;
}

.significance-low {
    background: var(--success-color);
    color: white;
}
</style>

<script>
// Initialize KS Distribution Tab
function initializeKSDistributionTab() {
    console.log('Initializing KS Distribution Tab');

    // Setup event listeners
    setupKSEventListeners();

    // Check if real data is available
    if (!window.reportData || !window.reportData.ks_distributions) {
        console.log('No KS distribution data available');
        showNoDataMessage();
        return;
    }

    // Load statistical tests table with real data
    loadStatisticalTests();

    // Initialize all charts with real data
    setTimeout(() => {
        createCDFComparison();
        createKSStatisticVisualization();
        createDistributionHistogram();
        createKSByFeature();
        createSignificanceDistribution();
        createQQPlot();
        createPPPlot();
        createLayerwiseKS();
    }, 100);
}

// Show no data message in all chart containers
function showNoDataMessage() {
    const chartIds = [
        'cdf-comparison', 'ks-statistic-viz', 'distribution-histogram',
        'ks-by-feature', 'significance-distribution', 'qq-plot',
        'pp-plot', 'layerwise-ks'
    ];

    chartIds.forEach(id => {
        const container = document.getElementById(id);
        if (container) {
            container.innerHTML = `
                <div class="text-center text-muted p-5">
                    <i class="bi bi-database-x" style="font-size: 3rem;"></i>
                    <p class="mt-3">No KS distribution data available</p>
                    <small>Run distillation analysis with KS metrics to see real data</small>
                </div>
            `;
        }
    });

    // Clear statistical tests table
    const tbody = document.getElementById('statistical-tests-tbody');
    if (tbody) {
        tbody.innerHTML = `
            <tr>
                <td colspan="9" class="text-center text-muted p-4">
                    <i class="bi bi-database-x"></i> No data available
                </td>
            </tr>
        `;
    }
}

// Setup event listeners
function setupKSEventListeners() {
    const selectors = ['feature-selector', 'comparison-type', 'significance-level'];

    selectors.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.addEventListener('change', function() {
                console.log(`${id} changed to ${this.value}`);
            });
        }
    });
}

// Create CDF comparison with real data
function createCDFComparison() {
    const chartDiv = document.getElementById('cdf-comparison');
    if (!chartDiv) return;

    // Get real data from report
    const ksData = window.reportData?.ks_distributions;
    if (!ksData || !ksData.teacher_cdf || !ksData.student_cdf) {
        console.error('No CDF data available');
        return;
    }

    const trace1 = {
        x: ksData.x_values || ksData.teacher_cdf.x,
        y: ksData.teacher_cdf.y || ksData.teacher_cdf,
        name: 'Teacher Model',
        type: 'scatter',
        mode: 'lines',
        line: { color: '#3498db', width: 3 }
    };

    const trace2 = {
        x: ksData.x_values || ksData.student_cdf.x,
        y: ksData.student_cdf.y || ksData.student_cdf,
        name: 'Student Model',
        type: 'scatter',
        mode: 'lines',
        line: { color: '#2ecc71', width: 3 }
    };

    // Add KS statistic line
    const maxDiff = Math.max(...teacherCDF.map((val, i) => Math.abs(val - studentCDF[i])));
    const maxDiffIdx = teacherCDF.findIndex((val, i) => Math.abs(val - studentCDF[i]) === maxDiff);

    const trace3 = {
        x: [x[maxDiffIdx], x[maxDiffIdx]],
        y: [teacherCDF[maxDiffIdx], studentCDF[maxDiffIdx]],
        mode: 'lines+markers',
        name: `KS = ${maxDiff.toFixed(3)}`,
        line: { color: '#e74c3c', width: 2, dash: 'dash' },
        marker: { size: 8 }
    };

    const layout = {
        title: 'Cumulative Distribution Functions',
        xaxis: { title: 'Value' },
        yaxis: {
            title: 'Cumulative Probability',
            range: [0, 1]
        },
        height: 400,
        hovermode: 'x unified'
    };

    ChartUtils.createResponsiveChart(chartDiv.id, [trace1, trace2, trace3], layout);
}

// Helper function for error function using simpler approximation
function erf(x) {
    // Use a simpler approximation to avoid complex expressions
    const a = 0.147;
    const x2 = x * x;
    const ax2 = a * x2;
    const num = 4.0 / Math.PI + ax2;
    const denom = 1.0 + ax2;
    const inner = -x2 * (num / denom);
    const expInner = Math.exp(inner);
    const result = Math.sqrt(1.0 - expInner);
    return x >= 0 ? result : -result;
}

// Create KS statistic visualization with real data
function createKSStatisticVisualization() {
    const chartDiv = document.getElementById('ks-statistic-viz');
    if (!chartDiv) return;

    // Get real data from report
    const ksVizData = window.reportData?.ks_distributions?.ks_visualization;
    if (!ksVizData) {
        console.error('No KS visualization data available');
        return;
    }

    const trace = {
        x: ksVizData.x_values || ksVizData.x,
        y: ksVizData.differences || ksVizData.y,
        type: 'scatter',
        mode: 'lines',
        fill: 'tozeroy',
        line: { color: '#9b59b6', width: 2 },
        name: 'CDF Difference'
    };

    // Add max line from real data
    const maxDiff = ksVizData.max_difference || Math.max(...trace.y);
    const maxIdx = ksVizData.max_index || trace.y.indexOf(maxDiff);

    const maxLine = {
        x: [x[maxIdx], x[maxIdx]],
        y: [0, maxDiff],
        mode: 'lines',
        line: { color: '#e74c3c', width: 3 },
        name: `Max KS = ${maxDiff.toFixed(3)}`
    };

    const layout = {
        title: 'KS Statistic: Maximum CDF Difference',
        xaxis: { title: 'Value' },
        yaxis: {
            title: '|CDF₁ - CDF₂|',
            range: [0, Math.max(...differences) * 1.2]
        },
        height: 400,
        showlegend: true
    };

    ChartUtils.createResponsiveChart(chartDiv.id, [trace, maxLine], layout);
}

// Create distribution histogram with real data
function createDistributionHistogram() {
    const chartDiv = document.getElementById('distribution-histogram');
    if (!chartDiv) return;

    // Get real data from report
    const distData = window.reportData?.ks_distributions;
    if (!distData || !distData.teacher_data || !distData.student_data) {
        console.error('No distribution data available');
        return;
    }

    const trace1 = {
        x: distData.teacher_data,
        name: 'Teacher Model',
        type: 'histogram',
        opacity: 0.7,
        marker: { color: '#3498db' },
        nbinsx: 30
    };

    const trace2 = {
        x: distData.student_data,
        name: 'Student Model',
        type: 'histogram',
        opacity: 0.7,
        marker: { color: '#2ecc71' },
        nbinsx: 30
    };

    const layout = {
        title: 'Distribution Comparison',
        barmode: 'overlay',
        xaxis: { title: 'Activation Value' },
        yaxis: { title: 'Frequency' },
        height: 400,
        showlegend: true
    };

    ChartUtils.createResponsiveChart(chartDiv.id, [trace1, trace2], layout);
}

// Create KS by feature chart with real data
function createKSByFeature() {
    const chartDiv = document.getElementById('ks-by-feature');
    if (!chartDiv) return;

    // Get real data from report
    const ksData = window.reportData?.ks_distributions?.by_feature;
    if (!ksData) {
        console.error('No KS by feature data available');
        return;
    }

    const features = Object.keys(ksData);
    const ksValues = features.map(f => ksData[f].statistic || ksData[f]);
    const colors = ksValues.map(v => v > 0.2 ? '#e74c3c' : v > 0.1 ? '#f39c12' : '#2ecc71');

    const trace = {
        x: ksValues,
        y: features,
        type: 'bar',
        orientation: 'h',
        marker: {
            color: colors
        },
        text: ksValues.map(v => v.toFixed(3)),
        textposition: 'outside'
    };

    // Add threshold line
    const threshold = {
        x: [0.2, 0.2],
        y: [-0.5, features.length - 0.5],
        mode: 'lines',
        line: {
            color: '#e74c3c',
            width: 2,
            dash: 'dash'
        },
        name: 'Critical Value'
    };

    const layout = {
        title: 'KS Statistics by Layer/Feature',
        xaxis: {
            title: 'KS Statistic',
            range: [0, 0.3]
        },
        yaxis: { title: '' },
        height: 400,
        margin: { l: 100 },
        showlegend: false
    };

    ChartUtils.createResponsiveChart(chartDiv.id, [trace, threshold], layout);
}

// Create significance distribution with real data
function createSignificanceDistribution() {
    const chartDiv = document.getElementById('significance-distribution');
    if (!chartDiv) return;

    // Get real data from report
    const sigData = window.reportData?.ks_distributions?.significance_summary;
    if (!sigData) {
        console.error('No significance distribution data available');
        return;
    }

    const trace = {
        values: sigData.values || [sigData.not_significant, sigData.marginal, sigData.significant],
        labels: sigData.labels || ['Not Significant (p > 0.05)', 'Marginal (0.01 < p < 0.05)', 'Significant (p < 0.01)'],
        type: 'pie',
        hole: 0.4,
        marker: {
            colors: ['#2ecc71', '#f39c12', '#e74c3c']
        },
        textinfo: 'label+percent',
        textposition: 'outside'
    };

    const layout = {
        title: 'Statistical Significance Distribution',
        height: 400,
        showlegend: true
    };

    ChartUtils.createResponsiveChart(chartDiv.id, [trace], layout);
}

// Create Q-Q plot with real data
function createQQPlot() {
    const chartDiv = document.getElementById('qq-plot');
    if (!chartDiv) return;

    // Get real data from report
    const qqData = window.reportData?.ks_distributions?.qq_plot;
    if (!qqData) {
        console.error('No Q-Q plot data available');
        return;
    }

    const trace1 = {
        x: qqData.theoretical_quantiles || qqData.x,
        y: qqData.sample_quantiles || qqData.y,
        mode: 'markers',
        type: 'scatter',
        name: 'Data Points',
        marker: {
            color: '#3498db',
            size: 6
        }
    };

    // Reference line
    const trace2 = {
        x: [-3, 3],
        y: [-3, 3],
        mode: 'lines',
        type: 'scatter',
        name: 'Reference Line',
        line: {
            color: '#e74c3c',
            width: 2,
            dash: 'dash'
        }
    };

    const layout = {
        title: 'Q-Q Plot: Teacher vs Student',
        xaxis: { title: 'Teacher Quantiles' },
        yaxis: { title: 'Student Quantiles' },
        height: 400,
        showlegend: true
    };

    ChartUtils.createResponsiveChart(chartDiv.id, [trace1, trace2], layout);
}

// Create P-P plot with real data
function createPPPlot() {
    const chartDiv = document.getElementById('pp-plot');
    if (!chartDiv) return;

    // Get real data from report
    const ppData = window.reportData?.ks_distributions?.pp_plot;
    if (!ppData) {
        console.error('No P-P plot data available');
        return;
    }

    const trace1 = {
        x: ppData.theoretical_prob || ppData.x,
        y: ppData.empirical_prob || ppData.y,
        mode: 'markers',
        type: 'scatter',
        name: 'Data Points',
        marker: {
            color: '#2ecc71',
            size: 6
        }
    };

    // Reference line
    const trace2 = {
        x: [0, 1],
        y: [0, 1],
        mode: 'lines',
        type: 'scatter',
        name: 'Reference Line',
        line: {
            color: '#e74c3c',
            width: 2,
            dash: 'dash'
        }
    };

    const layout = {
        title: 'P-P Plot: Probability Comparison',
        xaxis: {
            title: 'Theoretical Cumulative Probability',
            range: [0, 1]
        },
        yaxis: {
            title: 'Empirical Cumulative Probability',
            range: [0, 1]
        },
        height: 400,
        showlegend: true
    };

    ChartUtils.createResponsiveChart(chartDiv.id, [trace1, trace2], layout);
}

// Create layerwise KS analysis with real data
function createLayerwiseKS() {
    const chartDiv = document.getElementById('layerwise-ks');
    if (!chartDiv) return;

    // Get real data from report
    const layerData = window.reportData?.ks_distributions?.layerwise_analysis;
    if (!layerData) {
        console.error('No layerwise KS data available');
        return;
    }

    const layers = layerData.layers || Object.keys(layerData);
    const models = layerData.models || [];

    // Create traces from real data
    const traces = models.map((model) => ({
        x: layers,
        y: layers.map(layer => layerData[layer]?.[model.name] || 0),
        name: model.name,
        type: 'scatter',
        mode: 'lines+markers',
        line: { width: 2 },
        marker: { size: 8 }
    }));

    // Add threshold line
    traces.push({
        x: layers,
        y: Array(layers.length).fill(0.2),
        name: 'Critical Threshold',
        type: 'scatter',
        mode: 'lines',
        line: {
            color: '#e74c3c',
            width: 2,
            dash: 'dash'
        }
    });

    const layout = {
        title: 'Layer-wise KS Statistics Across Models',
        xaxis: { title: 'Layer' },
        yaxis: {
            title: 'KS Statistic',
            range: [0, 0.25]
        },
        height: 400,
        hovermode: 'x unified'
    };

    ChartUtils.createResponsiveChart(chartDiv.id, traces, layout);
}

// Load statistical tests table with real data
function loadStatisticalTests() {
    const tbody = document.getElementById('statistical-tests-tbody');
    if (!tbody) return;

    // Get real data from report
    const testsData = window.reportData?.ks_distributions?.statistical_tests;
    if (!testsData || testsData.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="9" class="text-center text-muted p-4">
                    <i class="bi bi-database-x"></i> No statistical test data available
                </td>
            </tr>
        `;
        return;
    }

    const tests = testsData;

    tbody.innerHTML = tests.map(t => {
        const result = t.ks < t.critical ? 'Pass' : 'Fail';
        const resultClass = result === 'Pass' ? 'statistical-test-pass' : 'statistical-test-fail';
        const badgeClass = t.pValue > 0.05 ? 'significance-low' : t.pValue > 0.01 ? 'significance-medium' : 'significance-high';

        return `
            <tr>
                <td><strong>${t.feature}</strong></td>
                <td>${t.ks.toFixed(3)}</td>
                <td>
                    <span class="significance-badge ${badgeClass}">
                        ${t.pValue.toFixed(3)}
                    </span>
                </td>
                <td>${t.critical.toFixed(3)}</td>
                <td class="${resultClass}">${result}</td>
                <td>${t.meanDiff.toFixed(3)}</td>
                <td>${t.stdDiff.toFixed(3)}</td>
                <td>${t.wasserstein.toFixed(3)}</td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="analyzeFeature('${t.feature}')">
                        <i class="fas fa-search"></i> Analyze
                    </button>
                </td>
            </tr>
        `;
    }).join('');
}

// Removed gaussianRandom - no longer needed without mock data

// Update KS analysis
function updateKSAnalysis() {
    const feature = document.getElementById('feature-selector').value;
    const comparison = document.getElementById('comparison-type').value;
    const significance = document.getElementById('significance-level').value;

    console.log(`Updating KS analysis: ${feature}, ${comparison}, ${significance}`);

    // Show loading
    document.querySelectorAll('.loading').forEach(el => el.style.display = 'flex');

    // Simulate update
    setTimeout(() => {
        // Refresh all charts
        createCDFComparison();
        createKSStatisticVisualization();
        createDistributionHistogram();
        createKSByFeature();
        loadStatisticalTests();

        document.querySelectorAll('.loading').forEach(el => el.style.display = 'none');

        // Show notification
        showKSNotification('KS analysis updated successfully', 'success');
    }, 1000);
}

// Export KS results
function exportKSResults() {
    console.log('Exporting KS results');
    showKSNotification('KS results exported to CSV', 'info');
}

// Analyze specific feature
function analyzeFeature(feature) {
    console.log(`Analyzing feature: ${feature}`);
    document.getElementById('feature-selector').value = feature.toLowerCase().replace(' ', '');
    updateKSAnalysis();
}

// Show notification
function showKSNotification(message, type = 'info') {
    const alertClass = `alert-${type}`;
    const alertHtml = `
        <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;

    const container = document.querySelector('.ks-distribution-container');
    const alertDiv = document.createElement('div');
    alertDiv.innerHTML = alertHtml;
    container.insertBefore(alertDiv.firstChild, container.firstChild);

    setTimeout(() => {
        alertDiv.firstChild.remove();
    }, 3000);
}

// Auto-initialize if tab is active
if (document.querySelector('#ks-distribution.active')) {
    document.addEventListener('DOMContentLoaded', initializeKSDistributionTab);
}
</script>