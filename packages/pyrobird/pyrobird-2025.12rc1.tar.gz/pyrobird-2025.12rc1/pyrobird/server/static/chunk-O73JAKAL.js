import{c as N}from"./chunk-2IR3OD6Q.js";import{a as T}from"./chunk-U54GQJ26.js";import{a as L,b as M}from"./chunk-3Y4HYQCO.js";import{a as S}from"./chunk-QBWQK3DT.js";import"./chunk-3MJ5AJB7.js";import"./chunk-STN7OMLL.js";import"./chunk-JFO4ENDF.js";import"./chunk-3W3OTHNE.js";import"./chunk-HB357Z3Y.js";import"./chunk-OI5V6APH.js";import"./chunk-S3FA7C5I.js";import"./chunk-FENW22PV.js";import{d as G}from"./chunk-K2P6CES6.js";import"./chunk-LNTKXTVM.js";import"./chunk-MFPRCIVI.js";import"./chunk-SVHROGNI.js";import{ka as C}from"./chunk-DLJYFRIS.js";import{Ma as E,Qa as x,Sa as P,g as _,hb as O,lb as A,mb as F,x as h}from"./chunk-MAT3H5WR.js";import{k as g}from"./chunk-KYPE3LET.js";var u=h(14),X=h(15),c=h(17),Y=h(18),y=(o,t)=>o.fBeta_bin_params.length>t?o.fBeta_bin_params[t].first:o.fBeta_alpha,p=(o,t)=>o.fBeta_bin_params.length>t?o.fBeta_bin_params[t].second:o.fBeta_beta,k=class o extends C{getEfficiency(t,i){let r=(e,f)=>e<=0||f<=0?0:e/(e+f),a=(e,f)=>{if(e<=0||f<=0)return 0;if(e<=1||f<=1){if(e<f)return 0;if(e>f)return 1;if(e===f)return .5}return(e-1)/(e+f-2)},n=t.fTotalHistogram.fArray[i],s=t.fPassedHistogram.fArray[i];if(t.TestBit(u)){let e=t.TestBit(c)?y(t,i):t.fBeta_alpha,f=t.TestBit(c)?p(t,i):t.fBeta_beta,l,m;if(t.TestBit(Y)){let d=n,H=t.fTotalHistogram.fSumw2?t.fTotalHistogram.fSumw2[i]:Math.abs(n),B=s;if(H<=0)return B/d;let w=d/H;l=B*w+e,m=(d-B)*w+f}else l=s+e,m=n-s+f;return t.TestBit(X)?a(l,m):r(l,m)}return n?s/n:0}getEfficiencyErrorLow(t,i,r){let a=t.fTotalHistogram.fArray[i],n=t.fPassedHistogram.fArray[i],s=0,e=0;return t.TestBit(u)&&(s=t.TestBit(c)?y(t,i):t.fBeta_alpha,e=t.TestBit(c)?p(t,i):t.fBeta_beta),r-this.fBoundary(a,n,t.fConfLevel,!1,s,e)}getEfficiencyErrorUp(t,i,r){let a=t.fTotalHistogram.fArray[i],n=t.fPassedHistogram.fArray[i],s=0,e=0;return t.TestBit(u)&&(s=t.TestBit(c)?y(t,i):t.fBeta_alpha,e=t.TestBit(c)?p(t,i):t.fBeta_beta),this.fBoundary(a,n,t.fConfLevel,!0,s,e)-r}copyAttributes(t,i){["fLineColor","fLineStyle","fLineWidth","fFillColor","fFillStyle","fMarkerColor","fMarkerStyle","fMarkerSize"].forEach(r=>{t[r]=i[r]})}createGraph(){let t=A(L);return t.fName="eff_graph",t}createHisto(t){let i=t.fTotalHistogram.fXaxis.fNbins,r=t.fTotalHistogram.fYaxis.fNbins,a=F(P,i,r);return Object.assign(a.fXaxis,t.fTotalHistogram.fXaxis),Object.assign(a.fYaxis,t.fTotalHistogram.fYaxis),a.fName="eff_histo",a}fillGraph(t,i){let r=this.getObject(),a=r.fTotalHistogram.fXaxis,n=a.fNbins,s=i.indexOf("e0")>=0;for(let e=0,f=0;e<n;++e){if(!s&&r.fTotalHistogram.getBinContent(e+1)===0)continue;let l=this.getEfficiency(r,e+1);t.fX[f]=a.GetBinCenter(e+1),t.fY[f]=l,t.fEXlow[f]=a.GetBinCenter(e+1)-a.GetBinLowEdge(e+1),t.fEXhigh[f]=a.GetBinLowEdge(e+2)-a.GetBinCenter(e+1),t.fEYlow[f]=this.getEfficiencyErrorLow(r,e+1,l),t.fEYhigh[f]=this.getEfficiencyErrorUp(r,e+1,l),t.fNpoints=++f}t.fTitle=r.fTitle,this.copyAttributes(t,r)}fillHisto(t){let i=this.getObject(),r=t.fXaxis.fNbins,a=t.fYaxis.fNbins;for(let n=0;n<r+2;++n)for(let s=0;s<a+2;++s){let e=t.getBin(n,s);t.fArray[e]=this.getEfficiency(i,e)}t.fTitle=i.fTitle,t.fBits|=O,this.copyAttributes(t,i)}drawFunction(t){let i=this.getObject();return!i?.fFunctions||t>=i.fFunctions.arr.length?this:N.draw(this.getPadPainter(),i.fFunctions.arr[t],i.fFunctions.opt[t]).then(r=>(r?.setSecondaryId(this,`func_${t}`),this.drawFunction(t+1)))}fillContextMenuItems(t){t.addRedrawMenu(this)}redrawWith(t,i){return g(this,null,function*(){i||this.getPadPainter()?.removePrimitive(this,!0),(!t||!_(t))&&(t=""),t=t.toLowerCase();let r,a=!1,n=this.getObject(),s=this.getDrawDom();if(t[0]==="b")a=!0,r=(this.ndim===1?S:T).draw(s,n.fTotalHistogram,t.slice(1));else if(this.ndim===1){t||(t="ap"),t.indexOf("same")<0&&t.indexOf("a")<0&&(t+="a"),t.indexOf("p")<0&&(t+="p");let e=this.createGraph(n);this.fillGraph(e,t),r=M.draw(s,e,t)}else{t||(t="col");let e=this.createHisto(n);this.fillHisto(e,t),r=T.draw(s,e,t)}return r.then(e=>(e?.setSecondaryId(this,"eff"),this.addToPadPrimitives(),a?this:this.drawFunction(0)))})}static draw(t,i,r){return g(this,null,function*(){if(!i||!i.fTotalHistogram)return null;let a=new o(t,i);if(i.fTotalHistogram._typename.indexOf(E)===0)a.ndim=1;else if(i.fTotalHistogram._typename.indexOf(x)===0)a.ndim=2;else return null;return a.fBoundary=G(i.fStatisticOption,i.TestBit(u)),a.redrawWith(r,!0)})}};export{k as TEfficiencyPainter};
