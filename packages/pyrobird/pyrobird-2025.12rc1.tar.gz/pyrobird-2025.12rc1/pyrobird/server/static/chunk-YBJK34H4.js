import{p as B}from"./chunk-SVHROGNI.js";import{f as S,ka as w,y as P}from"./chunk-DLJYFRIS.js";import{kb as M}from"./chunk-MAT3H5WR.js";import{k as b}from"./chunk-KYPE3LET.js";var $=class z extends w{updateObject(t){return this.matchObjectType(t)?(this.assignObject(t),!0):!1}getMenuHeader(){return this.getObject()?.fClassName||"TWebPainting"}fillContextMenu(t){let e=this.getMenuHeader();return t.header(e,`${M}${e}.html`),!0}handleMouseClick(t){let e=this.getPadPainter(),n=e?.getPadRect();if(e&&n&&this.getSnapId()){let i=S(t,this.getG().node());e.selectObjectPainter(this,{x:i[0]+n.x,y:i[1]+n.y})}}redraw(){return b(this,null,function*(){let t=this.getObject(),e=this.getAxisToSvgFunc();if(!t?.fOper||!e)return this;let n=0,i={},x=null,y="none",p="",u,d,s,T=this.createG(),c=t.fOper.split(";"),l=r=>{if(r!==y&&(x&&(x.attr("d",p),p="",x=null,y="none"),!!r))switch(y=r,x=T.append("svg:path").attr("d",""),r){case"f":x.call(this.fillatt.func);break;case"l":x.call(this.lineatt.func).style("fill","none");break;case"m":x.call(this.markeratt.func);break}},m=(r,h)=>{let a=0,o={_typename:"any"};for(let f=0;f<h.length;++f){let g=r.indexOf(":",a+1);o[h[f]]=parseInt(r.slice(a+1,g>a?g:void 0)),a=g}return o},C=r=>{for(;++r<c.length;)switch(u=c[r][0],u){case"z":this.createAttLine({attr:m(c[r],["fLineColor","fLineStyle","fLineWidth"]),force:!0}),l();continue;case"y":this.createAttFill({attr:m(c[r],["fFillColor","fFillStyle"]),force:!0}),l();continue;case"x":this.createAttMarker({attr:m(c[r],["fMarkerColor","fMarkerStyle","fMarkerSize"]),force:!0}),l();continue;case"o":i=m(c[r],["fTextColor","fTextFont","fTextSize","fTextAlign","fTextAngle"]),i.fTextSize<0&&(i.fTextSize*=-.001),l();continue;case"r":case"b":{l(u==="b"?"f":"l");let h=e.x(t.fBuf[n++]),a=e.y(t.fBuf[n++]),o=e.x(t.fBuf[n++]),f=e.y(t.fBuf[n++]);p+=`M${h},${a}h${o-h}v${f-a}h${h-o}z`;continue}case"l":case"f":{for(l(u),d=parseInt(c[r].slice(1)),s=0;s<d;++s)p+=`${s>0?"L":"M"}${e.x(t.fBuf[n++])},${e.y(t.fBuf[n++])}`;u==="f"&&(p+="Z");continue}case"m":{for(l(u),d=parseInt(c[r].slice(1)),this.markeratt.resetPos(),s=0;s<d;++s)p+=this.markeratt.create(e.x(t.fBuf[n++]),e.y(t.fBuf[n++]));continue}case"h":case"t":{if(i.fTextSize){l();let h=i.fTextSize>1?i.fTextSize:this.getPadPainter().getPadHeight()*i.fTextSize,a=T.append("svg:g");return this.startTextDrawingAsync(i.fTextFont,h,a).then(()=>{let o=c[r].slice(1),f=i.fTextAngle;if(f>=360&&(f-=Math.floor(f/360)*360),u==="h"){let g="";for(s=0;s<o.length;s+=2)g+=String.fromCharCode(parseInt(o.slice(s,s+2),16));o=g}return this.drawText({align:i.fTextAlign,x:e.x(t.fBuf[n++]),y:e.y(t.fBuf[n++]),rotate:-f,text:o,color:P(i.fTextColor),latex:0,draw_g:a}),this.finishTextDrawing(a)}).then(()=>C(r))}continue}default:console.log(`unsupported operation ${u}`)}return Promise.resolve(!0)};return C(-1).then(()=>(l(),B(this),this.isBatchMode()||T.on("click",r=>this.handleMouseClick(r)),this))})}static draw(t,e){return b(this,null,function*(){let n=new z(t,e);return n.addToPadPrimitives(),n.redraw()})}};export{$ as TWebPaintingPainter};
