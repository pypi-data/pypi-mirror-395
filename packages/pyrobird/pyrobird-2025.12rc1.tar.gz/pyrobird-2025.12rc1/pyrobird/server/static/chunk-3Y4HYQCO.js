import{a as ht,b as lt}from"./chunk-JFO4ENDF.js";import{g as W}from"./chunk-HB357Z3Y.js";import{g as st,k as at,p as nt}from"./chunk-SVHROGNI.js";import{I as O,K as w,O as R,P as D,e as S,ka as rt,p as it,q as C,va as I}from"./chunk-DLJYFRIS.js";import{Fa as J,Oa as tt,Sa as et,Va as G,Xa as L,ca as K,f as v,g as V,gb as A,hb as H,ka as T,lb as N,mb as q,nb as z,t as X,u as P,x as B}from"./chunk-MAT3H5WR.js";import{k as F}from"./chunk-KYPE3LET.js";var Z=B(18),Q="TGraphErrors",ft="TGraphAsymmErrors",ot="TGraphBentErrors",j="TGraphMultiErrors",ct=class U extends rt{#t;#u;#p;#f;#s;#c;#x;#o;#g;#y;#r;#n;#i;#a;#_;#M;#h;#l;#m;#d;#e;constructor(t,e){super(t,e),this.axes_draw=!1,this.xmin=this.ymin=this.xmax=this.ymax=0,this.#d=e._typename===ot,this.#m=e._typename===Q||e._typename===j||e._typename===ft||this.#d||e._typename.match(/^RooHist/),this.#e=""}get _wheel_zoomy(){return!0}getGraph(){return this.getObject()}getHistogram(){return this.getObject()?.fHistogram}isDummyHistogram(t){let e=this.getHistogram();if(!e)return!0;let i=!1;return t!=="y"&&(i||=e.fXaxis.fXmin!==.0011||e.fXaxis.fXmax!==1.1),t!=="x"&&(i||=e.fYaxis.fXmin!==.0011||e.fYaxis.fXmax!==1.1||e.fMinimum!==.0011||e.fMaximum!==1.1),!i}setHistogram(t){let e=this.getObject();e&&(e.fHistogram=t)}isScatter(){return!1}redraw(){return F(this,null,function*(){let t=Promise.resolve(!0);if(this.#f){this.#f=void 0;let e=this.getMainPainter();e?.isSecondary(this)&&this.axes_draw&&(t=e.redraw())}return t.then(()=>this.drawGraph()).then(()=>{let e=this.#c?.drawNext(0)??this;return this.#c=void 0,e})})}cleanup(){this.#t=void 0,this.#y=void 0,super.cleanup()}get_gme(){let t=this.getGraph();return t?._typename===j?t:null}decodeOptions(t,e){V(t)&&t.indexOf("same ")===0&&(t=t.slice(5));let i=this.getGraph(),n=!!this.get_gme(),h=e?!!this.getMainPainter():!this.axes_draw;function s(f,c){Object.assign(c,{Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,MainError:1,Ends:1,ScaleErrX:1}),n&&f.check("S=",!0)&&(c.ScaleErrX=f.partAsFloat()),f.check("L")&&(c.Line=1),f.check("F")&&(c.Fill=1),f.check("CC")&&(c.Curve=2),f.check("C")&&(c.Curve=1),f.check("*")&&(c.Mark=103),f.check("P0")&&(c.Mark=104),f.check("P")&&(c.Mark=1),f.check("B")&&(c.Bar=1,c.Errors=0),f.check("Z")&&(c.Errors=1,c.Ends=0),f.check("||")&&(c.Errors=1,c.MainError=0,c.Ends=1),f.check("[]")&&(c.Errors=1,c.MainError=0,c.Ends=2),f.check("|>")&&(c.Errors=1,c.Ends=3),f.check(">")&&(c.Errors=1,c.Ends=4),f.check("0")&&(c.Mark=1,c.Errors=1,c.OutRange=1),f.check("1")&&c.Bar===1&&(c.Bar=2),f.check("2")&&(c.Rect=1,c.Errors=0),f.check("3")&&(c.EF=1,c.Errors=0),f.check("4")&&(c.EF=2,c.Errors=0),f.check("5")&&(c.Rect=2,c.Errors=0),f.check("X")&&(c.Errors=0)}let a=this.setOptions({Axis:"",NoOpt:0,PadStats:!1,PadPalette:!1,original:t,second_x:!1,second_y:!1,individual_styles:!1}),x=[];n&&t&&(t.indexOf(";")>0?(x=t.split(";"),t=x.shift()):t.indexOf("_")>0&&(x=t.split("_"),t=x.shift()));let l=new O(t),p="";if(ht.forEach(f=>{l.check(f)&&(p+=";"+f)}),l.check("XAXIS_",!0)&&(p+=";XAXIS_"+l.part),l.check("YAXIS_",!0)&&(p+=";YAXIS_"+l.part),l.empty()&&(a.original=h?"lp":"alp",l=new O(a.original)),l.check("FILL_","color")&&(a.graphFillColor=l.color,a.graphFillPattern=1001),l.check("FILLPAT_",!0)&&(a.graphFillPattern=l.partAsInt()),l.check("LINE_","color")&&(a.graphLineColor=this.getColor(l.color)),l.check("WIDTH_",!0)&&(a.graphLineWidth=l.partAsInt()),l.check("NOOPT")&&(a.NoOpt=1),l.check("POS3D_",!0)&&(a.pos3d=l.partAsInt()-.5),l.check("PFC")&&!a._pfc&&(a._pfc=2),l.check("PLC")&&!a._plc&&(a._plc=2),l.check("PMC")&&!a._pmc&&(a._pmc=2),l.check("A")&&(a.Axis=l.check("I")?"A;":" "),l.check("X+")&&(a.Axis+="X+",a.second_x=h),l.check("Y+")&&(a.Axis+="Y+",a.second_y=h),l.check("RX")&&(a.Axis+="RX"),l.check("RY")&&(a.Axis+="RY"),n&&(a.blocks=[],a.skip_errors_x0=a.skip_errors_y0=!1,l.check("X0")&&(a.skip_errors_x0=!0),l.check("Y0")&&(a.skip_errors_y0=!0)),s(l,a),n&&l.check("S")&&(a.individual_styles=!0),a.Errors===void 0&&(a.Errors=this.#m&&(!n||!x.length)?1:0),a.Mark===1&&i.fMarkerStyle===1&&(a.Mark=101),a.Line+a.Fill+a.Curve+a.Mark+a.Bar+a.EF+a.Rect+a.Errors===0&&l.empty()&&(a.Line=1),this.matchObjectType(Q)){let f=i.fEX.length,c=0;for(let m=0;m<f;++m)c=Math.max(c,i.fEX[m],i.fEY[m]);c<1e-100&&(a.Errors=0)}if(this.#o=this.matchObjectType(K),this.#g=this.#o&&i.fNpoints>3&&i.fX[0]===i.fX[i.fNpoints-1]&&i.fY[0]===i.fY[i.fNpoints-1],!a.Axis){let f=this.getPadPainter()?.getRootPad(!0);(!f||f?.fPrimitives?.arr[0]===this.getObject())&&(a.Axis=" ")}a.Axis+=p;for(let f=0;f<x.length;++f){let c=new O(x[f]),m={};s(c,m),m.skip_errors_x0=a.skip_errors_x0,m.skip_errors_y0=a.skip_errors_y0,a.blocks.push(m)}}_getBins(){return this.#t}createBins(){let t=this.getGraph(),e=this.getOptions();if(!t)return;let i=0,n=t.fNpoints;this.#o&&this.#g&&n--,t._typename===Q?i=1:t._typename===j?i=2:(t._typename===ft||t._typename===ot||t._typename.match(/^RooHist/))&&(i=3),this.#t=new Array(n);for(let h=0;h<n;++h){let s=this.#t[h]={x:t.fX[h],y:t.fY[h],indx:h};switch(i){case 1:s.exlow=s.exhigh=t.fEX[h],s.eylow=s.eyhigh=t.fEY[h];break;case 2:s.exlow=t.fExL[h],s.exhigh=t.fExH[h],s.eylow=t.fEyL[0][h],s.eyhigh=t.fEyH[0][h];break;case 3:s.exlow=t.fEXlow[h],s.exhigh=t.fEXhigh[h],s.eylow=t.fEYlow[h],s.eyhigh=t.fEYhigh[h];break}h===0&&(this.xmin=this.xmax=s.x,this.ymin=this.ymax=s.y),i>0?(this.xmin=Math.min(this.xmin,s.x-s.exlow,s.x+s.exhigh),this.xmax=Math.max(this.xmax,s.x-s.exlow,s.x+s.exhigh),this.ymin=Math.min(this.ymin,s.y-s.eylow,s.y+s.eyhigh),this.ymax=Math.max(this.ymax,s.y-s.eylow,s.y+s.eyhigh)):(this.xmin=Math.min(this.xmin,s.x),this.xmax=Math.max(this.xmax,s.x),this.ymin=Math.min(this.ymin,s.y),this.ymax=Math.max(this.ymax,s.y))}this.#x=!0,this.xmin===0&&this.ymin===0&&n>0&&this.#t[0].x===0&&this.#t[0].y===0&&e.Mark&&!e.Line&&!e.Curve&&!e.Fill&&(this.#x="upper_layer")}getHistRangeMargin(){return .1}createHistogram(t=!0,e=!0){let i=this.getGraph(),n=this.xmin,h=this.getHistRangeMargin(),s=this.xmax,a=this.ymin,x=this.ymax;n>=s&&(s=n+1),a>=x&&(x=a+1);let l=(s-n)*h,p=(x-a)*h,f=n-l,c=s+l,m=a-p,r=x+p;a>0&&m<=0&&(m=(1-h)*a),x<0&&r>=0&&(r=(1-h)*x);let d=m,y=r,o=this.getHistogram();if(!this.isScatter()&&!o?.fXaxis.fTimeDisplay){let _=this.getPadPainter()?.getPadLog("x");f<0&&n>=0&&(f=_?n*(1-h):0),c>0&&s<=0&&(c=_?(1+h)*s:0)}return o?o.fMaximum!==A&&o.fMinimum!==A&&!this.isDummyHistogram("y")&&(m=o.fMinimum,r=o.fMaximum):(o=this.isScatter()?q(et,30,30):q(tt,100),o.fName=i.fName+"_h",o.fBits|=H,this.#y=!0,this.setHistogram(o)),i.fMinimum!==A&&(m=a=i.fMinimum),i.fMaximum!==A&&(r=i.fMaximum),m<0&&a>=0&&(m=(1-h)*a),x<0&&r>=0&&(r=(1-h)*x),z(o,this.getObject().fTitle),t&&!o.fXaxis.fLabels&&(o.fXaxis.fXmin=f,o.fXaxis.fXmax=c),e&&!o.fYaxis.fLabels&&(o.fYaxis.fXmin=Math.min(d,m),o.fYaxis.fXmax=Math.max(y,r),this.isScatter()||(o.fMinimum=m,o.fMaximum=r)),o.$xmin_nz=n>0?n:void 0,o.$ymin_nz=a>0?a:void 0,o}unzoomUserRange(t,e){let i=this.getGraph();if(this.#y||!i)return!1;let n=this.getHistogram();return t=t&&n&&(n.fXaxis.fXmin>this.xmin||n.fXaxis.fXmax<this.xmax),e=e&&n&&(n.fYaxis.fXmin>this.ymin||n.fYaxis.fXmax<this.ymax),!t&&!e?!1:(this.createHistogram(t,e),this.getMainPainter()?.extractAxesProperties(1),!0)}canOptimize(){return X.OptimizeDraw>0&&!this.getOptions().NoOpt}optimizeBins(t,e){if(this.#t.length<30&&!e)return this.#t;let i=null;if(v(e))for(let s=0;s<this.#t.length;++s)e(this.#t[s],s)?i||(i=s===0?[]:this.#t.slice(0,s)):i&&i.push(this.#t[s]);if(i||(i=this.#t),t||(t=5e5),i.length<t||!this.canOptimize())return i;let n=[],h=Math.max(2,Math.floor(i.length/t));for(let s=0;s<i.length;s+=h)n.push(i[s]);return n}needDrawFunc(t,e){return e._typename===T?e.fName!=="stats"||!t.TestBit(H):e._typename===G||e._typename===L?!e.TestBit(B(9)):!0}getTooltips(t){let e=this.get_fp(),i=[],n=this.getOptions(),h=e.getGrFuncs(n.second_x,n.second_y),s=this.get_gme();if(i.push(this.getObjectHint()),t&&h)if(t.indx!==void 0&&i.push("p = "+t.indx),i.push("x = "+h.axisAsText("x",t.x),"y = "+h.axisAsText("y",t.y)),s?i.push("error x = -"+h.axisAsText("x",s.fExL[t.indx])+"/+"+h.axisAsText("x",s.fExH[t.indx])):n.Errors&&h.x_handle.kind===I&&(t.exlow||t.exhigh)&&i.push("error x = -"+h.axisAsText("x",t.exlow)+"/+"+h.axisAsText("x",t.exhigh)),s)for(let a=0;a<s.fNYErrors;++a)i.push(`error y${a} = -${h.axisAsText("y",s.fEyL[a][t.indx])}/+${h.axisAsText("y",s.fEyH[a][t.indx])}`);else(n.Errors||n.EF>0)&&h.y_handle.kind===I&&(t.eylow||t.eyhigh)&&i.push("error y = -"+h.axisAsText("y",t.eylow)+"/+"+h.axisAsText("y",t.eyhigh));return i}get_fp(){let t=this.getFramePainter();if(t?.grx&&t?.gry)return t;let e=this.getPadPainter(),i=e?.getPadRect()||{width:800,height:600};return t={pad_layer:!0,pad:e?.getRootPad(!0)??N(J),pw:i.width,ph:i.height,fX1NDC:.1,fX2NDC:.9,fY1NDC:.1,fY2NDC:.9,getFrameWidth(){return this.pw},getFrameHeight(){return this.ph},grx(n){return this.pad.fLogx?n=n>0?Math.log10(n):this.pad.fUxmin:n=(n-this.pad.fX1)/(this.pad.fX2-this.pad.fX1),n*this.pw},gry(n){return this.pad.fLogv??this.pad.fLogy?n=n>0?Math.log10(n):this.pad.fUymin:n=(n-this.pad.fY1)/(this.pad.fY2-this.pad.fY1),(1-n)*this.ph},revertAxis(n,h){return n==="x"?h/this.pw*(this.pad.fX2-this.pad.fX1)+this.pad.fX1:n==="y"?(1-h/this.ph)*(this.pad.fY2-this.pad.fY1)+this.pad.fY1:h},getGrFuncs(){return this}},t}appendExclusion(t,e,i,n){let h=[];for(let a=i.length-1;a>=0;--a){let x=i[a],l=Math.sqrt(x.dgrx**2+x.dgry**2);l>1e-10&&(x.grx+=n*x.dgry/l,x.gry-=n*x.dgrx/l),h.push(x)}let s=w(h,{cmd:"L",line:!t});this.appendPath(e+s+"Z").call(this.fillatt.func).style("opacity",.75)}drawBins(t,e,i,n,h,s,a,x){let l=this.getGraph();if(!l?.fNpoints)return;let p=0,f=null,c=!this.isBatchMode()&&(e.Line||e.Errors)?"none":null;if(x&&s.excl_side&&(p=s.excl_width,s.width>0&&!e.Line&&!e.Curve&&(e.Line=1)),e.EF){f=this.optimizeBins(e.EF>1?2e4:0);for(let _=0;_<f.length;++_){let u=f[_];u.grx=t.grx(u.x),u.gry=t.gry(u.y-u.eylow)}let r=w(f,{line:e.EF<2,qubic:!0}),d=[];for(let _=f.length-1;_>=0;--_){let u=f[_];u.gry=t.gry(u.y+u.eyhigh),d.push(u)}let y=w(d,{line:e.EF<2,cmd:"L",qubic:!0}),o=i.append("svg:path").attr("d",r+y+"Z").call(a.func);a.empty()&&a.colorindx&&o.style("stroke",this.getColor(a.colorindx)),x&&(this.#e="lines")}if(e.Line||e.Fill){let r="";this.#o&&(r="Z",e.original||(e.Fill=1)),e.Fill&&(r="Z",p=0),f||(f=this.optimizeBins(0));for(let o=0;o<f.length;++o){let _=f[o];_.grx=t.grx(_.x),_.gry=t.gry(_.y)}let d=w(f,{line:!0,calc:p});p&&this.appendExclusion(!1,d,f,p);let y=i.append("svg:path").attr("d",d+r).style("pointer-events",c);e.Line&&y.call(s.func),e.Fill?y.call(a.func):y.style("fill","none"),x&&(this.#e="lines")}if(e.Curve){let r=f;if(this.#e!=="lines"||!r||e.Curve===1&&r.length>2e4){r=this.optimizeBins(e.Curve===1?2e4:0);for(let y=0;y<r.length;++y){let o=r[y];o.grx=t.grx(o.x),o.gry=t.gry(o.y)}}let d=w(r,{qubic:!p});p&&this.appendExclusion(!0,d,r,p),i.append("svg:path").attr("d",d).call(s.func).style("fill","none").style("pointer-events",c),x&&(this.#e="lines")}let m=null;if((e.Errors||e.Rect||e.Bar)&&(f=this.optimizeBins(5e3,(r,d)=>{let y=t.grx(r.x);if(!e.Bar&&(y<0||y>n))return!0;let o=t.gry(r.y);return!e.Bar&&!e.OutRange&&(o<0||o>h)?!0:(r.grx1=Math.round(y),r.gry1=Math.round(o),this.#m&&(r.grx0=Math.round(t.grx(r.x-e.ScaleErrX*r.exlow)-y),r.grx2=Math.round(t.grx(r.x+e.ScaleErrX*r.exhigh)-y),r.gry0=Math.round(t.gry(r.y-r.eylow)-o),r.gry2=Math.round(t.gry(r.y+r.eyhigh)-o),this.#d?(r.grdx0=Math.round(t.gry(r.y+l.fEXlowd[d])-o),r.grdx2=Math.round(t.gry(r.y+l.fEXhighd[d])-o),r.grdy0=Math.round(t.grx(r.x+l.fEYlowd[d])-y),r.grdy2=Math.round(t.grx(r.x+l.fEYhighd[d])-y)):r.grdx0=r.grdx2=r.grdy0=r.grdy2=0),!1)}),x&&(this.#e="nodes"),m=i.selectAll(".grpoint").data(f).enter().append("svg:g").attr("class","grpoint").attr("transform",r=>R(r.grx1,r.gry1))),e.Bar){let r=0,d=0;for(let g=0;g<f.length;++g)g===0?r=d=f[g].grx1:(r=Math.min(r,f[g].grx1),d=Math.max(d,f[g].grx1));let y=f.length<2?n/4:(d-r)/f.length,o=y*P.fBarWidth,_=y*P.fBarOffset,u=Math.round(t.gry(0)),k=a;if(x){let g=this.getFramePainter(),E=g?.fillatt?.empty()?-1:g.fillatt.getFillColor();E===a.getFillColor()&&(k=this.createAttFill({color:E==="white"?C:it,pattern:1001,std:!1}))}m.append("svg:path").attr("d",g=>{g.bar=!0;let E=o>1?Math.round(_-o/2):0,$=o>1?Math.round(o):1,M=e.Bar!==1?0:g.gry1>u?u-g.gry1:0,b=e.Bar!==1?h>g.gry1?h-g.gry1:0:Math.abs(u-g.gry1);return`M${E},${M}h${$}v${b}h${-$}z`}).call(k.func),this.#u=o,this.#p=_}if(e.Rect&&m.filter(r=>r.exlow>0&&r.exhigh>0&&r.eylow>0&&r.eyhigh>0).append("svg:path").attr("d",r=>(r.rect=!0,`M${r.grx0},${r.gry0}H${r.grx2}V${r.gry2}H${r.grx0}Z`)).call(a.func).call(e.Rect===2?s.func:()=>{}),this.error_size=0,e.Errors){let r=s.width+P.fEndErrorSize,d=e.Ends?`m0,${r}v${-2*r}`:"",y=e.Ends?`m${r},0h${-2*r}`:"",o=d,_=d,u=y,k=y,g,E=(M,b)=>{if(!e.MainError)return`M${M},${b}`;let Y="M0,0";return M?Y+(b?`L${M},${b}`:`H${M}`):b?Y+`V${b}`:Y};switch(e.Ends){case 2:g=Math.max(s.width+1,Math.round(r*.66)),o=`m${g},${r}h${-g}v${-2*r}h${g}`,_=`m${-g},${r}h${g}v${-2*r}h${-g}`,u=`m${-r},${g}v${-g}h${2*r}v${g}`,k=`m${-r},${-g}v${g}h${2*r}v${-g}`;break;case 3:r=Math.max(r,Math.round(l.fMarkerSize*8*.66)),g=Math.max(s.width+1,Math.round(r*.66)),o=`l${g},${r}v${-2*r}l${-g},${r}`,_=`l${-g},${r}v${-2*r}l${g},${r}`,u=`l${-r},${g}h${2*r}l${-r},${-g}`,k=`l${-r},${-g}h${2*r}l${-r},${g}`;break;case 4:r=Math.max(r,Math.round(l.fMarkerSize*8*.66)),g=Math.max(s.width+1,Math.round(r*.66)),o=`l${g},${r}m0,${-2*r}l${-g},${r}`,_=`l${-g},${r}m0,${-2*r}l${g},${r}`,u=`l${-r},${g}m${2*r},0l${-r},${-g}`,k=`l${-r},${-g}m${2*r},0l${-r},${g}`;break}this.error_size=r,r=Math.floor((s.width-1)/2);let $=m.filter(M=>M.exlow>0||M.exhigh>0||M.eylow>0||M.eyhigh>0);(e.skip_errors_x0||e.skip_errors_y0)&&($=$.filter(M=>(M.x||!e.skip_errors_x0)&&(M.y||!e.skip_errors_y0))),!this.isBatchMode()&&X.Tooltip&&x&&$.append("svg:path").attr("d",M=>`M${M.grx0},${M.gry0}h${M.grx2-M.grx0}v${M.gry2-M.gry0}h${M.grx0-M.grx2}z`).style("fill","none").style("pointer-events","visibleFill"),$.append("svg:path").attr("d",M=>(M.error=!0,(M.exlow>0?E(M.grx0+r,M.grdx0)+o:"")+(M.exhigh>0?E(M.grx2-r,M.grdx2)+_:"")+(M.eylow>0?E(M.grdy0,M.gry0-r)+k:"")+(M.eyhigh>0?E(M.grdy2,M.gry2+r)+u:""))).style("fill","none").call(s.func)}if(e.Mark){this.createAttMarker({attr:l,style:e.Mark-100}),this.#r=this.markeratt.getFullSize(),this.markeratt.resetPos();let r=!this.isBatchMode()&&X.Tooltip&&(!this.markeratt.fill||this.#r<7)&&!m&&x,d=Math.max(5,Math.round(this.#r*.7)),y=1e6/(this.markeratt.getMarkerLength()+7),o="",_,u,k,g="",E=1;f?this.canOptimize()&&f.length>1.5*y&&(E=Math.min(2,Math.round(f.length/y))):f=this.optimizeBins(y);for(let $=0;$<f.length;$+=E)_=f[$],u=t.grx(_.x),u>-this.#r&&u<n+this.#r&&(k=t.gry(_.y),k>-this.#r&&k<h+this.#r&&(o+=this.markeratt.create(u,k),r&&(g+=`M${u-d},${k-d}h${2*d}v${2*d}h${-2*d}z`)));o&&(i.append("svg:path").attr("d",o).call(this.markeratt.func),m===null&&this.#e==="none"&&x&&(this.#e=e.Mark===101?"path":"mark")),r&&g&&i.append("svg:path").attr("d",g).style("fill","none").style("pointer-events","visibleFill")}}appendQQ(t,e){let i=Math.max(t.scale_xmin,e.fXq1),n=Math.min(t.scale_xmax,e.fXq2),h=Math.max(t.scale_ymin,e.fYq1),s=Math.min(t.scale_ymax,e.fYq2),a=(m,r,d,y)=>`M${t.grx(m)},${t.gry(r)}L${t.grx(d)},${t.gry(y)}`,x=(e.fYq2-e.fYq1)*(t.scale_xmin-e.fXq1)/(e.fXq2-e.fXq1)+e.fYq1,l=(e.fYq2-e.fYq1)*(t.scale_xmax-e.fXq1)/(e.fXq2-e.fXq1)+e.fYq1,p;if(x<t.scale_ymin){let m=(e.fXq2-e.fXq1)*(t.scale_ymin-e.fYq1)/(e.fYq2-e.fYq1)+e.fXq1;p=a(m,t.scale_ymin,i,h)}else p=a(t.scale_xmin,x,i,h);if(l>t.scale_ymax){let m=(e.fXq2-e.fXq1)*(t.scale_ymax-e.fYq1)/(e.fYq2-e.fYq1)+e.fXq1;p+=a(n,s,m,t.scale_ymax)}else p+=a(n,s,t.scale_xmax,l);let f=this.createAttLine({style:1,width:1,color:C,std:!1}),c=this.createAttLine({style:2,width:1,color:C,std:!1});this.appendPath(a(i,h,n,s)).call(f.func).style("fill","none"),this.appendPath(p).call(c.func).style("fill","none")}drawBins3D(){console.log("Load ./hist/TGraphPainter.mjs to draw graph in 3D")}createGraphDrawAttributes(t){let e=this.getGraph(),i=this.getOptions();if(i._pfc>1||i._plc>1||i._pmc>1){let n=this.getPadPainter();if(v(n?.getAutoColor)){let h=n.getAutoColor(e.$num_graphs);this.#s="",i._pfc>1&&(i._pfc=1,e.fFillColor=h,this.#s+=`SetFillColor(${h});;`,this.deleteAttr("fill")),i._plc>1&&(i._plc=1,e.fLineColor=h,this.#s+=`SetLineColor(${h});;`,this.deleteAttr("line")),i._pmc>1&&(i._pmc=1,e.fMarkerColor=h,this.#s+=`SetMarkerColor(${h});;`,this.deleteAttr("marker"))}}t?this.deleteAttr():(this.createAttLine({attr:e,can_excl:!0,color0:i.graphLineColor,width:i.graphLineWidth}),this.createAttFill({attr:e,color:i.graphFillColor,pattern:i.graphFillPattern}))}drawGraph(){let t=this.get_fp(),e=this.getGraph(),i=this.getOptions();if(!t)return;if(i.pos3d)return this.drawBins3D(t,e);let n=!!this.get_gme(),h=t.getGrFuncs(i.second_x,i.second_y),s=h.getFrameWidth(),a=h.getFrameHeight(),x=this.createG(t.pad_layer?!1:this.#x);this.createGraphDrawAttributes(),this.fillatt.used=!1,this.#e="none",this.#r=0;let l=n?x.append("svg:g"):x;if(this.drawBins(h,i,l,s,a,this.lineatt,this.fillatt,!0),e._typename==="TGraphQQ"&&this.appendQQ(h,e),n){let p=f=>{this.#t?.forEach(c=>{c.eylow=e.fEyL[f][c.indx],c.eyhigh=e.fEyH[f][c.indx]})};for(let f=0;f<e.fNYErrors;++f){let c=i.individual_styles?this.createAttLine({attr:e.fAttLine[f],std:!1}):this.lineatt,m=i.individual_styles?this.createAttFill({attr:e.fAttFill[f],std:!1}):this.fillatt,r=x.append("svg:g"),d=f<i.blocks.length?i.blocks[f]:i;p(f),this.drawBins(h,d,r,s,a,c,m)}p(0)}this.isBatchMode()||(st(this,this.testEditable()),nt(this,at))}extractTooltip(t){if(!t)return null;if(this.#e==="lines"||this.#e==="path"||this.#e==="mark")return this.extractTooltipForPath(t);if(this.#e!=="nodes")return null;let e=this.get_fp(),i=this.getOptions(),n=e.getFrameHeight(),h=this.#u,s=this.#p,a=this.error_size,x=i.Bar===1,l=x?e.getGrFuncs(i.second_x,i.second_y):null,p=this.#r?Math.round(this.#r/2+1.5):0,f=null,c=1e10,m=null;if(this.getG().selectAll(".grpoint").each(function(){let o=S(this).datum();if(o===void 0)return;let _=(t.x-o.grx1)**2;if(t.nproc===1&&(_+=(t.y-o.gry1)**2),_>=c)return;let u;if(o.error||o.rect||o.marker)u={x1:Math.min(-a,o.grx0,-p),x2:Math.max(a,o.grx2,p),y1:Math.min(-a,o.gry2,-p),y2:Math.max(a,o.gry0,p)};else if(o.bar){if(u={x1:s-h/2,x2:s+h/2,y1:0,y2:n-o.gry1},x){let E=l.gry(0);u.y1=o.gry1>E?E-o.gry1:0,u.y2=o.gry1>E?0:E-o.gry1}}else u={x1:-5,x2:5,y1:-5,y2:5};let k=t.x>=o.grx1+u.x1&&t.x<=o.grx1+u.x2,g=t.y>=o.gry1+u.y1&&t.y<=o.gry1+u.y2;k&&(g||t.nproc>1)&&(c=_,f=this,m=u,m.exact=g)}),f===null)return null;let r=S(f).datum(),d=this.getGraph(),y={name:d.fName,title:d.fTitle,x:r.grx1,y:r.gry1,color1:this.lineatt.color,lines:this.getTooltips(r),rect:m,d3bin:f};return y.user_info={obj:d,name:d.fName,bin:r.indx,cont:r.y,grx:r.grx1,gry:r.gry1},this.fillatt?.used&&!this.fillatt?.empty()&&(y.color2=this.fillatt.getFillColor()),m.exact&&(y.exact=!0),y.menu=y.exact,y.menu_dist=3,y.bin=r,y.binindx=r.indx,y}showTooltip(t){let e=this.getG()?.selectChild(".tooltip_bin");if(!t||!this.getG()){e?.remove();return}if(t.usepath)return this.showTooltipForPath(t);let i=S(t.d3bin).datum();e.empty()&&(e=this.getG().append("svg:rect").attr("class","tooltip_bin").style("pointer-events","none").call(D)),t.changed=e.property("current_bin")!==t.d3bin,t.changed&&e.attr("x",i.grx1+t.rect.x1).attr("width",t.rect.x2-t.rect.x1).attr("y",i.gry1+t.rect.y1).attr("height",t.rect.y2-t.rect.y1).style("opacity","0.3").property("current_bin",t.d3bin)}processTooltipEvent(t){let e=this.extractTooltip(t);return(!t||!t.disabled)&&this.showTooltip(e),e}findBestBin(t){if(!this.#t)return null;let e=this.#e==="lines",i=this.getOptions(),n=this.get_fp().getGrFuncs(i.second_x,i.second_y),h=-1,s=null,a=1e10,x,l,p,f,c;for(f=0;f<this.#t.length;++f)c=this.#t[f],l=n.grx(c.x),p=n.gry(c.y),x=(t.x-l)**2+(t.y-p)**2,x<a&&(a=x,s=c,h=f);a>100&&e&&(s=null);let m=Math.max(this.lineatt.width+3,4,this.#r);s&&(a=Math.sqrt((t.x-n.grx(s.x))**2+(t.y-n.gry(s.y))**2)),!e&&a>m&&(s=null),s||(h=-1);let r={bin:s,indx:h,dist:a,radius:Math.round(m)};if(!s&&e){a=1e10;let d=(k,g,E)=>g>=k&&k>=E||g<=k&&k<=E,y=this.#t[0],o=n.grx(y.x),_,u;for(f=1;f<this.#t.length;++f)c=this.#t[f],l=n.grx(c.x),d(t.x,o,l)&&(_=n.gry(y.y),p=n.gry(c.y),Math.abs(l-o)<1?(u=t.y,x=d(t.y,_,p)?0:Math.min(Math.abs(t.y-_),Math.abs(t.y-p))):(u=_+(t.x-o)/(l-o)*(p-_),x=Math.abs(u-t.y)),x<a&&(a=x,r.linex=t.x,r.liney=u)),y=c,o=l;a<m*.5&&(r.linedist=a,r.closeline=!0)}return r}testEditable(t){let e=this.getGraph();return v(e?.TestBit)?((t==="toggle"||t!==void 0)&&e.SetBit(Z,!t),!e.TestBit(Z)):!1}extractTooltipForPath(t){if(!this.#t)return null;let e=this.findBestBin(t);if(!e||!e.bin&&!e.closeline)return null;let i=this.#e==="lines",n=this.#e==="mark",h=this.get_fp(),s=this.getOptions(),a=h.getGrFuncs(s.second_x,s.second_y),x=this.getGraph(),l={name:x.fName,title:x.fTitle,x:e.bin?a.grx(e.bin.x):e.linex,y:e.bin?a.gry(e.bin.y):e.liney,color1:this.lineatt.color,lines:this.getTooltips(e.bin),usepath:!0,ismark:n,islines:i};return l.user_info={obj:x,name:x.fName,bin:0,cont:0,grx:l.x,gry:l.y},e.closeline?(l.menu=l.exact=!0,l.menu_dist=e.linedist):e.bin&&(s.EF&&i?(l.gry1=a.gry(e.bin.y-e.bin.eylow),l.gry2=a.gry(e.bin.y+e.bin.eyhigh)):l.gry1=l.gry2=a.gry(e.bin.y),l.binindx=e.indx,l.bin=e.bin,l.radius=e.radius,l.user_info.bin=e.indx,l.user_info.cont=e.bin.y,l.exact=Math.abs(t.x-l.x)<=e.radius&&(Math.abs(t.y-l.gry1)<=e.radius||Math.abs(t.y-l.gry2)<=e.radius),l.menu=l.exact,l.menu_dist=Math.sqrt((t.x-l.x)**2+Math.min(Math.abs(t.y-l.gry1),Math.abs(t.y-l.gry2))**2)),this.fillatt?.used&&!this.fillatt?.empty()&&(l.color2=this.fillatt.getFillColor()),i||(l.color1=this.getColor(x.fMarkerColor),l.color2||(l.color2=l.color1)),l}showTooltipForPath(t){let e=this.getG()?.selectChild(".tooltip_bin");if(!t?.bin||!this.getG()){e?.remove();return}if(e.empty()&&(e=this.getG().append("svg:g").attr("class","tooltip_bin")),t.changed=e.property("current_bin")!==t.bin,t.changed)if(e.selectAll("*").remove(),e.property("current_bin",t.bin),t.ismark)e.append("svg:rect").style("pointer-events","none").call(D).style("opacity","0.3").attr("x",Math.round(t.x-t.radius)).attr("y",Math.round(t.y-t.radius)).attr("width",2*t.radius).attr("height",2*t.radius);else{e.append("svg:circle").attr("cy",Math.round(t.gry1)),Math.abs(t.gry1-t.gry2)>1&&e.append("svg:circle").attr("cy",Math.round(t.gry2));let i=this.getOptions(),n=e.selectAll("circle").attr("r",t.radius).attr("cx",Math.round(t.x));t.islines?(i.Line||i.Curve?n.call(this.lineatt.func):n.style("stroke","black"),i.Fill?n.call(this.fillatt.func):n.style("fill","none")):n.style("stroke",t.color1==="black"?"green":"black").style("fill","none")}}moveEnabled(){return this.testEditable()}moveStart(t,e,i){let n=this.getOptions();this.#h=this.#l=0,this.#i=this.get_fp().getGrFuncs(n.second_x,n.second_y);let h=i?.shiftKey?null:this.extractTooltip({x:t,y:e});h?.exact&&h.binindx!==void 0?(this.#n=h.binindx,this.#a=h.bin,this.#_=this.#i.grx(this.#a.x),this.#M=this.#i.gry(this.#a.y)):this.#n=void 0}moveDrag(t,e){this.#h+=t,this.#l+=e,this.#n===void 0?R(this.getG(),this.#h,this.#l):this.#i&&this.#a&&(this.#a.x=this.#i.revertAxis("x",this.#_+this.#h),this.#a.y=this.#i.revertAxis("y",this.#M+this.#l),this.drawGraph())}moveEnd(t){let e=this.getGraph(),i=e?.fNpoints-1,n="",h=s=>{n+=`SetPoint(${s.indx},${s.x},${s.y});;`,e.fX[s.indx]=s.x,e.fY[s.indx]=s.y,s.indx===0&&this.#g&&(n+=`SetPoint(${i},${s.x},${s.y});;`,e.fX[i]=s.x,e.fY[i]=s.y)};if(this.#n===void 0){if(this.getG().attr("transform",null),this.#i&&this.#t&&!t){for(let s=0;s<this.#t.length;++s){let a=this.#t[s];a.x=this.#i.revertAxis("x",this.#i.grx(a.x)+this.#h),a.y=this.#i.revertAxis("y",this.#i.gry(a.y)+this.#l),h(a)}e.$redraw_pad?this.redrawPad():this.drawGraph()}}else h(this.#a),this.#n=void 0,e.$redraw_pad&&this.redrawPad();this.#i=void 0,n&&!t&&this.submitCanvExec(n)}fillWebObjectOptions(t){this.#s&&t&&(t.fcust="auto_exec:"+this.#s,this.#s=void 0)}fillContextMenuItems(t){this.hasSnapId()||(t.addchk(this.testEditable(),"Editable",()=>{this.testEditable("toggle"),this.drawGraph()}),this.axes_draw&&t.add("Title",()=>t.input("Enter graph title",this.getObject().fTitle).then(e=>{this.getObject().fTitle=e;let i=this.getMainPainter();i?.isSecondary(this)&&(z(i.getHisto(),e),this.interactiveRedraw("pad"))})),t.addRedrawMenu(this.getPrimary()))}executeMenuCommand(t,e){if(super.executeMenuCommand(t,e))return!0;let i=this.getCanvPainter(),n=this.get_fp();if(t.fName==="RemovePoint"||t.fName==="InsertPoint"){if(!i||i.isReadonly())return!0;let h=v(n?.getLastEventPos)?n.getLastEventPos():null,s=this.extractTooltip(h);if(t.fName==="InsertPoint"){if(h){let a=this.getOptions(),x=n.getGrFuncs(a.second_x,a.second_y),l=x.revertAxis("x",h.x)??0,p=x.revertAxis("y",h.y)??0;this.submitCanvExec(`AddPoint(${l.toFixed(3)}, ${p.toFixed(3)})`,t.$execid)}}else t.$execid&&s?.binindx!==void 0&&this.submitCanvExec(`RemovePoint(${s.binindx})`,t.$execid);return!0}return!1}_updateMembers(t,e){t.fBits=e.fBits,t.fTitle=e.fTitle,t.fX=e.fX,t.fY=e.fY,["fEX","fEY","fExL","fExH","fEXlow","fEXhigh","fEYlow","fEYhigh","fEXlowd","fEXhighd","fEYlowd","fEYhighd"].forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t.fNpoints=e.fNpoints,t.fMinimum=e.fMinimum,t.fMaximum=e.fMaximum;let i=this.getOptions();return this.hasSnapId()&&(i._pfc=i._plc=i._pmc=0),i._pfc||(t.fFillColor=e.fFillColor),t.fFillStyle=e.fFillStyle,i._plc||(t.fLineColor=e.fLineColor),t.fLineStyle=e.fLineStyle,t.fLineWidth=e.fLineWidth,i._pmc||(t.fMarkerColor=e.fMarkerColor),t.fMarkerSize=e.fMarkerSize,t.fMarkerStyle=e.fMarkerStyle,e.fFunctions}updateObject(t,e){if(!this.matchObjectType(t))return!1;let i=this.getOptions();e&&e!==i.original&&this.decodeOptions(e);let n=this._updateMembers(this.getObject(),t);if(this.createBins(),this.#f=void 0,this.axes_draw){let h=this.createHistogram(),s=this.getMainPainter();s?.isSecondary(this)&&(s.updateObject(h,i.Axis),this.#f=!0)}return this.#c=new W(this,this.getPadPainter(),n),!0}canZoomInside(t,e,i){let n=this.getGraph();if(!n||t!=="x"&&t!=="y")return!1;let h=n.fX;if(this.isScatter())h=t==="x"?n.fX:n.fY;else if(t!==(this.getOptions().pos3d?"y":"x"))return!1;for(let s=0;s<n.fNpoints;++s)if(e<h[s]&&h[s]<i)return!0;return!1}clickButton(t){return t!=="ToggleZoom"||this.xmin===this.xmax&&this.ymin===this.ymax?!1:this.getFramePainter()?.zoom(this.xmin,this.xmax,this.ymin,this.ymax)}findFunc(){return this.getGraph()?.fFunctions?.arr?.find(t=>t._typename===G||t._typename===L)}findStat(){return this.getGraph()?.fFunctions?.arr?.find(t=>t._typename===T&&t.fName==="stats")}createStat(){let t=this.findFunc();if(!t)return null;let e=this.findStat();if(e)return e;let i=P;return!i.fOptFit||this.getCanvPainter()?.getRootPad(!0)?.fPrimitives?.arr.length?null:(this.create_stats=!0,e=N(T),Object.assign(e,{fName:"stats",fOptStat:0,fOptFit:i.fOptFit,fBorderSize:1,fX1NDC:i.fStatX-i.fStatW,fY1NDC:i.fStatY-i.fStatH,fX2NDC:i.fStatX,fY2NDC:i.fStatY,fFillColor:i.fStatColor,fFillStyle:i.fStatStyle}),e.fTextAngle=0,e.fTextSize=i.fStatFontSize,e.fTextAlign=12,e.fTextColor=i.fStatTextColor,e.fTextFont=i.fStatFont,e.AddText(t.fName),this.getGraph().fFunctions.Add(e),e)}fillStatistic(t,e,i){let n=this.findFunc();return!n||!i?!1:(t.clearPave(),t.fillFunctionStat(n,i===1?111:i,1),!0)}drawAxisHisto(){return F(this,null,function*(){let t=this.isDummyHistogram("x"),e=this.isDummyHistogram("y"),i=this.createHistogram(t,e);return lt.draw(this.getDrawDom(),i,this.getOptions().Axis)})}static _drawGraph(t,e){return F(this,null,function*(){t.decodeOptions(e,!0),t.createBins(),t.createStat();let i=t.getGraph();X.DragGraphs||i?.SetBit(Z,!0);let n=Promise.resolve();return(!t.getMainPainter()||t.options.second_x||t.options.second_y)&&t.options.Axis&&(n=t.drawAxisHisto().then(h=>{h?.setSecondaryId(t,"hist"),t.axes_draw=!!h})),n.then(()=>(t.addToPadPrimitives(),t.drawGraph())).then(()=>new W(t,t.getPadPainter(),i.fFunctions,!0).drawNext(0))})}static draw(t,e,i){return F(this,null,function*(){return U._drawGraph(new U(t,e),i)})}};export{ft as a,ct as b};
