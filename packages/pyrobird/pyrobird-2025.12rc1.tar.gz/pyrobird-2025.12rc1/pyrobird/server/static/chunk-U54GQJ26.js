import{c as R,d as V,e as j,f as I,g as K}from"./chunk-3MJ5AJB7.js";import{d as Z}from"./chunk-STN7OMLL.js";import{h as N}from"./chunk-HB357Z3Y.js";import{a as x,d as G}from"./chunk-S3FA7C5I.js";import{c as A,h as O}from"./chunk-MFPRCIVI.js";import{ba as E,gb as v,u as Y}from"./chunk-MAT3H5WR.js";import{k as F}from"./chunk-KYPE3LET.js";function $(l){let s=l.getHisto(),e=l.getFramePainter(),m=e.z_handle.getScaleMin(),i=e.z_handle.getScaleMax(),c=s.fBins.arr.length,f=e.grz(m),z,g,b,d;l.maxbin=l.gmaxbin,l.minbin=l.gminbin,l.minposbin=l.gminposbin;let W=l.getContour(!0),q=l.getHistPalette();for(b=0;b<c;++b){if(g=s.fBins.arr[b],g.fContent<m||(z=W.getPaletteIndex(q,g.fContent),z===null)||g.fXmin>e.scale_xmax||g.fXmax<e.scale_xmin||g.fYmin>e.scale_ymax||g.fYmax<e.scale_ymin)continue;d=e.grz(g.fContent>i?i:g.fContent);let S=[],k=[],X=1,p=g.fPoly,T=0;p._typename===E&&(X=g.fPoly.fGraphs.arr.length,p=null);for(let u=0;u<X;++u){(!p||u>0)&&(p=g.fPoly.fGraphs.arr[u]);let h=p.fX,w=p.fY,r=p.fNpoints;for(;r>2&&h[0]===h[r-1]&&w[0]===w[r-1];)--r;let a,o;for(let _=0;_<2;++_){let P,D,B,C,L=e.size_x3d*e.size_z3d,Q=_>0?0:L/1e6;a=[],o=null;for(let H=0;H<r;++H)B=e.grx(h[H]),C=e.gry(w[H]),H>0&&(L=(B-P)**2+(C-D)**2),L>Q&&(a.push(new x.Vector2(B,C)),P=B,D=C);try{a.length>2&&(o=x.ShapeUtils.triangulateShape(a,[]))}catch{o=null}if(o&&o.length>a.length-3)break}o?.length&&a&&(S.push(a),k.push(o),T+=o.length*2,d>f&&(T+=a.length*2))}let n=new Float32Array(T*9),t=0;for(let u=0;u<S.length;++u){let h=S[u],w=k[u];for(let r=0;r<2;++r)for(let a=0;a<w.length;++a){let o=w[a],_=h[o[0]],P=h[o[r===0?2:1]],D=h[o[r===0?1:2]];n[t]=_.x,n[t+1]=_.y,n[t+2]=r?d:f,t+=3,n[t]=P.x,n[t+1]=P.y,n[t+2]=r?d:f,t+=3,n[t]=D.x,n[t+1]=D.y,n[t+2]=r?d:f,t+=3}if(d>f)for(let r=0;r<h.length;++r){let a=h.at(r),o=h.at(r>0?r-1:-1);n[t]=a.x,n[t+1]=a.y,n[t+2]=f,t+=3,n[t]=o.x,n[t+1]=o.y,n[t+2]=f,t+=3,n[t]=o.x,n[t+1]=o.y,n[t+2]=d,t+=3,n[t]=a.x,n[t+1]=a.y,n[t+2]=f,t+=3,n[t]=o.x,n[t+1]=o.y,n[t+2]=d,t+=3,n[t]=a.x,n[t+1]=a.y,n[t+2]=d,t+=3}}let M=new x.BufferGeometry;M.setAttribute("position",new x.BufferAttribute(n,3)),M.computeVertexNormals();let J=new x.MeshBasicMaterial(G(l.getHistPalette()?.getColor(z),{vertexColors:!1,side:x.DoubleSide})),y=new x.Mesh(M,J);e.add3DMesh(y),y.painter=l,y.bins_index=b,y.draw_z0=f,y.draw_z1=d,y.tip_color=65280,y.tooltip=function(){let u=this.painter,h=u.getObject().fBins.arr[this.bins_index];return{use_itself:!0,x1:e.grx(h.fXmin),x2:e.grx(h.fXmax),y1:e.gry(h.fYmin),y2:e.gry(h.fYmax),z1:this.draw_z0,z2:this.draw_z1,bin:this.bins_index,value:g.fContent,color:this.tip_color,lines:u.getPolyBinTooltips(this.bins_index)}}}}var U=class l extends Z{checkRangeFor3D(s){let e=this.getPadPainter()?.getRootPad(!0),m=e?.fLogv??e?.fLogz,i=1;return s.ohmin&&s.ohmax?(this.zmin=s.hmin,this.zmax=s.hmax):s.minimum!==v&&s.maximum!==v?(this.zmin=s.minimum,this.zmax=s.maximum):(this.draw_content||this.gmaxbin)&&(this.zmin=m?this.gminposbin*.3:this.gminbin,this.zmax=this.gmaxbin,i=1+2*Y.fHistTopMargin),m&&this.zmin<=0&&(this.zmin=this.zmax*1e-5),this.createHistDrawAttributes(!0),i}draw3DBins(s){this.isTH2Poly()?$(this):s.Contour?I(this,!0):s.Surf?K(this):s.Error?j(this):V(this)}draw3D(s){return F(this,null,function*(){this.mode3d=!0;let e=this.getFramePainter(),m=this.isMainPainter(),i=this.getOptions(),c=Promise.resolve(!0),f=!0;if(s==="resize"){let z=m?e.resize3D():!1;z!==1&&(f=!1,z&&e.render3D())}return f&&(i.zmult=this.checkRangeFor3D(i),m&&(c=R(this,A,i.Render3D)),e.mode3d&&(c=c.then(()=>{this.draw_content?this.draw3DBins(i):i.Axis&&i.Zscale&&(this.getContourLevels(!0),this.getHistPalette()),e.render3D(),this.updateStatWebCanvas(),e.addKeysHandler()}))),m&&(c=c.then(()=>this.drawColorPalette(i.Zscale&&(i.Lego===12||i.Lego===14||i.Surf===11||i.Surf===12)))),c.then(()=>this.updateFunctions()).then(()=>this.updateHistTitle()).then(()=>this)})}static build3d(s,e,m){return F(this,null,function*(){let i=new l(null,s);i.decodeOptions(e);let c=i.getOptions();i.isTH2Poly()&&(c.Lego=12),i.scanContent(),c.zmult=i.checkRangeFor3D(c);let f=new O(null,null);return i.getFramePainter=()=>f,R(i,A).then(()=>(i.draw_content&&i.draw3DBins(c),m?i:f.create3DScene(-1,!0)))})}static draw(s,e,m){return F(this,null,function*(){return N._drawHist(new l(s,e),m)})}};export{U as a};
