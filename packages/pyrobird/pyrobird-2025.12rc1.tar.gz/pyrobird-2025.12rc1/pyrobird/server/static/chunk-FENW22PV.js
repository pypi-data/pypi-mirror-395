import{c as kt}from"./chunk-K2P6CES6.js";import{b as It}from"./chunk-LNTKXTVM.js";import{c as Ht,e as Et}from"./chunk-MFPRCIVI.js";import{j as Rt,o as Bt}from"./chunk-SVHROGNI.js";import{H as ct,L as Ot,O as et,P as Xt,Q as Ft,aa as Lt,b as bt,e as j,f as dt,ka as At,ta as St}from"./chunk-DLJYFRIS.js";import{Ba as _t,e as Pt,f as G,fb as Yt,g as H,ia as Ct,ja as Q,jb as Dt,ka as tt,la as rt,ma as lt,n as wt,na as ht,oa as nt,pa as V,q as zt,ra as Z,t as W,ta as U,u,va as ft,x as yt,y as mt,za as vt}from"./chunk-MAT3H5WR.js";import{k as I}from"./chunk-KYPE3LET.js";var Gt=yt(17),jt="postitle",Wt="autoplace",Vt="brNDC";function qt(q){let e=(t,i)=>Math.abs(t-i)<.001;return e(q.fX1NDC,u.fStatX-u.fStatW)&&e(q.fY1NDC,u.fStatY-u.fStatH)&&e(q.fX2NDC,u.fStatX)&&e(q.fY2NDC,u.fStatY)}var Zt=class q extends At{#i;#a;#e;#t;#r;#n;#s;constructor(e,t,i){super(e,t,i),this.Enabled=!0,this.UseContextMenu=!0}autoPlaceLegend(e,t,i){return I(this,null,function*(){let n=this.getPadPainter().getFrameSvg().selectChild(".main_layer").node().outerHTML;n=Ot(n),n=`<svg xmlns="${Yt}"`+n.slice(4);let r=t?.fLeftMargin??u.fPadLeftMargin,o=t?.fRightMargin??u.fPadRightMargin,h=t?.fTopMargin??u.fPadTopMargin,a=t?.fBottomMargin??u.fPadBottomMargin;return Ft(n).then(s=>{if(!s)return!1;let d=100,p=100,x=s.getContext("2d"),c=x.getImageData(0,0,s.width,s.height).data,D=Math.floor(s.width/d),$=Math.floor(s.height/p),w=new Array(d*p);c.length!==s.width*s.height*4&&(console.log(`Image size missmatch in TLegend autoplace ${c.length} expected ${s.width*s.height*4}`),d=p=0);for(let l=0;l<d;++l){let P=l*D,g=P+D;for(let S=0;S<p;++S){let z=S*$,N=z+$,v=0;for(let L=P;L<g&&!v;++L)for(let M=z;M<N;++M){let C=(M*s.width+L)*4;if(c[C]||c[C+1]||c[C+2]||c[C+3]){v=1;break}}w[S*d+l]=v}}let m=.3/Math.max(.2,1-r-o),T=Math.min(.5,Math.max(.1,e.fPrimitives.arr.length*.05))/Math.max(.2,1-h-a),b=Math.round(m*d),O=Math.round(T*p),y=(l,P)=>{for(let g=l;g<l+b;++g)for(let S=P;S<P+O;++S)if(w[S*d+g])return!1;return!0};for(let l=0;l<d-b;++l)for(let P=p-O-1;P>=0;--P)if(y(l,P))return e.fX1NDC=r+l/d*(1-r-o),e.fX2NDC=e.fX1NDC+m*(1-r-o),e.fY2NDC=1-h-P/p*(1-a-h),e.fY1NDC=e.fY2NDC-T*(1-a-h),!0}).then(s=>{if(s||i)return s;e.fX1NDC=Math.max(r??0,e.fX2NDC-.3),e.fX2NDC=Math.min(e.fX1NDC+.3,1-o);let d=Math.max(e.fPrimitives?e.fPrimitives.arr.length*.05:0,.2);return e.fY2NDC=Math.min(1-h,e.fY1NDC+d),e.fY1NDC=Math.max(e.fY2NDC-d,a),!0})})}getPaveDrawOption(){let e=this.getDrawOpt();return(this.isStats()||!e)&&(e=this.getObject()?.fOption),e||Vt}setPaveDrawOption(e){this.isStats()?this.getObject().fOption=e:this.storeDrawOpt(e)}drawPave(e){return I(this,null,function*(){if(!this.Enabled)return this.removeG(),this;let t=this.getObject(),i=this.getPaveDrawOption().toUpperCase(),f=this.getFramePainter(),n=this.getPadPainter(),r=n.getRootPad(!0),o,h,a;t.fInit===0&&(this.stored=Object.assign({},t),t.fInit=1,t._typename===Z&&!t.fX1&&!t.fX2&&!t.fY1&&!t.fY2?f?(t.fX1NDC=f.fX2NDC+.01,t.fX2NDC=Math.min(.96,f.fX2NDC+.06),t.fY1NDC=f.fY1NDC,t.fY2NDC=f.fY2NDC):(t.fX2NDC=.8,t.fX1NDC=.9,t.fY1NDC=.1,t.fY2NDC=.9):t.fOption.indexOf("NDC")>=0?(t.fX1NDC<1e-20&&t.fX2NDC<1e-20&&(t.fX1NDC=t.fX1,t.fX2NDC=t.fX2),t.fY1NDC<1e-20&&t.fY2NDC<1e-20&&(t.fY1NDC=t.fY1,t.fY2NDC=t.fY2)):r&&r.fX1===0&&r.fX2===1&&r.fY1===0&&r.fY2===1&&H(e)&&e.indexOf("postpone")>=0?(t.fInit=0,t.fX1NDC=t.fY1NDC=.99,t.fX2NDC=t.fY2NDC=1):r?(r.fLogx&&(t.fX1>0&&(t.fX1=Math.log10(t.fX1)),t.fX2>0&&(t.fX2=Math.log10(t.fX2))),r.fLogy&&(t.fY1>0&&(t.fY1=Math.log10(t.fY1)),t.fY2>0&&(t.fY2=Math.log10(t.fY2))),t.fX1NDC=(t.fX1-r.fX1)/(r.fX2-r.fX1),t.fY1NDC=(t.fY1-r.fY1)/(r.fY2-r.fY1),t.fX2NDC=(t.fX2-r.fX1)/(r.fX2-r.fX1),t.fY2NDC=(t.fY2-r.fY1)/(r.fY2-r.fY1)):(t.fX1NDC=t.fY1NDC=.1,t.fX2NDC=t.fY2NDC=.9));let s=Promise.resolve(!0);return t._typename===V&&(this.AutoPlace||t.fX1NDC===t.fX2NDC&&t.fY1NDC===t.fY2NDC)&&(s=this.autoPlaceLegend(t,r).then(d=>(delete this.AutoPlace,d||(t.fX1NDC=f.fX2NDC-.2,t.fX2NDC=f.fX2NDC,t.fY1NDC=f.fY2NDC-.1,t.fY2NDC=f.fY2NDC),d))),s.then(()=>{if(this.isStats()&&!this.NoFillStats&&!n.isFastDrawing()){let m=t.$main_painter||this.getMainPainter();if(G(m?.fillStatistic)){let T=t.fOptStat,b=t.fOptFit;if((t.TestBit(Gt)||!Number.isInteger(T))&&(T=u.fOptStat),(t.TestBit(Gt)||!Number.isInteger(b))&&(b=u.fOptFit),m.fillStatistic(this,T,b)){let O=t.fLines?.arr.length||0,y=O>0&&!this.moved_interactive&&qt(t),l=this.#r&&this.#n>1?u.fStatH:0;l&&(O-=this.#s);let P=u.fStatH,g=u.fStatW;this.#r&&(g=1.8*u.fStatW),u.fStatFontSize<=0||u.fStatFont%10===3?P=O*.25*u.fStatH:u.fStatFontSize<1&&(P=O*u.fStatFontSize),y?(t.fX1NDC=Math.max(.005,t.fX2NDC-g),t.fY1NDC=Math.max(.005,t.fY2NDC-P-l)):(t.fY1NDC>t.fY2NDC&&(t.fY2NDC=Math.min(.995,t.fY1NDC+P+l)),t.fX1NDC>t.fX2NDC&&(t.fY2NDC=Math.min(.995,t.fX1NDC+g)))}}}let d=n.getPadRect(),p=t.fBorderSize,x=i.indexOf("NB")>=0,c=i.indexOf("L")>=0?-1:i.indexOf("R")>=0?1:0,D=i.indexOf("T")>=0?-1:i.indexOf("B")>=0?1:0,$=this.createG();this.#i=Math.round(t.fX1NDC*d.width),this.#a=Math.round((1-t.fY2NDC)*d.height),h=Math.round((t.fX2NDC-t.fX1NDC)*d.width),a=Math.round((t.fY2NDC-t.fY1NDC)*d.height);let w=i.indexOf("ARC")>=0&&t.fCornerRadius>0?Math.round(Math.min(h,a)*t.fCornerRadius):0;if(et($,this.#i,this.#a),this.createAttLine({attr:t,width:p>0?t.fLineWidth:0}),this.createAttFill({attr:t}),this.fillatt.empty()&&w&&this.fillatt.setSolidColor(this.getColor(t.fFillColor)||"white"),t._typename===nt){let m=Math.round(a/2),T=Math.round(h/2),b=`l${T},${-m}l${T},${m}l${-T},${m}z`;this.fillatt.empty()||this.drawBorder($,h,a,0,b),o=$.append("svg:path").attr("d","M0,"+m+b).call(this.fillatt.func).call(this.lineatt.func);let O=$.append("svg:g");return et(O,Math.round(h/4),Math.round(a/4)),this.drawPaveText(T,m,e,O)}if(t.fNpaves)for(let m=t.fNpaves-1;m>0;--m)$.append("svg:path").attr("d",`M${c*4*m},${D*4*m}h${h}v${a}h${-h}z`).call(this.fillatt.func).call(this.lineatt.func);else this.drawBorder($,h,a,w);switch((!this.isBatchMode()||!this.fillatt.empty()||!this.lineatt.empty()&&!x)&&(w?o=$.append("svg:rect").attr("width",h).attr("height",a).attr("rx",w):o=$.append("svg:path").attr("d",`M0,0H${h}V${a}H0Z`),o.call(this.fillatt.func),x||o.call(this.lineatt.func)),t._typename){case lt:case ht:return this.drawPaveLabel(h,a,e);case tt:return this.drawPaveStats(h,a,e);case Q:case rt:case nt:return this.drawPaveText(h,a,e);case V:return this.drawLegend(h,a,e);case Z:return this.drawPaletteAxis(h,a,e)}}).then(()=>this.isBatchMode()||t._typename===Ct?this:(o?.style("pointer-events","visibleFill").on("mouseenter",()=>this.showObjectStatus()),Et(this,{obj:t,x:this.#i,y:this.#a,width:h,height:a,minwidth:10,minheight:20,canselect:!0,ctxmenu:zt.touches&&W.ContextMenu&&this.UseContextMenu,redraw:()=>{this.moved_interactive=!0,this.interactiveRedraw(!1,"pave_moved").then(()=>this.drawPave())}}),this.UseContextMenu&&W.ContextMenu&&this.getG().on("contextmenu",d=>this.paveContextMenu(d)),this.isPalette()&&this.interactivePaletteAxis(h,a),this))})}drawBorder(e,t,i,f,n){let r=this.getObject(),o=this.getPaveDrawOption().toUpperCase().replaceAll("ARC","").replaceAll("NDC",""),h=this.isPalette()||o.indexOf("NB")>=0,a=o.indexOf("L")>=0?-1:o.indexOf("R")>=0?1:0,s=o.indexOf("T")>=0?-1:o.indexOf("B")>=0?1:0;if(r.fBorderSize<2||r.fShadowColor===0||!a&&!s||h)return;let d=this.getColor(r.fShadowColor),p=r.fBorderSize,x=!this.lineatt.empty()&&this.lineatt.width>2?`${this.lineatt.width-1}px`:"1px";if(n)e.append("svg:path").attr("d",`M0,${Math.round(i/2)+p}${n}`).style("fill",d).style("stroke",d).style("stroke-width",x);else if(f)e.append("svg:rect").attr("width",t).attr("height",i).attr("rx",f).attr("x",a*p).attr("y",s*p).style("fill",d).style("stroke",d).style("stroke-width",x);else{let c;a<0&&s<0?c=`M0,0v${i-p-1}h${1-p}v${2-i}h${t-2}v${p-1}z`:a<0&&s>0?c=`M0,${i}v${p+1-i}h${1-p}v${i-2}h${t-2}v${1-p}z`:a>0&&s<0?c=`M${p+1},0v${1-p}h${t-2}v${i-2}h${1-p}v${p+1-i}z`:c=`M${t},${p+1}h${p-1}v${i-2}h${2-t}v${1-p}h${t-p-2}z`,e.append("svg:path").attr("d",c).style("fill",d).style("stroke",d).style("stroke-width",x)}}fillWebObjectOptions(e){let t=this.getObject();return t?.fInit&&(e.fcust="pave",e.fopt=[t.fX1NDC,t.fY1NDC,t.fX2NDC,t.fY2NDC],t.fName==="stats"&&this.isStats()&&t.fLines.arr.forEach(i=>{(i._typename===U||i._typename===ft)&&(e.fcust+=`;;${i.fTitle}`)})),e}drawPaveLabel(e,t){return I(this,null,function*(){let i=this.getObject();return!i.fLabel||!i.fLabel.trim()?this:(this.createAttText({attr:i,can_rotate:!1}),this.startTextDrawingAsync(this.textatt.font,t/1.2).then(()=>this.drawText(this.textatt.createArg({width:e,height:t,text:i.fLabel,norotate:!0}))).then(()=>this.finishTextDrawing()))})}drawPaveStats(e,t){let i=this.getObject(),f=[],n=[],r=0,o=0,h=0;for(let x=0;x<i.fLines.arr.length;++x){let c=i.fLines.arr[x];(c._typename===U||c._typename===ft)&&(f.push(c.fTitle),n.push(c.fTextColor))}let a=f.length;for(let x=0;x<a;++x){let c=f[x];if(x>0&&(h=Math.max(h,c.length)),x===0||c.indexOf("|")<0)continue;r===0&&(r=x);let D=c.split("|");D.length>o&&(o=D.length)}let s=t/a,d=i.fMargin*e,p=!1;return this.createAttText({attr:i,can_rotate:!1}),this.startTextDrawingAsync(this.textatt.font,t/(a*1.2)).then(()=>{if(a===1)this.drawText(this.textatt.createArg({width:e,height:t,text:f[0],latex:1,norotate:!0}));else for(let c=0;c<a;++c){let D=c*s,$=n[c]>1?this.getColor(n[c]):this.textatt.color;if(r&&c>=r){let w=f[c].split("|");for(let m=0;m<w.length;++m)this.drawText({align:"middle",x:e*m/o,y:D,latex:0,width:e/o,height:s,text:w[m],color:$})}else if(f[c].indexOf("=")<0){if(c===0){p=!0;let w=Math.max(h,Math.round((e-2*d)/s/.65));f[c].length>w+5&&(f[c]=f[c].slice(0,w+2)+"...")}this.drawText({align:c===0?"middle":"start",x:d,y:D,width:e-2*d,height:s,text:f[c],color:$})}else{let w=f[c].split("="),m=[];for(let T=0;T<2;++T){let b={align:T===0?"start":"end",x:d,y:D,width:e-2*d,height:s,text:T>0?w[T].trimStart():w[T].trimEnd(),color:$,_expected_width:e-2*d,_args:m,post_process(O){this._args[0].ready&&this._args[1].ready&&O.scaleTextDrawing(1.05*(this._args[0].result_width+this._args[1].result_width)/this._expected_width,O.getG())}};m.push(b)}for(let T=0;T<2;++T)this.drawText(m[T])}}let x="";if(i.fBorderSize>0&&p&&(x+=`M0,${Math.round(s)}h${e}`),r>0&&o>1){for(let c=r;c<a;++c)x+=`M0,${Math.round(c*s)}h${e}`;for(let c=0;c<o-1;++c)x+=`M${Math.round(e/o*(c+1))},${Math.round(r*s)}V${t}`}return x&&this.appendPath(x).call(this.lineatt.func),this.finishTextDrawing(void 0,a>1)})}drawPaveText(e,t,i,f){return I(this,null,function*(){let n=this.getObject(),r=n.fLines?.arr||[],o=r.length,h=this.getPadPainter(),a=h.getPadHeight(),s=n.fLabel.length,d=[],p=n.fMargin*e,x=t/(o||1),c=.85*x,D=0;this.createAttText({attr:n,can_rotate:!1}),o===1&&this.textatt.size>0&&(D=Math.max(3,this.textatt.getSize(h))),f||(f=this.getG());let $=o===1&&h.isFastDrawing(),w=0,m=0,T=0,b=0;return r.forEach(y=>{y._typename!==U&&y._typename!==ft||!y.fTitle?.trim()||(w++,(y.fX||y.fY||y.fTextSize)&&m++,!y.fTextSize&&!this.textatt.size&&(T=Math.max(T,Lt(y.fTitle,this.textatt.font,c))))}),T&&(b=c,T>.92*e&&(b*=.92*e/T),b=Math.round(b)),(w>m?this.startTextDrawingAsync(this.textatt.font,this.$postitle?this.textatt.getSize(h,1,.05):c,f,D):Promise.resolve()).then(()=>{for(let y=0;y<o;++y){let l=r[y],P=y*x;switch(l._typename){case U:case ft:{if(!l.fTitle||!l.fTitle.trim())continue;let g=l.fTextColor?this.getColor(l.fTextColor):"";g||(g=this.textatt.color);let S=l.fTextAlign||this.textatt.align,z=S%10,N=(S-z)/10;if(l.fX||l.fY||l.fTextSize){let v=l.fX?l.fX*e:N===1?p:N===2?e/2:e-p,L=l.fY?(1-l.fY)*t:P+(z===2?x/2:z===3?x:0),M=f.append("svg:g");d.push(this.startTextDrawingAsync(this.textatt.font,this.textatt.getAltSize(l.fTextSize,h)||b,M).then(()=>this.drawText({align:S,x:v,y:L,text:l.fTitle,color:g,latex:l._typename===U?0:1,draw_g:M,fast:$})).then(()=>this.finishTextDrawing(M)))}else{let v={x:0,y:P,draw_g:f,latex:l._typename===U?0:1,text:l.fTitle,color:g,fast:$};this.$postitle?v.post_process=function(L){L.$titlebox=this.box}:(v.align=S,v.x=N===1?p:0,v.width=N===2?e:e-p,v.y=P+.05*x,v.height=.9*x),this.drawText(v)}break}case vt:{let g=l.fX1?Math.round(l.fX1*e):0,S=l.fX2?Math.round(l.fX2*e):e,z=l.fY1?Math.round((1-l.fY1)*t):Math.round(P+x*.5),N=l.fY2?Math.round((1-l.fY2)*t):Math.round(P+x*.5),v=this.createAttLine(l);f.append("svg:path").attr("d",`M${g},${z}L${S},${N}`).call(v.func);break}case _t:{let g=l.fX1?Math.round(l.fX1*e):0,S=l.fX2?Math.round(l.fX2*e):e,z=l.fY1?Math.round((1-l.fY1)*t):Math.round(P),N=l.fY2?Math.round((1-l.fY2)*t):Math.round(P+x),v=this.createAttFill(l);f.append("svg:path").attr("d",`M${g},${z}H${S}V${N}H${g}Z`).call(v.func);break}}}return w>m&&d.push(this.finishTextDrawing(f,w>m+1)),this.isTitle()&&this.getG().style("display",w?null:"none"),Promise.all(d).then(()=>this)}).then(()=>{if(!s)return;let y=Math.round(e*.5),l=Math.round(a*.04),P=f.append("svg:g");return et(P,Math.round(e*.25),Math.round(-a*.02)),this.drawBorder(P,y,l),P.append("svg:path").attr("d",`M0,0h${y}v${l}h${-y}z`).call(this.fillatt.func).call(this.lineatt.func),this.startTextDrawingAsync(this.textatt.font,.9*l,P).then(()=>this.drawText({align:22,x:0,y:0,width:y,height:l,text:n.fLabel,color:this.textatt.color,draw_g:P})).then(()=>d.push(this.finishTextDrawing(P)))}).then(()=>this)})}format(e,t){t||(t="stat");let i=this.getObject();switch(t){case"stat":t=i.fStatFormat||u.fStatFormat;break;case"fit":t=i.fFitFormat||u.fFitFormat;break;case"entries":if(Math.abs(e)<1e9&&Math.round(e)===e)return e.toFixed(0);t="14.7g";break}return ct(e,t||"6.4g")}drawLegend(e,t){let i=this.getObject(),f=i.fPrimitives.arr.length,n=Math.max(1,i.fNColumns),r=Math.round(f/n),o=!1,h=!1;r*n<f&&r++;let a=g=>!g.fObject&&!g.fOption&&(!g.fLabel||!g.fLabel.trim());for(let g=0;g<f;++g){let S=i.fPrimitives.arr[g];a(S)?n===1&&r--:S.fLabel&&(o=!0,(S.fTextFont&&S.fTextFont!==i.fTextFont||S.fTextSize&&S.fTextSize!==i.fTextSize)&&(h=!0))}r<1&&(r=1);let s=Math.round(.03*e/n),d=Math.round(.03*t),p=(t-2*d)/(r+(r-1)*i.fEntrySeparation),x=p*i.fEntrySeparation,c=s,D=(e-2*s-(n-1)*c)/n;i.fColumnSeparation&&(D=(e-2*s)/(n+(n-1)*i.fColumnSeparation),c=D*i.fColumnSeparation);let $=new Array(n+1).fill(s),w=D*i.fMargin;if(n>1){let g=new Array(n).fill(1),S=e-2*s-(n-1)*c-n*w;for(let N=0;N<f;++N){let v=i.fPrimitives.arr[N];if(a(v))continue;let L=N%n;g[L]=Math.max(g[L],v.fLabel.length)}let z=0;for(let N=0;N<n;++N)z+=g[N];for(let N=0;N<n-1;++N)$[N+1]=$[N]+w+g[N]/z*S+c}$[n]=e-s;let m=p,T=0,b=!1;this.createAttText({attr:i,can_rotate:!1});let O=this.getPadPainter(),y=this.textatt.getSize(O);y&&y<m&&(m=T=y);let l=[];return(o&&!h?this.startTextDrawingAsync(this.textatt.font,m,void 0,T):Promise.resolve()).then(()=>{for(let g=0,S=-1;g<f;++g){let z=i.fPrimitives.arr[g];if(a(z))continue;n===1?++S:S=g;let N=z.fOption.toLowerCase(),v=S%n,L=(S-v)/n,M=Math.round($[v]),C=Math.round(d+L*(p+x)),_=Math.round(M+w),F=Math.round(M+(w-s)/2),K=Math.round(C+p*.1),J=Math.round(p*.8),E=Math.round(C+p*.5),k=z.fObject,Ut=N.indexOf("f")!==-1,ut=N.indexOf("l")!==-1,pt=N.indexOf("e")!==-1,Nt=N.indexOf("p")!==-1,Tt=z,Mt=z,xt=z,A=null,ot=!1;if(Pt(k)&&("fLineColor"in k&&(xt=k),"fFillColor"in k&&(Tt=k),"fMarkerColor"in k&&(Mt=k),A=O.findPainterFor(k)),Ut){let R=A?.fillatt?.used?A.fillatt:this.createAttFill(Tt),X;!ut&&!pt&&!Nt&&(X=A?.lineatt?.used?A.lineatt:this.createAttLine(xt),X.empty()&&(X=null)),(!R.empty()||X)&&(ot=!0,this.appendPath(`M${M},${K}v${J}h${_-s-M}v${-J}z`).call(R.func).call(X?X.func:()=>{}))}if(ut||pt){let R=A?.lineatt?.used?A.lineatt:this.createAttLine(xt);if(!R.empty()&&(ot=!0,ut&&this.appendPath(`M${M},${E}h${_-s-M}`).call(R.func),pt)){let X=0,Y=p*.05;G(A?.getHisto)&&A.options?.ErrorKind===1?X=1:G(A?.getGraph)&&k?.fLineWidth!==void 0&&k?.fMarkerSize!==void 0&&(X=A.options?.Ends??1,Y=k.fLineWidth+u.fEndErrorSize,X>1&&(Y=Math.max(Y,k.fMarkerSize*8*.66)));let $t=X===3?.2:0,it=Math.round(C+p*$t),at=Math.round(C+p*(1-$t)),B=Math.round(Y*.66);Y=Math.round(Y);let st=`M${F},${it}V${at}`;switch(X){case 1:st+=`M${F-Y},${it}h${2*Y}M${F-Y},${at}h${2*Y}`;break;case 2:st+=`M${F-Y},${it+B}v${-B}h${2*Y}v${B}M${F-Y},${at-B}v${B}h${2*Y}v${-B}`;break;case 3:st+=`M${F-Y},${it}h${2*Y}l${-Y},${-B}zM${F-Y},${at}h${2*Y}l${-Y},${B}z`;break;case 4:st+=`M${F-Y},${it+B}l${Y},${-B}l${Y},${B}M${F-Y},${at-B}l${Y},${B}l${Y},${-B}`;break}this.appendPath(st).call(R.func).style("fill",X>1?"none":null)}}if(Nt){let R=A?.markeratt?.used?A.markeratt:this.createAttMarker(Mt);R.empty()||(ot=!0,this.appendPath(R.create(F,E)).call(R.func))}!ot&&A?.lineatt&&!A.lineatt.empty()&&this.appendPath(`M${M},${K}v${J}h${_-s-M}v${-J}z`).style("fill","none").call(A.lineatt.func);let gt=_;if(H(N)&&N.toLowerCase()!=="h"?b=!0:b||(gt=M),z.fLabel){let R=this.createAttText({attr:z,std:!1,attr_alt:i}),X={draw_g:this.getG(),align:R.align,x:gt,width:Math.round($[v+1]-gt),y:C,height:Math.round(p),scale:h&&!z.fTextSize||!i.fTextSize,text:z.fLabel,color:R.color};h?(X.draw_g=this.getG().append("svg:g"),l.push(this.startTextDrawingAsync(R.font,R.getSize(O),X.draw_g,T).then(()=>this.drawText(X)).then(()=>this.finishTextDrawing(X.draw_g)))):this.drawText(X)}}return o&&!h&&l.push(this.finishTextDrawing()),Promise.all(l)})}isPaletteVertical(){return this.#e}drawPaletteAxis(e,t,i){let f=this.getObject(),n=f.fAxis,r=this.getG(),o=H(i)&&i.indexOf("can_move")>=0,h=H(i)&&i.indexOf("postpone")>=0,a=H(i)&&i.indexOf("cjust")>=0,s=H(i)&&i.indexOf("bring_stats_front")>=0,d=this.getPadPainter(),p=d.getPadWidth(),x=d.getPadHeight(),c=d.getRootPad(!0),D=f.$main_painter||this.getMainPainter(),$=this.getFramePainter(),w=D.getContour(!1),m=w?.getLevels(),T=G(D.getDimension)&&D.getDimension()===3,b=G(D.getZaxis),O=c?.fLogv??(T?!1:c?.fLogz),y=D.getHistPalette(),l=b?D.getZaxis():D.getObject()?.fZaxis,P=c?.fTickz?.35:.7,g=0,S=100,z,N,v,L=0;if(this.#e=f.fX2NDC-f.fX1NDC<f.fY2NDC-f.fY1NDC,n.fTickSize=.03,typeof l?.fLabelOffset<"u"&&!T&&(n.fBits=l.fBits&~St.kTickMinus&~St.kTickPlus,n.fTitle=l.fTitle,n.fTickSize=l.fTickLength,n.fTitleSize=l.fTitleSize,n.fTitleOffset=l.fTitleOffset,n.fTextColor=l.fTitleColor,n.fTextFont=l.fTitleFont,n.fLineColor=l.fAxisColor,n.fLabelSize=l.fLabelSize,n.fLabelColor=l.fLabelColor,n.fLabelFont=l.fLabelFont,n.fLabelOffset=l.fLabelOffset,this.z_handle.setHistPainter(D,b?"hist#z":"z"),this.z_handle.source_axis=l),w&&$&&!T?$.zmin!==void 0&&$.zmax!==void 0&&$.zmin!==$.zmax?(z=$.zmin,N=$.zmax,g=$.zoom_zmin,S=$.zoom_zmax,g===S&&(g=z,S=N)):(g=m.at(0),S=m.at(-1)):D.gmaxbin!==void 0&&D.gminbin!==void 0?(g=D.gminbin,S=D.gmaxbin):D.hmin!==void 0&&D.hmax!==void 0&&(g=D.hmin,S=D.hmax),r.selectAll("rect").style("fill","white"),(z===void 0||N===void 0||z===N)&&(z=g,N=S),this.#e?(this.#t=f.fX2NDC<.5,n.fChopt="S+"+(this.#t?"R":"L"),this.z_handle.configureAxis("zaxis",z,N,g,S,!0,[0,t],{log:O,fixed_ticks:a?m:null,maxTickSize:Math.round(e*P),swap_side:this.#t,minposbin:D.gminposbin}),v=this.#t?null:`translate(${e})`,c?.fTickz&&(L=this.#t?e:-e)):(this.#t=f.fY1NDC>.5,n.fChopt="S+",this.z_handle.configureAxis("zaxis",z,N,g,S,!1,[0,e],{log:O,fixed_ticks:a?m:null,maxTickSize:Math.round(t*P),swap_side:this.#t,minposbin:D.gminposbin}),v=this.#t?null:`translate(0,${t})`,c?.fTickz&&(L=this.#t?t:-t)),!w||!y||h)this.appendPath(`M0,0H${e}V${t}H0Z`).style("fill","white");else for(let M=0;M<m.length-1;++M){let C=Math.round(this.z_handle.gr(m[M])),_=Math.round(this.z_handle.gr(m[M+1])),F=.5,K;if(this.#e){if(_>=t||C<0)continue;C+=1,C>t?(C>_+1&&(F=.5*(t-_)/(C-_-1)),C=t,_<0&&(_=0)):_<0&&(C>1&&(F=1-.5*C/(C-_-1)),_=0),K=`M0,${_}H${e}V${C}H0Z`}else{if(C>=e||_<0)continue;_+=1,_>e?(_>C+1&&(F=1-.5*(e-C)/(_-C-1)),_=e,C<0&&(C=0)):C<0&&(_>1&&(F=.5*(_-1)/(_-C-1)),C=0),K=`M${C},0V${t}H${_}V0Z`}let J=m[M]*F+m[M+1]*(1-F),E=w.getPaletteColor(y,J);if(!E)continue;let k=this.appendPath(K).style("fill",E).property("fill0",E).property("fill1",bt(E).darker(.5).formatRgb());this.isBatchMode()||(this.isTooltipAllowed()&&k.on("mouseover",function(){j(this).transition().duration(100).style("fill",j(this).property("fill1"))}).on("mouseout",function(){j(this).transition().duration(100).style("fill",j(this).property("fill0"))}).append("svg:title").text(this.z_handle.axisAsText(m[M])+" - "+this.z_handle.axisAsText(m[M+1])),W.Zooming&&k.on("dblclick",()=>this.getFramePainter().unzoomSingle("z")))}return s&&this.getPadPainter()?.findPainterFor(null,"",tt)?.bringToFront(),this.z_handle.drawAxis(r,e,t,v,L).then(()=>{let M;if(o)if(W.ApproxTextSize||wt()){M={x:this.#i,y:this.#a,width:e,height:t};let C=this.z_handle.labelsFont?.size||14;if(this.#e){let _=(this.z_handle._maxlbllen||3)*.6*C;M.width+=_,this.#t&&(M.x-=_)}else M.height+=C,this.#t&&(M.y-=C)}else"getBoundingClientRect"in r.node()&&(M=r.node().getBoundingClientRect());if(!M)return this;if(this.#e){let C=this.#i+parseInt(M.width)-Math.round(.995*p)+3;C>0&&(this.#i-=C,et(r,this.#i,this.#a),f.fX1NDC-=C/p,f.fX2NDC-=C/p)}else{let C=Math.round((1.05-u.fTitleY)*x)-M.y;C>0&&(this.#a+=C,et(r,this.#i,this.#a),f.fY1NDC-=C/x,f.fY2NDC-=C/x)}return this})}interactivePaletteAxis(e,t){let i=!1,f=0,n=0,r=null,o=s=>{if(!i)return;s.preventDefault();let d=dt(s,this.getG().node());this.#e?(n=Math.min(Math.max(d[1],0),t),r.attr("y",Math.min(f,n)).attr("height",Math.abs(n-f))):(n=Math.min(Math.max(d[0],0),e),r.attr("x",Math.min(f,n)).attr("width",Math.abs(n-f)))},h=s=>{if(!i)return;s.preventDefault(),j(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null),r.remove(),r=null,i=!1;let d=this.z_handle.revertPoint(f),p=this.z_handle.revertPoint(n);this.getFramePainter().zoomSingle("z",Math.min(d,p),Math.max(d,p),!0)},a=s=>{if(i)return;i=!0,s.preventDefault(),s.stopPropagation();let d=dt(s,this.getG().node());r=this.getG().append("svg:rect").attr("id","colzoomRect").call(Xt,!0),this.#e?(f=n=d[1],r.attr("x","0").attr("width",e).attr("y",f).attr("height",1)):(f=n=d[0],r.attr("x",f).attr("width",1).attr("y",0).attr("height",t)),j(window).on("mousemove.colzoomRect",o).on("mouseup.colzoomRect",h,!0)};W.Zooming&&this.getG().selectAll(".axis_zoom").on("mousedown",a).on("dblclick",()=>this.getFramePainter().zoomSingle("z",0,0,!0)),W.ZoomWheel&&this.getG().on("wheel",s=>{let d=dt(s,this.getG().node()),p=this.#e?1-d[1]/t:d[0]/e,x=this.z_handle.analyzeWheelEvent(s,p);x?.changed&&this.getFramePainter().zoomSingle("z",x.min,x.max,!0)})}fillContextMenuItems(e){let t=this.getObject(),i=this.isStats()?"SetOption":"SetDrawOption";e.sub("Shadow"),e.addSizeMenu("size",0,12,1,t.fBorderSize,a=>{t.fBorderSize=a,this.interactiveRedraw(!0,`exec:SetBorderSize(${a})`)}),e.addColorMenu("color",t.fShadowColor,a=>{t.fShadowColor=a,this.interactiveRedraw(!0,Rt(a,"SetShadowColor"))});let f=["nb","tr","tl","br","bl"],n="",r=this.getPaveDrawOption(),o=r;f.forEach(a=>{let s=o.indexOf(a);s>=0&&!n&&(n=a,o=o.slice(0,s)+o.slice(s+a.length))}),e.addSelectMenu("positon",f,n||"nb",a=>{a+=o,this.setPaveDrawOption(a),this.interactiveRedraw(!0,`exec:${i}("${a}")`)},"Direction of pave shadow or nb - off"),e.endsub(),e.sub("Corner");let h=r.toLowerCase().indexOf("arc");if(e.addchk(h>=0,"arc",a=>{a?r+=" arc":r=r.slice(0,h)+r.slice(h+3),this.setPaveDrawOption(r),this.interactiveRedraw(!0,`exec:${i}("${r}")`)},"Usage of ARC draw option"),e.addSizeMenu("radius",0,.2,.02,t.fCornerRadius,a=>{t.fCornerRadius=a,this.interactiveRedraw(!0,`exec:SetCornerRadius(${a})`)},"Corner radius when ARC is enabled"),e.endsub(),(this.isStats()||this.isPaveText()||this.isPavesText())&&(e.add("Label",()=>e.input("Enter new label",t.fLabel).then(a=>{t.fLabel=a,this.interactiveRedraw("pad",`exec:SetLabel("${a}")`)})),e.addSizeMenu("Margin",0,.2,.02,t.fMargin,a=>{t.fMargin=a,this.interactiveRedraw(!0,`exec:SetMargin(${a})`)})),this.isStats()){e.add("Default position",()=>{t.fX2NDC=u.fStatX,t.fX1NDC=t.fX2NDC-u.fStatW,t.fY2NDC=u.fStatY,t.fY1NDC=t.fY2NDC-u.fStatH,t.fInit=1,this.interactiveRedraw(!0,"pave_moved")}),e.add("Save to gStyle",()=>{u.fStatX=t.fX2NDC,u.fStatW=t.fX2NDC-t.fX1NDC,u.fStatY=t.fY2NDC,u.fStatH=t.fY2NDC-t.fY1NDC,this.fillatt?.saveToStyle("fStatColor","fStatStyle"),u.fStatTextColor=t.fTextColor,u.fStatFontSize=t.fTextSize,u.fStatFont=t.fTextFont,u.fFitFormat=t.fFitFormat,u.fStatFormat=t.fStatFormat,u.fOptStat=t.fOptStat,u.fOptFit=t.fOptFit},"Store stats attributes to gStyle"),e.separator(),e.add("SetStatFormat",()=>{e.input("Enter StatFormat",t.fStatFormat).then(s=>{s&&(t.fStatFormat=s,this.interactiveRedraw(!0,`exec:SetStatFormat("${s}")`))})}),e.add("SetFitFormat",()=>{e.input("Enter FitFormat",t.fFitFormat).then(s=>{s&&(t.fFitFormat=s,this.interactiveRedraw(!0,`exec:SetFitFormat("${s}")`))})}),e.sub("SetOptStat",()=>{e.input("Enter OptStat",t.fOptStat,"int").then(s=>{t.fOptStat=s,this.interactiveRedraw(!0,`exec:SetOptStat(${s})`)})});let a=(s,d)=>{let p=s<10?t.fOptStat:t.fOptFit;p=parseInt(parseInt(p)/parseInt(Math.pow(10,s%10)))%10,e.addchk(p,d,p*100+s,x=>{let c=parseInt(x/100),D=x%100<10?t.fOptStat:t.fOptFit;D-=(c>0?c:-1)*parseInt(Math.pow(10,x%10)),x%100<10?(t.fOptStat=D,this.interactiveRedraw(!0,`exec:SetOptStat(${D})`)):(t.fOptFit=D,this.interactiveRedraw(!0,`exec:SetOptFit(${D})`))})};a(0,"Histogram name"),a(1,"Entries"),a(2,"Mean"),a(3,"Std Dev"),a(4,"Underflow"),a(5,"Overflow"),a(6,"Integral"),a(7,"Skewness"),a(8,"Kurtosis"),e.endsub(),e.sub("SetOptFit",()=>{e.input("Enter OptStat",t.fOptFit,"int").then(s=>{t.fOptFit=s,this.interactiveRedraw(!0,`exec:SetOptFit(${s})`)})}),a(10,"Fit parameters"),a(11,"Par errors"),a(12,"Chi square / NDF"),a(13,"Probability"),e.endsub(),e.separator()}else this.isPaveText()||this.isPavesText()?(this.isPavesText()&&e.addSizeMenu("Paves",1,10,1,t.fNpaves,a=>{t.fNpaves=a,this.interactiveRedraw(!0,`exec:SetNpaves(${a})`)}),this.isTitle()&&(e.add("Default position",()=>{t.fX1NDC=u.fTitleW>0?u.fTitleX-u.fTitleW/2:u.fPadLeftMargin,t.fY1NDC=u.fTitleY-Math.min(u.fTitleFontSize*1.1,.06),t.fX2NDC=u.fTitleW>0?u.fTitleX+u.fTitleW/2:1-u.fPadRightMargin,t.fY2NDC=u.fTitleY,t.fInit=1,this.interactiveRedraw(!0,"pave_moved")}),e.add("Save to gStyle",()=>{u.fTitleX=(t.fX2NDC+t.fX1NDC)/2,u.fTitleY=t.fY2NDC,this.fillatt?.saveToStyle("fTitleColor","fTitleStyle"),u.fTitleTextColor=t.fTextColor,u.fTitleFontSize=t.fTextSize,u.fTitleFont=t.fTextFont},"Store title position and graphical attributes to gStyle"))):t._typename===V&&(e.sub("Legend"),e.add("Autoplace",()=>{this.autoPlaceLegend(t,this.getPadPainter()?.getRootPad(!0),!0).then(a=>{a&&this.interactiveRedraw(!0,"pave_moved")})}),e.addSizeMenu("Entry separation",0,1,.1,t.fEntrySeparation,a=>{t.fEntrySeparation=a,this.interactiveRedraw(!0,`exec:SetEntrySeparation(${a})`)},"Vertical entries separation, meaningful values between 0 and 1"),e.addSizeMenu("Columns separation",0,1,.1,t.fColumnSeparation,a=>{t.fColumnSeparation=a,this.interactiveRedraw(!0,`exec:SetColumnSeparation(${a})`)},"Horizontal columns separation, meaningful values between 0 and 1"),e.addSizeMenu("Num columns",1,7,1,t.fNColumns,a=>{t.fNColumns=a,this.interactiveRedraw(!0,`exec:SetNColumns(${a})`)},"Number of columns in the legend"),e.endsub())}paveContextMenu(e){if(this.z_handle){let t=this.getFramePainter();G(t?.showContextMenu)&&t.showContextMenu("pal",e)}else Bt(e,this)}isStats(){return this.matchObjectType(tt)}isPaveText(){return this.matchObjectType(Q)}isPavesText(){return this.matchObjectType(rt)}isPalette(){return this.matchObjectType(Z)}isTitle(){return this.isPaveText()&&this.getObject()?.fName===Dt}clearPave(){this.getObject().Clear()}addText(e){this.getObject().AddText(e)}getBestFormat(e,t){let i=e.indexOf("e"),f=e.indexOf(".");return i>=0?e.indexOf("+")<0||t>=1?`.${i-f-1}e`:".1f":f<0?".1f":`.${e.length-f-1}f`}fillFunctionStat(e,t,i=1){if(this.#r=t&&e,!this.#r)return!1;this.#n=i,this.#s=0;let f=i===1?t%10:1,n=i===1?Math.floor(t/10)%10:1,r=i===1?Math.floor(t/100)%10:1,o=i===1?Math.floor(t/1e3)%10:0;if(r&&(this.addText("#chi^{2} / ndf = "+this.format(e.fChisquare,"fit")+" / "+e.fNDF),this.#s++),o&&(this.addText("Prob = "+this.format(kt(e.fChisquare,e.fNDF))),this.#s++),f)for(let h=0;h<e.GetNumPars();++h){let a=e.GetParName(h),s=e.GetParValue(h),d=e.GetParError(h);s===void 0?(s="<not avail>",d=null):(s=this.format(Number(s),"fit"),n&&d!==void 0&&(d=ct(d,this.getBestFormat(s,d)),!Number(d)&&e.GetParError(h)&&(d=ct(e.GetParError(h),"4.2g")))),n&&d?this.addText(`${a} = ${s} #pm ${d}`):this.addText(`${a} = ${s}`),this.#s++}return!0}isDummyPos(e){return e?!e.fInit&&!e.fX1&&!e.fX2&&!e.fY1&&!e.fY2&&!e.fX1NDC&&!e.fX2NDC&&!e.fY1NDC&&!e.fY2NDC:!0}updateObject(e,t){if(!this.matchObjectType(e))return!1;let i=this.getObject(),f=t===Wt;switch(!i.$modifiedNDC&&!this.isDummyPos(e)&&(this.stored&&!e.fInit&&this.stored.fX1===e.fX1&&this.stored.fX2===e.fX2&&this.stored.fY1===e.fY1&&this.stored.fY2===e.fY2?(this.stored.fX1NDC!==e.fX1NDC&&(i.fX1NDC=e.fX1NDC),this.stored.fX2NDC!==e.fX2NDC&&(i.fX2NDC=e.fX2NDC),this.stored.fY1NDC!==e.fY1NDC&&(i.fY1NDC=e.fY1NDC),this.stored.fY2NDC!==e.fY2NDC&&(i.fY2NDC=e.fY2NDC)):(i.fInit=e.fInit,i.fX1=e.fX1,i.fX2=e.fX2,i.fY1=e.fY1,i.fY2=e.fY2,i.fX1NDC=e.fX1NDC,i.fX2NDC=e.fX2NDC,i.fY1NDC=e.fY1NDC,i.fY2NDC=e.fY2NDC),this.stored=Object.assign({},e)),i.fOption=e.fOption,i.fBorderSize=e.fBorderSize,i.fTextColor!==void 0&&e.fTextColor!==void 0&&(i.fTextAngle=e.fTextAngle,i.fTextSize=e.fTextSize,i.fTextAlign=e.fTextAlign,i.fTextColor=e.fTextColor,i.fTextFont=e.fTextFont),e._typename){case nt:case Q:i.fLines=mt(e.fLines);break;case rt:i.fLines=mt(e.fLines),i.fNpaves=e.fNpaves;break;case lt:case ht:i.fLabel=e.fLabel;break;case tt:i.fOptStat=e.fOptStat,i.fOptFit=e.fOptFit;break;case V:{let n=i.fPrimitives;if(i.fPrimitives=e.fPrimitives,i.fNColumns=e.fNColumns,this.AutoPlace=f,n?.arr?.length&&n?.arr?.length===i.fPrimitives?.arr?.length)for(let r=0;r<n.arr.length;++r){let o=n.arr[r].fObject,h=i.fPrimitives.arr[r].fObject;o&&h&&o._typename===h._typename&&o.fName===h.fName&&(i.fPrimitives.arr[r].fObject=o)}return!0}case Z:i.fBorderSize=1,i.fShadowColor=0;break;default:return!1}return this.storeDrawOpt(f?Vt:t),!0}redraw(){return I(this,null,function*(){return this.drawPave()})}cleanup(){this.z_handle?.cleanup(),delete this.z_handle;let e=this.getObject();e&&delete e.$main_painter,super.cleanup()}setTitlePosition(e,t,i){let f=u.fTitleX,n=u.fTitleY,r=u.fTitleAlign%10,o=(u.fTitleAlign-r)/10,h=u.fTitleW,a=u.fTitleH,s=!1;return a<=0&&(i?a=1.1*i/this.getPadPainter().getPadHeight():(a=.05,s=!0)),h<=0&&(t?h=Math.min(.7,.02+t/this.getPadPainter().getPadWidth()):(h=.5,s=!0)),e.fX1NDC=o<2?f:o>2?f-h:f-h/2,e.fY1NDC=r<2?n:r>2?n-a:n-a/2,e.fX2NDC=e.fX1NDC+h,e.fY2NDC=e.fY1NDC+a,e.fInit=1,s}static canDraw(e){let t=e?._typename;return t===Ct||t===lt||t===ht||t===tt||t===Q||t===rt||t===nt||t===V||t===Z}static draw(e,t,i){return I(this,null,function*(){let f=i,n=i===jt,r=i===Wt;(n||r||H(i)&&i.indexOf(";")>=0)&&(i="");let o=new q(e,t,i);return It(o,!1).then(()=>{if(o.isTitle()){let h=o.getPadPainter(),a=h.findPainterFor(null,Dt,Q);a&&a!==o?h.removePrimitive(a):(n||o.isDummyPos(t))&&o.setTitlePosition(t)&&(o.$postitle=!0)}else t._typename===Z?(t.fBorderSize=1,t.fShadowColor=0,t.fAxis&&(t.fAxis.fChopt||(t.fAxis.fChopt="+"),t.fAxis.fNdiv||(t.fAxis.fNdiv=12),t.fAxis.fLabelOffset||(t.fAxis.fLabelOffset=.005)),o.z_handle=new Ht(o.getPadPainter(),t.fAxis,!0),o.UseContextMenu=!0):t._typename===V&&(o.AutoPlace=r);return o.NoFillStats=t.fName!=="stats",o.drawPave(f)}).then(()=>{let h=o.$postitle&&o.$titlebox;return h&&o.setTitlePosition(t,o.$titlebox.width,o.$titlebox.height),delete o.$postitle,delete o.$titlebox,h?o.drawPave(f):o})})}};export{jt as a,Zt as b};
