import{b as O}from"./chunk-JFO4ENDF.js";import{a as _,b as w}from"./chunk-3W3OTHNE.js";import{h as H}from"./chunk-HB357Z3Y.js";import{H as T,na as N,oa as C}from"./chunk-DLJYFRIS.js";import{Pa as h,Va as X,Wa as S,f as v,g as F,hb as d,mb as M,nb as b,t as p,u as P}from"./chunk-MAT3H5WR.js";import{k as y}from"./chunk-KYPE3LET.js";function A(a,e,t,i){let r,l;i>0?(l=Math.log(i),r=t>0?Math.log(t):l-5):(l=-10,r=-15),a.fNbins=e,a.fXbins=new Array(e+1);for(let s=0;s<=e;++s)a.fXbins[s]=Math.exp(r+s/e*(l-r));a.fXmin=Math.exp(r),a.fXmax=Math.exp(l)}function B(a){F(a)||(a="");let e=a.indexOf(";webcanv_hist"),t=!1,i=0;return e>=0&&(t=!0,a=a.slice(0,e)),e=a.indexOf(";force_saved"),e>=0&&(i=2,a=a.slice(0,e)),e=a.indexOf(";prefer_saved"),e>=0&&(i=1,a=a.slice(0,e)),{opt:a,_webcanv_hist:t,_use_saved:i}}var z=class a extends O{#t;#e;#i;#s;setFunc(e){this.#e=e}getObjectName(){return this.#e?.fName??"func"}getClassName(){return this.#e?._typename??X}isTF1(){return!0}isTF12(){return this.getClassName()===S}getPrimaryObject(){return this.#e}updateObject(e){if(!e||this.getClassName()!==e._typename)return!1;delete e.evalPar;let t=this.getHisto();if(this._webcanv_hist){let i=this.getPadPainter()?.findInPrimitives("Func",h);i&&this.updateAxes(t,i,this.getFramePainter())}return this.setFunc(e),this.createTF1Histogram(e,t),this.scanContent(),!0}redraw(e){return!this.#t&&(e==="logx"||e==="zoom")&&(this.createTF1Histogram(this.#e,this.getHisto()),this.scanContent()),super.redraw(e)}createTF1Histogram(e,t){let i=this.getFramePainter(),r=this.getPadPainter()?.getRootPad(!0),l=r?.fLogx,s=i?.getGrFuncs(this.second_x,this.second_y),o=e.fXmin,c=e.fXmax,m=Math.max(e.fNpx,100);if(s?.zoom_xmin!==s?.zoom_xmax){let f=(c-o)/m;o<s.zoom_xmin&&s.zoom_xmin<c&&(o=Math.max(o,s.zoom_xmin-f)),o<s.zoom_xmax&&s.zoom_xmax<c&&(c=Math.min(c,s.zoom_xmax+f))}this.#t=e.fSave.length>3&&(p.PreferSavedPoints||this._use_saved>1);let u=f=>{t.fNcells!==f+2&&(t.fNcells=f+2,t.fArray=new Float32Array(t.fNcells)),t.fArray.fill(0),t.fXaxis.fNbins=f,t.fXaxis.fXbins=[]};if(this.#s=void 0,!this.#t){let f=!1;if(!e.evalPar)try{this.isTF12()?_(e.fF2)?e.evalPar=function(n){return this.fCase?this.fF2.evalPar(n,this.fXY):this.fF2.evalPar(this.fXY,n)}:f=!0:_(e)||(f=!0)}catch{f=!0}u(m),l?A(t.fXaxis,m,o,c):(t.fXaxis.fXmin=o,t.fXaxis.fXmax=c);for(let n=0;n<m&&!f;n++){let x=t.fXaxis.GetBinCenter(n+1),g=0;try{g=e.evalPar(x)}catch{f=!0}f||t.setBinContent(n+1,Number.isFinite(g)?g:0)}f&&(this.#s=!0),f&&e.fSave.length>3&&(this.#t=!0)}if(this.#t){m=e.fSave.length-3;let f=null;if(o=e.fSave[m+1],c=e.fSave[m+2],o===c){let n=this.getMainPainter();v(n?.getHisto)&&(f=n?.getHisto()?.fXaxis)}if(f){u(t.fXaxis.fNbins),Object.assign(t.fXaxis,f);for(let n=0;n<m;++n){let x=e.fSave[n];t.setBinContent(n+1,Number.isFinite(x)?x:0)}}else{u(e.fNpx),t.fXaxis.fXmin=e.fXmin,t.fXaxis.fXmax=e.fXmax;for(let n=0;n<e.fNpx;++n){let x=w(e,t.fXaxis.GetBinCenter(n+1));t.setBinContent(n+1,Number.isFinite(x)?x:0)}}}t.fName="Func",b(t,e.fTitle),t.fMinimum=e.fMinimum,t.fMaximum=e.fMaximum,t.fLineColor=e.fLineColor,t.fLineStyle=e.fLineStyle,t.fLineWidth=e.fLineWidth,t.fFillColor=e.fFillColor,t.fFillStyle=e.fFillStyle,t.fMarkerColor=e.fMarkerColor,t.fMarkerStyle=e.fMarkerStyle,t.fMarkerSize=e.fMarkerSize,t.fBits|=d}extractAxesProperties(e){super.extractAxesProperties(e);let t=this.#e,i=t?.fSave.length??0;i>3&&this.#t&&(this.xmin=Math.min(this.xmin,t.fSave[i-2]),this.xmax=Math.max(this.xmax,t.fSave[i-1])),t&&(this.xmin=Math.min(this.xmin,t.fXmin),this.xmax=Math.max(this.xmax,t.fXmax))}canZoomInside(e,t,i){let r=this.#e?.fSave.length??0;if(r>3&&this.#t&&e==="x"){let l=r-2,s=this.#e.fSave[r-2],o=this.#e.fSave[r-1];return Math.abs(o-s)/l<Math.abs(i-t)}return e==="x"||e==="y"}getTF1Tooltips(e){this.#i=void 0;let t=[this.getObjectHint()],i=this.getOptions(),r=this.getFramePainter()?.getGrFuncs(i.second_x,i.second_y);if(!r||!v(this.#e?.evalPar))return t.push("grx = "+e.x,"gry = "+e.y),t;let l=r.revertAxis("x",e.x),s=0,o=0,c=!1;try{s=this.#e.evalPar(l),o=Math.round(r.gry(s))}catch{c=!0}return t.push("x = "+r.axisAsText("x",l),"value = "+(c?"<fail>":T(s,P.fStatFormat))),c||(this.#i={y:s,gry:o}),t}processTooltipEvent(e){if(this.#t)return super.processTooltipEvent(e);let t=this.getG()?.selectChild(".tooltip_bin");if(!this.getG()||!e)return t?.remove(),null;let i={name:this.#e?.fName,title:this.#e?.fTitle,x:e.x,y:e.y,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getTF1Tooltips(e),exact:!0,menu:!0};return e.disabled?t.remove():(t.empty()&&(t=this.getG().append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").style("fill","none").attr("r",(this.lineatt?.width??1)+4)),t.attr("cx",e.x).attr("cy",this.#i?.gry??e.y),this.lineatt&&t.call(this.lineatt.func)),i}fillWebObjectOptions(e){e.fcust=this.#s&&!this._use_saved?"func_fail":""}static draw(e,t,i){return y(this,null,function*(){let r=B(i);i=r.opt,delete r.opt;let l;r._webcanv_hist&&(l=N(e)?.findInPrimitives("Func",h)),l||(l=M(h,100),l.fBits|=d),!i&&C(e)&&(i="same");let s=new a(e,l);return s.setFunc(t),Object.assign(s,r),s.createTF1Histogram(t,l),H._drawHist(s,i)})}};export{A as a,B as b,z as c};
