import{a as q}from"./chunk-FXELJSYA.js";import{a as Z}from"./chunk-SPM2GRPV.js";import{e as K,f as A,g as J,l as U,m as Q,n as W,q as X,s as b,t as Y}from"./chunk-RHEMMLWD.js";import{a as G}from"./chunk-U54GQJ26.js";import{a as v}from"./chunk-4NO5EP4U.js";import{a as C}from"./chunk-QBWQK3DT.js";import{a as T,e as M}from"./chunk-SVHROGNI.js";import{M as y,e as B,ka as g,la as H,ra as R,sa as w}from"./chunk-DLJYFRIS.js";import{C as k,Ea as V,G as x,Ma as E,O as N,Qa as I,Ua as F,aa as S,d as h,f as P,g as d,j as O,l as $,lb as L,vb as z}from"./chunk-MAT3H5WR.js";import{k as u}from"./chunk-KYPE3LET.js";X.prototype.ShowProgress=function(i){let t,e;if(i===void 0||!Number.isFinite(i))t=e="";else if(this._break)t="Breaking ... ",e="break";else{if(this.last_progress!==i){let r=i-this.last_progress;this.aver_diff||(this.aver_diff=r),this.aver_diff=r*.3+this.aver_diff*.7}this.last_progress=i;let s=0;this.aver_diff<=0?s=0:this.aver_diff<1e-4?s=3:this.aver_diff<.001?s=2:this.aver_diff<.01&&(s=1),t=`TTree draw ${(i*100).toFixed(s)} % `}return T(t,0,()=>{this._break=1}),e};function j(i,t,e){return u(this,null,function*(){let s=t?._typename;return!s||!d(s)?Promise.reject(Error("Object without type cannot be draw with TTree")):s.indexOf(E)===0?C.draw(i,t,e):s.indexOf(I)===0?G.draw(i,t,e):s.indexOf(F)===0?v.draw(i,t,e):s.indexOf(S)===0?q.draw(i,t,e):s===V&&t.$hist?v.draw(i,t.$hist,e).then(()=>{let r=new g(i,t,e);return r.addToPadPrimitives(),r.redraw=Z,r.redraw()}):Promise.reject(Error(`Object of type ${s} cannot be draw with TTree`))})}function ee(i,t){return u(this,null,function*(){if(!(!t&&!this.last_pr)){if(this.dump||this.dump_entries||this.testio){if(!t)return;if($()){let s=new y(this.drawid);return s.selectDom().property("_json_object_",i),s}if(P(h.drawInspector))return h.drawInspector(this.drawid,i);let e=L(N);return e.fString=k(i,2),H(this.drawid,e)}return this.last_pr||(this.last_pr=Promise.resolve(!0)),this.last_pr.then(()=>(this.obj_painter?this.last_pr=O(this.obj_painter.redrawObject(i)).then(()=>this.obj_painter):i?this.last_pr=j(this.drawid,i,this.drawopt).then(e=>(this.obj_painter=e,t||(this.last_pr=null),e)):(t&&console.log("no result after tree drawing"),this.last_pr=!1),t?this.last_pr:null))}})}function re(i){return i.draw_first=!0,i.configureOnline=function(t,e,s,r,n){this.setItemName(t,"",this),this.url=e,this.root_version=r,this.askey=s,this.draw_expr=n},i.configureTree=function(t){this.local_tree=t},i.showExtraButtons=function(t){let e=this.selectDom(),s=this.local_tree?.fEntries||0;e.select(".treedraw_more").remove(),e.select(".treedraw_buttons").node().innerHTML+=`Cut: <input class="treedraw_cut ui-corner-all ui-widget" style="width:8em;margin-left:5px" title="cut expression"></input>Opt: <input class="treedraw_opt ui-corner-all ui-widget" style="width:5em;margin-left:5px" title="histogram draw options"></input>Num: <input class="treedraw_number" type='number' min="0" max="${s}" step="1000" style="width:7em;margin-left:5px" title="number of entries to process (default all)"></input>First: <input class="treedraw_first" type='number' min="0" max="${s}" step="1000" style="width:7em;margin-left:5px" title="first entry to process (default first)"></input><button class="treedraw_clear" title="Clear drawing">Clear</button>`,e.select(".treedraw_exe").on("click",()=>this.performDraw()),e.select(".treedraw_cut").property("value",t?.parse_cut||"").on("change",()=>this.performDraw()),e.select(".treedraw_opt").property("value",t?.drawopt||"").on("change",()=>this.performDraw()),e.select(".treedraw_number").attr("value",t?.numentries||""),e.select(".treedraw_first").attr("value",t?.firstentry||""),e.select(".treedraw_clear").on("click",()=>w(this.drawid))},i.showPlayer=function(t){let e=this.selectDom();this.drawid="jsroot_tree_player_"+h.id_counter+++"_draw";let s=t?.parse_cut||t?.numentries||t?.firstentry;e.html(`<div style="display:flex; flex-flow:column; height:100%; width:100%;"><div class="treedraw_buttons" style="flex: 0 1 auto;margin-top:0.2em;"><button class="treedraw_exe" title="Execute draw expression" style="margin-left:0.5em">Draw</button>Expr:<input class="treedraw_varexp treedraw_varexp_info" style="width:12em;margin-left:5px" title="draw expression"></input><label class="treedraw_varexp_info">\u24D8</label><button class="treedraw_more">More</button></div><div style="flex: 0 1 auto"><hr/></div><div id="${this.drawid}" style="flex: 1 1 auto; overflow:hidden;"></div></div>`),this.setTopPainter(),this.local_tree&&e.select(".treedraw_buttons").attr("title","Tree draw player for: "+this.local_tree.fName),e.select(".treedraw_exe").on("click",()=>this.performDraw()),e.select(".treedraw_varexp").attr("value",t?.parse_expr||this.draw_expr||"px:py").on("change",()=>this.performDraw()),e.select(".treedraw_varexp_info").attr("title",`Example of valid draw expressions:
  px - 1-dim draw
  px:py - 2-dim draw
  px:py:pz - 3-dim draw
  px+py:px-py - use any expressions
  px:py>>Graph - create and draw TGraph
  px:py>>dump - dump extracted variables
  px:py>>h(50,-5,5,50,-5,5) - custom histogram
  px:py;hbins:100 - custom number of bins`),s?this.showExtraButtons(t):e.select(".treedraw_more").on("click",()=>this.showExtraButtons(t)),this.checkResize(),M(this)},i.getValue=function(t){let e=this.selectDom().select(t);if(!e.empty())return e.property("value")??e.attr("value")},i.performLocalDraw=function(){if(!this.local_tree)return;let t=this.selectDom(),e={expr:this.getValue(".treedraw_varexp")};t.select(".treedraw_more").empty()&&(e.cut=this.getValue(".treedraw_cut"),e.cut||delete e.cut,e.drawopt=this.getValue(".treedraw_opt"),e.drawopt==="dump"&&(e.dump=!0,e.drawopt=""),e.drawopt||delete e.drawopt,e.numentries=parseInt(this.getValue(".treedraw_number")),Number.isInteger(e.numentries)||delete e.numentries,e.firstentry=parseInt(this.getValue(".treedraw_first")),Number.isInteger(e.firstentry)||delete e.firstentry),w(this.drawid),e.drawid=this.drawid,e.progress=ee.bind(e),b(this.local_tree,e).then(s=>e.progress(s,!0))},i.getDrawOpt=function(){let t="player",e=this.getValue(".treedraw_varexp");return e&&(t+=":"+e),t},i.performDraw=function(){if(this.local_tree)return this.performLocalDraw();let t=this.selectDom(),e=this.url+"/exe.json.gz?compact=3&method=Draw",s=this.getValue(".treedraw_varexp"),r="h_tree_draw",n="",l=s.indexOf(">>");if(l<0)s+=`>>${r}`;else{r=s.slice(l+2),r[0]==="+"&&(r=r.slice(1));let o=r.indexOf("(");o>0&&(r=r.slice(0,o))}if(t.select(".treedraw_more").empty()){let o=this.getValue(".treedraw_cut"),c=this.getValue(".treedraw_number"),f=this.getValue(".treedraw_first");n=this.getValue(".treedraw_opt"),e+=`&prototype="const char*,const char*,Option_t*,Long64_t,Long64_t"&varexp="${s}"&selection="${o}"`,c||(c="TTree::kMaxEntries"),f||(f="0"),e+=`&option="${n}"&nentries=${c}&firstentry=${f}`}else e+=`&prototype="Option_t*"&opt="${s}"`;e+=`&_ret_object_=${r}`;let a=()=>{x(e,"object").then(o=>{w(this.drawid),j(this.drawid,o,n)})};this.draw_expr=s,this.askey?(this.askey=!1,x(this.url+"/root.json.gz?compact=3","text").then(a)):a()},i.checkResize=function(){R(this.drawid)},i}function te(i,t,e,s){let r=i.findItem(t),n="",l=0,a=i.getTopOnlineItem(r);if(!r||!a)return null;if(s){for(n=r._name;r&&!r._ttree;)r=r._parent;if(!r)return null;t=i.itemFullName(r)}let o=i.getOnlineItemUrl(t);if(!o)return null;let c=a._root_version||400129,f=i.getDisplay();if(!f)return null;let D=f.findFrame(t,!0);if(!D)return null;let ie=B(D).attr("id"),p=new y(ie);if(r._childs&&!s)for(let m=0;m<r._childs.length;++m){let _=r._childs[m];d(_?._kind)&&_._kind.indexOf(z("TLeaf"))===0&&l<2&&(l++>0&&(n+=":"),n+=_._name)}return re(p),p.configureOnline(t,o,e,c,n),p.showPlayer(),p}function me(i,t){return te(i,t,!0)}function _e(i,t){return te(i,t,!1,!0)}function xe(i,t,e){return u(this,null,function*(){let s=t,r=e;if(t._typename===W?(r={expr:`.${t.func}()`,branch:t.branch},e&&e.indexOf("dump")===0?r.expr+=">>"+e:e&&(r.expr+=e),s=t.branch.$tree):t.$branch?(r={expr:`.${t.fName}${e||""}`,branch:t.$branch},(r.branch.fType===U||r.branch.fType===Q)&&(r.expr=e,r.direct_branch=!0),s=t.$branch.$tree):t.$tree?(!e&&t.fStreamerType&&t.fStreamerType!==A&&t.fStreamerType>=K&&t.fStreamerType<=J&&(e="dump"),r={expr:e,branch:t},s=t.$tree):(r||(r="player"),d(r)&&(r={expr:r})),!s)throw Error("No TTree object available for TTree::Draw");if(d(r.expr)){let a=r.expr.indexOf("player");a===0?(r.player=!0,r.expr=r.expr.slice(6),r.expr[0]===":"&&(r.expr=r.expr.slice(1))):a>=0&&a===r.expr.length-6&&(r.player=!0,r.expr=r.expr.slice(0,a),a>0&&r.expr[a-1]===";"&&(r.expr=r.expr.slice(0,a-1)))}let n;r.player?(n=new g(i,t,e),re(n),n.configureTree(s),n.showPlayer(r),r.drawid=n.drawid):r.drawid=i,r.progress=ee.bind(r);let l;if(r.expr==="testio")r.testio=!0,r.showProgress=a=>T(a,-1,()=>{r._break=1}),l=Y(s,r);else if(r.expr||r.branch)l=b(s,r);else return n;return l.then(a=>r.progress(a,!0))})}export{ee as a,te as b,me as c,_e as d,xe as e};
