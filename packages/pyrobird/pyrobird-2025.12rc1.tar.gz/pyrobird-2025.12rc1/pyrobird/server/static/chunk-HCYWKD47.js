import{a as C}from"./chunk-FXELJSYA.js";import{a as I}from"./chunk-U54GQJ26.js";import{b as B}from"./chunk-3Y4HYQCO.js";import"./chunk-QBWQK3DT.js";import"./chunk-3MJ5AJB7.js";import"./chunk-STN7OMLL.js";import{a as A,b as w}from"./chunk-JFO4ENDF.js";import"./chunk-3W3OTHNE.js";import{g as b}from"./chunk-HB357Z3Y.js";import"./chunk-OI5V6APH.js";import"./chunk-S3FA7C5I.js";import"./chunk-FENW22PV.js";import"./chunk-K2P6CES6.js";import{b as _}from"./chunk-LNTKXTVM.js";import"./chunk-MFPRCIVI.js";import"./chunk-SVHROGNI.js";import{I as R,ka as Y}from"./chunk-DLJYFRIS.js";import{O as L,Oa as j,Sa as F,T as k,gb as y,hb as S,lb as G,mb as X,x as D}from"./chunk-MAT3H5WR.js";import{k as u}from"./chunk-KYPE3LET.js";var Z=D(17),P=class T extends Y{#i;#t;#s;#a;#e;#n;#r;constructor(e,i){super(e,i),this.#i=null,this.#t=[]}cleanup(){this.#t=[],this.#n=void 0,this.#r=void 0,this.#e=void 0,this.#a=void 0,super.cleanup()}is3d(){return this.#n}updateObject(e){if(!this.matchObjectType(e))return!1;let i=this.getObject(),r=e.fGraphs,n=this.getPadPainter();i.fTitle=e.fTitle;let h=!1;if(this.#i){let m=this.scanGraphsRange(r,e.fHistogram,n?.getRootPad(!0),!0);this.#i.updateObject(m)&&(h=!0)}let t=Math.min(r.arr.length,this.#t.length);for(let m=0;m<t;++m)this.#t[m].updateObject(r.arr[m],(r.opt[m]||this.#a)+this.#e)&&(h=!0);return this.#s=new b(this,n,e.fFunctions),h}redraw(e){return u(this,null,function*(){let i=this.#i?.redraw(e)??Promise.resolve(!0),r=n=>u(this,null,function*(){return n>=this.#t.length?this:this.#t[n].redraw(e).then(()=>r(n+1))});return i.then(()=>r(0)).then(()=>{let n=this.#s?.drawNext(0)??this;return this.#s=void 0,n})})}scanGraphsRange(e,i,r,n){let h=this.getObject(),t={xmin:0,xmax:0,ymin:0,ymax:0,first:!0},m=(s,x)=>Math.abs(x-s)<1e-6,a,f,g=!1,l=!1,d,O=!1;r&&(g=r.fLogx,l=r.fLogv??r.fLogy),this.is3d()&&i&&!i.fXaxis.fLabels&&(i=null),i?(O=m(i.fMinimum,-.05)&&m(i.fMaximum,1.05)&&m(i.fXaxis.fXmin,-.05)&&m(i.fXaxis.fXmax,1.05),d=i):d=e.arr[0]?.fHistogram,e.arr.forEach(s=>{if(s.fNpoints!==0){s.TestBit(Z)&&(n=!0),t.first&&(t.xmin=t.xmax=s.fX[0],t.ymin=t.ymax=s.fY[0],t.first=!1);for(let x=0;x<s.fNpoints;++x)t.xmin=Math.min(t.xmin,s.fX[x]),t.xmax=Math.max(t.xmax,s.fX[x]),t.ymin=Math.min(t.ymin,s.fY[x]),t.ymax=Math.max(t.ymax,s.fY[x])}}),t.xmin===t.xmax&&(t.xmax+=1),t.ymin===t.ymax&&(t.ymax+=1);let H=.05*(t.xmax-t.xmin),N=.05*(t.ymax-t.ymin),o=t.xmin-H,p=t.xmax+H;l?(t.ymin<=0&&(t.ymin=.001*t.ymax),f=t.ymin/(1+.5*Math.log10(t.ymax/t.ymin)),a=t.ymax*(1+.2*Math.log10(t.ymax/t.ymin))):(f=t.ymin-N,a=t.ymax+N),f<0&&t.ymin>=0&&(f=0),a>0&&t.ymax<=0&&(a=0);let $=f,W=a;if(o<0&&t.xmin>=0&&(o=g?.9*t.xmin:0),p>0&&t.xmax<=0&&(p=g?1.1*t.xmax:0),h.fMinimum!==y&&(t.ymin=f=h.fMinimum),h.fMaximum!==y&&(t.ymax=a=h.fMaximum),f<0&&t.ymin>=0&&l&&(f=.9*t.ymin),a>0&&t.ymax<=0&&l&&(a=1.1*t.ymax),f<=0&&l&&(f=.001*a),!l&&f>0&&f<.05*a&&(f=0),o<=0&&g&&(o=p>1e3?1:.001*p),!i||n||O){let s,x;if(this.is3d()){i=X(F,e.arr.length,10),s=i.fXaxis,s.fXmin=0,s.fXmax=e.arr.length,s.fLabels=G(k);for(let c=0;c<e.arr.length;c++){let M=G(L);M.fString=e.arr[c].fTitle||`gr${c}`,M.fUniqueID=e.arr.length-c,s.fLabels.Add(M,"")}s=i.fYaxis,x=i.fZaxis}else i=X(d?._typename??j,d?.fXaxis.fNbins??10),s=i.fXaxis,x=i.fYaxis;if(d&&(Object.assign(s,d.fXaxis),x.fTitle=d.fYaxis.fTitle),i.fTitle=h.fTitle,i.fTitle.indexOf(";")>=0){let c=i.fTitle.split(";");i.fTitle=c[0],c[1]&&(s.fTitle=c[1]),c[2]&&(x.fTitle=c[2])}s.fLabels||(s.fXmin=o,s.fXmax=p)}let v=this.is3d()?i.fZaxis:i.fYaxis;return v.fXmin=Math.min(f,$),v.fXmax=Math.max(a,W),i.fMinimum===y&&(i.fMinimum=f),i.fMaximum===y&&(i.fMaximum=a),i.fBits|=S,i}drawAxisHist(e,i){return u(this,null,function*(){return w.draw(this.getDrawDom(),e,i)})}drawGraph(e,i,r){return u(this,null,function*(){return B.draw(e,i,r)})}drawNextGraph(e,i){return u(this,null,function*(){let r=this.getObject().fGraphs;if(e>=r.arr.length)return this;let n=r.arr[e],h=(r.opt[e]||this.#a)+this.#e,t=r.arr.length-e,m=`graphs_${e}`;if(i){let a=i.getSubPadPainter(e+1);return a?(a.cleanPrimitives(!0),this.drawGraph(a,n,h,t).then(f=>(f&&(f.setSecondaryId(this,m),this.#t.push(f)),this.drawNextGraph(e+1,i)))):this}return this.#e&&(n.$num_graphs=r.arr.length),this.drawGraph(this.getPadPainter(),n,h,t).then(a=>(a&&(a.setSecondaryId(this,m),this.#t.push(a)),this.drawNextGraph(e+1)))})}fillContextMenuItems(e){e.addRedrawMenu(this)}redrawWith(e,i){return u(this,null,function*(){if(!i){this.#i=null,this.#t=[];let a=this.getPadPainter();a?.removePrimitive(this,!0),this.#r&&a?.divide(0,0)}let r=new R(e),n=this.getObject();this.#n=r.check("3D"),this.#e="",this.#r=r.check("PADS"),["PFC","PLC","PMC"].forEach(a=>{r.check(a)&&(this.#e+=" "+a)});let h="",t=null;r.check("FB")&&this.is3d()&&(h+="FB"),A.forEach(a=>{r.check(a)&&(h+=";"+a)}),this.#a=r.remain();let m=Promise.resolve(!0);if(this.#r)m=_(this,!1).then(()=>(t=this.getPadPainter(),t.divide(n.fGraphs.arr.length,0,!0)));else if(r.check("A")||!this.getMainPainter()){let a=this.scanGraphsRange(n.fGraphs,n.fHistogram,this.getPadPainter()?.getRootPad(!0));m=this.drawAxisHist(a,h).then(f=>{f.setSecondaryId(this,"hist"),this.#i=f})}return m.then(()=>(this.addToPadPrimitives(),this.drawNextGraph(0,t))).then(()=>this.#r?this:new b(this,this.getPadPainter(),this.getObject().fFunctions,!0).drawNext(0))})}static draw(e,i,r){return u(this,null,function*(){return new T(e,i,r).redrawWith(r,!0)})}};var E=class T extends P{drawAxisHist(e,i){return u(this,null,function*(){let r=this.getDrawDom();return this.is3d()?I.draw(r,e,"LEGO"+i):w.draw(r,e,i)})}drawGraph(e,i,r,n){return u(this,null,function*(){return this.is3d()&&(r+=`pos3d_${n}`),C.draw(e,i,r)})}static draw(e,i,r){return u(this,null,function*(){return new T(e,i,r).redrawWith(r,!0)})}};export{E as TMultiGraphPainter};
