import{a as et}from"./chunk-U54GQJ26.js";import{a as wt,b as Tt}from"./chunk-3MJ5AJB7.js";import{b as yt}from"./chunk-STN7OMLL.js";import"./chunk-HB357Z3Y.js";import"./chunk-OI5V6APH.js";import{a as L,d as pt,n as V,q as Mt}from"./chunk-S3FA7C5I.js";import"./chunk-FENW22PV.js";import"./chunk-K2P6CES6.js";import"./chunk-LNTKXTVM.js";import"./chunk-MFPRCIVI.js";import"./chunk-SVHROGNI.js";import{I as mt,K as xt,ka as gt}from"./chunk-DLJYFRIS.js";import{Ta as ut,da as Nt,ea as Q,gb as st,hb as dt,j as at,mb as Xt,nb as Yt,ra as ct,t as ot}from"./chunk-MAT3H5WR.js";import{k as R}from"./chunk-KYPE3LET.js";function Ct(I){let t=I[0];for(let f=1;f<I.length;++f)t=Math.max(t,I[f]);return t}function _t(I){let t=I[0];for(let f=1;f<I.length;++f)t=Math.min(t,I[f]);return t}function Pt(I,t,f){let i=new Array(I);for(let s=0;s<I;++s)i[s]={v:t[s],i:s};i.sort((s,N)=>s.v<N.v?-1:s.v>N.v?1:0);for(let s=0;s<I;++s)f[s]=i[s].i}var ht=class{constructor(t){this.fGraph2D=t,this.fX=t.fX,this.fY=t.fY,this.fZ=t.fZ,this.fNpoints=t.fNpoints,this.fZout=0,this.fNdt=0,this.fNhull=0,this.fHullPoints=null,this.fXN=null,this.fYN=null,this.fOrder=null,this.fDist=null,this.fPTried=null,this.fNTried=null,this.fMTried=null,this.fInit=!1,this.fXNmin=0,this.fXNmax=0,this.fYNmin=0,this.fYNmax=0,this.fXoffset=0,this.fYoffset=0,this.fXScaleFactor=0,this.fYScaleFactor=0,this.SetMaxIter()}Initialize(){this.fInit||(this.CreateTrianglesDataStructure(),this.FindHull(),this.fInit=!0)}ComputeZ(t,f){this.Initialize();let i=(t+this.fXoffset)*this.fXScaleFactor,s=(f+this.fYoffset)*this.fYScaleFactor,N=this.Interpolate(i,s);return N===0&&(N=this.Interpolate(i+1e-4,s)),N}CreateTrianglesDataStructure(){let t=Ct(this.fGraph2D.fX),f=Ct(this.fGraph2D.fY),i=_t(this.fGraph2D.fX),s=_t(this.fGraph2D.fY);this.fXoffset=-(t+i)/2,this.fYoffset=-(f+s)/2,this.fXScaleFactor=1/(t-i),this.fYScaleFactor=1/(f-s),this.fXNmax=(t+this.fXoffset)*this.fXScaleFactor,this.fXNmin=(i+this.fXoffset)*this.fXScaleFactor,this.fYNmax=(f+this.fYoffset)*this.fYScaleFactor,this.fYNmin=(s+this.fYoffset)*this.fYScaleFactor,this.fXN=new Array(this.fNpoints+1),this.fYN=new Array(this.fNpoints+1);for(let N=0;N<this.fNpoints;N++)this.fXN[N+1]=(this.fX[N]+this.fXoffset)*this.fXScaleFactor,this.fYN[N+1]=(this.fY[N]+this.fYoffset)*this.fYScaleFactor;this.fPTried=[],this.fNTried=[],this.fMTried=[]}Enclose(t,f,i,s){let N=[this.fXN[t],this.fXN[f],this.fXN[i],this.fXN[t]],e=[this.fYN[t],this.fYN[f],this.fYN[i],this.fYN[t]],o=this.fXN[s],a=this.fYN[s],m=0,x=N.length-1,u=!1;for(;m<N.length;++m)(e[m]<a&&e[x]>=a||e[x]<a&&e[m]>=a)&&N[m]+(a-e[m])/(e[x]-e[m])*(N[x]-N[m])<o&&(u=!u),x=m;return u}FileIt(t,f,i){let s,N=t,e=f,o=i;do s=!1,e>N&&([e,N]=[N,e],s=!0),o>e&&([o,e]=[e,o],s=!0);while(s);this.fNdt++,this.fPTried.push(N),this.fNTried.push(e),this.fMTried.push(o)}FindAllTriangles(){if(this.fAllTri)return;this.fAllTri=!0;let t,f,i,s,N,e,o,a,m,x,u,X,l,h,g,r,n,w,C,Y,y,c,_,k=0,M=0,P,p,Z=0,d=[!1,!1,!1],F=1e-4;for(this.Initialize(),t=0,f=0,p=1;p<=this.fNhull;p++)t+=this.fXN[this.fHullPoints[p-1]],f+=this.fYN[this.fHullPoints[p-1]];for(t=t/this.fNhull+F,f=f/this.fNhull+F,this.Interpolate(t,f),r=1;r<=this.fNdt;){for(w=this.fPTried[r-1],C=this.fNTried[r-1],Y=this.fMTried[r-1],d[0]=!1,d[1]=!1,d[2]=!1,n=1;n<=this.fNdt;n++)n!==r&&(y=this.fPTried[n-1],c=this.fNTried[n-1],_=this.fMTried[n-1],w===y&&C===c||w===y&&C===_||w===c&&C===_?d[0]=!0:w===y&&Y===c||w===y&&Y===_||w===c&&Y===_?d[1]=!0:(C===y&&Y===c||C===y&&Y===_||C===c&&Y===_)&&(d[2]=!0)),d[0]&&d[1]&&d[2];for(P=1;P<=3;P++)d[P-1]||(P===1?(k=w,M=C,Z=Y):P===2?(k=w,M=Y,Z=C):P===3&&(k=C,M=Y,Z=w),i=(this.fXN[k]+this.fXN[M])/2,s=(this.fYN[k]+this.fYN[M])/2,o=this.fXN[k]-this.fXN[M],a=this.fYN[k]-this.fYN[M],m=a,x=-o,h=Math.sqrt(m*m+x*x),m/=h,x/=h,u=this.fXN[Z]-i,X=this.fYN[Z]-s,l=u*m+X*x,l>0&&(m=-m,x=-x),g=Math.abs(Math.max(F*i,F*s)),N=i+m*g,e=s+x*g,this.Interpolate(N,e));r++}}FindHull(){this.fHullPoints||(this.fHullPoints=new Array(this.fNpoints));let t=0;for(let f=1;f<=this.fNpoints;f++)this.InHull(f,f)||(t++,this.fHullPoints[t-1]=f);this.fNhull=t}InHull(t,f){let i,s,N,e,o,a,m,x,u,X,l,h,g,r,n,w,C,Y,y,c,_,k=!1,M=this.fXN[t],P=this.fYN[t];for(this.fNhull>0?o=this.fNhull:o=this.fNpoints,i=1,s=2,i===f?(i=s,s++):s===f&&s++,u=M-this.fXN[i],h=P-this.fYN[i],X=M-this.fXN[s],g=P-this.fYN[s],y=Math.atan2(h,u),c=Math.atan2(g,X),_=y-c-Math.floor((y-c)/(Math.PI*2))*Math.PI*2,_<0&&(_+=Math.PI*2),a=_,N=1;N<=o;N++)if(this.fNhull>0?e=this.fHullPoints[N-1]:e=N,e!==i&&e!==s&&e!==f&&(u=M-this.fXN[i],h=P-this.fYN[i],X=M-this.fXN[s],g=P-this.fYN[s],l=M-this.fXN[e],r=P-this.fYN[e],m=X*h-u*g,x=u*g-X*h,m*x&&(n=(X*r-l*g)/m,w=(u*r-l*h)/x,n<0||w<0))){if(C=(u*l+h*r)/Math.sqrt(u*u+h*h),Y=(X*l+g*r)/Math.sqrt(X*X+g*g),C>Y?(i=e,y=Math.atan2(r,l),c=Math.atan2(g,X)):(s=e,y=Math.atan2(h,u),c=Math.atan2(r,l)),_=y-c-Math.floor((y-c)/(Math.PI*2))*Math.PI*2,_<0&&(_+=Math.PI*2),(_-Math.PI)*(a-Math.PI)<0)return k=!0,k;a=_}return k}InterpolateOnPlane(t,f,i,s){let N,e=t,o=f,a=i;do N=!1,o>e&&([e,o]=[o,e],N=!0),a>o&&([o,a]=[a,o],N=!0);while(N);let m=this.fXN[e],x=this.fXN[o],u=this.fXN[a],X=this.fYN[e],l=this.fYN[o],h=this.fYN[a],g=this.fZ[e-1],r=this.fZ[o-1],n=this.fZ[a-1],w=(g*(l-h)+r*(h-X)+n*(X-l))/(m*(l-h)+x*(h-X)+u*(X-l)),C=(g*(x-u)+r*(u-m)+n*(m-x))/(X*(x-u)+l*(u-m)+h*(m-x)),Y=g-w*m-C*X;return w*this.fXN[s]+C*this.fYN[s]+Y}Interpolate(t,f){let i,s,N,e,o,a,m,x,u,X,l,h,g,r,n,w,C,Y,y,c,_=0,k=0,M=0,P=0,p=0,Z,d,F,O,H,A,b,E,q,G,v,D,S,z,T,W,U,tt,J,K,it,rt,nt,B=[0,0,0],$=[0,0,0];if(this.Initialize(),this.fOrder||(this.fOrder=new Array(this.fNpoints),this.fDist=new Array(this.fNpoints)),this.fXN[0]=t,this.fYN[0]=f,i=this.fZout,N=0,t>this.fXNmax||t<this.fXNmin||f>this.fYNmax||f<this.fYNmin)return i;for(s=1;s<=this.fNdt;s++)if(e=this.fPTried[s-1],o=this.fNTried[s-1],a=this.fMTried[s-1],this.Enclose(e,o,a,0))return i=this.InterpolateOnPlane(e,o,a,0),i;let lt=this.InHull(0,-1);if(!lt)return i;for(s=1;s<=this.fNpoints;s++)Z=this.fXN[s],d=this.fYN[s],this.fDist[s-1]=Math.sqrt((t-Z)*(t-Z)+(f-d)*(f-d));for(Pt(this.fNpoints,this.fDist,this.fOrder),s=0;s<this.fNpoints;s++)this.fOrder[s]++;for(u=3;u<=this.fNpoints;u++)for(a=this.fOrder[u-1],x=2;x<=u-1;x++)for(o=this.fOrder[x-1],m=1;m<=x-1;m++){let j=!1;if(e=this.fOrder[m-1],N>this.fMaxIter)return i;if(N++,F=Math.sqrt((this.fXN[e]-this.fXN[o])**2+(this.fYN[e]-this.fYN[o])**2),O=Math.sqrt((this.fXN[e]-this.fXN[a])**2+(this.fYN[e]-this.fYN[a])**2),H=Math.sqrt((this.fXN[o]-this.fXN[a])**2+(this.fYN[o]-this.fYN[a])**2),!(F+O<=H||F+H<=O||O+H<=F)&&this.Enclose(e,o,a,0)){for(_=0,l=1;l<=this.fNpoints;l++)if(!(l===e||l===o||l===a)){for(X=1;X<=this.fNpoints;X++)if(this.fOrder[X-1]===l)if(X<m||X<x||X<u){if(this.Enclose(e,o,a,l)){j=!0;break}}else break;if(j)break;if((this.fXN[e]-this.fXN[l])*(this.fYN[e]-this.fYN[o])===(this.fYN[e]-this.fYN[l])*(this.fXN[e]-this.fXN[o])?(w=e,C=o):(this.fXN[e]-this.fXN[l])*(this.fYN[e]-this.fYN[a])===(this.fYN[e]-this.fYN[l])*(this.fXN[e]-this.fXN[a])?(w=e,C=a):(this.fXN[o]-this.fXN[l])*(this.fYN[o]-this.fYN[a])===(this.fYN[o]-this.fYN[l])*(this.fXN[o]-this.fXN[a])?(w=o,C=a):(w=0,C=0),w){if(this.fXN[w]!==this.fXN[C])if((this.fXN[l]-this.fXN[w])*(this.fXN[l]-this.fXN[C])<0){j=!0;break}else(this.fXN[l]-this.fXN[w])*(this.fXN[l]-this.fXN[C])===0&&console.warn(`Interpolate Two of these three points are coincident ${w} ${C} ${l}`);else if((this.fYN[l]-this.fYN[w])*(this.fYN[l]-this.fYN[C])<0){j=!0;break}else(this.fYN[l]-this.fYN[w])*(this.fYN[l]-this.fYN[C])===0&&console.warn(`Interpolate Two of these three points are coincident ${w} ${C} ${l}`);continue}if(j)break;for(h=a,r=e,n=o,B[0]=this.fXN[e]-this.fXN[l],$[0]=this.fYN[e]-this.fYN[l],B[1]=this.fXN[o]-this.fXN[l],$[1]=this.fYN[o]-this.fYN[l],B[2]=this.fXN[a]-this.fXN[l],$[2]=this.fYN[a]-this.fYN[l],X=1;X<=3;X++)if(W=B[X-1],U=B[X%3],tt=B[(X+1)%3],J=$[X-1],K=$[X%3],it=$[(X+1)%3],rt=(it*U-tt*K)*(J*U-W*K),nt=(it*W-tt*J)*(K*W-U*J),rt>=0&&nt>=0){X===1?(h=a,r=e,n=o):X===2?(h=e,r=o,n=a):(h=o,r=a,n=e);break}if(S=((this.fXN[h]-this.fXN[r])*(this.fXN[l]-this.fXN[r])+(this.fYN[h]-this.fYN[r])*(this.fYN[l]-this.fYN[r]))/Math.sqrt(((this.fXN[h]-this.fXN[r])*(this.fXN[h]-this.fXN[r])+(this.fYN[h]-this.fYN[r])*(this.fYN[h]-this.fYN[r]))*((this.fXN[l]-this.fXN[r])*(this.fXN[l]-this.fXN[r])+(this.fYN[l]-this.fYN[r])*(this.fYN[l]-this.fYN[r]))),z=((this.fXN[n]-this.fXN[r])*(this.fXN[l]-this.fXN[r])+(this.fYN[n]-this.fYN[r])*(this.fYN[l]-this.fYN[r]))/Math.sqrt(((this.fXN[n]-this.fXN[r])*(this.fXN[n]-this.fXN[r])+(this.fYN[n]-this.fYN[r])*(this.fYN[n]-this.fYN[r]))*((this.fXN[l]-this.fXN[r])*(this.fXN[l]-this.fXN[r])+(this.fYN[l]-this.fYN[r])*(this.fYN[l]-this.fYN[r]))),T=((this.fXN[n]-this.fXN[r])*(this.fXN[h]-this.fXN[r])+(this.fYN[n]-this.fYN[r])*(this.fYN[h]-this.fYN[r]))/Math.sqrt(((this.fXN[n]-this.fXN[r])*(this.fXN[n]-this.fXN[r])+(this.fYN[n]-this.fYN[r])*(this.fYN[n]-this.fYN[r]))*((this.fXN[h]-this.fXN[r])*(this.fXN[h]-this.fXN[r])+(this.fYN[h]-this.fYN[r])*(this.fYN[h]-this.fYN[r]))),!(S>z||S>T))if(E=Math.sqrt((this.fXN[l]-this.fXN[r])*(this.fXN[l]-this.fXN[r])+(this.fYN[l]-this.fYN[r])*(this.fYN[l]-this.fYN[r])),q=Math.sqrt((this.fXN[l]-this.fXN[n])*(this.fXN[l]-this.fXN[n])+(this.fYN[l]-this.fYN[n])*(this.fYN[l]-this.fYN[n])),G=Math.sqrt((this.fXN[h]-this.fXN[r])*(this.fXN[h]-this.fXN[r])+(this.fYN[h]-this.fYN[r])*(this.fYN[h]-this.fYN[r])),v=Math.sqrt((this.fXN[h]-this.fXN[n])*(this.fXN[h]-this.fXN[n])+(this.fYN[h]-this.fYN[n])*(this.fYN[h]-this.fYN[n])),A=((this.fXN[l]-this.fXN[r])*(this.fXN[l]-this.fXN[n])+(this.fYN[l]-this.fYN[r])*(this.fYN[l]-this.fYN[n]))/E/q,b=((this.fXN[h]-this.fXN[r])*(this.fXN[h]-this.fXN[n])+(this.fYN[h]-this.fYN[r])*(this.fYN[h]-this.fYN[n]))/G/v,D=A*Math.sqrt(1-b*b)+b*Math.sqrt(1-A*A),D<-1e-6){j=!0;break}else Math.abs(D)<=1e-6&&(_++,k=l,M=h,P=r,p=n)}if(!j)return _>0?(g=k,h=M,r=P,n=p,this.fZ[r-1]+this.fZ[n-1]>this.fZ[g-1]+this.fZ[h-1]?(Y=e,y=o,c=a,this.FileIt(e,o,a),this.FileIt(g,r,n)):(Y=h,y=g,this.Enclose(h,g,r,0)?c=r:c=n,this.FileIt(h,g,r),this.FileIt(h,g,n))):(this.FileIt(e,o,a),Y=e,y=o,c=a),i=this.InterpolateOnPlane(Y,y,c,0),i}}return lt&&console.error(`Interpolate Point outside hull when expected inside: this point could be dodgy ${t}  ${f} ${N}`),i}SetMaxIter(t=1e5){this.fAllTri=!1,this.fMaxIter=t}SetMarginBinsContent(t){this.fZout=t}GetContourList(t){if(!this.fNdt)return null;let f,i,s,N,e,o,a,m,x,u,X,l,h,g,r,n,w,C,Y,y,c=0,_,k,M,P,p=[0,0,0],Z=new Array(this.fNdt).fill(0),d=new Array(this.fNdt).fill(0),F=new Array(this.fNdt).fill(0),O=new Array(this.fNdt).fill(0);for(w=0;w<this.fNdt;w++){if(p[0]=this.fPTried[w],p[1]=this.fNTried[w],p[2]=this.fMTried[w],e=p[0]-1,o=p[1]-1,a=p[2]-1,m=this.fX[e],g=this.fX[e],x=this.fY[e],r=this.fY[e],u=this.fZ[e],n=this.fZ[e],C=Y=y=0,this.fZ[o]<=u&&(u=this.fZ[o],m=this.fX[o],x=this.fY[o],C=1),this.fZ[o]>n&&(n=this.fZ[o],g=this.fX[o],r=this.fY[o],y=1),this.fZ[a]<=u&&(u=this.fZ[a],m=this.fX[a],x=this.fY[a],C=2),this.fZ[a]>n&&(n=this.fZ[a],g=this.fX[a],r=this.fY[a],y=2),C===0&&y===0)return console.error("GetContourList: wrong vertices ordering"),null;Y=3-y-C,X=this.fX[p[Y]-1],l=this.fY[p[Y]-1],h=this.fZ[p[Y]-1],t>=u&&t<=n&&(s=(t-u)/(n-u),_=s*(g-m)+m,k=s*(r-x)+x,t>=h&&t<=n?(i=(t-h)/(n-h),M=i*(g-X)+X,P=i*(r-l)+l):(N=(t-u)/(h-u),M=N*(X-m)+m,P=N*(l-x)+x),(_!==M||k!==P)&&(c++,Z[c-1]=_,d[c-1]=k,F[c-1]=M,O[c-1]=P))}let H=[],A=new Array(this.fNdt).fill(!1),b=0,E=0,q=0,G=0,v,D,S,z,T;for(z=0;z<c;z++)if(!A[z]){for(D=S=!1,T=0;T<c;T++)z!==T&&(Z[z]===Z[T]&&d[z]===d[T]&&(D=!0),Z[z]===F[T]&&d[z]===O[T]&&(D=!0),F[z]===Z[T]&&O[z]===d[T]&&(S=!0),F[z]===F[T]&&O[z]===O[T]&&(S=!0));if(!D&&!S){f=[],f.push(Z[z],d[z]),f.push(F[z],O[z]),A[z]=!0,H.push(f);continue}if(!D||!S){for(f=[],D&&(b=Z[z],E=d[z],q=F[z],G=O[z]),S&&(b=F[z],E=O[z],q=Z[z],G=d[z]),f.push(q,G),A[z]=!0,T=0;;){for(v=!1;T<c&&A[T];)T++;if(b===Z[T]&&E===d[T]?(b=F[T],E=O[T],v=!0):b===F[T]&&E===O[T]&&(b=Z[T],E=d[T],v=!0),v)A[T]=!0,f.push(b,E),T=0;else if(++T>=c)break}H.push(f)}}for(z=0;z<c;z++)if(!A[z]){for(f=[],A[z]=!0,b=Z[z],E=d[z],T=0,f.push(b,E);;){for(;T<c&&A[T];)T++;if(v=!1,b===Z[T]&&E===d[T]?(b=F[T],E=O[T],v=!0):b===F[T]&&E===O[T]&&(b=Z[T],E=d[T],v=!0),v)A[T]=!0,f.push(b,E),T=0;else if(++T>=c)break}f.push(Z[z],d[z]),H.push(f)}return H}};function ft(I){let t=Math.floor(I.index/this.nvertex);if(t<0||t>=this.index.length)return null;let f=a=>a*a;t=this.index[t];let i=this.fp,s=this.graph,N=i.grx(s.fX[t]),e=i.gry(s.fY[t]),o=i.grz(s.fZ[t]);if(this.check_next&&t+1<s.fX.length){let a=I.point,m=i.grx(s.fX[t+1]),x=i.gry(s.fY[t+1]),u=i.grz(s.fZ[t+1]);f(a.x-m)+f(a.y-x)+f(a.z-u)<f(a.x-N)+f(a.y-e)+f(a.z-o)&&(N=m,e=x,o=u,t++)}return{x1:N-this.scale0,x2:N+this.scale0,y1:e-this.scale0,y2:e+this.scale0,z1:o-this.scale0,z2:o+this.scale0,color:this.tip_color,lines:[this.tip_name,"pnt: "+t,"x: "+i.axisAsText("x",s.fX[t]),"y: "+i.axisAsText("y",s.fY[t]),"z: "+i.axisAsText("z",s.fZ[t])]}}var zt=class I extends gt{#i;#t;decodeOptions(t){let f=new mt(t),i=this.getObject();f.check("FILL_","color")&&i&&(i.fFillColor=f.color),f.check("LINE_","color")&&i&&(i.fLineColor=f.color),f.check("SAME");let s=0,N=0;f.check("CONT5")?N=15:f.check("TRI1")?s=11:f.check("TRI2")?s=10:f.check("TRIW")?s=1:f.check("TRI")&&(s=2);let e=this.setOptions({Triangles:s,Contour:N,Line:f.check("LINE"),Error:f.check("ERR")&&(this.matchObjectType(Nt)||this.matchObjectType(Q))});f.check("P0COL")?e.Color=e.Circles=e.Markers=!0:(e.Color=f.check("COL"),e.Circles=f.check("P0"),e.Markers=f.check("P")),e.Markers||(e.Color=!1),(e.Color||e.Triangles>=10||e.Contour)&&(e.Zscale=f.check("Z")),e.isAny=function(){return this.Markers||this.Error||this.Circles||this.Line||this.Triangles||e.Contour},e.Contour?e.Axis="":e.isAny()?(e.Axis="lego2",e.Zscale&&(e.Axis+="z")):e.Axis=t,this.storeDrawOpt(t)}createHistogram(){let t=this.getObject(),f=this.getOptions(),i=this.matchObjectType(Q),s=t.fX[0],N=s,e=t.fY[0],o=e,a=t.fZ[0],m=a;for(let c=0;c<t.fNpoints;++c){let _=t.fX[c],k=t.fY[c],M=t.fZ[c];f.Error?(s=Math.min(s,_-(i?t.fEXlow[c]:t.fEX[c])),N=Math.max(N,_+(i?t.fEXhigh[c]:t.fEX[c])),e=Math.min(e,k-(i?t.fEYlow[c]:t.fEY[c])),o=Math.max(o,k+(i?t.fEYhigh[c]:t.fEY[c])),a=Math.min(a,M-(i?t.fEZlow[c]:t.fEZ[c])),m=Math.max(m,M+(i?t.fEZhigh[c]:t.fEZ[c]))):(s=Math.min(s,_),N=Math.max(N,_),e=Math.min(e,k),o=Math.max(o,k),a=Math.min(a,M),m=Math.max(m,M))}function x(c,_,k){return c<_?k*(_-c):Math.abs(c)<1e5?.02:.02*Math.abs(c)}let u=x(s,N,t.fMargin),X=x(e,o,t.fMargin),l=x(a,m,0),h=s-u,g=N+u,r=e-X,n=o+X,w=a-l,C=m+l;h<0&&s>=0&&(h=s*.98),g>0&&N<=0&&(g=0),r<0&&e>=0&&(r=e*.98),n>0&&o<=0&&(n=0),w<0&&a>=0&&(w=a*.98),C>0&&m<=0&&(C=0);let Y=this.getObject();Y.fMinimum!==st&&(w=Y.fMinimum),Y.fMaximum!==st&&(C=Y.fMaximum);let y=Xt(ut,Y.fNpx,Y.fNpy);if(y.fName=Y.fName+"_h",Yt(y,Y.fTitle),y.fXaxis.fXmin=h,y.fXaxis.fXmax=g,y.fYaxis.fXmin=r,y.fYaxis.fXmax=n,y.fZaxis.fXmin=w,y.fZaxis.fXmax=C,y.fMinimum=w,y.fMaximum=C,y.fBits|=dt,!f.isAny()){let c=this.buildDelaunay(Y);if(c)for(let _=0;_<Y.fNpx;++_){let k=h+(_+.5)/Y.fNpx*(g-h);for(let M=0;M<Y.fNpy;++M){let P=r+(M+.5)/Y.fNpy*(n-r),p=c.ComputeZ(k,P);y.fArray[y.getBin(_+1,M+1)]=p}}}return y}buildDelaunay(t){return this.#t||(this.#t=new ht(t),this.#t.FindAllTriangles(),this.#t.fNdt||(this.#t=void 0)),this.#t}drawTriangles(t,f,i,s){let N=this.buildDelaunay(f);if(!N)return;let e=t.logz?X=>X<t.scale_zmin?-.1:t.grz(X):t.grz,o=this.getOptions(),a=o.Triangles===2,m=o.Triangles>=10||a,x=o.Triangles%10===1||a&&f.fLineColor!==f.fFillColor,u=new yt(i,e,0,2*t.size_z3d,x);for(u.loop=0;u.loop<2;++u.loop){u.createBuffers();for(let X=0;X<N.fNdt;++X){let l=[N.fPTried[X],N.fNTried[X],N.fMTried[X]],h=[],g=!0;for(let r=0;r<3;++r){let n=l[r]-1;h.push(t.grx(f.fX[n]),t.gry(f.fY[n]),e(f.fZ[n])),(f.fX[n]<t.scale_xmin||f.fX[n]>t.scale_xmax||f.fY[n]<t.scale_ymin||f.fY[n]>t.scale_ymax)&&(g=!1)}m&&g&&u.addMainTriangle(...h),x&&g&&(u.addLineSegment(h[0],h[1],h[2],h[3],h[4],h[5]),u.addLineSegment(h[3],h[4],h[5],h[6],h[7],h[8]),u.addLineSegment(h[6],h[7],h[8],h[0],h[1],h[2]))}}u.callFuncs((X,l)=>{let h=Tt(this.getMainPainter(),l,null,100,100),g=a?this.getColor(f.fFillColor):s.calcColor(X,i.length),r=new L.MeshBasicMaterial(pt(g,{side:L.DoubleSide,vertexColors:!1})),n=new L.Mesh(h,r);t.add3DMesh(n,this),n.painter=this},(X,l)=>{let h=this.getColor(f.fLineColor),g=new L.LineBasicMaterial({color:new L.Color(h),linewidth:f.fLineWidth}),r=V(wt(this.getMainPainter(),l,100,100),g);t.add3DMesh(r,this)})}updateObject(t,f){if(!this.matchObjectType(t))return!1;let i=this.getOptions();if(f&&f!==i.original&&this.decodeOptions(f,t),Object.assign(this.getObject(),t),this.#t=void 0,this.#i=void 0,this.axes_draw){let s=this.getMainPainter();s?.updateObject(this.createHistogram(),i.Axis),this.#i=s}return!0}redraw(){return R(this,null,function*(){let t=at(this.#i?.redraw());return this.#i=void 0,t.then(()=>this.drawGraph2D())})}drawContour(t,f,i){return R(this,null,function*(){let s=this.buildDelaunay(i);if(!s)return this;let N=f.getContour(),e=f.getHistPalette(),o=N.getLevels(),a=t.getGrFuncs(),m=this.createG(!0);this.createAttLine({attr:i,nocolor:!0});for(let x=0;x<o.length;++x){let u=s.GetContourList(o[x]),X=N.getPaletteColor(e,o[x]),l="";for(let h=0;h<u.length;++h){let g=u[h],r=[];for(let n=0;n<g.length;n+=2)r.push({grx:a.grx(g[n]),gry:a.gry(g[n+1])});l+=xt(r,{cmd:"M",line:!0})}this.lineatt.color=X,m.append("svg:path").attr("d",l).style("fill","none").call(this.lineatt.func)}return this})}drawGraph2D(){return R(this,null,function*(){let t=this.getFramePainter(),f=this.getMainPainter(),i=this.getObject(),s=this.getOptions();if(!i||!f||!t)return this;if(s.Contour)return this.drawContour(t,f,i);if(!t.mode3d)return this;if(t.remove3DMeshes(this),!s.isAny()){if(f.draw_content)return this;i.fMarkerSize===1&&i.fMarkerStyle===1?s.Circles=!0:s.Markers=!0}let N=(h,g)=>{let r=0;for(let n=0;n<i.fNpoints;++n)i.fX[n]>=t.scale_xmin&&i.fX[n]<=t.scale_xmax&&i.fY[n]>=t.scale_ymin&&i.fY[n]<=t.scale_ymax&&i.fZ[n]>=h&&i.fZ[n]<g&&++r;return r},e=1;if(ot.OptimizeDraw>0&&!t.webgl){let h=N(t.scale_zmin,t.scale_zmax),g=5e4;h>g&&(e=Math.max(2,Math.floor(h/g)))}let o=this.createAttMarker({attr:i,std:!1}),a=[],m=null,x=[t.scale_zmin,t.scale_zmax],u=t.size_x3d/100*o.getFullSize();s.Circles&&(u=.06*t.size_x3d),t.usesvg&&(u*=.3);let X=t.getFrameWidth(),l=t.getFrameHeight();X>10&&l>10&&(u*=7*Math.max(t.size_x3d/X,t.size_z3d/l)),(s.Color||s.Triangles>=10)&&(x=f.getContourLevels(!0),m=f.getHistPalette()),s.Triangles&&this.drawTriangles(t,i,x,m);for(let h=0;h<x.length-1;++h){let g=Math.max(x[h],t.scale_zmin),r=Math.min(x[h+1],t.scale_zmax);if(g>=r)continue;let n=Math.floor(N(g,r)/e),w=new Int32Array(n),C=s.Markers||s.Circles?new Mt(n,t.webgl,u/3):null,Y=s.Error?new Float32Array(n*6*3):null,y=Y&&this.matchObjectType(Q),c=s.Line?new Float32Array((n-1)*6):null,_=0,k=0,M=0,P=0;for(let p=0;p<i.fNpoints;++p){if(i.fX[p]<t.scale_xmin||i.fX[p]>t.scale_xmax||i.fY[p]<t.scale_ymin||i.fY[p]>t.scale_ymax||i.fZ[p]<g||i.fZ[p]>=r||e>1&&(_=(_+1)%e,_))continue;w[k++]=p;let Z=t.grx(i.fX[p]),d=t.gry(i.fY[p]),F=t.grz(i.fZ[p]);C?.addPoint(Z,d,F),Y&&(Y[M]=t.grx(i.fX[p]-(y?i.fEXlow[p]:i.fEX[p])),Y[M+1]=d,Y[M+2]=F,Y[M+3]=t.grx(i.fX[p]+(y?i.fEXhigh[p]:i.fEX[p])),Y[M+4]=d,Y[M+5]=F,M+=6,Y[M]=Z,Y[M+1]=t.gry(i.fY[p]-(y?i.fEYlow[p]:i.fEY[p])),Y[M+2]=F,Y[M+3]=Z,Y[M+4]=t.gry(i.fY[p]+(y?i.fEYhigh[p]:i.fEY[p])),Y[M+5]=F,M+=6,Y[M]=Z,Y[M+1]=d,Y[M+2]=t.grz(i.fZ[p]-(y?i.fEZlow[p]:i.fEZ[p])),Y[M+3]=Z,Y[M+4]=d,Y[M+5]=t.grz(i.fZ[p]+(y?i.fEZhigh[p]:i.fEZ[p])),M+=6),c&&(P>=6&&(c[P]=c[P-3],c[P+1]=c[P-2],c[P+2]=c[P-1],P+=3),c[P]=Z,c[P+1]=d,c[P+2]=F,P+=3)}if(c&&P>3&&c.length===P){let p=this.getColor(i.fLineColor),Z=new L.LineBasicMaterial({color:new L.Color(p),linewidth:i.fLineWidth}),d=V(c,Z);t.add3DMesh(d,this),d.graph=i,d.index=w,d.fp=t,d.scale0=.7*u,d.tip_name=this.getObjectHint(),d.tip_color=i.fMarkerColor===3?16711680:65280,d.nvertex=2,d.check_next=!0,d.tooltip=ft}if(Y){let p=this.getColor(i.fLineColor),Z=new L.LineBasicMaterial({color:new L.Color(p),linewidth:i.fLineWidth}),d=V(Y,Z);t.add3DMesh(d,this),d.graph=i,d.index=w,d.fp=t,d.scale0=.7*u,d.tip_name=this.getObjectHint(),d.tip_color=i.fMarkerColor===3?16711680:65280,d.nvertex=6,d.tooltip=ft}if(C){let p="blue";(!s.Circles||s.Color)&&(p=m?.calcColor(h,x.length)??this.getColor(i.fMarkerColor));let Z=C.createPoints({color:p,fill:s.Circles?"white":void 0,style:s.Circles?4:i.fMarkerStyle}).then(d=>{d.graph=i,d.fp=t,d.tip_color=i.fMarkerColor===3?16711680:65280,d.scale0=.3*u,d.index=w,d.tip_name=this.getObjectHint(),d.tooltip=ft,t.add3DMesh(d,this)});a.push(Z)}}return Promise.all(a).then(()=>{let h=this.getMainPainter();if(!(this.axes_draw||h?.draw_content===!1))return;let r=h?.findFunction(ct),n=this.getPadPainter()?.findPainterFor(r);if(n){if(n.Enabled=s.Zscale,s.Zscale)return n.drawPave();n.removeG()}}).then(()=>(t.render3D(100),this))})}static build3d(t,f){return R(this,null,function*(){let i=new I(null,t);return i.decodeOptions(f,t),i.options.Contour?(console.error("Contour plot is not 3d"),null):et.build3d(i.createHistogram(),i.options.Axis,!0).then(s=>{i.axes_draw=!0;let N=s.getFramePainter();return i.getFramePainter=()=>N,i.getMainPainter=()=>s,i.drawGraph2D().then(()=>N.create3DScene(-1,!0))})})}static draw(t,f,i){return R(this,null,function*(){let s=new I(t,f);s.decodeOptions(i,f);let N=Promise.resolve(null);return s.getMainPainter()||(N=et.draw(t,s.createHistogram(),s.options.Axis),s.axes_draw=!0),N.then(()=>(s.addToPadPrimitives(),s.drawGraph2D()))})}};export{zt as TGraph2DPainter};
