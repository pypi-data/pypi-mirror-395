import{a as B,e as W}from"./chunk-JPOZZ6CV.js";import{e as V}from"./chunk-MFPRCIVI.js";import{l as O}from"./chunk-SVHROGNI.js";import{O as R,b as j,e as z,f as k}from"./chunk-DLJYFRIS.js";import{eb as Z,f as T,t as A,z as S}from"./chunk-MAT3H5WR.js";import{k as D}from"./chunk-KYPE3LET.js";function it(){let d=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=i?this.v7EvalAttr("clipping",!1):!1,t=e.getCoordinate(d.fPos,i),h=this.v7EvalFont("text",{size:12,color:"black",align:22});return this.createG(n?"main_layer":i?"upper_layer":!1),this.startTextDrawingAsync(h,"font").then(()=>(this.drawText({x:t.x,y:t.y,text:d.fText,latex:1}),this.finishTextDrawing()))}function nt(){let d=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=i?this.v7EvalAttr("clipping",!1):!1,t=e.getCoordinate(d.fP1,i),h=e.getCoordinate(d.fP2,i),g=this.createG(n?"main_layer":i?"upper_layer":!1);this.createv7AttLine(),g.append("svg:path").attr("d",`M${t.x},${t.y}L${h.x},${h.y}`).call(this.lineatt.func)}function rt(){let d=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=i?this.v7EvalAttr("clipping",!1):!1,t=e.getCoordinate(d.fP1,i),h=e.getCoordinate(d.fP2,i),g=this.createG(n?"main_layer":i?"upper_layer":!1);this.createv7AttLine("border_"),this.createv7AttFill(),g.append("svg:path").attr("d",`M${t.x},${t.y}H${h.x}V${h.y}H${t.x}Z`).call(this.lineatt.func).call(this.fillatt.func)}function lt(){let d=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=i?this.v7EvalAttr("clipping",!1):!1,t=e.getCoordinate(d.fP,i),h=this.createG(n?"main_layer":i?"upper_layer":!1);this.createv7AttMarker();let g=this.markeratt.create(t.x,t.y);g&&h.append("svg:path").attr("d",g).call(this.markeratt.func)}var X=class d extends B{getHistPalette(){let e=this.getObject()?.fPalette;return e&&!T(e.getColor)&&S(e,`${Z}RPalette`),e}drawPalette(e){let i=this.getHistPalette(),n=i.getContour(),t=this.getFramePainter();if(!n)return console.log("no contour - no palette");if(!t)return console.log("no frame painter - no palette");let h=n.at(0),g=n.at(-1),f=t.getFrameRect(),P=this.getPadPainter().getPadWidth(),H=this.getPadPainter().getPadHeight(),q=this.v7EvalAttr("visible",!0),l=this.v7EvalAttr("vertical",!0),M=this.getG(),b=i.full_min,C=i.full_max,$,E,s,c;if(e){s=e.width,c=e.height;let a={};l?(this.v7AttrChange(a,"margin",(e.x-f.x-f.width)/P),this.v7AttrChange(a,"width",s/P)):(this.v7AttrChange(a,"margin",(e.y-f.y-f.height)/P),this.v7AttrChange(a,"width",c/H)),this.v7SendAttrChanges(a,!1)}else{if(l){let a=this.v7EvalLength("margin",P,.02);$=Math.round(f.x+f.width+a),s=this.v7EvalLength("width",P,.05),E=f.y,c=f.height}else{let a=this.v7EvalLength("margin",H,.02);$=f.x,s=f.width,E=Math.round(f.y+f.height+a),c=this.v7EvalLength("width",H,.05)}R(M,$,E)}let _=M.selectChild(".colbtns");if(_.empty()?_=M.append("svg:g").attr("class","colbtns"):_.selectAll("*").remove(),!q)return;_.append("svg:path").attr("d",`M0,0H${s}V${c}H0Z`).style("stroke","black").style("fill","none"),(b===void 0||C===void 0)&&(b=h,C=g),l?t.z_handle.configureAxis("zaxis",b,C,h,g,!0,[c,0],-c,{reverse:!1}):t.z_handle.configureAxis("zaxis",b,C,h,g,!1,[0,s],s,{reverse:!1});for(let a=0;a<n.length-1;++a){let m=Math.round(t.z_handle.gr(n[a])),u=Math.round(t.z_handle.gr(n[a+1])),p=i.getContourColor((n[a]+n[a+1])/2),x=_.append("svg:path").attr("d",l?`M0,${u}H${s}V${m}H0Z`:`M${m},0V${c}H${u}V0Z`).style("fill",p).style("stroke",p).property("fill0",p).property("fill1",j(p).darker(.5).formatRgb());this.isBatchMode()||(this.isTooltipAllowed()&&x.on("mouseover",function(){z(this).transition().duration(100).style("fill",z(this).property("fill1"))}).on("mouseout",function(){z(this).transition().duration(100).style("fill",z(this).property("fill0"))}).append("svg:title").text(n[a].toFixed(2)+" - "+n[a+1].toFixed(2)),A.Zooming&&x.on("dblclick",()=>t.unzoom("z")))}t.z_handle.maxTickSize=Math.round(s*.3);let G=t.z_handle.drawAxis(M,R(l?s:0,c),l?-1:1);return this.isBatchMode()||e?G:G.then(()=>{if(A.ContextMenu&&M.on("contextmenu",r=>{r.stopPropagation(),r.preventDefault(),O(r,this).then(o=>{o.header("Palette"),o.addchk(l,"Vertical",y=>{this.v7SetAttr("vertical",y),this.redrawPad()}),t.z_handle.fillAxisContextMenu(o,"z"),o.show()})}),V(this,{x:$,y:E,width:s,height:c,minwidth:20,minheight:20,no_change_x:!l,no_change_y:l,redraw:r=>this.drawPalette(r)}),!A.Zooming)return;let a=!1,m=0,u=0,p,x,F,v,I=r=>{if(!a)return;if(r.preventDefault(),v=k(r,this.getG().node()),F)return t.z_handle.processLabelsMove("move",v);l?u=Math.min(Math.max(v[1],0),c):u=Math.min(Math.max(v[0],0),s);let o=Math.abs(u-m);!x&&o>1&&(p.style("display",null),x=!0),l?p.attr("y",Math.min(m,u)).attr("height",o):p.attr("x",Math.min(m,u)).attr("width",o)},J=r=>{if(a)if(r.preventDefault(),z(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null),p.remove(),p=null,a=!1,F)t.z_handle.processLabelsMove("stop",v);else{let o=t.z_handle.func,y=o.invert(m),w=o.invert(u);t.zoomSingle("z",Math.min(y,w),Math.max(y,w))}},K=r=>{a||(a=!0,r.preventDefault(),r.stopPropagation(),v=k(r,this.getG().node()),m=u=v[l?1:0],x=!1,F=!1,p=_.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").style("display","none"),l?p.attr("x",0).attr("width",s).attr("y",m).attr("height",1):p.attr("x",m).attr("width",1).attr("y",0).attr("height",c),z(window).on("mousemove.colzoomRect",I).on("mouseup.colzoomRect",J,!0),setTimeout(()=>{!x&&a&&(F=t.z_handle.processLabelsMove("start",v))},500))},L=()=>{this.getG().selectAll(".axis_zoom, .axis_labels").on("mousedown",K).on("dblclick",()=>t.unzoom("z")),A.ZoomWheel&&this.getG().on("wheel",r=>{r.stopPropagation(),r.preventDefault();let o=k(r,this.getG().node()),y=l?1-o[1]/c:o[0]/s,w=t.z_handle.analyzeWheelEvent(r,y);w.changed&&t.zoomSingle("z",w.min,w.max)})};t.z_handle.setAfterDrawHandler(L),L()})}static draw(e,i,n){return D(this,null,function*(){let t=new d(e,i,n,"palette");return W(t,!1).then(()=>(t.createG(),t))})}};export{X as RPalettePainter,rt as drawBox,nt as drawLine,lt as drawMarker,it as drawText};
