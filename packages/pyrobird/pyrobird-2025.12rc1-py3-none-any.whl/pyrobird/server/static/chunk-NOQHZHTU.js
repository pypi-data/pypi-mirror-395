import{a as A,b as E}from"./chunk-2IR3OD6Q.js";import{a as j}from"./chunk-U54GQJ26.js";import"./chunk-3MJ5AJB7.js";import"./chunk-STN7OMLL.js";import"./chunk-JFO4ENDF.js";import{a as Z}from"./chunk-3W3OTHNE.js";import{h as O}from"./chunk-HB357Z3Y.js";import"./chunk-OI5V6APH.js";import"./chunk-S3FA7C5I.js";import"./chunk-FENW22PV.js";import"./chunk-K2P6CES6.js";import"./chunk-LNTKXTVM.js";import"./chunk-MFPRCIVI.js";import"./chunk-SVHROGNI.js";import{I as B,na as L}from"./chunk-DLJYFRIS.js";import{Sa as N,Ya as w,hb as C,mb as k,nb as Y,t as b}from"./chunk-MAT3H5WR.js";import{k as T}from"./chunk-KYPE3LET.js";function G(p,t,e=0){for(let i=p.length-2;i>=0;--i){let o=t[i],f=t[i+1],n=p[i],x=p[i+1];if(o===e)return n;if(f===e)return x;if(o<e!=f<e)return n+(e-o)/(f-o)*(x-n)}return p[0]-1}var W=class p extends j{#e;#t;#i;setFunc(t){this.#t=t}getObjectName(){return this.#t?.fName??"func"}getClassName(){return this.#t?._typename??w}isTF1(){return!0}getPrimaryObject(){return this.#t}updateObject(t){if(!t||this.getClassName()!==t._typename)return!1;delete t.evalPar;let e=this.getHisto();if(this._webcanv_hist){let i=this.getPadPainter()?.findInPrimitives("Func",N);i&&this.updateAxes(e,i,this.getFramePainter())}return this.setFunc(t),this.createTF3Histogram(t,e),this.scanContent(),!0}redraw(t){return!this.#e&&(t==="logx"||t==="logy"||t==="logy"||t==="zoom")&&(this.createTF3Histogram(this.#t,this.getHisto()),this.scanContent()),super.redraw(t)}createTF3Histogram(t,e){let i=t.fSave.length-9;this.#e=i>0&&(b.PreferSavedPoints||this._use_saved>1);let o=this.getFramePainter(),f=this.getPadPainter()?.getRootPad(!0),n=f?.fLogx,x=f?.fLogy,a=o?.getGrFuncs(this.second_x,this.second_y),y=t.fXmin,_=t.fXmax,v=t.fYmin,g=t.fYmax,l=t.fZmin,S=t.fZmax,d=Math.max(t.fNpx,20),M=Math.max(t.fNpy,20),s=Math.max(t.fNpz,20);if(a?.zoom_xmin!==a?.zoom_xmax){let m=(_-y)/d;y<a.zoom_xmin&&a.zoom_xmin<_&&(y=Math.max(y,a.zoom_xmin-m)),y<a.zoom_xmax&&a.zoom_xmax<_&&(_=Math.min(_,a.zoom_xmax+m))}if(a?.zoom_ymin!==a?.zoom_ymax){let m=(g-v)/M;v<a.zoom_ymin&&a.zoom_ymin<g&&(v=Math.max(v,a.zoom_ymin-m)),v<a.zoom_ymax&&a.zoom_ymax<g&&(g=Math.min(g,a.zoom_ymax+m))}a?.zoom_zmin!==a?.zoom_zmax&&(l<a.zoom_zmin&&a.zoom_zmin<S&&(l=a.zoom_zmin),l<a.zoom_zmax&&a.zoom_zmax<S&&(S=a.zoom_zmax));let H=(m,h)=>{e.fNcells!==(m+2)*(h+2)&&(e.fNcells=(m+2)*(h+2),e.fArray=new Float32Array(e.fNcells)),e.fArray.fill(0),e.fXaxis.fNbins=m,e.fXaxis.fXbins=[],e.fYaxis.fNbins=h,e.fYaxis.fXbins=[],e.fXaxis.fXmin=y,e.fXaxis.fXmax=_,e.fYaxis.fXmin=v,e.fYaxis.fXmax=g,e.fMinimum=l,e.fMaximum=S};if(this.#i=void 0,!this.#e){let m=!1;!t.evalPar&&!Z(t)&&(m=!0),H(d,M),n&&A(e.fXaxis,d,y,_),x&&A(e.fYaxis,M,v,g);let h=new Array(s),c=new Array(s);for(let r=0;r<s;++r)c[r]=l+r/(s-1)*(S-l);for(let r=0;r<M&&!m;++r)for(let z=0;z<d&&!m;++z){let u=e.fXaxis.GetBinCenter(z+1),F=e.fYaxis.GetBinCenter(r+1),X=0;try{for(let P=0;P<s;++P)h[P]=t.evalPar(u,F,c[P]);X=G(c,h)}catch{m=!0}m||e.setBinContent(e.getBin(z+1,r+1),Number.isFinite(X)?X:0)}m&&(this.#i=!0),m&&i>0&&(this.#e=!0)}if(this.#e){y=t.fSave[i],_=t.fSave[i+1],v=t.fSave[i+2],g=t.fSave[i+3],l=t.fSave[i+4],S=t.fSave[i+5],d=Math.round(t.fSave[i+6]),M=Math.round(t.fSave[i+7]),s=Math.round(t.fSave[i+8]);let m=(S-l)/s;H(d+1,M+1);let h=new Array(s+1),c=new Array(s+1);for(let r=0;r<=s;r++)c[r]=l+r*m;for(let r=0;r<=d;++r)for(let z=0;z<=M;++z){for(let F=0;F<=s;F++)h[F]=t.fSave[r+(d+1)*(z+(M+1)*F)];let u=G(c,h);e.setBinContent(e.getBin(r+1,z+1),Number.isFinite(u)?u:0)}}return e.fName="Func",Y(e,t.fTitle),e.fLineColor=t.fLineColor,e.fLineStyle=t.fLineStyle,e.fLineWidth=t.fLineWidth,e.fFillColor=t.fFillColor,e.fFillStyle=t.fFillStyle,e.fMarkerColor=t.fMarkerColor,e.fMarkerStyle=t.fMarkerStyle,e.fMarkerSize=t.fMarkerSize,e.fBits|=C,e}extractAxesProperties(t){super.extractAxesProperties(t);let e=this.#t,i=e?.fSave.length??0;i>9&&this.#e&&(this.xmin=Math.min(this.xmin,e.fSave[i-9]),this.xmax=Math.max(this.xmax,e.fSave[i-8]),this.ymin=Math.min(this.ymin,e.fSave[i-7]),this.ymax=Math.max(this.ymax,e.fSave[i-6]),this.zmin=Math.min(this.zmin,e.fSave[i-5]),this.zmax=Math.max(this.zmax,e.fSave[i-4])),e&&(this.xmin=Math.min(this.xmin,e.fXmin),this.xmax=Math.max(this.xmax,e.fXmax),this.ymin=Math.min(this.ymin,e.fYmin),this.ymax=Math.max(this.ymax,e.fYmax),this.zmin=Math.min(this.zmin,e.fZmin),this.zmax=Math.max(this.zmax,e.fZmax))}fillWebObjectOptions(t){t.fcust=this.#i&&!this._use_saved?"func_fail":""}static draw(t,e,i){return T(this,null,function*(){let o=E(i);i=o.opt,delete o.opt;let f=new B(i);f.empty()||i==="gl"?i="surf1":f.opt==="SAME"&&(i="surf1 same");let n;o._webcanv_hist&&(n=L(t)?.findInPrimitives("Func",N)),n||(n=k(N,20,20),n.fBits|=C);let x=new p(t,n);return x.setFunc(e,w),Object.assign(x,o),x.createTF3Histogram(e,n),O._drawHist(x,i)})}};export{W as TF3Painter};
