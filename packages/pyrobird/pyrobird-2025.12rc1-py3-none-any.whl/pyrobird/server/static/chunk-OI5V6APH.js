import{a as x,c as E,d as T}from"./chunk-S3FA7C5I.js";import{$ as B,ca as I,da as k,ka as N}from"./chunk-DLJYFRIS.js";import{g as z,va as A}from"./chunk-MAT3H5WR.js";var b=class d{constructor(s,t,u){this.kind=s??"g",this.childs=[],this.x=0,this.y=0,this.font_size=t?.font_size??u,this.stroke_width=t?.stroke_width??5,t?.childs.push(this)}append(s){if(s==="svg:g")return new d("g",this);if(s==="svg:text")return new d("text",this);if(s==="svg:path")return new d("path",this);console.warn("missing handle for svg",s)}style(s,t){return s==="stroke-width"&&t&&(this.stroke_width=Number.parseInt(t)),this}property(s,t){return t===void 0?this[s]:(this[s]=t,this)}attr(s,t){let u=()=>{if(!t)return"";let i=t[0];return t=t.slice(1),i},e=i=>{let n=0;for(;t[n]>="0"&&t[n]<="9"||t[n]==="-";)n++;let g=Number.parseInt(t.slice(0,n));return t=t.slice(n),i&&u(),g};if(s==="font-size"&&t)this.font_size=Number.parseInt(t);else if(s==="transform"&&z(t)&&t.indexOf("translate")===0){let i=t.slice(t.indexOf("(")+1,t.lastIndexOf(")")).split(",");this.x+=i[0]?Number.parseInt(i[0])*.01:0,this.y-=i[1]?Number.parseInt(i[1])*.01:0}else if(s==="x"&&this.kind==="text")this.x+=Number.parseInt(t)*.01;else if(s==="y"&&this.kind==="text")this.y-=Number.parseInt(t)*.01;else if(s==="fill"&&this.kind==="text")this.fill=t;else if(s==="d"&&this.kind==="path"&&t!=="M0,0"){if(u()!=="M")return console.error("Not starts with M");let i=e(!0),n=e(),g,p=[],r=(a,l)=>{let c=Math.atan2(l-n,a-i),h=.5*this.stroke_width*Math.sin(c),f=-.5*this.stroke_width*Math.cos(c);p.push(i-h,n-f,0,a-h,l-f,0,a+h,l+f,0,i-h,n-f,0,a+h,l+f,0,i+h,n+f,0),p.push(i-h,n-f,0,a+h,l+f,0,a-h,l-f,0,i-h,n-f,0,i+h,n+f,0,a+h,l+f,0),i=a,n=l};for(;g=u();)switch(g){case"L":r(e(!0),e());continue;case"l":r(i+e(!0),n+e());continue;case"H":r(e(),n);continue;case"h":r(i+e(),n);continue;case"V":r(i,e());continue;case"v":r(i,n+e());continue;case"a":{let a=e(!0),l=e(!0),c=e(!0)/180*Math.PI,h=e(!0);e(!0);let f=i+e(!0),o=n+e(),w=i+a*Math.cos(c),y=n+l*Math.sin(c),m=Math.atan2(y-o,w-f);h&&m<c?m+=2*Math.PI:!h&&m>c&&(m-=2*Math.PI);for(let M=0;M<10;++M){let _=c+(m-c)/10*(M+1);r(w-a*Math.cos(_),y-l*Math.sin(_))}continue}default:console.log("not supported path operator",g)}if(p.length){let a=new Float32Array(p);this.geom=new x.BufferGeometry,this.geom.setAttribute("position",new x.BufferAttribute(a,3)),this.geom.scale(.01,-.01,.01),this.geom.computeVertexNormals()}}return this}text(s){this.kind==="text"&&(this._text=s)}collect(s,t,u){if(this._text){t.size=Math.round(.01*this.font_size);let e=new x.TextGeometry(this._text,t);u&&(e.scale(1,.9,1),e.translate(0,5e-4*this.font_size,0)),e.translate(this.x,this.y,0),e._fill=this.fill,s.push(e)}this.geom&&(this.geom.translate(this.x,this.y,0),this.geom._fill=this.fill,s.push(this.geom)),this.childs.forEach(e=>{e.x+=this.x,e.y+=this.y,e.collect(s,t,u)})}};function O(d,s,t,u,e=!0){let i={font:E(),size:t,height:0,curveSegments:5},n=t*100,g=new b("g",null,n),p={font_size:n,latex:e?1:0,x:0,y:0,text:s,align:["start","top"],fast:!0,font:{size:n,isMonospace:()=>!1,aver_width:.9}},r=[];if(x.REVISION>162?i.depth=0:i.height=0,I(s)||(k(d,g,p),g.collect(r,i,u)),!r.length){i.size=t;let o=new x.TextGeometry(B(s),i);return u?[o]:o}if(u)return r;if(r.length===1)return r[0];let a=0;r.forEach(o=>{a+=o.getAttribute("position").array.length});let l=new Float32Array(a),c=new Float32Array(a),h=0;r.forEach(o=>{let w=o.getAttribute("position").array,y=o.getAttribute("normal").array;for(let m=0;m<w.length;++m,++h)l[h]=w[m],c[h]=y[m]});let f=new x.BufferGeometry;return f.setAttribute("position",new x.BufferAttribute(l,3)),f.setAttribute("normal",new x.BufferAttribute(c,3)),f}function H(d,s,t,u){t||(t=new N(null,d,s));let e=t.createAttText({attr:d}),i=e.align%10,n=(e.align-i)/10,g=e.size>1?e.size:2*e.size*(u?.size_z3d||100),p=O(t,d.fTitle,g||10,!0,u||d._typename===A),r=new x.Box3().makeEmpty();p.forEach(o=>{o.computeBoundingBox(),r.expandByPoint(o.boundingBox.max),r.expandByPoint(o.boundingBox.min)});let a=0,l=0;n===2?a=.5*(r.max.x+r.min.x):n===3&&(a=r.max.x),i===2?l=.5*(r.max.y+r.min.y):i===3&&(l=r.max.y);let c=new x.Object3D,h=[],f=o=>(o||(o="black"),h[o]||(h[o]=new x.MeshBasicMaterial(T(o,{vertexColors:!1}))),h[o]);return p.forEach(o=>{o.translate(-a,-l,0),c.add(new x.Mesh(o,f(o._fill||e.color)))}),p.length===1?c.children[0]:c}export{O as a,H as b};
