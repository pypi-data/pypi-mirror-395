import{a as G}from"./chunk-NZWYMOVY.js";import{b as X}from"./chunk-LNTKXTVM.js";import"./chunk-MFPRCIVI.js";import"./chunk-SVHROGNI.js";import{ka as F}from"./chunk-DLJYFRIS.js";import{Fa as l,f as k,lb as C,za as x}from"./chunk-MAT3H5WR.js";import{k as g}from"./chunk-KYPE3LET.js";var y="upper_pad",w="lower_pad",b="top_pad",L=class v extends F{#t;setGridsRange(i,a,n,e,f){let r=this.getObject();if(i===a){let t=this.getPadPainter()?.findPainterFor(r.fLowerPad,w,l)?.getFramePainter()?.x_handle;if(!t)return;i===0?(i=t.full_min,a=t.full_max):(i=t.scale_min,a=t.scale_max)}r.fGridlines.forEach(t=>{t.fX1=i,t.fX2=a});let o=Math.min(r.fGridlines.length,r.fGridlinePositions.length);for(let t=0;t<o;++t){let d=r.fGridlinePositions[t],s=r.fGridlines[t];n!=="ignorey"&&(s.$do_not_draw=n!==e&&(d<n||d>e),s.fY1=s.fY2=d),f?.findPainterFor(s)?.redraw()}}configureInteractive(){let i=this.getObject(),a=this.getPadPainter(),n=a.findPainterFor(i.fUpperPad,y,l),e=n?.getFramePainter(),f=a.findPainterFor(i.fLowerPad,w,l),r=f?.getFramePainter();!n||!f||(f.forEachPainterInPad(o=>{k(o?.testEditable)&&o.testEditable(!1)}),this.setGridsRange(r.scale_xmin,r.scale_xmax,r.scale_ymin,r.scale_ymax,f),!(n._ratio_interactive&&f._ratio_interactive)&&(n._ratio_interactive=!0,f._ratio_interactive=!0,e.o_zoom=e.zoom,e._ratio_low_fp=r,e._ratio_painter=this,e.zoom=function(o,t,d,s,_,c){return this.o_zoom(o,t,d,s,_,c).then(u=>(this._ratio_painter.setGridsRange(e.scale_xmin,e.scale_xmax,"ignory"),this._ratio_low_fp.o_zoom(e.scale_xmin,e.scale_xmax).then(()=>u)))},e.o_sizeChanged=e.sizeChanged,e.sizeChanged=function(){this.o_sizeChanged(),this._ratio_low_fp.fX1NDC=this.fX1NDC,this._ratio_low_fp.fX2NDC=this.fX2NDC,this._ratio_low_fp.o_sizeChanged()},r.o_zoom=r.zoom,r._ratio_up_fp=e,r._ratio_painter=this,r.zoom=function(o,t,d,s,_,c){return o===t?(o=e.xmin,t=e.xmax):(o=Math.min(o,e.xmin),t=Math.max(t,e.xmax)),this._ratio_painter.setGridsRange(o,t,d,s),this._ratio_up_fp.o_zoom(o,t).then(()=>this.o_zoom(o,t,d,s,_,c))},r.o_sizeChanged=r.sizeChanged,r.sizeChanged=function(){this.o_sizeChanged(),this._ratio_up_fp.fX1NDC=this.fX1NDC,this._ratio_up_fp.fX2NDC=this.fX2NDC,this._ratio_up_fp.o_sizeChanged()}))}redrawOld(){return g(this,null,function*(){let i=this.getObject(),a=this.getPadPainter(),n=a.findPainterFor(i.fTopPad,b,l),e=a.getRootPad(),f=e.fFrameFillStyle===0?1:0,r=e.fTickx||f,o=e.fTicky||f;n?.disablePadDrawing();let t=a.findPainterFor(i.fUpperPad,y,l),d=t?.getMainPainter(),s=t?.getFramePainter(),_=a.findPainterFor(i.fLowerPad,w,l),c=_?.getMainPainter(),u=_?.getFramePainter(),m=Promise.resolve(!0);if(t&&d&&s&&u&&!t._ratio_configured){t._ratio_configured=!0,d.options.Axis=0;let h=d.getHisto();h.fYaxis.$use_top_pad=!0,h.fXaxis.fLabelSize=0,h.fXaxis.fTitle="",t.getRootPad().fTickx=r,t.getRootPad().fTicky=o,m=t.redrawPad()}return m.then(()=>{if(!_||!c||!u||!s||_._ratio_configured)return this;_._ratio_configured=!0,c.options.Axis=0;let h=c.getHisto();h.fXaxis.fTitle="x",h.fXaxis.$use_top_pad=!0,h.fYaxis.$use_top_pad=!0,_.getRootPad().fTickx=r,_.getRootPad().fTicky=o;let z=[];return i.fGridlinePositions.length&&i.fGridlines.length<i.fGridlinePositions.length&&i.fGridlinePositions.forEach(P=>{let T=!1;if(i.fGridlines.forEach(p=>{p.fY1===p.fY2&&Math.abs(p.fY1-P)<1e-6&&(T=!0)}),!T){let p=C(x);p.fX1=s.scale_xmin,p.fX2=s.scale_xmax,p.fY1=p.fY2=P,p.fLineStyle=2,i.fGridlines.push(p),z.push(G.draw(_,p))}}),Promise.all(z).then(()=>u.zoomSingle("x",s.scale_xmin,s.scale_xmax)).then(P=>P?!0:_.redrawPad()).then(()=>this)})})}redraw(){return g(this,null,function*(){let i=this.getObject(),a=this.getPadPainter();if(this.#t===void 0&&(this.#t=!!a.findPainterFor(i.fTopPad,b,l)),a.$userInteractive=()=>this.configureInteractive(),this.#t)return this.redrawOld();let n=a.getRootPad(),e=n.fFrameFillStyle===0?1:0,f=n.fTickx||e,r=n.fTicky||e;return i.fTopPad.$disable_drawing=!0,i.fUpperPad.$ratio_pad="up",i.fUpperPad.fTickx=f,i.fUpperPad.fTicky=r,i.fLowerPad.$ratio_pad="low",i.fLowerPad.fTickx=f,i.fLowerPad.fTicky=r,this})}static draw(i,a,n){return g(this,null,function*(){let e=new v(i,a,n);return X(e,!1).then(()=>e.redraw())})}};export{L as TRatioPlotPainter};
