import{a as z,b as E}from"./chunk-2IR3OD6Q.js";import{a as j}from"./chunk-U54GQJ26.js";import"./chunk-3MJ5AJB7.js";import"./chunk-STN7OMLL.js";import"./chunk-JFO4ENDF.js";import{a as L}from"./chunk-3W3OTHNE.js";import{h as G}from"./chunk-HB357Z3Y.js";import"./chunk-OI5V6APH.js";import"./chunk-S3FA7C5I.js";import"./chunk-FENW22PV.js";import"./chunk-K2P6CES6.js";import"./chunk-LNTKXTVM.js";import"./chunk-MFPRCIVI.js";import"./chunk-SVHROGNI.js";import{H as k,I as B,na as O}from"./chunk-DLJYFRIS.js";import{Sa as X,Xa as w,f as b,hb as P,mb as A,nb as H,t as C,u as Y}from"./chunk-MAT3H5WR.js";import{k as N}from"./chunk-KYPE3LET.js";var W=class I extends j{#t;#e;#i;setFunc(e){this.#e=e}getObjectName(){return this.#e?.fName??"func"}getClassName(){return this.#e?._typename??w}isTF1(){return!0}getPrimaryObject(){return this.#e}updateObject(e){if(!e||this.getClassName()!==e._typename)return!1;delete e.evalPar;let t=this.getHisto();if(this._webcanv_hist){let i=this.getPadPainter()?.findInPrimitives("Func",X);i&&this.updateAxes(t,i,this.getFramePainter())}return this.setFunc(e),this.createTF2Histogram(e,t),this.scanContent(),!0}redraw(e){return!this.#t&&(e==="logx"||e==="logy"||e==="zoom")&&(this.createTF2Histogram(this.#e,this.getHisto()),this.scanContent()),super.redraw(e)}createTF2Histogram(e,t){let i=e.fSave.length-6;i>0&&i!==(e.fSave[i+4]+1)*(e.fSave[i+5]+1)&&(i=0),this.#t=i>0&&(C.PreferSavedPoints||this._use_saved>1);let m=this.getFramePainter(),v=this.getPadPainter()?.getRootPad(!0),l=v?.fLogx,c=v?.fLogy,r=m?.getGrFuncs(this.second_x,this.second_y),n=e.fXmin,y=e.fXmax,f=e.fYmin,g=e.fYmax,x=Math.max(e.fNpx,20),p=Math.max(e.fNpy,20);if(r?.zoom_xmin!==r?.zoom_xmax){let a=(y-n)/x;n<r.zoom_xmin&&r.zoom_xmin<y&&(n=Math.max(n,r.zoom_xmin-a)),n<r.zoom_xmax&&r.zoom_xmax<y&&(y=Math.min(y,r.zoom_xmax+a))}if(r?.zoom_ymin!==r?.zoom_ymax){let a=(g-f)/p;f<r.zoom_ymin&&r.zoom_ymin<g&&(f=Math.max(f,r.zoom_ymin-a)),f<r.zoom_ymax&&r.zoom_ymax<g&&(g=Math.min(g,r.zoom_ymax+a))}let T=(a,o)=>{t.fNcells!==(a+2)*(o+2)&&(t.fNcells=(a+2)*(o+2),t.fArray=new Float32Array(t.fNcells)),t.fArray.fill(0),t.fXaxis.fNbins=a,t.fXaxis.fXbins=[],t.fYaxis.fNbins=o,t.fYaxis.fXbins=[]};if(this.#i=void 0,!this.#t){let a=!1;!e.evalPar&&!L(e)&&(a=!0),T(x,p),t.fXaxis.fXmin=n,t.fXaxis.fXmax=y,t.fYaxis.fXmin=f,t.fYaxis.fXmax=g,l&&z(t.fXaxis,x,n,y),c&&z(t.fYaxis,p,f,g);for(let o=0;o<p&&!a;++o)for(let S=0;S<x&&!a;++S){let h=t.fXaxis.GetBinCenter(S+1),d=t.fYaxis.GetBinCenter(o+1),s=0;try{s=e.evalPar(h,d)}catch{a=!0}a||t.setBinContent(t.getBin(S+1,o+1),Number.isFinite(s)?s:0)}a&&(this.#i=!0),a&&i>6&&(this.#t=!0)}if(this.#t){x=Math.round(e.fSave[i+4]),p=Math.round(e.fSave[i+5]),n=e.fSave[i],y=e.fSave[i+1],f=e.fSave[i+2],g=e.fSave[i+3];let a=(y-n)/x,o=(g-f)/p,S=(h,d)=>{if(h<n||h>y||a<=0||d<f||d>g||o<=0)return 0;let s=Math.min(x-1,Math.floor((h-n)/a)),_=Math.min(p-1,Math.floor((d-f)/o)),M=n+s*a,D=f+_*o,u=(h-M)/a,F=(d-D)/o,R=_*(x+1)+s,q=_*(x+1)+s+1,J=(_+1)*(x+1)+s+1,K=(_+1)*(x+1)+s;return(1-u)*(1-F)*e.fSave[R]+u*(1-F)*e.fSave[q]+u*F*e.fSave[J]+(1-u)*F*e.fSave[K]};T(e.fNpx,e.fNpy),t.fXaxis.fXmin=e.fXmin,t.fXaxis.fXmax=e.fXmax,t.fYaxis.fXmin=e.fYmin,t.fYaxis.fXmax=e.fYmax;for(let h=0;h<e.fNpy;++h){let d=t.fYaxis.GetBinCenter(h+1);for(let s=0;s<e.fNpx;++s){let _=t.fXaxis.GetBinCenter(s+1),M=S(_,d);t.setBinContent(t.getBin(s+1,h+1),Number.isFinite(M)?M:0)}}}return t.fName="Func",H(t,e.fTitle),t.fMinimum=e.fMinimum,t.fMaximum=e.fMaximum,t.fLineColor=e.fLineColor,t.fLineStyle=e.fLineStyle,t.fLineWidth=e.fLineWidth,t.fFillColor=e.fFillColor,t.fFillStyle=e.fFillStyle,t.fMarkerColor=e.fMarkerColor,t.fMarkerStyle=e.fMarkerStyle,t.fMarkerSize=e.fMarkerSize,t.fBits|=P,t}extractAxesProperties(e){super.extractAxesProperties(e);let t=this.#e,i=t?.fSave.length??0;i>6&&this.#t&&(this.xmin=Math.min(this.xmin,t.fSave[i-6]),this.xmax=Math.max(this.xmax,t.fSave[i-5]),this.ymin=Math.min(this.ymin,t.fSave[i-4]),this.ymax=Math.max(this.ymax,t.fSave[i-3])),t&&(this.xmin=Math.min(this.xmin,t.fXmin),this.xmax=Math.max(this.xmax,t.fXmax),this.ymin=Math.min(this.ymin,t.fYmin),this.ymax=Math.max(this.ymax,t.fYmax))}getTF2Tooltips(e){let t=[this.getObjectHint()],i=this.getOptions(),m=this.getFramePainter()?.getGrFuncs(i.second_x,i.second_y);if(!m||!b(this.#e?.evalPar))return t.push("grx = "+e.x,"gry = "+e.y),t;let v=m.revertAxis("x",e.x),l=m.revertAxis("y",e.y),c=0,r=!1;try{c=this.#e.evalPar(v,l)}catch{r=!0}return t.push("x = "+m.axisAsText("x",v),"y = "+m.axisAsText("y",l),"value = "+(r?"<fail>":k(c,Y.fStatFormat))),t}processTooltipEvent(e){if(this.#t)return super.processTooltipEvent(e);let t=this.getG()?.selectChild(".tooltip_bin");if(!this.getG()||!e)return t?.remove(),null;let i={name:this.#e?.fName,title:this.#e?.fTitle,x:e.x,y:e.y,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getTF2Tooltips(e),exact:!0,menu:!0};return e.disabled?t.remove():(t.empty()&&(t=this.getG().append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").style("fill","none").attr("r",(this.lineatt?.width??1)+4)),t.attr("cx",e.x).attr("cy",e.y),this.lineatt&&t.call(this.lineatt.func)),i}fillWebObjectOptions(e){e.fcust=this.#i&&!this._use_saved?"func_fail":""}static draw(e,t,i){return N(this,null,function*(){let m=E(i);i=m.opt,delete m.opt;let v=new B(i);v.empty()?i="cont3":v.opt==="SAME"&&(i="cont2 same");let l;m._webcanv_hist&&(l=O(e)?.findInPrimitives("Func",X)),l||(l=A(X,20,20),l.fBits|=P);let c=new I(e,l);return c.setFunc(t),Object.assign(c,m),c.createTF2Histogram(t,l),G._drawHist(c,i)})}};export{W as TF2Painter};
