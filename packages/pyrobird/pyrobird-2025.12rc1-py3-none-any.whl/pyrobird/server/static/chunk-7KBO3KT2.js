import{a as b}from"./chunk-QBWQK3DT.js";import"./chunk-3MJ5AJB7.js";import"./chunk-STN7OMLL.js";import"./chunk-JFO4ENDF.js";import"./chunk-3W3OTHNE.js";import"./chunk-HB357Z3Y.js";import"./chunk-OI5V6APH.js";import"./chunk-S3FA7C5I.js";import"./chunk-FENW22PV.js";import"./chunk-K2P6CES6.js";import"./chunk-LNTKXTVM.js";import"./chunk-MFPRCIVI.js";import"./chunk-SVHROGNI.js";import{H as u,I as X,K as P,ka as _}from"./chunk-DLJYFRIS.js";import{Na as d,hb as y,mb as M,u as x}from"./chunk-MAT3H5WR.js";import{k as g}from"./chunk-KYPE3LET.js";var O=class v extends _{#t;updateObject(t,i){let e=this.getObject();return e._typename!==t._typename?!1:(e!==t&&Object.assign(e,t),i!==void 0&&this.decodeOptions(i),!0)}eval(t,i){let e=i-t.fX;return t._typename==="TSplinePoly3"?t.fY+e*(t.fB+e*(t.fC+e*t.fD)):t._typename==="TSplinePoly5"?t.fY+e*(t.fB+e*(t.fC+e*(t.fD+e*(t.fE+e*t.fF)))):t.fY+e}findX(t){let i=this.getObject(),e=0,s=i.fNp-1;if(t<=i.fXmin)return e;if(t>=i.fXmax)return s;if(i.fKstep)e=Math.round((t-i.fXmin)/i.fDelta),t<i.fPoly[e].fX?e=Math.max(e-1,0):e<s&&t>i.fPoly[e+1].fX&&++e;else for(;s-e>1;){let r=Math.round((e+s)/2);t>i.fPoly[r].fX?e=r:s=r}return e}createDummyHisto(){let t=this.getObject(),i=0,e=1,s=0,r=1;t.fPoly&&(i=e=t.fPoly[0].fX,s=r=t.fPoly[0].fY,t.fPoly.forEach(f=>{i=Math.min(f.fX,i),e=Math.max(f.fX,e),s=Math.min(f.fY,s),r=Math.max(f.fY,r)}),r>0&&(r*=1+x.fHistTopMargin),s<0&&(s*=1+x.fHistTopMargin));let a=M(d,10);return a.fName=t.fName+"_hist",a.fTitle=t.fTitle,a.fBits|=y,a.fXaxis.fXmin=i,a.fXaxis.fXmax=e,a.fYaxis.fXmin=s,a.fYaxis.fXmax=r,a.fMinimum=s,a.fMaximum=r,a}processTooltipEvent(t){let i=this.getObject(),e=this.getOptions(),s=this.getFramePainter()?.getGrFuncs(e.second_x,e.second_y),r=!1,a,f,n=null,l=0;t===null||!i||!s?r=!0:(a=s.revertAxis("x",t.x),l=this.findX(a),n=i.fPoly[l],f=this.eval(n,a),l<i.fN-1&&Math.abs(i.fPoly[l+1].fX-a)<Math.abs(a-n.fX)&&(n=i.fPoly[++l]),Math.abs(s.grx(n.fX)-t.x)<.5*this.#t?(a=n.fX,f=n.fY):(n=null,(a<i.fXmin||a>i.fXmax)&&(r=!0)));let c=this.getG()?.selectChild(".tooltip_bin"),h=this.lineatt.width+3;if(r||!this.getG())return c?.remove(),null;c.empty()&&(c=this.getG().append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",h).style("fill","none").call(this.lineatt.func));let o={name:this.getObject().fName,title:this.getObject().fTitle,x:s.grx(a),y:s.gry(f),color1:this.lineatt.color,lines:[],exact:n!==null||Math.abs(s.gry(f)-t.y)<h};o.changed=c.property("current_xx")!==a,o.menu=o.exact,o.menu_dist=Math.sqrt((o.x-t.x)**2+(o.y-t.y)**2),o.changed&&c.attr("cx",Math.round(o.x)).attr("cy",Math.round(o.y)).property("current_xx",a);let m=this.getObjectHint();return m&&o.lines.push(m),o.lines.push(`x = ${s.axisAsText("x",a)}`,`y = ${s.axisAsText("y",f)}`),n!==null&&(o.lines.push(`knot = ${l}`,`B = ${u(n.fB,x.fStatFormat)}`,`C = ${u(n.fC,x.fStatFormat)}`,`D = ${u(n.fD,x.fStatFormat)}`),n.fE!==void 0&&n.fF!==void 0&&o.lines.push(`E = ${u(n.fE,x.fStatFormat)}`,`F = ${u(n.fF,x.fStatFormat)}`)),o}redraw(){let t=this.getObject(),i=this.getOptions(),e=this.getFramePainter().getGrFuncs(i.second_x,i.second_y),s=e.getFrameWidth(),r=e.getFrameHeight(),a=this.createG(!0);if(this.#t=5,this.createAttLine({attr:t}),i.Line||i.Curve){let f=Math.max(10,t.fNpx),n=[],l=Math.max(e.scale_xmin,t.fXmin),c=Math.min(e.scale_xmax,t.fXmax),h=this.findX(l);e.logx&&(l=Math.log(l),c=Math.log(c));for(let o=0;o<f;++o){let m=l+(c-l)/f*(o-1);for(e.logx&&(m=Math.exp(m));h<t.fNp-1&&m>t.fPoly[h+1].fX;)++h;let p=this.eval(t.fPoly[h],m);n.push({x:m,y:p,grx:e.grx(m),gry:e.gry(p)})}a.append("svg:path").attr("class","line").attr("d",P(n)).style("fill","none").call(this.lineatt.func)}if(i.Mark){this.createAttMarker({attr:t}),this.markeratt.resetPos(),this.#t=this.markeratt.getFullSize();let f="";for(let n=0;n<t.fPoly.length;n++){let l=t.fPoly[n],c=e.grx(l.fX);if(c>-this.#t&&c<s+this.#t){let h=e.gry(l.fY);h>-this.#t&&h<r+this.#t&&(f+=this.markeratt.create(c,h))}}f&&a.append("svg:path").attr("d",f).call(this.markeratt.func)}}canZoomInside(t){return t!=="x"?!1:!!this.getObject()}decodeOptions(t){let i=new X(t),e=this.setOptions({Same:i.check("SAME"),Line:i.check("L"),Curve:i.check("C"),Mark:i.check("P"),Hopt:"",second_x:!1,second_y:!1});!e.Line&&!e.Curve&&!e.Mark&&(e.Curve=!0),i.check("X+")&&(e.Hopt+="X+",e.second_x=!!this.getMainPainter()),i.check("Y+")&&(e.Hopt+="Y+",e.second_y=!!this.getMainPainter()),this.storeDrawOpt(t)}static draw(t,i,e){return g(this,null,function*(){let s=new v(t,i);s.decodeOptions(e);let r=!s.getMainPainter(),a=Promise.resolve();if(r||s.options.second_x||s.options.second_y){if(s.options.Same&&r)return console.warn("TSpline painter requires histogram to be drawn"),null;let f=s.createDummyHisto();a=b.draw(t,f,s.options.Hopt)}return a.then(()=>(s.addToPadPrimitives(),s.redraw(),s))})}};export{O as TSplinePainter};
