"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[875],{4027:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C});var o=n(61624),i=n(2512),l=n(3104),a=n(31249),r=n(9733),u=n(4359),s=n(8568),d=n(14485);function c(e,t,n,o,i,l,a){try{var r=e[l](a),u=r.value}catch(e){n(e);return}r.done?t(u):Promise.resolve(u).then(o,i)}function v(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var l=e.apply(t,n);function a(e){c(l,o,i,a,r,"next",e)}function r(e){c(l,o,i,a,r,"throw",e)}a(void 0)})}}let f={class:"chat-wrapper"},p={class:"chat-container"},h={key:0,class:"session-list-sidebar"},w={class:"top-controls"},m={class:"input-icon suffix-icon"},y=["onClick"],k={class:"conversation-title"},g={class:"conversation-subtitle"},N=(0,o.defineComponent)({__name:"page-demo",setup(e){var t,n,c,N;let C=(0,o.ref)(null),V=(0,o.ref)([]),S=(0,o.ref)(null),E=(0,o.ref)(""),x=(0,o.ref)(null),D=(0,o.ref)(!1),B=(0,o.ref)(window.BK_API_PREFIX),_=(t=v(function*(){let e=yield(0,d.i)(B.value);return x.value=e,e}),function(){return t.apply(this,arguments)}),A=e=>{console.error("SDK错误:",e),s.A.push("/403")},T=(0,o.ref)(800),b=(0,o.computed)(()=>"undefined"==typeof window?800:I.value?window.innerWidth-280:window.innerWidth),L=(0,o.ref)("加载中..."),P=(0,o.ref)(!0),z=(0,o.reactive)({loading:P,title:L}),W=(0,o.computed)(()=>E.value?V.value.filter(e=>e.sessionName.toLowerCase().includes(E.value.toLowerCase())):V.value),I=(0,o.computed)(()=>{var e,t,n;return!!x.value&&(null===(n=null===(t=x.value)||void 0===t?void 0:null===(e=t.conversation_settings)||void 0===e?void 0:e.enable_chat_session)||void 0===n||n)}),$=e=>{if(!e)return"";let t=new Date(e),n=new Date,o=new Date(n);return(o.setDate(o.getDate()-1),t.toDateString()===n.toDateString())?"今天":t.toDateString()===o.toDateString()?"昨天":t.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})},F=(n=v(function*(e){if(C.value&&"function"==typeof C.value.switchToSession)try{yield C.value.switchToSession(e);let t=V.value;S.value=t.find(t=>t.sessionCode===e)||null}catch(e){console.error("切换会话失败:",e)}}),function(e){return n.apply(this,arguments)}),H=(c=v(function*(){if(C.value&&"function"==typeof C.value.addNewSession)try{let e=yield C.value.addNewSession();C.value.getSessionList&&(V.value=yield C.value.getSessionList()),e&&e.sessionCode&&(S.value=e)}catch(e){console.error("创建新会话失败:",e)}}),function(){return c.apply(this,arguments)}),K=(N=v(function*(){var e;if(C.value&&void 0!==(null===(e=C.value.sessionList)||void 0===e?void 0:e.value))V.value=C.value.sessionList.value,S.value=V.value[0]||null;else if(C.value&&"function"==typeof C.value.getSessionList)try{V.value=yield C.value.getSessionList(),S.value=V.value[0]||null}catch(e){console.error("获取会话列表失败:",e)}}),function(){return N.apply(this,arguments)});(0,o.watch)(()=>{var e,t;return null===(t=C.value)||void 0===t?void 0:null===(e=t.sessionList)||void 0===e?void 0:e.value},e=>{e&&(V.value=e,!S.value&&e.length>0&&(S.value=e[0]))},{deep:!0});let j=()=>{"undefined"!=typeof window&&(T.value=I.value?window.innerWidth-280:window.innerWidth,setTimeout(()=>{if(C.value&&"function"==typeof C.value.updatePositionAndSize){let e=I.value?window.innerWidth-280:window.innerWidth,t=window.innerWidth-e;C.value.updatePositionAndSize(t,52,e,window.innerHeight-52)}},100))};return(0,o.onMounted)(v(function*(){"undefined"!=typeof window&&window.addEventListener("resize",j),yield _(),D.value=!0,setTimeout(()=>{var e;null===(e=C.value)||void 0===e||e.handleShow(),P.value=!1,K(),setTimeout(()=>{"undefined"!=typeof window&&window.dispatchEvent(new Event("resize"))},100)},200)})),(e,t)=>{let n=(0,o.resolveComponent)("bk-exception"),s=(0,o.resolveDirective)("bkloading");return(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("div",f,[(0,o.createElementVNode)("div",p,[I.value?((0,o.openBlock)(),(0,o.createElementBlock)("div",h,[(0,o.createElementVNode)("div",w,[(0,o.createVNode)((0,o.unref)(i.A),{type:"text",class:"search-input",placeholder:"搜索会话名称",modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=e=>E.value=e),clearable:""},{suffix:(0,o.withCtx)(()=>[(0,o.createElementVNode)("span",m,[(0,o.createVNode)((0,o.unref)(a.A))])]),_:1},8,["modelValue"])]),t[4]||(t[4]=(0,o.createTextVNode)()),(0,o.createVNode)((0,o.unref)(l.Ay),{class:"new-chat-button",onClick:H},{default:(0,o.withCtx)(()=>[(0,o.createVNode)((0,o.unref)(r.A),{class:"f22"}),t[1]||(t[1]=(0,o.createTextVNode)()),t[2]||(t[2]=(0,o.createElementVNode)("span",null,"添加会话",-1))]),_:1,__:[1,2]}),t[5]||(t[5]=(0,o.createTextVNode)()),(0,o.createElementVNode)("div",{class:(0,o.normalizeClass)(["conversation-list",{"is-empty":0===W.value.length&&E.value}])},[W.value.length>0?((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,{key:0},(0,o.renderList)(W.value,e=>{var n;return(0,o.openBlock)(),(0,o.createElementBlock)("div",{key:e.sessionCode,class:(0,o.normalizeClass)(["conversation-item",{active:(null===(n=S.value)||void 0===n?void 0:n.sessionCode)===e.sessionCode}]),onClick:t=>F(e.sessionCode)},[(0,o.createElementVNode)("div",k,(0,o.toDisplayString)(e.sessionName),1),t[3]||(t[3]=(0,o.createTextVNode)()),(0,o.createElementVNode)("div",g,(0,o.toDisplayString)($(e.createdAt)),1)],10,y)}),128)):((0,o.openBlock)(),(0,o.createBlock)(n,{key:1,style:{"margin-top":"100px"},description:E.value?"搜索为空":"暂无对话",scene:"part",type:E.value?"search-empty":"empty"},null,8,["description","type"]))],2)])):(0,o.createCommentVNode)("",!0),t[6]||(t[6]=(0,o.createTextVNode)()),(0,o.createElementVNode)("div",{class:(0,o.normalizeClass)(["main-chat-area",{"full-width":!I.value}])},[D.value?((0,o.openBlock)(),(0,o.createBlock)((0,o.unref)(u.Ay),{key:0,ref_key:"aiBlueking",ref:C,"ext-cls":"page-demo-ai-blueking","hide-header":"",draggable:!1,"hide-nimbus":!1,url:B.value,"default-top":52,"sdk-error":A,"default-width":b.value},null,8,["url","default-width"])):(0,o.createCommentVNode)("",!0)],2)])])),[[s,z]])}}}),C=(0,n(24028).A)(N,[["__scopeId","data-v-7481ca16"]])},14485:(e,t,n)=>{n.d(t,{i:()=>l});var o=n(8568);function i(e,t,n,o,i,l,a){try{var r=e[l](a),u=r.value}catch(e){n(e);return}r.done?t(u):Promise.resolve(u).then(o,i)}let l=function(){var e,t=(e=function*(e){try{let t=yield fetch(`${e}/agent/info/`,{credentials:"include"});if(!t.ok&&403===t.status)throw o.A.push("/403"),Error(`HTTP Error: ${t.status} ${t.statusText}`);return(yield t.json()).data}catch(e){return console.error("获取Agent信息失败:",e),null}},function(){var t=this,n=arguments;return new Promise(function(o,l){var a=e.apply(t,n);function r(e){i(a,o,l,r,u,"next",e)}function u(e){i(a,o,l,r,u,"throw",e)}r(void 0)})});return function(e){return t.apply(this,arguments)}}()}}]);