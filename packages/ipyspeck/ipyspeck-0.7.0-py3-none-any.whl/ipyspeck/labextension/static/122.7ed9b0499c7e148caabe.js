"use strict";(self.webpackChunkipyspeck=self.webpackChunkipyspeck||[]).push([[122],{56:(e,t,i)=>{e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function i(e){for(var i=-1,o=0;o<t.length;o++)if(t[o].identifier===e){i=o;break}return i}function o(e,o){for(var n={},r=[],a=0;a<e.length;a++){var l=e[a],c=o.base?l[0]+o.base:l[0],d=n[c]||0,h="".concat(c," ").concat(d);n[c]=d+1;var u=i(h),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(m);else{var p=s(m,o);o.byIndex=a,t.splice(a,0,{identifier:h,updater:p,references:1})}r.push(h)}return r}function s(e,t){var i=t.domAPI(t);return i.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,s){var n=o(e=e||[],s=s||{});return function(e){e=e||[];for(var r=0;r<n.length;r++){var a=i(n[r]);t[a].references--}for(var l=o(e,s),c=0;c<n.length;c++){var d=i(n[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}n=l}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},122:function(e,t,i){var o=this&&this.__createBinding||(Object.create?function(e,t,i,o){void 0===o&&(o=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,o,s)}:function(e,t,i,o){void 0===o&&(o=i),e[o]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&o(t,e,i);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(983),a=n(i(885)),l=i(797),c={id:"ipyspeck:plugin",requires:[r.IJupyterWidgetRegistry],activate:function(e,t){t.registerWidget({name:l.MODULE_NAME,version:l.MODULE_VERSION,exports:a})},autoStart:!0};t.default=c},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var i="",o=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),o&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),o&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i}).join("")},t.i=function(e,i,o,s,n){"string"==typeof e&&(e=[[null,e,void 0]]);var r={};if(o)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(r[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&r[d[0]]||(void 0!==n&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=n),i&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=i):d[2]=i),s&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=s):d[4]="".concat(s)),t.push(d))}},t}},463:(e,t,i)=>{i.r(t),i.d(t,{default:()=>w});var o=i(72),s=i.n(o),n=i(825),r=i.n(n),a=i(659),l=i.n(a),c=i(56),d=i.n(c),h=i(540),u=i.n(h),m=i(113),p=i.n(m),v=i(930),f={};f.styleTagTransform=p(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=r(),f.insertStyleElement=u(),s()(v.A,f);const w=v.A&&v.A.locals?v.A.locals:void 0},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,i){var o=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(i)}},797:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MODULE_NAME=t.MODULE_VERSION=void 0;const o=i(330);t.MODULE_VERSION=o.version,t.MODULE_NAME=o.name},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var o="";i.supports&&(o+="@supports (".concat(i.supports,") {")),i.media&&(o+="@media ".concat(i.media," {"));var s=void 0!==i.layer;s&&(o+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),o+=i.css,s&&(o+="}"),i.media&&(o+="}"),i.supports&&(o+="}");var n=i.sourceMap;n&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},885:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SpeckView=t.SpeckModel=void 0;const o=i(983),s=i(797),n=i(686),r=i(212),a=i(572),l=i(156),c=i(609);i(463);class d extends o.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:d.model_name,_model_module:d.model_module,_model_module_version:d.model_module_version,_view_name:d.view_name,_view_module:d.view_module,_view_module_version:d.view_module_version,data:"",bonds:!0,atomScale:.24,relativeAtomScale:.64,bondScale:.5,brightness:.5,outline:0,spf:32,bondThreshold:1.2,bondShade:.5,atomShade:.5,dofStrength:0,dofPosition:.5})}}t.SpeckModel=d,d.serializers=Object.assign({},o.DOMWidgetModel.serializers),d.model_name="SpeckModel",d.model_module=s.MODULE_NAME,d.model_module_version=s.MODULE_VERSION,d.view_name="SpeckView",d.view_module=s.MODULE_NAME,d.view_module_version=s.MODULE_VERSION;class h extends o.DOMWidgetView{initialize(e){super.initialize(e),this.system=r.new(),this.view=a.new(),this.view.resolution.x=200,this.view.resolution.y=200,this.view.bonds=this.model.get("bonds"),this.view.atomScale=this.model.get("atomScale"),this.view.relativeAtomScale=this.model.get("relativeAtomScale"),this.view.bondScale=this.model.get("bondScale"),this.view.brightness=this.model.get("brightness"),this.view.outline=this.model.get("outline"),this.view.spf=this.model.get("spf"),this.view.bondThreshold=this.model.get("bondThreshold"),this.view.bondShade=this.model.get("bondShade"),this.view.atomShade=this.model.get("atomShade"),this.view.dofStrength=this.model.get("dofStrength"),this.view.dofPosition=this.model.get("dofPosition"),this.renderer=null,this.needReset=!1,this.current_schema="speck"}render(){const e=this;e.container=document.createElement("div"),e.canvas=document.createElement("canvas"),e.canvas.addEventListener("dblclick",function(){e.center()}),e.topbar=document.createElement("div"),e.topbar.style.top="0px",e.topbar.style.height="20px",e.topbar.style.right="0px",e.topbar.style.position="absolute",e.topbar.style.background="rgba(255,255,255,0.5)",e.topbar.style.flexDirection="row",e.topbar.style.alignContent="flex-end",e.topbar.style.display="flex",e.container.appendChild(e.canvas),e.el.appendChild(e.topbar),e.el.appendChild(e.container),e.el.style.width="100%",e.el.style.height="100%",l({container:e.container,scrollZoom:!0,getRotation:function(){return e.view.rotation},setRotation:function(t){e.view.rotation=t},getTranslation:function(){return e.view.translation},setTranslation:function(t){e.view.translation=t},getZoom:function(){return e.view.zoom},setZoom:function(t){e.view.zoom=t},refreshView:function(){e.needReset=!0}}),this.model.on("change:data",this.loadStructure,this),this.model.on("change:bonds",()=>{this.view.bonds=this.model.get("bonds"),this.needReset=!0}),this.model.on("change:atomScale",()=>{this.view.atomScale=this.model.get("atomScale"),this.needReset=!0}),this.model.on("msg:custom",this.handleCustomMessage,this)}processLuminoMessage(e){super.processLuminoMessage(e),this._handleMessage(e)}_handleMessage(e){const t=this;switch(e.type){case"before-attach":window.addEventListener("resize",function(){t.reflow(),t.loadStructure()});break;case"after-attach":t.reflow(),t.loop(),t.loadStructure();break;case"resize":t.reflow(),t.center()}}handleCustomMessage(e){"do"in e&&("frontView"===e.do?this.frontview():"topView"===e.do?this.topview():"rightView"===e.do?this.rightview():"changeAtomsColor"===e.do?this.setAtomsColor(e.atoms):"changeColorSchema"===e.do?this.setColorSchema(e.schema):"switchColorSchema"===e.do&&this.switchColorSchema())}loadStructure(){const e=this.xyz(this.model.get("data"))[0];if(e){this.system=r.new();for(let t=0;t<e.length;t++){const i=e[t];r.addAtom(this.system,i.symbol,i.position[0],i.position[1],i.position[2])}this.center()}}center(){this.system&&(r.center(this.system),r.calculateBonds(this.system,this.view),this.renderer.setSystem(this.system,this.view),a.center(this.view,this.system),this.needReset=!0)}topview(){this.system&&(a.rotateX(this.view,Math.PI/2),this.center())}frontview(){this.system&&(a.rotateX(this.view,0),this.center())}rightview(){this.system&&(a.rotateY(this.view,-Math.PI/2),this.center())}setAtomsColor(e){for(const t in e)t in this.view.elements&&(this.view.elements[t].color=e[t],this.needReset=!0);this.needReset&&(r.calculateBonds(this.system,this.view),this.renderer.setSystem(this.system,this.view))}setColorSchema(e){e in c&&(this.current_schema=e,this.setAtomsColor(c[e]))}switchColorSchema(){let e,t=!1;for(const i in c){if(void 0===e&&(e=i),t)return void this.setColorSchema(i);i===this.current_schema&&(t=!0)}e&&this.setColorSchema(e)}xyz(e){const t=e.split("\n"),i=parseInt(t[0]),o=Math.floor(t.length/(i+2)),s=[];for(let e=0;e<o;e++){const o=[];for(let s=0;s<i;s++){const n=t[e*(i+2)+s+2].split(/\s+/),r={};let a=0;for(;""===n[a];)a++;r.symbol=n[a++],r.position=[parseFloat(n[a++]),parseFloat(n[a++]),parseFloat(n[a++])],o.push(r)}s.push(o)}return s}reflow(){let e=this.container.parentElement.clientWidth,t=this.container.parentElement.clientHeight;0===e&&(e=this.view.resolution.x),0===t&&(t=this.view.resolution.y),this.view.resolution.x===e&&this.view.resolution.y===t||(this.container.style.height=t+"px",this.container.style.width=e+"px",this.container.style.left="0px",this.container.style.top="0px",this.view.resolution.x=e,this.view.resolution.y=t,this.renderer=new n(this.canvas,this.view.resolution,this.view.aoRes))}loop(){this.needReset&&(this.renderer.reset(),this.needReset=!1),this.renderer.render(this.view),requestAnimationFrame(()=>this.loop())}}t.SpeckView=h},930:(e,t,i)=>{i.d(t,{A:()=>a});var o=i(601),s=i.n(o),n=i(314),r=i.n(n)()(s());r.push([e.id,"/* Speck widget styles */\n",""]);const a=r}}]);