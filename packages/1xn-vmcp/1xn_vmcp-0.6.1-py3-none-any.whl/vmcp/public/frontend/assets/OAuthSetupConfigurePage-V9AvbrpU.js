import{j as e}from"./ui-BzkW_zSA.js";import{f as z,j as Z,r as h}from"./vendor-Dje7enk0.js";import{u as q,d as G,a as w,B as N,C as H,S as J,z as K}from"./index-CxHQsSmh.js";import{C as A,d as P,b as M,c as W,a as O}from"./card-BfWTGDCc.js";import{B as Y}from"./badge-B4R87TdU.js";import{V as Q,I as X}from"./VMCPDetailsDisplay-729UBGdX.js";import{T as ee}from"./triangle-alert-Bh-fty_y.js";import{A as V}from"./arrow-left-CKzykAC6.js";import{Z as se}from"./zap-BQC4oCcW.js";import{L as te}from"./lock-BylOtS64.js";import{M as re}from"./message-square-CU5DKSXQ.js";import{C as ae}from"./circle-check-big-Ca-XExcj.js";import"./favicon-icon-BELQjD9b.js";import"./chevron-down-Cj0HsQ0D.js";import"./type-BdYygmtS.js";import"./file-text-BF6iJmBf.js";import"./wifi-C6zxt-eS.js";function Ce(){const f=q(),S=z(),[n]=Z(),{error:g}=G(),i=S.vmcp_name,b=n.get("vmcp_username"),j=n.get("code"),l=n.get("state"),r=n.get("redirect_url"),u=n.get("user_id"),x=n.get("vmcp_type"),d=n.get("error"),[k,v]=h.useState(!0),[C,y]=h.useState(!1),[t,_]=h.useState(null);h.useEffect(()=>{E()},[]);const E=async()=>{try{if(v(!0),console.log("Loading VMCP data for:",i,b,u,d),d){v(!1);return}const a=n.get("fetch_vmcp_config_from");if(a){const o=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({original_state:l,vmcp_name:i,vmcp_username:b,user_id:u})});if(o.ok){const p=await o.json(),s=p.vmcp_config||{},L=Object.values(s.selected_tools||{}).reduce((m,c)=>m+(Array.isArray(c)?c.length:0),0),B=Object.values(s.selected_resources||{}).reduce((m,c)=>m+(Array.isArray(c)?c.length:0),0),D=Object.values(s.selected_prompts||{}).reduce((m,c)=>m+(Array.isArray(c)?c.length:0),0),F=Array.isArray(s.custom_prompts)?s.custom_prompts.length:0,U=s.total_prompts!==void 0?s.total_prompts:D+F,I=s.name||s.selected_servers?.[0]?.name||i,$=s.description||s.selected_servers?.[0]?.description;_({id:p.vmcp_new_id||i,name:I,description:$,vmcp_config:s,total_tools:L,total_resources:B,total_prompts:U,environment_variables:s.environment_variables||[]})}else throw new Error("Failed to fetch VMCP configuration")}else{const o=await w.getVMCPConfiguration(i,{code:j,state:l,redirect_url:r,user_id:u,vmcp_type:x});o.success?_(o.data):g("Failed to load VMCP data")}}catch(a){console.error("Error loading VMCP data:",a),g("Error loading VMCP data")}finally{v(!1)}},T=async()=>{try{y(!0),console.log("Saving VMCP Configuration");const a=await w.saveVMCPConfiguration(i,{vmcp_config:t,code:j,state:l,user_id:u,vmcp_type:x});if(console.log("VMCP Configuration saved"),r){console.log("Redirecting to:",r);const o=r.includes("?")?"&":"?",p=r+(l?"&state="+l:"");window.location.href=p}else f.push(`/oauth_setup/${i}/callback?code=${j}&state=${l}&configured=true`)}catch(a){console.error("Error completing OAuth:",a),g("Error completing OAuth flow")}finally{y(!1)}},R=()=>{if(r){const a=r.includes("?")?"&":"?",o=r+a+"error="+encodeURIComponent(d||"OAuth setup failed");console.log("Returning to client:",o),window.location.href=o}else f.push("/vmcp")};return k?e.jsx("div",{className:"min-h-screen bg-background text-foreground flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading OAuth configuration..."})]})}):d?e.jsx("div",{className:"min-h-screen bg-background text-foreground flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-destructive/20 flex items-center justify-center mx-auto mb-4",children:e.jsx(ee,{className:"h-6 w-6 text-destructive"})}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"OAuth Setup Error"}),e.jsx("div",{className:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg mb-6",children:e.jsx("p",{className:"text-destructive text-sm",children:d})}),e.jsx("div",{className:"flex gap-3 justify-center",children:r&&e.jsxs(N,{onClick:R,variant:"destructive",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Return to Client"]})})]})}):t?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/20 flex items-center justify-center",children:e.jsx(H,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Complete OAuth Setup"}),e.jsxs("p",{className:"text-muted-foreground",children:["OAuth authentication for ",t.name]})]})]})}),e.jsxs(A,{className:"mb-6",children:[e.jsx(P,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{className:"text-xl",children:t.name}),e.jsx(W,{className:"text-sm mt-1",children:t.description||"No description available"})]}),e.jsx(Y,{variant:"default",className:"text-xs px-2 py-1",children:x==="wellknown"?"Well-Known":"Public"})]})}),e.jsx(O,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted/30",children:[e.jsx(J,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("div",{className:"text-xl font-bold",children:t.vmcp_config?.selected_servers?.length||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"MCP Servers"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted/30",children:[e.jsx(se,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("div",{className:"text-xl font-bold",children:t.total_tools||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Tools"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted/30",children:[e.jsx(te,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("div",{className:"text-xl font-bold",children:t.total_resources||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Resources"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted/30",children:[e.jsx(re,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("div",{className:"text-xl font-bold",children:t.total_prompts||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Prompts"})]})]})})]}),e.jsx("div",{className:"mb-8",children:e.jsx(Q,{vmcpData:t,vmcpType:x||"public",isRemoteVMCP:!1,showExpandableLists:!1})}),e.jsxs(A,{className:"mb-8",children:[e.jsx(P,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-primary"}),"OAuth Setup Details"]})}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"By completing the OAuth flow, you will:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1 pl-4",children:[e.jsx("li",{children:"• Authenticate with the VMCP service"}),e.jsx("li",{children:"• Grant necessary permissions for the VMCP to function"}),e.jsx("li",{children:"• Complete the setup process"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"You can configure server authentication and environment variables after OAuth completion."})]})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(N,{onClick:T,disabled:C,size:"lg",className:"px-8 py-3",children:C?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 mr-2 animate-spin"}),"Completing OAuth..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Complete OAuth Setup"]})})})]})}):e.jsx("div",{className:"min-h-screen bg-background text-foreground flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-destructive",children:"OAuth configuration not found"}),e.jsxs(N,{onClick:()=>f.push("/vmcp"),className:"mt-4",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Back to VMCP"]})]})})}export{Ce as default};
//# sourceMappingURL=OAuthSetupConfigurePage-V9AvbrpU.js.map
