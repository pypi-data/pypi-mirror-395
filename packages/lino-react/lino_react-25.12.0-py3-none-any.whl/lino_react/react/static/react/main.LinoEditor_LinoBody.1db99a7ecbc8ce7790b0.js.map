{"version":3,"file":"main.LinoEditor_LinoBody.1db99a7ecbc8ce7790b0.js","mappings":"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","sources":["webpack://lino_react/./lino_react/react/components/LinoEditor.jsx"],"sourcesContent":["export const name = \"LinoEditor\";\n\nimport React from \"react\";\nimport { RegisterImportPool, URLContextType } from \"./Base\";\nimport { quillToolbar, overrideImageButtonHandler, getQuillModules,\n    invokeRefInsert, quillLoad, QuillNextEditor, changeDelta, refInsert,\n    onRightClick, tableContextMenuProps, Delta } from \"./quillmodules\";\nimport { LeafComponentInput } from \"./LinoComponentUtils\";\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nlet ex; const exModulePromises = ex = {\n    AbortController: import(/* webpackChunkName: \"AbortController_LinoEditor\" */\"abort-controller\"),\n    i18n: import(/* webpackChunkName: \"i18n_LinoEditor\" */\"./i18n\"),\n    // prButton: import(/* webpackChunkName: \"prButton_LinoEditor\" */\"primereact/button\"),\n    // prEditor: import(/* webpackChunkName: \"prEditor_LinoEditor\" */\"primereact/editor\"),\n    // prDialog: import(/* webpackChunkName: \"prDialog_LinoEditor\" */\"primereact/dialog\"),\n    prContextMenu: import(/* webpackChunkName: \"prContextMenu_LinoEditor\" */\"primereact/contextmenu\"),\n    prUtils: import(/* webpackChunkName: \"prUtils_LinoEditor\" */\"primereact/utils\"),\n    u: import(/* webpackChunkName: \"LinoUtils_LinoEditor\" */\"./LinoUtils\"),\n};RegisterImportPool(ex);\n\n\nexport class LinoEditor extends LeafComponentInput {\n    static requiredModules = [\"i18n\", \"AbortController\", \"prContextMenu\",\n        \"prUtils\", \"u\"].concat(LeafComponentInput.requiredModules);\n    static iPool = Object.assign(ex, LeafComponentInput.iPool.copy());\n\n    static defaultProps = {\n        ...LeafComponentInput.defaultProps,\n        leafIndex: 0,\n    }\n\n    async prepare() {\n        await super.prepare();\n        this.controller = new this.ex.AbortController.default();\n        this.ex.i18n = this.ex.i18n.default;\n    }\n\n    constructor(props) {\n        super(props);\n        this.state = {...this.state,\n                      plain: props.elem.field_options.format === \"plain\"}\n\n        this.closeEditor = this.closeEditor.bind(this);\n        this.onGlobalKeyDown = this.onGlobalKeyDown.bind(this);\n    }\n\n    onReady() {\n        window.addEventListener('keydown', this.onGlobalKeyDown);\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener('keydown', this.onGlobalKeyDown);\n        this.controller.abort();\n    }\n\n    onGlobalKeyDown(e) {\n        if (e.code == 'Escape') this.closeEditor(e);\n    }\n\n    closeEditor() {\n        const { c } = this;\n        const DO = () => {\n            c.history.pushPath({\n                pathname: `/api/${c.value.packId}/${c.value.actorId}/${c.value.pk}`,\n                params: c.actionHandler.defaultStaticParams()\n            })\n        }\n        if (!c.isModified()) {DO()} else\n            c.actionHandler.discardModDConfirm({agree: DO});\n    }\n\n    headerExtend() {\n        return <>\n            {this.state.plain\n                ? refInsert(this)\n                : quillToolbar.commonHeader(this)\n            }\n            <span className=\"ql-formats\">\n                <button type='button'\n                    onClick={async (e) => {\n                        const data = await this.c.actionHandler.submit({});\n                        if (data.success) this.closeEditor(e);\n                    }}\n                    aria-label='Submit changes'>\n                    <i className=\"pi pi-save\"></i></button>\n                <button type='button'\n                    onClick={this.closeEditor}\n                    aria-label='Close window'>\n                    <i className=\"pi pi-times\"></i></button>\n            </span>\n        </>\n    }\n\n    render () {\n        if (!this.state.ready) return null;\n        return <URLContextType.Consumer>\n            {value => {\n                const { APP } = value.controller;\n                const { modules, meta } = getQuillModules(\n                    APP,\n                    value.controller.actionHandler.silentFetch,\n                    this.controller.signal,\n                    value.controller.mentionValues,\n                    this.ex.i18n,\n                    this,\n                );\n                return <div className=\"l-editor\"\n                    spellCheck={!APP.state.site_data.disable_spell_check}\n                    onContextMenu={onRightClick(this)}\n                    onKeyDown={async (e) => {\n                        if ((e.ctrlKey || e.metaKey) && e.code === \"KeyS\") {\n                            e.stopPropagation();\n                            e.preventDefault();\n                            const data = await this.c.actionHandler.submit({});\n                            if (data.success) this.closeEditor(e);\n                        } else if (e.ctrlKey && e.shiftKey && e.code == \"KeyL\") {\n                            e.stopPropagation();\n                            e.preventDefault();\n                            invokeRefInsert(this);\n                        } else if (e.code !== 'Escape') e.stopPropagation();\n                    }}>\n                    <div id={meta.toolbarID}>\n                        {this.headerExtend()}\n                    </div>\n                    {\n                    <QuillNextEditor\n                        config={{\n                            modules: modules,\n                            theme: \"snow\",\n                        }}\n                        defaultValue={this.state.plain ? new Delta().insert(this.getValue()) : null}\n                        dangerouslySetInnerHTML={this.state.plain ? null : {__html: this.getValue()}}\n                        onTextChange={changeDelta(this)}\n                        onReady={(quill) => {\n                            window.elem = this;\n                            this.quill = quill;\n                            quillLoad(this, quill);\n                            overrideImageButtonHandler(quill);\n                            quill.focus();\n                        }}/>\n                    }\n                    {\n                    // <this.ex.prEditor.Editor\n                    //     headerTemplate={this.headerExtend()}\n                    //     modules={modules}\n                    //     onLoad={e => {\n                    //         this.quill = this.inputEl.getQuill();\n                    //         quillLoad(this, this.quill);\n                    //         overrideImageButtonHandler(this.quill);\n                    //     }}\n                    //     onTextChange={(e) => onTextChange(this, e)}\n                    //     ref={ref => this.inputEl = ref}\n                    //     style={{background: \"#ffffff\"}}\n                    //     value={this.context.data[value.fieldName]}/>\n                    }\n                    <this.ex.prContextMenu.ContextMenu\n                        {...tableContextMenuProps(this)}\n                        ref={ref => this.tableContextMenu = ref}/>\n                    <div id=\"raw-editor-container\"\n                        onKeyDown={e => e.stopPropagation()}></div>\n                </div>\n            }}\n        </URLContextType.Consumer>\n    }\n}\n"],"names":["ex","name","AbortController","i18n","prContextMenu","prUtils","u","RegisterImportPool","LinoEditor","_LeafComponentInput","props","_this","_classCallCheck","state","_objectSpread","plain","elem","field_options","format","closeEditor","bind","onGlobalKeyDown","_inherits","_createClass","key","value","_prepare","_asyncToGenerator","_regeneratorRuntime","_callee","_context","prev","next","_superPropGet","this","controller","stop","apply","arguments","window","addEventListener","removeEventListener","abort","e","code","c","DO","history","pushPath","pathname","concat","packId","actorId","pk","params","actionHandler","defaultStaticParams","isModified","discardModDConfirm","agree","_this2","React","refInsert","quillToolbar","commonHeader","className","type","onClick","_ref","_callee2","_context2","submit","sent","success","_x","_this3","ready","URLContextType","Consumer","APP","_getQuillModules","getQuillModules","silentFetch","signal","mentionValues","modules","meta","spellCheck","site_data","disable_spell_check","onContextMenu","onRightClick","onKeyDown","_ref2","_callee3","_context3","ctrlKey","metaKey","stopPropagation","preventDefault","shiftKey","invokeRefInsert","_x2","id","toolbarID","headerExtend","QuillNextEditor","config","theme","defaultValue","Delta","insert","getValue","dangerouslySetInnerHTML","__html","onTextChange","changeDelta","onReady","quill","quillLoad","overrideImageButtonHandler","focus","ContextMenu","_extends","tableContextMenuProps","ref","tableContextMenu","LeafComponentInput","requiredModules","iPool","Object","assign","copy","defaultProps","leafIndex"],"ignoreList":[],"sourceRoot":""}