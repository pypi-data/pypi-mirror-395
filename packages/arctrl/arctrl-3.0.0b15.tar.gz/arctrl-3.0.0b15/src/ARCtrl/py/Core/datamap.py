from __future__ import annotations
from collections.abc import Callable
from typing import Any
from ..fable_modules.fable_library.list import (of_array, FSharpList)
from ..fable_modules.fable_library.reflection import (TypeInfo, class_type)
from ..fable_modules.fable_library.seq import (map, iterate_indexed)
from ..fable_modules.fable_library.types import Array
from .data_context import (DataContext, DataContext__get_Explication, DataContext__set_Explication_279AAFF2, DataContext__get_Unit, DataContext__set_Unit_279AAFF2, DataContext__get_ObjectType, DataContext__set_ObjectType_279AAFF2, DataContext__get_Description, DataContext__set_Description_6DFDD678, DataContext__Copy)
from .Helper.hash_codes import (hash_1, box_hash_seq)
from .ontology_annotation import OntologyAnnotation
from .Table.composite_cell import CompositeCell
from .Table.composite_header import (IOType, CompositeHeader)

DatamapAux_dataHeader: CompositeHeader = CompositeHeader(11, IOType(2))

DatamapAux_explication: OntologyAnnotation = OntologyAnnotation("Clarification", "NCIT", "http://purl.obolibrary.org/obo/NCIT_C94778")

DatamapAux_explicationHeader: CompositeHeader = CompositeHeader(3, DatamapAux_explication)

DatamapAux_unit: OntologyAnnotation = OntologyAnnotation("Unit", "UO", "http://purl.obolibrary.org/obo/UO_0000000")

DatamapAux_unitHeader: CompositeHeader = CompositeHeader(3, DatamapAux_unit)

DatamapAux_objectType: OntologyAnnotation = OntologyAnnotation("Data Type", "NCIT", "http://purl.obolibrary.org/obo/NCIT_C42645")

DatamapAux_objectTypeHeader: CompositeHeader = CompositeHeader(3, DatamapAux_objectType)

DatamapAux_labelHeader: CompositeHeader = CompositeHeader(13, "Label")

DatamapAux_descriptionHeader: CompositeHeader = CompositeHeader(13, "Description")

DatamapAux_generatedByHeader: CompositeHeader = CompositeHeader(13, "Generated By")

DatamapAux_allowedHeaders: FSharpList[CompositeHeader] = of_array([DatamapAux_dataHeader, DatamapAux_explicationHeader, DatamapAux_unitHeader, DatamapAux_objectTypeHeader, DatamapAux_descriptionHeader, DatamapAux_generatedByHeader])

def DatamapAux_getOntologyColumn(f: Callable[[DataContext], OntologyAnnotation | None], data_contexts: Array[DataContext]) -> Array[CompositeCell]:
    def mapping(dc: DataContext, f: Any=f, data_contexts: Any=data_contexts) -> CompositeCell:
        match_value: OntologyAnnotation | None = f(dc)
        if match_value is None:
            return CompositeCell.empty_term()

        else: 
            return CompositeCell(0, match_value)


    return list(map(mapping, data_contexts))


def DatamapAux_getStringColumn(f: Callable[[DataContext], str | None], data_contexts: Array[DataContext]) -> Array[CompositeCell]:
    def mapping(dc: DataContext, f: Any=f, data_contexts: Any=data_contexts) -> CompositeCell:
        match_value: str | None = f(dc)
        if match_value is None:
            return CompositeCell.empty_free_text()

        else: 
            return CompositeCell(1, match_value)


    return list(map(mapping, data_contexts))


def DatamapAux_setOntologyColumn(f: Callable[[DataContext, OntologyAnnotation | None], None], column: Array[CompositeCell], data_contexts: Array[DataContext]) -> None:
    def action(i: int, cell: CompositeCell, f: Any=f, column: Any=column, data_contexts: Any=data_contexts) -> None:
        if cell.tag == 0:
            f(data_contexts[i], cell.fields[0])


    iterate_indexed(action, column)


def DatamapAux_setStringColumn(f: Callable[[DataContext, str | None], None], column: Array[CompositeCell], data_contexts: Array[DataContext]) -> None:
    def action(i: int, cell: CompositeCell, f: Any=f, column: Any=column, data_contexts: Any=data_contexts) -> None:
        if cell.tag == 1:
            f(data_contexts[i], cell.fields[0])


    iterate_indexed(action, column)


def DatamapAux_SanityChecks_rowIndexInBoundaries(row: int, data_contexts: Array[DataContext]) -> None:
    if row < 0:
        raise Exception("Row index must be greater or equal to 0.")

    if row >= len(data_contexts):
        raise Exception("Row index must be less than the number of rows.")



def DatamapAux_SanityChecks_lengthOfNewColumn(new_column: Array[CompositeCell], data_contexts: Array[DataContext]) -> None:
    if len(new_column) != len(data_contexts):
        raise Exception("Length of new column does not match length of data contexts.")



def _expr887() -> TypeInfo:
    return class_type("ARCtrl.Datamap", None, Datamap)


class Datamap:
    def __init__(self, data_contexts: Array[DataContext]) -> None:
        self.static_hash: int = 0
        self.data_contexts_0040108: Array[DataContext] = data_contexts

    @property
    def StaticHash(self, __unit: None=None) -> int:
        this: Datamap = self
        return this.static_hash

    @StaticHash.setter
    def StaticHash(self, value: int) -> None:
        this: Datamap = self
        this.static_hash = value or 0

    @property
    def DataContexts(self, __unit: None=None) -> Array[DataContext]:
        this: Datamap = self
        return this.data_contexts_0040108

    @staticmethod
    def init(__unit: None=None) -> Datamap:
        return Datamap([])

    def GetExplicationColumn(self, __unit: None=None) -> Array[CompositeCell]:
        this: Datamap = self
        return DatamapAux_getOntologyColumn(DataContext__get_Explication, this.data_contexts_0040108)

    def SetExplicationColumn(self, cells: Array[CompositeCell]) -> None:
        this: Datamap = self
        def _arrow880(dc: DataContext, oa: OntologyAnnotation | None=None) -> None:
            DataContext__set_Explication_279AAFF2(dc, oa)

        DatamapAux_setOntologyColumn(_arrow880, cells, this.data_contexts_0040108)

    def GetUnitColumn(self, __unit: None=None) -> Array[CompositeCell]:
        this: Datamap = self
        return DatamapAux_getOntologyColumn(DataContext__get_Unit, this.data_contexts_0040108)

    def SetUnitColumn(self, cells: Array[CompositeCell]) -> None:
        this: Datamap = self
        def _arrow881(dc: DataContext, oa: OntologyAnnotation | None=None) -> None:
            DataContext__set_Unit_279AAFF2(dc, oa)

        DatamapAux_setOntologyColumn(_arrow881, cells, this.data_contexts_0040108)

    def GetObjectTypeColumn(self, __unit: None=None) -> Array[CompositeCell]:
        this: Datamap = self
        return DatamapAux_getOntologyColumn(DataContext__get_ObjectType, this.data_contexts_0040108)

    def SetDataTypeColumn(self, cells: Array[CompositeCell]) -> None:
        this: Datamap = self
        def _arrow882(dc: DataContext, oa: OntologyAnnotation | None=None) -> None:
            DataContext__set_ObjectType_279AAFF2(dc, oa)

        DatamapAux_setOntologyColumn(_arrow882, cells, this.data_contexts_0040108)

    def GetLabelColumn(self, __unit: None=None) -> Array[CompositeCell]:
        this: Datamap = self
        def _arrow883(dc: DataContext) -> str | None:
            return dc.Name

        return DatamapAux_getStringColumn(_arrow883, this.data_contexts_0040108)

    def SetLabelColumn(self, cells: Array[CompositeCell]) -> None:
        this: Datamap = self
        def _arrow884(dc: DataContext, s: str | None=None) -> None:
            dc.Name = s

        DatamapAux_setStringColumn(_arrow884, cells, this.data_contexts_0040108)

    def GetDescriptionColumn(self, __unit: None=None) -> Array[CompositeCell]:
        this: Datamap = self
        return DatamapAux_getStringColumn(DataContext__get_Description, this.data_contexts_0040108)

    def SetDescriptionColumn(self, cells: Array[CompositeCell]) -> None:
        this: Datamap = self
        def _arrow885(dc: DataContext, s: str | None=None) -> None:
            DataContext__set_Description_6DFDD678(dc, s)

        DatamapAux_setStringColumn(_arrow885, cells, this.data_contexts_0040108)

    def GetDataContext(self, row: int, SkipValidation: Any | None=None) -> DataContext:
        this: Datamap = self
        DatamapAux_SanityChecks_rowIndexInBoundaries(row, this.data_contexts_0040108)
        return this.data_contexts_0040108[row]

    @staticmethod
    def get_data_context(row: int, SkipValidation: Any | None=None) -> Callable[[Datamap], DataContext]:
        def _arrow886(dm: Datamap) -> DataContext:
            return dm.GetDataContext(row, SkipValidation)

        return _arrow886

    def Copy(self, __unit: None=None) -> Datamap:
        this: Datamap = self
        return Datamap(list(map(DataContext__Copy, this.data_contexts_0040108)))

    def __eq__(self, obj: Any=None) -> bool:
        this: Datamap = self
        return hash_1(this) == hash_1(obj)

    def __hash__(self, __unit: None=None) -> Any:
        this: Datamap = self
        return box_hash_seq(this.data_contexts_0040108)

    @staticmethod
    def FileName() -> str:
        return "isa.datamap.xlsx"


Datamap_reflection = _expr887

def Datamap__ctor_4E3220A7(data_contexts: Array[DataContext]) -> Datamap:
    return Datamap(data_contexts)


__all__ = ["DatamapAux_dataHeader", "DatamapAux_explication", "DatamapAux_explicationHeader", "DatamapAux_unit", "DatamapAux_unitHeader", "DatamapAux_objectType", "DatamapAux_objectTypeHeader", "DatamapAux_labelHeader", "DatamapAux_descriptionHeader", "DatamapAux_generatedByHeader", "DatamapAux_allowedHeaders", "DatamapAux_getOntologyColumn", "DatamapAux_getStringColumn", "DatamapAux_setOntologyColumn", "DatamapAux_setStringColumn", "DatamapAux_SanityChecks_rowIndexInBoundaries", "DatamapAux_SanityChecks_lengthOfNewColumn", "Datamap_reflection"]

