(self.webpackChunkdocprovider_extension_codio=self.webpackChunkdocprovider_extension_codio||[]).push([[20],{20:(e,t,s)=>{"use strict";s.r(t),s.d(t,{WebsocketProvider:()=>ee,messageAuth:()=>J,messageAwareness:()=>V,messageQueryAwareness:()=>Q,messageSync:()=>W});var n=s(206);const o=()=>new Map,c=(e,t,s)=>{let n=e.get(t);return void 0===n&&e.set(t,n=s()),n},r=()=>new Set;var a=s(554);let i=new class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},l=!0;try{"undefined"!=typeof localStorage&&localStorage&&(i=localStorage,l=!1)}catch(e){}const h=i,d=Array.from,u=(Array.isArray,Object.assign,Object.keys),f=(Object.values,e=>u(e).length),g=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p=(Object.freeze,Symbol("Equality")),w=(e,t)=>{if(e===t)return!0;if(null==e||null==t||e.constructor!==t.constructor)return!1;if(null!=e[p])return e[p](t);switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;break;case Set:if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;break;case Map:if(e.size!==t.size)return!1;for(const s of e.keys())if(!t.has(s)||!w(e.get(s),t.get(s)))return!1;break;case Object:if(f(e)!==f(t))return!1;for(const s in e)if(!g(e,s)||!w(e[s],t[s]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!w(e[s],t[s]))return!1;break;default:return!1}return!0};var m=s(288);const v=void 0!==m&&m.release&&/node|io\.js/.test(m.release.name)&&"[object process]"===Object.prototype.toString.call(void 0!==m?m:0),b="undefined"!=typeof window&&"undefined"!=typeof document&&!v;let y;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);const _=[],k=e=>(()=>{if(void 0===y)if(v){y=o();const e=m.argv;let t=null;for(let s=0;s<e.length;s++){const n=e[s];"-"===n[0]?(null!==t&&y.set(t,""),t=n):null!==t?(y.set(t,n),t=null):_.push(n)}null!==t&&y.set(t,"")}else"object"==typeof location?(y=o(),(location.search||"?").slice(1).split("&").forEach(e=>{if(0!==e.length){const[t,s]=e.split("=");y.set(`--${a.jN(t,"-")}`,s),y.set(`-${a.jN(t,"-")}`,s)}})):y=o();return y})().has(e),S=e=>{return void 0===(t=v?m.env[e.toUpperCase().replaceAll("-","_")]:h.getItem(e))?null:t;var t},I=e=>k("--"+e)||null!==S(e);var C;I("production"),v&&(C=m.env.FORCE_COLOR,["true","1","2"].includes(C))||!k("--no-colors")&&!I("no-color")&&(!v||m.stdout.isTTY)&&(!v||k("--color")||null!==S("COLORTERM")||(S("TERM")||"").includes("color"));const L=b?e=>{let t="";for(let s=0;s<e.byteLength;s++)t+=a.QV(e[s]);return btoa(t)}:e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),U=b?e=>{const t=atob(e),s=(n=t.length,new Uint8Array(n));var n;for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);return s}:e=>{const t=Buffer.from(e,"base64");return s=t.buffer,n=t.byteOffset,o=t.byteLength,new Uint8Array(s,n,o);var s,n,o},x=new Map,T="undefined"==typeof BroadcastChannel?class{constructor(e){var t;this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&null!==this.onmessage&&this.onmessage({data:U(t.newValue||"")}),t=this._onChange,l||addEventListener("storage",t)}postMessage(e){h.setItem(this.room,L(new Uint8Array(e)))}close(){var e;e=this._onChange,l||removeEventListener("storage",e)}}:BroadcastChannel,z=e=>c(x,e,()=>{const t=r(),s=new T(e);return s.onmessage=e=>t.forEach(t=>t(e.data,"broadcastchannel")),{bc:s,subs:t}}),A=(e,t,s=null)=>{const n=z(e);n.bc.postMessage(t),n.subs.forEach(e=>e(t,s))},O=Date.now;var E=s(214),B=s(721);const j=(e,t)=>{E.zd(e,0);const s=n.encodeStateVector(t);E.Gu(e,s)},M=(e,t,s)=>{E.zd(e,1),E.Gu(e,n.encodeStateAsUpdate(t,s))},R=(e,t,s)=>{try{n.applyUpdate(t,B.bo(e),s)}catch(e){console.error("Caught error while handling a Yjs update",e)}},F=R;var D=s(801);class H{constructor(){this._observers=o()}on(e,t){c(this._observers,e,r).add(t)}once(e,t){const s=(...n)=>{this.off(e,s),t(...n)};this.on(e,s)}off(e,t){const s=this._observers.get(e);void 0!==s&&(s.delete(t),0===s.size&&this._observers.delete(e))}emit(e,t){return d((this._observers.get(e)||o()).values()).forEach(e=>e(...t))}destroy(){this._observers=o()}}class G extends H{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const e=O();null!==this.getLocalState()&&15e3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const t=[];this.meta.forEach((s,n)=>{n!==this.clientID&&3e4<=e-s.lastUpdated&&this.states.has(n)&&t.push(n)}),t.length>0&&$(this,t,"timeout")},D.RI(3e3)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID,s=this.meta.get(t),n=void 0===s?0:s.clock+1,o=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:O()});const c=[],r=[],a=[],i=[];null===e?i.push(t):null==o?null!=e&&c.push(t):(r.push(t),w(o,e)||a.push(t)),(c.length>0||a.length>0||i.length>0)&&this.emit("change",[{added:c,updated:a,removed:i},"local"]),this.emit("update",[{added:c,updated:r,removed:i},"local"])}setLocalStateField(e,t){const s=this.getLocalState();null!==s&&this.setLocalState({...s,[e]:t})}getStates(){return this.states}}const $=(e,t,s)=>{const n=[];for(let s=0;s<t.length;s++){const o=t[s];if(e.states.has(o)){if(e.states.delete(o),o===e.clientID){const t=e.meta.get(o);e.meta.set(o,{clock:t.clock+1,lastUpdated:O()})}n.push(o)}}n.length>0&&(e.emit("change",[{added:[],updated:[],removed:n},s]),e.emit("update",[{added:[],updated:[],removed:n},s]))},N=(e,t,s=e.states)=>{const n=t.length,o=E.xv();E.zd(o,n);for(let c=0;c<n;c++){const n=t[c],r=s.get(n)||null,a=e.meta.get(n).clock;E.zd(o,n),E.zd(o,a),E.Qj(o,JSON.stringify(r))}return E.Fo(o)};var P=s(288);const W=0,Q=3,V=1,J=2,Y=[];Y[W]=(e,t,s,n,o)=>{E.zd(e,W);const c=((e,t,s,n)=>{const o=B.cw(e);switch(o){case 0:((e,t,s)=>{M(t,s,B.bo(e))})(e,t,s);break;case 1:R(e,s,n);break;case 2:F(e,s,n);break;default:throw new Error("Unknown message type")}return o})(t,e,s.doc,s);n&&1===c&&!s.synced&&(s.synced=!0)},Y[Q]=(e,t,s,n,o)=>{E.zd(e,V),E.Gu(e,N(s.awareness,Array.from(s.awareness.getStates().keys())))},Y[V]=(e,t,s,n,o)=>{((e,t,s)=>{const n=B.$C(t),o=O(),c=[],r=[],a=[],i=[],l=B.cw(n);for(let t=0;t<l;t++){const t=B.cw(n);let s=B.cw(n);const l=JSON.parse(B.t3(n)),h=e.meta.get(t),d=e.states.get(t),u=void 0===h?0:h.clock;(u<s||u===s&&null===l&&e.states.has(t))&&(null===l?t===e.clientID&&null!=e.getLocalState()?s++:e.states.delete(t):e.states.set(t,l),e.meta.set(t,{clock:s,lastUpdated:o}),void 0===h&&null!==l?c.push(t):void 0!==h&&null===l?i.push(t):null!==l&&(w(l,d)||a.push(t),r.push(t)))}(c.length>0||a.length>0||i.length>0)&&e.emit("change",[{added:c,updated:a,removed:i},s]),(c.length>0||r.length>0||i.length>0)&&e.emit("update",[{added:c,updated:r,removed:i},s])})(s.awareness,B.bo(t),s)},Y[J]=(e,t,s,n,o)=>{((e,t,s)=>{0===B.cw(e)&&s(0,B.t3(e))})(t,s.doc,(e,t)=>q(s,t))};const q=(e,t)=>console.warn(`Permission denied to access ${e.url}.\n${t}`),K=(e,t,s)=>{const n=B.$C(t),o=E.xv(),c=B.cw(n),r=e.messageHandlers[c];return r?r(o,n,e,s,c):console.error("Unable to compute message"),o},X=e=>{if(e.shouldConnect&&null===e.ws){const t=new e._WS(e.url);t.binaryType="arraybuffer",e.ws=t,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,t.onmessage=s=>{e.wsLastMessageReceived=O();const n=K(e,new Uint8Array(s.data),!0);E.Bw(n)>1&&t.send(E.Fo(n))},t.onerror=t=>{e.emit("connection-error",[t,e])},t.onclose=t=>{e.emit("connection-close",[t,e]),e.ws=null,e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,$(e.awareness,Array.from(e.awareness.getStates().keys()).filter(t=>t!==e.doc.clientID),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(X,D.jk(100*D.n7(2,e.wsUnsuccessfulReconnects),e.maxBackoffTime),e)},t.onopen=()=>{e.wsLastMessageReceived=O(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const s=E.xv();if(E.zd(s,W),j(s,e.doc),t.send(E.Fo(s)),null!==e.awareness.getLocalState()){const s=E.xv();E.zd(s,V),E.Gu(s,N(e.awareness,[e.doc.clientID])),t.send(E.Fo(s))}},e.emit("status",[{status:"connecting"}])}},Z=(e,t)=>{const s=e.ws;e.wsconnected&&s&&s.readyState===s.OPEN&&s.send(t),e.bcconnected&&A(e.bcChannel,t,e)};class ee extends H{constructor(e,t,s,{connect:n=!0,awareness:o=new G(s),params:c={},WebSocketPolyfill:r=WebSocket,resyncInterval:a=-1,maxBackoffTime:i=2500,disableBc:l=!1}={}){for(super();"/"===e[e.length-1];)e=e.slice(0,e.length-1);const h=(e=>((e,t)=>{const s=[];for(const n in e)s.push(t(e[n],n));return s})(e,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"))(c);this.maxBackoffTime=i,this.bcChannel=e+"/"+t,this.url=e+"/"+t+(0===h.length?"":"?"+h),this.roomname=t,this.doc=s,this._WS=r,this.awareness=o,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=l,this.wsUnsuccessfulReconnects=0,this.messageHandlers=Y.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=n,this._resyncInterval=0,a>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const e=E.xv();E.zd(e,W),j(e,s),this.ws.send(E.Fo(e))}},a)),this._bcSubscriber=(e,t)=>{if(t!==this){const t=K(this,new Uint8Array(e),!1);E.Bw(t)>1&&A(this.bcChannel,E.Fo(t),this)}},this._updateHandler=(e,t)=>{if(t!==this){const t=E.xv();E.zd(t,W),((e,t)=>{E.zd(e,2),E.Gu(e,t)})(t,e),Z(this,E.Fo(t))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:e,updated:t,removed:s},n)=>{const c=e.concat(t).concat(s),r=E.xv();E.zd(r,V),E.Gu(r,N(o,c)),Z(this,E.Fo(r))},this._exitHandler=()=>{$(this.awareness,[s.clientID],"app closed")},v&&void 0!==P&&P.on("exit",this._exitHandler),o.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&3e4<O()-this.wsLastMessageReceived&&this.ws.close()},3e3),n&&this.connect()}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),v&&void 0!==P&&P.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;var e,t;this.bcconnected||(e=this.bcChannel,t=this._bcSubscriber,z(e).subs.add(t),this.bcconnected=!0);const s=E.xv();E.zd(s,W),j(s,this.doc),A(this.bcChannel,E.Fo(s),this);const n=E.xv();E.zd(n,W),M(n,this.doc),A(this.bcChannel,E.Fo(n),this);const o=E.xv();E.zd(o,Q),A(this.bcChannel,E.Fo(o),this);const c=E.xv();E.zd(c,V),E.Gu(c,N(this.awareness,[this.doc.clientID])),A(this.bcChannel,E.Fo(c),this)}disconnectBc(){const e=E.xv();E.zd(e,V),E.Gu(e,N(this.awareness,[this.doc.clientID],new Map)),Z(this,E.Fo(e)),this.bcconnected&&(((e,t)=>{const s=z(e);s.subs.delete(t)&&0===s.subs.size&&(s.bc.close(),x.delete(e))})(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(X(this),this.connectBc())}}},288:e=>{var t,s,n=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function r(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(s){try{return t.call(null,e,0)}catch(s){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{s="function"==typeof clearTimeout?clearTimeout:c}catch(e){s=c}}();var a,i=[],l=!1,h=-1;function d(){l&&a&&(l=!1,a.length?i=a.concat(i):h=-1,i.length&&u())}function u(){if(!l){var e=r(d);l=!0;for(var t=i.length;t;){for(a=i,i=[];++h<t;)a&&a[h].run();h=-1,t=i.length}a=null,l=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===c||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];i.push(new f(e,t)),1!==i.length||l||r(u)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}}}]);