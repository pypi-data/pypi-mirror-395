"use strict";(self.webpackChunkdocprovider_extension_codio=self.webpackChunkdocprovider_extension_codio||[]).push([[96],{96:(e,t,o)=>{o.r(t),o.d(t,{default:()=>I});var r=o(246),n=o(256),i=o(334),a=o(644),s=o(176),c=o(212),d=o(598),l=o(912),u=o(104),v=o(0),g=o(818),p=o(981),h=o(907);const b=(()=>{let e,t;const o=new Promise((o,r)=>{e=o,t=r});return{resolve:e,reject:t,promise:o}})(),m=function(){b.resolve(),console.log("[docprovider-extension] codio client loaded")},w="api/collaboration/timeline",y="The file %1 has been opened with two different views. This is not supported. Please close this view; otherwise, some of your edits may not be saved properly.",f={id:"docprovider-extension-codio:content-provider",description:"The RTC content provider",provides:g.ICollaborativeContentProvider,requires:[u.ITranslator],optional:[g.IGlobalAwareness,l.ISettingRegistry],activate:async(e,t,o,r)=>{const n=t.load("jupyter_collaboration"),i=e.serviceManager.contents.defaultDrive;if(!i)throw Error("Cannot initialize content provider: default drive property not accessible on contents manager instance.");const a=i.contentProviderRegistry;if(!a)throw Error("Cannot initialize content provider: no content provider registry.");const s=r?await r.load("@jupyterlab/docmanager-extension:plugin"):null,c=new p.RtcContentProvider({apiEndpoint:"/api/contents",serverSettings:i.serverSettings,user:e.serviceManager.user,trans:n,globalAwareness:o,docmanagerSettings:s});return a.register("rtc",c),c}},x={id:"docprovider-extension-codio:yfile",description:"Plugin to register the shared model factory for the content type 'file'",autoStart:!0,requires:[g.ICollaborativeContentProvider,s.IEditorWidgetFactory],activate:(e,t,o)=>{t.sharedModelFactory.registerDocumentFactory("file",()=>new v.YFile),o.contentProviderId="rtc"}},C={id:"docprovider-extension-codio:ynotebook",description:"Plugin to register the shared model factory for the content type 'notebook'",autoStart:!0,requires:[g.ICollaborativeContentProvider,d.INotebookWidgetFactory],optional:[l.ISettingRegistry],activate:(e,t,o,r)=>{let n=!0;r&&r.load("@jupyterlab/notebook-extension:tracker").then(e=>{const t=e=>{var t;const o=null==e?void 0:e.get("experimentalEnableDocumentWideUndoRedo").composite;n=null===(t=!o)||void 0===t||t};t(e),e.changed.connect(e=>t(e))}),t.sharedModelFactory.registerDocumentFactory("notebook",()=>new v.YNotebook({disableDocumentWideUndoRedo:n})),o.contentProviderId="rtc"}},k={id:"docprovider-extension-codio:statusBarTimeline",description:"Plugin to add a timeline slider to the status bar",autoStart:!0,requires:[a.IStatusBar,g.ICollaborativeContentProvider,i.IDocumentManager],activate:async(e,t,o,r)=>{try{await(async e=>{window.codio?b.resolve():(e||(e="https://codio.com/ext/iframe/base/static/codio-client.js"),((e,t,o)=>{console.log("[docprovider-extension] loadCodio from url",e);const r=document.createElement("script");r.src=e,r.onload=t,r.onerror=(...e)=>{console.log("[docprovider-extension] loading script error",e),b.reject(e)},o.appendChild(r)})(e,m,document.body),await b.promise)})("https://codio.com/ext/iframe/base/static/codio-client.js");const i=await(async()=>{var e;if(!window.codio)return!1;const t=new Promise((e,t)=>{window.codio.subscribe("projectState",async t=>{e(t)}),setTimeout(()=>{e({})},1e4)});return null===(e=window.codio)||void 0===e||e.setLoaded(),await window.codio.loaded(),t})();let a=null,s=null;const c=async(t,a)=>{var c;if(!a)return;s&&(s.dispose(),s=null);const[d,l]=a.split(":"),u=o.providers.get(`${d}:${l}:${t}`);if(!u)return;const v=u,g=h.URLExt.join(e.serviceManager.serverSettings.baseUrl,w,t);let b=!1;const m=e.shell.currentWidget;if(m){const e=r.contextForWidget(m);e&&(b=!0!==(null===(c=e.contentsModel)||void 0===c?void 0:c.writable))}s=new p.TimelineWidget(g,v,v.contentType,v.format,w,i&&i.complete,b);const y=document.getElementById("jp-slider-status-bar");y&&!s.isAttached&&n.Widget.attach(s,y)};e.shell.currentChanged&&e.shell.currentChanged.connect(async(e,t)=>{const o=t.newValue;s&&(s.dispose(),s=null),o&&"context"in o&&(await o.context.ready,await c(o.context.path,o.context.model.sharedModel.getState("document_id")))}),t&&(a||(a=new n.Widget,a.addClass("jp-StatusBar-GroupItem"),a.addClass("jp-mod-highlighted"),a.id="jp-slider-status-bar",t.registerStatusItem("jp-slider-status-bar",{item:a,align:"left",rank:4,isActive:()=>{var t,o;const r=e.shell.currentWidget;return(null===(o=null===(t=null==r?void 0:r.context)||void 0===t?void 0:t.model)||void 0===o?void 0:o.collaborative)||!1}})))}catch(e){console.error("Failed to activate statusBarTimeline plugin:",e)}}},I=[f,x,C,{id:"docprovider-extension-codio:logger",description:"A logging plugin for debugging purposes.",autoStart:!0,optional:[c.ILoggerRegistry,s.IEditorTracker,d.INotebookTracker,u.ITranslator],activate:(e,t,o,n,i)=>{const a=(null!=i?i:u.nullTranslator).load("jupyter_collaboration"),s="https://schema.jupyter.org/jupyter_collaboration/session/v1";if(!t)return void e.serviceManager.events.stream.connect((e,t)=>{var o,n;t.schema_id===s&&(console.debug(`[${t.room}(${t.path})] ${null!==(o=t.action)&&void 0!==o?o:""}: ${null!==(n=t.msg)&&void 0!==n?n:""}`),"WARNING"===t.level&&(0,r.showDialog)({title:a.__("Warning"),body:a.__(y,t.path),buttons:[r.Dialog.okButton()]}))});const c=new Map,d=(e,o)=>{const r=t.getLogger(o.context.path);c.set(o.context.localPath,r),o.disposed.connect(e=>{c.delete(e.context.localPath)})};o&&o.widgetAdded.connect(d),n&&n.widgetAdded.connect(d),(async()=>{var t,o;const{events:n}=e.serviceManager;for await(const e of n.stream)if(e.schema_id===s){const n=c.get(e.path);null==n||n.log({type:"text",level:e.level.toLowerCase(),data:`[${e.room}] ${null!==(t=e.action)&&void 0!==t?t:""}: ${null!==(o=e.msg)&&void 0!==o?o:""}`}),"WARNING"===e.level&&(0,r.showDialog)({title:a.__("Warning"),body:a.__(y,e.path),buttons:[r.Dialog.warnButton({label:a.__("Ok")})]})}})()}},{id:"docprovider-extension-codio:notebook-cell-executor",description:"Add notebook cell executor that uses REST API instead of kernel protocol over WebSocket.",autoStart:!0,provides:d.INotebookCellExecutor,activate:e=>"true"===h.PageConfig.getOption("serverSideExecution")?new p.NotebookCellServerExecutor({serverSettings:e.serviceManager.serverSettings}):Object.freeze({runCell:d.runCell})},k,{id:"docprovider-extension-codio:forkManager",autoStart:!0,requires:[g.ICollaborativeContentProvider],provides:p.IForkManagerToken,activate:(e,t)=>{const o=e.serviceManager.events;return new p.ForkManager({contentProvider:t,eventManager:o})}}]}}]);