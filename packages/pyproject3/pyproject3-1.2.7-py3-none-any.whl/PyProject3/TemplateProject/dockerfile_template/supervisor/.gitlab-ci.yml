stages:
  - build_image

variables:
  DEV_REGISTRY: "harbor.xmov.ai/xmov"
  PRO_REGISTRY: "registry.cn-hangzhou.aliyuncs.com/xmov"
  # FS_URL: "https://open.feishu.cn/open-apis/bot/v2/hook/596839f6-7241-4e81-b8cf-bca30c299c51"

build_image:
  stage: build_image
  only:
    - dev
    - qa
    - master
    - tags
  script:
    - |
      if [[ $CI_COMMIT_REF_NAME == "master" ]]
      then
        docker buildx build --builder newbuilder --push . -t $PRO_REGISTRY/$CI_PROJECT_NAME:latest
      else
        docker buildx build --builder newbuilder --push . -t $DEV_REGISTRY/$CI_PROJECT_NAME:$CI_COMMIT_REF_NAME
      fi
  tags:
    - node-50
