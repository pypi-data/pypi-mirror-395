"""Fill in a module description here"""

# AUTOGENERATED! DO NOT EDIT! File to edit: ../nbs/00_core.ipynb.

# %% auto 0
__all__ = ['read_icons', 'sz_attrs', 'symbol', 'sprites', 'Icon', 'SvgStyle', 'SvgSprites']

# %% ../nbs/00_core.ipynb 2
from fastcore.utils import *
from fastcore.xml import *
from fasthtml.common import *
from fasthtml.svg import *
from json import loads
from copy import deepcopy
import pathlib

# %% ../nbs/00_core.ipynb 5
def read_icons():
    path = pathlib.Path(__file__).parent
    fpath = path/'_icons.py'
    return loads(fpath.read_text())

# %% ../nbs/00_core.ipynb 9
def sz_attrs(sz, vbox=24):
    if isinstance(vbox, int): vbox = (vbox, vbox)
    if isinstance(sz, int): sz = (sz, sz)
    return dict(viewBox=f'0 0 {vbox[0]} {vbox[1]}', width=f'{sz[0]}px', height=f'{sz[1]}px')

# %% ../nbs/00_core.ipynb 11
def symbol(
    icons, # icon dict
    nm, # Name of icon in lucide
    pre='' # Prefix to add to element id
):
    "Create a `symbol` element for an icon"
    ico = icons[nm]
    sym = [ft(t, **attrs) for t,attrs in ico]
    return Symbol(*sym, id=pre+nm)

# %% ../nbs/00_core.ipynb 13
def sprites(
    icons, # icon dict
    nms, # List of lucide icon names
    pre='' # Prefix to add to all element ids
):
    "SVG element containing all symbols in `nms`"
    syms = [symbol(icons, nm, pre) for nm in nms]
    return Svg(Defs(*syms), style="display: none")

# %% ../nbs/00_core.ipynb 15
def _style_str(stroke=None, fill=None, stroke_width=None):
    "Build CSS style string from stroke/fill/stroke-width"
    styles = []
    if stroke: styles.append(f'stroke: {stroke}')
    if fill: styles.append(f'fill: {fill}')
    if stroke_width: styles.append(f'stroke-width: {stroke_width}')
    return '; '.join(styles) if styles else None

# %% ../nbs/00_core.ipynb 16
class Icon:
    def __init__(
        self,
        nm, # Name of icon in lucide
        pre='', # Prefix to add to element id
        cls="lucide-icon", # class to use for svg
        vbox=24, # viewBox size (int for square, or (w,h) tuple)
        sz=24, # size of svg
        stroke=None, # Stroke CSS
        stroke_width=None, # Stroke width CSS
        fill=None, # Fill CSS
        trans=None, # SVG transform attribute
        **attrs # additional attrs for svg
    ):
        "A `use` element in an `svg` element refering to `nm`"
        store_attr()
        self.attrs = sz_attrs(self.sz, self.vbox) | attrs
        style = _style_str(stroke, fill, stroke_width)
        self.uses = [Use(href=f"#{pre}{nm}", style=style, transform=trans)]
    
    def __ft__(self): return Svg(*self.uses, cls=self.cls, **self.attrs)

    def _repr_markdown_(self): return self.__ft__()._repr_markdown_()
    def __repr__(self): return self.__ft__().__repr__()
    def __str__(self): return self.__ft__().__str__()
    def __call__(self, *args, **kwargs): return self.__ft__().__call__(*args, **kwargs)

# %% ../nbs/00_core.ipynb 23
@patch
def _with_trans(self:Icon, t):
    "Helper function to add the transform to all underlying uses."
    res = deepcopy(self)
    for u in res.uses: u.transform = f"{u.transform or ''} {t}".strip()
    return res

# %% ../nbs/00_core.ipynb 25
@patch
def rotate(self:Icon, a, cx=0, cy=0):
    "Rotates the element by a degrees, optionally around point (cx, cy)."
    return self._with_trans(f'rotate({a})' if not cx else f'rotate({a},{cx},{cy})')

# %% ../nbs/00_core.ipynb 27
@patch
def scale(self:Icon, x, y=0):
    "Scales the element by x (and optionally y)."
    return self._with_trans(f'scale({x})' if not y else f'scale({x},{y})')

# %% ../nbs/00_core.ipynb 31
@patch
def translate(self:Icon, x, y=0): 
    "Moves the element by x horizontally and optionally y vertically."
    return self._with_trans(f'translate({x})' if not y else f'translate({x},{y})')

# %% ../nbs/00_core.ipynb 33
@patch
def skewX(self:Icon, a):
    "Skews the element along the X axis by a degrees."
    return self._with_trans(f'skewX({a})')

@patch
def skewY(self:Icon, a):
    "Skews the element along the Y axis by a degrees."
    return self._with_trans(f'skewY({a})')

# %% ../nbs/00_core.ipynb 36
@patch
def matrix(self:Icon, a, b, c, d, e, f):
    "Applies a matrix transformation with 6 values."
    return self._with_trans(f'matrix({a},{b},{c},{d},{e},{f})')

# %% ../nbs/00_core.ipynb 42
@patch
def __iadd__(self:Icon, b):
    self.uses += b.uses
    return self

@patch
def __add__(self:Icon, b):
    res = deepcopy(self)
    res += b
    return res

# %% ../nbs/00_core.ipynb 51
def SvgStyle(cls="lucide-icon"):
    "Styles required for lucide icons to display correctly"
    return Style(f'.{cls} {{ stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }}')

# %% ../nbs/00_core.ipynb 52
class SvgSprites:
    "Create and track used icons"
    def __init__(self, pre='', vbox=24, sz=24, cls="lucide-icon", nms=(), **attrs):
        nms = set(nms)
        self.attrs = attrs
        self.icons = read_icons()
        store_attr()

    def __call__(self, nm, sz=None, cls="", **kw):
        self.nms.add(nm)
        if not sz: sz=self.sz
        attrs = self.attrs | kw
        return Icon(nm, self.pre, vbox=self.vbox, sz=sz, cls = f"{self.cls} {cls}", **attrs)

    def __ft__(self):
        return SvgStyle(cls=self.cls),sprites(self.icons, self.nms, self.pre)
