"""Internal interface for the `is_it_slop` package.

This module provides thin Python wrappers around Rust bindings to ensure
excellent IDE support with type hints and documentation.
All core functionality is implemented in Rust for maximum performance.
"""

from __future__ import annotations

from typing import Final, Literal

from ._is_it_slop_rust_bindings import CLASSIFICATION_THRESHOLD as _CLASSIFICATION_THRESHOLD
from ._is_it_slop_rust_bindings import MODEL_VERSION as _MODEL_VERSION
from ._is_it_slop_rust_bindings import PredictionResult as _PredictionResult
from ._is_it_slop_rust_bindings import __version__
from ._is_it_slop_rust_bindings import is_this_slop as _is_this_slop
from ._is_it_slop_rust_bindings import is_this_slop_batch as _is_this_slop_batch

CLASSIFICATION_THRESHOLD: Final[float] = _CLASSIFICATION_THRESHOLD
"""Default classification threshold between 0.0 and 1.0.

If P(AI) >= threshold, the text is classified as AI-generated.
Lower thresholds are more sensitive (classify more as AI), higher thresholds are more conservative (classify more as Human).
This threshold is optimized for overall f1 score based on validation data and is used by default in prediction functions.
"""

MODEL_VERSION: Final[str] = _MODEL_VERSION
"""Version of the underlying ML model used for predictions."""

__all__ = [
    "CLASSIFICATION_THRESHOLD",
    "MODEL_VERSION",
    "Prediction",
    "__version__",
    "is_this_slop",
    "is_this_slop_batch",
]


class Prediction:
    """Result of a prediction containing probabilities and classification.

    This is a thin wrapper around the Rust PredictionResult type, providing
    full type hints and documentation for an excellent IDE experience.

    Attributes:
        human_probability: Probability that the text is human-written (0.0 to 1.0)
        ai_probability: Probability that the text is AI-generated (0.0 to 1.0)
        classification: Classification label ("Human" or "AI")

    Examples:
        >>> result = is_this_slop("Some text")
        >>> print(result.human_probability)
        0.847
        >>> print(result.ai_probability)
        0.153
        >>> print(result.classification)
        "Human"

        >>> # Use in conditionals
        >>> if result.classification == "AI":
        ...     print(f"Detected slop with {result.ai_probability:.1%} confidence")

        >>> # Check probabilities directly
        >>> if result.ai_probability > 0.8:
        ...     print("High confidence AI-generated")

    """

    __slots__ = ("_inner",)

    def __init__(self, inner: _PredictionResult) -> None:
        """Initialize from Rust PredictionResult.

        Args:
            inner: The underlying Rust PredictionResult object

        """
        self._inner = inner

    @property
    def human_probability(self) -> float:
        """Probability that the text is human-written (0.0 to 1.0)."""
        return self._inner.human_probability

    @property
    def ai_probability(self) -> float:
        """Probability that the text is AI-generated (0.0 to 1.0)."""
        return self._inner.ai_probability

    @property
    def classification(self) -> Literal["Human", "AI"]:
        """Classification label ("Human" or "AI")."""
        return self._inner.classification  # type: ignore[return-value]

    def __repr__(self) -> str:
        """Return a detailed string representation.

        Returns:
            str: Detailed representation of the prediction

        """
        return self._inner.__repr__()

    def __str__(self) -> str:
        """Return a human-readable string representation.

        Returns:
            str: Human-readable summary of the prediction

        """
        return self._inner.__str__()


def is_this_slop(text: str, threshold: float | None = None) -> Prediction:
    """Predict whether text is AI-generated (slop) or human-written.

    This function analyzes the given text using a trained ML model to determine
    whether it was likely generated by an AI system or written by a human.

    Args:
        text: Input text to classify. Must be a non-empty string.
        threshold: Classification threshold between 0.0 and 1.0 (default: built-in
            threshold optimized for overall f1). If P(AI) >= threshold, the text is classified as AI-generated.
            Lower thresholds are more sensitive (classify more as AI), higher thresholds
            are more conservative (classify more as Human).

    Returns:
        Prediction: A result object containing probabilities and classification.

    Examples:
        >>> result = is_this_slop("This is some text")
        >>> print(result.classification)
        "Human"
        >>> print(f"AI probability: {result.ai_probability:.2%}")
        AI probability: 15.23%

        >>> # Use custom threshold
        >>> result = is_this_slop("Generated content", threshold=0.7)
        >>> if result.classification == "AI":
        ...     print(f"Detected slop with {result.ai_probability:.1%} confidence")

        >>> # Access probabilities directly
        >>> if result.ai_probability > 0.8:
        ...     print("High confidence AI-generated text")

    """
    return Prediction(_is_this_slop(text, threshold))


def is_this_slop_batch(texts: list[str], threshold: float | None = None) -> list[Prediction]:
    """Predict whether multiple texts are AI-generated (slop) or human-written.

    Efficiently processes multiple texts in a single batch, which is faster than
    calling is_this_slop() individually for each text.

    Args:
        texts: List of input texts to classify. All must be non-empty strings.
        threshold: Classification threshold between 0.0 and 1.0 (default: built-in
            threshold optimized for overall f1). Applied uniformly to all texts in the batch.

    Returns:
        list[Prediction]: List of prediction results, one for each input text,
            in the same order as the input.

    Examples:
        >>> texts = ["First text", "Second text", "Third text"]
        >>> results = is_this_slop_batch(texts)
        >>> for text, result in zip(texts, results):
        ...     print(f"{text}: {result.classification}")
        First text: Human
        Second text: AI
        Third text: Human

        >>> # Count AI-generated texts
        >>> ai_count = sum(1 for r in results if r.classification == "AI")
        >>> print(f"Found {ai_count} slop texts out of {len(texts)}")
        Found 1 slop texts out of 3

        >>> # Filter high-confidence AI texts
        >>> slop = [(text, result) for text, result in zip(texts, results) if result.ai_probability > 0.8]

        >>> # Use custom threshold for entire batch
        >>> conservative_results = is_this_slop_batch(texts, threshold=0.9)

    """
    return [Prediction(r) for r in _is_this_slop_batch(texts, threshold)]
