"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[304],{3453:function(e,n,t){t.d(n,{$R:function(){return g},QR:function(){return x}});var r,o=t(67825),i=t.n(o),s=t(26068),l=t.n(s),a=t(53649),u=t.n(a),c=t(2825),d=t(25408),f=t(75271),p=t(67585),v=t(52676),m=["styles"],h=p.ZP.div(r||(r=u()(["\n  max-height: ",";\n  overflow-y: auto;\n  width: 100%;\n"])),(function(e){var n=e.$maxHeight;return"number"==typeof n?"".concat(n,"px"):n})),x=function(e){var n=e.children,t=e.maxHeight,r=e.scrollbars,o=e.oppositeTheme,i=e.style,s=e.onScroll,a=f.useRef(null),u=(0,c.Z)({options:{scrollbars:r,oppositeTheme:o}}).initialize;return f.useEffect((function(){a.current&&u(a.current)}),[]),(0,v.jsx)(h,{ref:a,"data-overlayscrollbars-initialize":!0,className:"overlay-scroller-wrapper",$maxHeight:t||200,hidden:!1,onWheel:s,style:l()({paddingInlineStart:8,paddingInlineEnd:8},i),children:n})},g=function(e){var n=e.children,t=e.maxHeight,r=e.title,o=e.toolTipProps,s=e.scrollbars,a=e.oppositeTheme,u=o||{},c=u.styles,f=i()(u,m);return(0,v.jsx)(d.Z,l()(l()({styles:l()(l()({},c),{},{body:l()({paddingInline:0},null==c?void 0:c.body)}),title:r&&(0,v.jsx)(x,{scrollbars:l()(l()({},s),{},{theme:"os-theme-light"}),maxHeight:t,oppositeTheme:a,children:r})},f),{},{children:n}))};n.ZP=x},3108:function(e,n,t){t.d(n,{f:function(){return x},Z:function(){return g}});var r=t(91780),o=t(83843),i=t(17114),s=t(38913),l=t(67618),a=t(37565),u=t(53231),c=t(18843),d=t(79635),f=t(97014),p=t(75271),v=t(88256),m=t(52676),h=function(e){var n=e.left,t=e.right,r=e.marginBottom,o=void 0===r?0:r,i=e.marginTop,s=void 0===i?30:i,l=e.style,a=(0,p.useMemo)((function(){var e={};return e.marginBottom="".concat(o,"px"),e.marginTop="".concat(s,"px"),l&&Object.assign(e,l),e}),[o,s,l]);return(0,m.jsxs)("div",{className:"page-tools",style:a,children:[(0,m.jsx)("div",{className:"left",children:n}),(0,m.jsx)("div",{className:"right",children:t})]})},x=function(e){var n=e.handleInputChange,t=e.handleSelectChange,x=e.handleSearch,g=e.handleDeleteByBatch,w=void 0===g?null:g,b=e.handleClickPrimary,j=void 0===b?null:b,y=e.rowSelection,k=e.actionItems,Z=void 0===k?[]:k,C=e.selectOptions,P=e.showSelect,S=e.buttonText,M=e.buttonIcon,D=e.actionType,F=void 0===D?"button":D,B=e.marginBottom,O=void 0===B?10:B,R=(e.marginTop,e.inputHolder),A=e.selectHolder,T=e.right,z=(e.left,e.width),I=(0,u.useIntl)(),N=(0,p.useMemo)((function(){var e,n,t,l;return j||w?(0,m.jsxs)(c.Z,{size:20,children:[j?"dropdown"===F?(0,m.jsx)(r.Z,{menu:{items:Z,onClick:j},children:(0,m.jsx)(d.ZP,{icon:(0,m.jsx)(o.Z,{}),type:"primary",iconPosition:"end",children:S})}):(0,m.jsx)(d.ZP,{icon:null!=M?M:(0,m.jsx)(i.Z,{}),type:"primary",onClick:j,children:S}):null,w&&(0,m.jsx)(d.ZP,{icon:(0,m.jsx)(s.Z,{}),danger:!0,onClick:w,disabled:!(null!=y&&null!==(e=y.selectedRowKeys)&&void 0!==e&&e.length),children:(0,m.jsxs)("span",{children:[null==I||null===(n=I.formatMessage)||void 0===n?void 0:n.call(I,{id:"common.button.delete"}),(null==y||null===(t=y.selectedRowKeys)||void 0===t?void 0:t.length)>0&&(0,m.jsxs)("span",{children:["(",null==y||null===(l=y.selectedRowKeys)||void 0===l?void 0:l.length,")"]})]})})]}):null}),[Z,F,null==y?void 0:y.selectedRowKeys,j,I]);return(0,m.jsx)(h,{marginBottom:O,marginTop:0,left:(0,m.jsxs)(c.Z,{children:[(0,m.jsx)(f.Z,{prefix:(0,m.jsx)(l.Z,{style:{color:"var(--ant-color-text-placeholder)"}}),placeholder:R||I.formatMessage({id:"common.filter.name"}),style:{width:(null==z?void 0:z.input)||230},allowClear:!0,onChange:n}),P&&(0,m.jsx)(v.Z,{allowClear:!0,showSearch:!1,placeholder:A,style:{width:(null==z?void 0:z.select)||230},size:"large",onChange:t,options:C}),(0,m.jsx)(d.ZP,{type:"text",style:{color:"var(--ant-color-text-tertiary)"},onClick:x,icon:(0,m.jsx)(a.Z,{})})]}),right:T||N})},g=h},17488:function(e,n,t){var r,o=t(53649),i=t.n(o),s=t(92829),l=t(84825),a=(t(75271),t(67585)),u=t(52676),c=(0,a.ZP)(l.Z)(r||(r=i()(["\n  .ant-breadcrumb-link {\n    font-size: 16px;\n    font-weight: 500;\n    a {\n      background: unset;\n    }\n  }\n  .ant-breadcrumb-separator {\n    display: flex;\n    align-items: center;\n  }\n"])));n.Z=function(e){var n=e.items;return(0,u.jsx)(c,{separator:(0,u.jsx)(s.Z,{type:"icon-down2",rotate:-90}),items:n})}},91416:function(e,n,t){t.r(n),t.d(n,{default:function(){return be}});var r,o,i,s,l,a,u,c,d=t(31759),f=t.n(d),p=t(90228),v=t.n(p),m=t(15558),h=t.n(m),x=t(87999),g=t.n(x),w=t(26068),b=t.n(w),j=t(82092),y=t.n(j),k=t(48305),Z=t.n(k),C=t(53649),P=t.n(C),S=t(32914),M=t(91315),D=t(17488),F=t(53231),B=t(26447),O=t(32699),R=t.n(O),A=t(75271),T=t(67585),z=t(94213),I=t(92047),N=t(21433),E=t(3839),K=t(52676),H=E.Z.Step,W=T.ZP.div(r||(r=P()(["\n  width: min(1200px, 100%);\n  margin: 0 auto;\n  padding-block: 30px;\n  background-color: var(--ant-color-bg-container);\n  .ant-steps-item-description {\n    max-width: 300px !important;\n    color: var(--ant-color-text-description) !important;\n  }\n"]))),_=function(e){var n=e.steps,t=e.currentStep,r=e.onChange;return(0,K.jsx)(W,{children:(0,K.jsx)(E.Z,{current:t,size:"small",onChange:r,progressDot:!0,children:n.map((function(e){return(0,K.jsx)(H,{title:e.title,description:e.content},e.title)}))})})},V=t(30627),L=t(3923),$=t(79635),q=T.ZP.span(o||(o=P()(["\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  font-weight: 700;\n  font-size: 16px;\n  .text {\n    font-size: 20px;\n  }\n"]))),Q=function(e){var n=e.onPrevious,t=e.onNext,r=e.handleCancel,o=e.handleSubmit,i=e.showButtons,s=(0,F.useIntl)();return(0,K.jsx)(q,{style:{height:64},children:(0,K.jsxs)("div",{className:"flex-center gap-16",children:[i.previous&&(0,K.jsx)($.ZP,{type:"link",icon:(0,K.jsx)(V.Z,{}),onClick:n,children:s.formatMessage({id:"common.button.prev"})}),i.next&&(0,K.jsxs)($.ZP,{type:"link",onClick:function(){t()},children:[s.formatMessage({id:"common.button.next"}),(0,K.jsx)(L.Z,{})]}),i.skip&&(0,K.jsx)($.ZP,{type:"primary",onClick:r,children:s.formatMessage({id:"clusters.create.skipfornow"})}),i.save&&(0,K.jsx)($.ZP,{type:"primary",onClick:o,style:{minWidth:88},children:s.formatMessage({id:"common.button.save"})})]})})},U=t(66374),X=t(73940),G=t(10939),J=[{label:"Docker",locale:!1,value:X.dC.Docker,key:X.dC.Docker,icon:A.cloneElement(G.Z.DockerOutlined,{style:{color:"var(--ant-blue-6)"}}),group:"clusters.create.provider.self"},{label:"Kubernetes",locale:!1,value:X.dC.Kubernetes,key:X.dC.Kubernetes,icon:A.cloneElement(G.Z.KubernetesFilled,{style:{color:"var(--ant-blue-6)"}}),group:"clusters.create.provider.self"},{label:"DigitalOcean",locale:!1,value:X.dC.DigitalOcean,key:X.dC.DigitalOcean,icon:A.cloneElement(G.Z.DigitalOcean,{style:{color:"var(--ant-blue-6)"}}),group:"clusters.create.provider.cloud"},{label:"AWS",locale:!1,disabled:!0,value:X.dC.AWS,key:X.dC.AWS,icon:G.Z.AWS,description:"cluster.provider.comingsoon",group:"clusters.create.provider.cloud"},{label:"Alibaba Cloud",locale:!1,disabled:!0,value:X.dC.AliCloud,key:X.dC.AliCloud,icon:G.Z.AliCloud,description:"cluster.provider.comingsoon",group:"clusters.create.provider.cloud"}],Y=(0,A.createContext)({formValues:{}}),ee=t(51349),ne=t(3108),te=t(6077),re=T.ZP.span(i||(i=P()(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  font-weight: 700;\n  font-size: 16px;\n  .text {\n    font-size: 20px;\n  }\n"]))),oe=(0,A.forwardRef)((function(e,n){var t=(0,F.useIntl)(),r=e.provider,o=e.credentialList,i=e.action,s=e.currentData,l=(0,A.useRef)(null);return(0,A.useImperativeHandle)(n,(function(){var e,n,t;return{validateFields:null===(e=l.current)||void 0===e?void 0:e.validateFields,getFieldsValue:null===(n=l.current)||void 0===n?void 0:n.getFieldsValue,submit:null===(t=l.current)||void 0===t?void 0:t.submit}})),(0,K.jsxs)("div",{children:[(0,K.jsx)(ne.Z,{marginBottom:16,left:(0,K.jsx)(re,{children:t.formatMessage({id:"clusters.create.configBasic"})}),marginTop:0}),(0,K.jsx)(te.Z,{provider:r,action:i,ref:l,credentialList:o,onFinish:function(e){},currentData:s})]})})),ie=t(17114),se=t(29032),le=T.ZP.div(s||(s=P()(["\n  display: flex;\n  align-items: flex-start;\n  gap: 16px;\n"]))),ae=T.ZP.div(l||(l=P()(["\n  flex: 1;\n  margin-bottom: 16px;\n"]))),ue=T.ZP.span(a||(a=P()(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  font-weight: 700;\n  font-size: 16px;\n  .text {\n    font-size: 20px;\n  }\n"]))),ce=(0,A.forwardRef)((function(e,n){var t=(0,F.useIntl)(),r=e.provider,o=e.action,i=e.currentData,s=(0,A.useRef)(0),l=(0,A.useRef)({}),a=(0,A.useState)(new Set([0])),u=Z()(a,2),c=u[0],d=u[1],f=(0,A.useState)(new Map([[0,{name:"Pool-1"}]])),p=Z()(f,2),m=p[0],h=p[1],x=function(e){},w=function(e){return e.map((function(e){return"fulfilled"===e.status?e.value:"rejected"===e.status&&(null===(n=e.reason)||void 0===n?void 0:n.values)||{};var n})).filter((function(e){return e}))},b=function(){var e=g()(v()().mark((function e(){var n,t;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Array.from(Object.values(l.current)).map((function(e){return null==e?void 0:e.validateFields()})),e.next=3,Promise.allSettled(n);case 3:if(!(t=e.sent).some((function(e){return"rejected"===e.status}))){e.next=7;break}return e.abrupt("return",Promise.reject({values:{worker_pools:w(t)}}));case 7:return e.abrupt("return",Promise.resolve({worker_pools:w(t)}));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=function(){return{worker_pools:Object.values(l.current).map((function(e){return null==e?void 0:e.getFieldsValue()}))}};return(0,A.useImperativeHandle)(n,(function(){return{submit:function(){},validateFields:b,getFieldsValue:j}})),(0,A.useEffect)((function(){var e;i&&(e=(i.worker_pools||[]).map((function(e,n){return[n,e]})),h(new Map(e)))}),[i]),(0,K.jsxs)("div",{children:[(0,K.jsx)(ne.Z,{marginBottom:22,marginTop:0,left:(0,K.jsx)("span",{className:"flex-center gap-16",children:(0,K.jsx)(ue,{children:t.formatMessage({id:"clusters.workerpool.title"})})}),right:(0,K.jsx)($.ZP,{onClick:function(){var e=(s.current+=1,s.current);h((function(n){return new Map(n).set(e,{name:"Pool-".concat(e+1)})})),requestAnimationFrame((function(){d((function(n){return new Set([e])})),window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}))},variant:"filled",color:"default",icon:(0,K.jsx)(ie.Z,{}),children:t.formatMessage({id:"clusters.button.addNodePool"})})}),Array.from(m.keys()).map((function(e,n){return(0,K.jsx)(le,{children:(0,K.jsx)(ae,{children:(0,K.jsx)(se.Z,{name:"workerPoolForm_".concat(e),action:o,ref:function(n){n&&(l.current[e]=n)},collapseProps:{collapsible:!0,open:c.has(e),defaultOpen:c.has(e),onToggle:function(n){return function(e,n){d(e?function(e){return new Set([n])}:function(e){var t=new Set(e);return t.delete(n),t})}(n,e)}},showDelete:m.size>1,onFinish:x,provider:r,currentData:m.get(e),onDelete:function(){return n=e,void(1!==m.size&&(h((function(e){var t=new Map(e);return t.delete(n),t})),l.current[n]=null));var n}})})},e)}))]})})),de=ce,fe="BasicForm",pe="WorkerPoolForm",ve="ProviderCatalog",me="AddWorkerStep",he=y()(y()(y()(y()({},fe,oe),pe,de),ve,U.Z),me,ee.Z),xe=t(25383);var ge=T.ZP.div(u||(u=P()(["\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n"]))),we=T.ZP.div(c||(c=P()(["\n  width: 600px;\n"]))),be=function(){var e=(0,F.useIntl)(),n=function(){var e=(0,F.useIntl)(),n=(0,F.useNavigate)(),t=(0,xe.Z)((function(){n(-1)}));return(0,A.useMemo)((function(){return[{title:e.formatMessage({id:"clusters.create.selectProvider"}),content:"",showButtons:function(e){return{previous:!1,next:!0,save:!1,skip:!1}},defaultShow:!0,showForms:[],showModules:[ve],providers:[]},{title:e.formatMessage({id:"clusters.create.configBasic"}),content:"",showButtons:function(e){return{previous:!0,next:e===X.dC.DigitalOcean,save:e!==X.dC.DigitalOcean,skip:!1}},defaultShow:!0,showForms:[fe],showModules:[],providers:[]},{title:e.formatMessage({id:"clusters.button.addNodePool"}),content:"",showButtons:function(e){return{previous:!0,next:!1,save:!0,skip:!1}},defaultShow:!1,showForms:[pe],showModules:[],providers:[X.dC.DigitalOcean],beforeNext:t},{title:e.formatMessage({id:"resources.button.create"}),content:"",showButtons:function(e){return{previous:!1,next:!1,save:!1,skip:!0}},defaultShow:!1,showForms:[],showModules:[me],providers:[X.dC.Docker]},{title:e.formatMessage({id:"clusters.button.register"}),content:"",showButtons:function(e){return{previous:!1,next:!1,save:!1,skip:!0}},defaultShow:!1,showForms:[],showModules:[me],providers:[X.dC.Kubernetes]}]}),[t,e])}(),t=(0,F.useSearchParams)(),r=Z()(t,1)[0].get("action")||M.Kd.CREATE,o=(0,F.useNavigate)(),i=(0,B.KO)(S.q_),s=Z()(i,2),l=s[0],a=s[1],u=(0,A.useState)([]),c=Z()(u,2),d=c[0],p=c[1],m=(0,A.useState)(0),x=Z()(m,2),w=x[0],j=x[1],k=(0,A.useState)({token:"",image:"",server_url:"",cluster_id:0}),C=Z()(k,2),P=C[0],O=C[1],T=(0,A.useState)({provider:X.dC.Docker}),E=Z()(T,2),H=E[0],W=E[1],V=(0,A.useState)({}),L=Z()(V,2),$=L[0],q=L[1],G=y()(y()({},fe,(0,A.useRef)(null)),pe,(0,A.useRef)(null)),ee=(0,A.useMemo)((function(){return d.filter((function(e){return e.provider===H.provider}))}),[d,H.provider]),ne=(0,A.useMemo)((function(){return H.provider?n.filter((function(e){var n;return null===(n=e.providers)||void 0===n||!n.length||e.providers.includes(H.provider)})).map((function(e,n){return b()(b()({},e),{},{disabled:r===M.Kd.CREATE})})):n.filter((function(e){return e.defaultShow}))}),[r,H.provider,n]),te=function(){var e=g()(v()().mark((function e(){var n,t,r,o,i;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=ne[w],!((null==(t=(null==n?void 0:n.showForms)||[])?void 0:t.length)>0)){e.next=14;break}return e.next=5,Promise.allSettled(t.map((function(e){var n;return null===(n=G[e].current)||void 0===n?void 0:n.validateFields()})));case 5:if(r=e.sent,o=new Map,r.forEach((function(e,n){if("rejected"===e.status){var r,i=(null===(r=e.reason)||void 0===r?void 0:r.values)||{};o.set(t[n],i)}else"fulfilled"===e.status&&o.set(t[n],e.value)})),i=R().merge($,Object.fromEntries(o)),q(i),r.every((function(e){return"fulfilled"===e.status}))){e.next=13;break}return e.abrupt("return",!1);case 13:return e.abrupt("return",Object.assign.apply(Object,[{}].concat(h()(Object.values(i)))));case 14:return e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),re=function(){var e=g()(v()().mark((function e(n){var t,r,o;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,te();case 3:if(!(t=e.sent)){e.next=10;break}return e.next=7,null==n?void 0:n(t);case 7:o=ne[w],null===(r=o.beforeNext)||void 0===r||r.call(o),j((function(e){return Math.min(e+1,ne.length-1)}));case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(n){return e.apply(this,arguments)}}();(0,A.useEffect)((function(){var e=function(){var e=g()(v()().mark((function e(){var n,t,r;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,I.gX)({page:-1});case 2:t=e.sent,r=null===(n=t.items)||void 0===n?void 0:n.map((function(e){return{label:e.name,value:e.id,provider:e.provider}})),p(r);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]);var oe,ie,se=(0,A.useMemo)((function(){var e=ne[w];return null!=e&&e.showButtons?null==e?void 0:e.showButtons(H.provider):{}}),[w,ne,H.provider]),le=function(){var e=g()(v()().mark((function e(n){var t,r,o;return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=b()(b()({},H),"object"===f()(n)?n:{}),e.next=3,(0,I.c0)({data:t});case 3:return r=e.sent,e.next=6,(0,I.zc)({id:r.id});case 6:return o=e.sent,O(b()(b()({},o),{},{cluster_id:r.id})),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(){var e=g()(v()().mark((function e(){return v()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:re(le);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ue=[{title:(0,K.jsx)("a",{children:e.formatMessage({id:"clusters.title"})}),onClick:function(){return o(-1)}},{title:e.formatMessage({id:"common.button.create"})}];return(0,K.jsxs)(z.R,{footer:[(0,K.jsx)(Q,{onPrevious:function(){q((function(e){for(var n=R().cloneDeep(e),t=0,r=Object.entries(G);t<r.length;t++){var o,i,s,l=Z()(r[t],2),a=l[0],u=l[1],c=null==u||null===(o=u.current)||void 0===o||null===(i=(s=o).getFieldsValue)||void 0===i?void 0:i.call(s);c&&(n[a]=c)}return n})),j((function(e){return Math.max(e-1,0)}))},onNext:re,handleCancel:function(){if(null!=l&&l.firstAddCluster)return a({firstAddCluster:!1,firstAddWorker:!1}),void o("/cluster-management/clusters/list");o(-1)},handleSubmit:ae,showButtons:se},"buttons")],header:{title:(0,K.jsx)(D.Z,{items:ue})},children:[(0,K.jsx)(_,{steps:ne,currentStep:w}),(0,K.jsxs)("div",{style:{width:800,margin:"0 auto"},children:[0===w&&(0,K.jsx)(U.Z,{dataList:J,height:70,onSelect:function(e){e!==H.provider?(W({provider:e}),function(){q({});for(var e=0,n=Object.entries(G);e<n.length;e++){var t=Z()(n[e],2),r=t[0];t[1],G[r]=A.createRef()}}(),re()):re()},clickable:!0,current:H.provider}),(0,K.jsxs)(Y.Provider,{value:{formValues:$},children:[(oe=ne[w],ie=(null==oe?void 0:oe.showModules)||[],0===ie.length?null:ie.map((function(e){var n=he[e];return n?(0,K.jsx)(n,{stepList:H.provider===X.dC.Docker?N.bc:N.fU,registrationInfo:P,provider:H.provider},e):null}))),(0,K.jsx)(ge,{children:(0,K.jsx)(we,{children:function(){var e=ne[w],n=(null==e?void 0:e.showForms)||[];return 0===n.length?null:n.map((function(e){var n=he[e];return n?(0,K.jsx)(n,{ref:G[e],action:r,provider:H.provider,credentialList:ee,currentData:$[e]},e):null}))}()})})]})]})]})}}}]);