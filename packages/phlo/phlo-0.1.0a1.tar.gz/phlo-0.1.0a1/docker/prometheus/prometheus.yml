global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'phlo-lakehouse'
    environment: 'local'

# Alertmanager configuration (optional - can add later)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets: []

# Load rules once and periodically evaluate them
# rule_files:
#   - "alerts/*.yml"

scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # Grafana Alloy
  - job_name: 'alloy'
    static_configs:
      - targets: ['alloy:12345']
        labels:
          service: 'alloy'

  # MinIO metrics
  - job_name: 'minio'
    metrics_path: /minio/v2/metrics/cluster
    static_configs:
      - targets: ['minio:9000']
        labels:
          service: 'minio'

  # Postgres exporter
  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres-exporter:9187']
        labels:
          service: 'postgres'
          database: 'lakehouse'

  # Trino JMX metrics
  - job_name: 'trino'
    metrics_path: /v1/jmx/mbean
    params:
      # Query specific JMX beans - Trino exposes many metrics
      pattern: ['*:*']
    static_configs:
      - targets: ['trino:8080']
        labels:
          service: 'trino'

  # Nessie metrics (Quarkus/Micrometer)
  - job_name: 'nessie'
    metrics_path: /q/metrics
    static_configs:
      - targets: ['nessie:19120']
        labels:
          service: 'nessie'

  # Dagster metrics (if exposed - will 404 if not available, that's ok)
  - job_name: 'dagster'
    metrics_path: /server_info
    static_configs:
      - targets: ['dagster-webserver:3000']
        labels:
          service: 'dagster'
    # Don't fail if Dagster doesn't expose Prometheus metrics
    scrape_interval: 30s
    scrape_timeout: 10s
