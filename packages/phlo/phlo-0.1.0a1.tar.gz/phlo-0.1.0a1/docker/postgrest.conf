# PostgREST Configuration
# Documentation: https://postgrest.org/en/stable/configuration.html

## Database Connection
# The database role to use when no client authentication is provided
db-anon-role = "anon"

# The name of which database schema to expose to REST clients
db-schemas = "api"

# Database connection string (format: postgres://user:pass@host:port/db)
# Override with PGRST_DB_URI environment variable in production
db-uri = "postgres://authenticator:authenticator_password_change_in_production@postgres:5432/lakehouse"

# Number of connections to keep open in PostgREST's database pool
db-pool = 20

# Time to live for any connection in seconds
db-pool-timeout = 10

# Use prepared statements
db-prepared-statements = true

# Extra search path for PostgreSQL schemas (comma-separated)
db-extra-search-path = "public"

# Maximum number of rows returned in a response (prevents accidentally large responses)
db-max-rows = 10000

# Transaction mode for writable requests (commit, rollback, commit-allow-override)
db-tx-end = "commit"

## Server Configuration
# Hostname/IP address to listen on
server-host = "0.0.0.0"

# Port to listen on
server-port = 3000

# Proxy URI for OpenAPI output (used in Swagger UI and API docs)
# This should be your public-facing URL
openapi-server-proxy-uri = "http://localhost:10010"

# OpenAPI mode (follow-privileges, ignore-privileges, disabled)
# follow-privileges: Only shows endpoints the JWT user has access to
openapi-mode = "follow-privileges"

## JWT Authentication
# The secret used to sign and verify JWT tokens
# MUST match the secret used by your authentication system (FastAPI, Hasura)
# Override with PGRST_JWT_SECRET environment variable
jwt-secret = "phlo-jwt-secret-change-in-production"

# Whether the jwt-secret is base64-encoded
jwt-secret-is-base64 = false

# The JWT claim to use for role switching
jwt-role-claim-key = ".role"

# Audience claim to validate in JWT tokens
# jwt-aud = "phlo-api"

## Logging
# Log level (crit, error, warn, info)
log-level = "info"

## CORS
# Disabled in PostgREST - handle in nginx reverse proxy
# server-cors-allowed-origins = "*"

## Admin Server (for health checks and schema cache reload)
admin-server-port = 3001

## OpenAPI
# OpenAPI specification output
# Access at http://localhost:3000/ with Accept: application/openapi+json header
openapi-security-active = true

## Performance
# Pre-request function (useful for rate limiting or logging)
# db-pre-request = "api.check_rate_limit"

# Enable EXPLAIN for queries (useful for debugging performance)
# db-plan-enabled = true
