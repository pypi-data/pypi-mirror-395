# Alerting Configuration for Glucose Platform
# This file defines alerting rules and destinations for data quality issues

# Alert destinations (configured via environment variables)
destinations:
  - type: slack
    enabled: true
    channel: "#glucose-alerts"
    webhook_env: PHLO_ALERT_SLACK_WEBHOOK
    severity_levels: [ERROR, CRITICAL]

  - type: pagerduty
    enabled: false  # Enable for production
    integration_key_env: PHLO_ALERT_PAGERDUTY_KEY
    severity_levels: [CRITICAL]

  - type: email
    enabled: false  # Enable for production
    smtp_host_env: PHLO_ALERT_EMAIL_SMTP_HOST
    recipients_env: PHLO_ALERT_EMAIL_RECIPIENTS
    severity_levels: [WARNING, ERROR, CRITICAL]

# Alert rules
rules:
  # Quality check failures
  - name: quality_check_failure
    description: "Alert when quality checks fail"
    condition: "asset_check.failed"
    severity: ERROR
    destinations: [slack, email]

  # Data freshness violations
  - name: stale_data
    description: "Alert when data freshness SLA is violated"
    condition: "freshness.hours > 24"
    severity: WARNING
    destinations: [slack]

  # High glucose variability
  - name: high_variability
    description: "Alert when coefficient of variation exceeds 40%"
    condition: "cv > 40 and days > 7"
    severity: WARNING
    destinations: [slack]

  # Pipeline failures
  - name: materialization_failure
    description: "Alert when asset materialization fails"
    condition: "run.status == 'FAILURE'"
    severity: CRITICAL
    destinations: [slack, pagerduty, email]

# Deduplication settings
deduplication:
  enabled: true
  window_minutes: 60  # Don't send duplicate alerts within 1 hour

# Quiet hours (optional)
quiet_hours:
  enabled: false
  start: "22:00"
  end: "08:00"
  timezone: "America/Los_Angeles"
  severity_threshold: CRITICAL  # Only allow CRITICAL alerts during quiet hours
