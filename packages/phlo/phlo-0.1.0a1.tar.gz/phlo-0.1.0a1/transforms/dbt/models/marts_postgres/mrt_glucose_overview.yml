# mrt_glucose_overview.yml - Schema tests for glucose overview mart

version: 2

models:
  - name: mrt_glucose_overview
    description: "PostgreSQL mart providing denormalized daily glucose metrics"
    columns:
      - name: reading_date
        description: "Date of glucose readings"
        tests:
          - not_null
          - unique

      - name: reading_count
        description: "Number of readings on this date"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: bigint

      - name: avg_glucose_mg_dl
        description: "Average glucose level"
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: double

      - name: min_glucose_mg_dl
        description: "Minimum glucose level"
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: bigint

      - name: max_glucose_mg_dl
        description: "Maximum glucose level"
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: bigint

      - name: time_in_range_pct
        description: "Percentage of time in range"
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: double
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 100
