# fct_github_repo_stats.yml - Schema and business logic tests for GitHub repository statistics fact table

version: 2

models:
  - name: fct_github_repo_stats
    description: "Silver layer fact table for enriched GitHub repository statistics"
    meta:
      dagster:
        asset_key: ["fct_github_repo_stats"]
    columns:
      - name: repo_name
        description: "Name of the repository"
        tests:
          - not_null

      - name: repo_full_name
        description: "Full name of the repository (owner/repo)"
        tests:
          - not_null
          - unique

      - name: repo_id
        description: "GitHub repository ID"
        tests:
          - not_null
          - unique

      - name: repo_owner
        description: "Repository owner"
        tests:
          - not_null

      - name: repo_short_name
        description: "Repository short name"
        tests:
          - not_null

      - name: collection_date
        description: "Date when statistics were collected"
        tests:
          - not_null

      - name: contributor_count
        description: "Number of contributors"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: integer

      - name: total_commits_last_52_weeks
        description: "Total commits in last 52 weeks"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: integer

      - name: net_code_changes
        description: "Net code changes (deletions)"
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: integer

      - name: weeks_with_activity
        description: "Number of weeks with activity"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: integer

      - name: activity_score
        description: "Calculated activity score"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: numeric

      - name: contribution_level
        description: "Contribution level classification"
        tests:
          - not_null
          - accepted_values:
              values: ['high_contribution', 'medium_contribution', 'low_contribution', 'no_contribution']

      - name: activity_level
        description: "Activity level classification"
        tests:
          - not_null
          - accepted_values:
              values: ['very_active', 'active', 'moderate', 'inactive']

      - name: repository_health
        description: "Repository health status"
        tests:
          - not_null
          - accepted_values:
              values: ['healthy', 'stable', 'developing', 'dormant']

      - name: avg_commits_per_week
        description: "Average commits per week"
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: numeric
