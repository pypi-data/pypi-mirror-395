[project]
name = "pytest-error"
version = "0.1.0"
description = "A decorator for testing exceptions with pytest"
license = "MIT"
readme = "README.md"
requires-python = ">=3.10, <4.0"
authors = [
    {name = "Jonathan King", email = "jonking93@gmail.com"},
]
maintainers = [
    {name = "Jonathan King", email = "jonking93@gmail.com"},
]
keywords = [ "pytest", "testing", "exception", "error", "error message"]
classifiers = [
    "Development Status :: 4 - Beta",
    "Framework :: Pytest",
    "Intended Audience :: Developers",
    "Topic :: Software Development :: Testing",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Programming Language :: Python",
    "Programming Language :: Python :: 3 :: Only",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Programming Language :: Python :: 3.14",
]
dependencies = [
    "pytest>=8.4"
]

[dependency-groups]
poe = ["poethepoet"]
audit = ["pip-audit"]
lint = ["black", "isort"]
coverage = ["coverage", "pytest-cov"]
docs = ["sphinx", "furo", "sphinx_design", "sphinx-copybutton"]
deploy = ["twine"]
dev = [
    { include-group = "poe" },
    { include-group = "audit" },
    { include-group = "lint" },
    { include-group = "coverage" },
    { include-group = "docs" },
    { include-group = "deploy" },
]

[project.urls]
repository = "https://github.com/pytest-error"
documentation = "https://jonking93.github.io/pytest-error"


#####
# Poetry
#####

[build-system]
requires = ["poetry-core>=2.0.0,<3.0.0"]
build-backend = "poetry.core.masonry.api"

[tool.poetry]
packages = [
    { include = "pytest_error.py", from = "src" },
]


#####
# Tool configurations
#####

[tool.isort]
profile = "black"

[tool.coverage.report]
exclude_also = [
    "if typing.TYPE_CHECKING",
]


#####
# Dev scripts
#####

##### Utils

[tool.poe.tasks._rmtree]
help = "Deletes a folder and its contents"
expr = "shutil.rmtree(sys.argv[1]) if pathlib.Path(sys.argv[1]).exists() else None"
imports = ["shutil", "pathlib"]

[tool.poe.tasks._delete]
help = "Deletes a file"
expr = "pathlib.Path(sys.argv[1]).unlink() if pathlib.Path(sys.argv[1]).exists() else None"
imports = ["pathlib"]

[tool.poe.tasks._open]
help = "Opens an HTML index page in a browser"
expr = "webbrowser.open(pathlib.Path.cwd() / sys.argv[1] / 'index.html')"
imports = ["webbrowser", "pathlib"]


##### Dependencies: Audit, Lock

[tool.poe.tasks.audit]
help = "Checks package dependencies for security issues"
cmd = "pip-audit ."

[tool.poe.tasks.update]
help = "Deletes poetry.lock and reinstalls the project"
sequence = [
  {ref = "_delete poetry.lock" },
  {cmd = "poetry install --all-groups --all-extras" },
]


##### Formatting

[tool.poe.tasks.format]
help = "Applies black and isort to the package and its tests"
sequence = [
  "isort src", 
  "isort tests", 
  "black src", 
  "black tests",
  ]
default_item_type = "cmd"

[tool.poe.tasks.lint]
help = "Requires the package and its tests to be properly formatted"
sequence = [
  "isort src --check", 
  "isort tests --check",
  "black src --check", 
  "black tests --check",
]
default_item_type = "cmd"


##### Testing and test coverage

[tool.poe.tasks.tests]
help = "Runs the tests and requires 100% coverage"
sequence = [
  { cmd = "pytest tests --cov=src --cov=tests --cov-fail-under=100 --cov-report xml:coverage.xml" },
  { ref = "coverage" },
]

[tool.poe.tasks.coverage]
help = "Prints the coverage report for the tests"
cmd = "coverage report"

[tool.poe.tasks.htmlcov]
help = "Builds an HTML coverage report and opens in browser"
sequence = [
  { ref = "_rmtree htmlcov" },
  { cmd = "coverage html --skip-covered" },
  { ref = "_open htmlcov" },
]


##### Docs

[tool.poe.tasks.docs]
help = "Deletes and then rebuilds the documentation"
sequence = [
  { ref = "_rmtree public" },
  { cmd = "sphinx-build -qa docs public" },
]

[tool.poe.tasks.open-docs]
help = "Opens the docs in a webbrowser"
ref = "_open public"
