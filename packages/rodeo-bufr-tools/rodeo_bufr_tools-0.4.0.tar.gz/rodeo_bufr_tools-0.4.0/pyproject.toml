[build-system]
requires = ["setuptools", "setuptools-scm", "pybind11~=2.11.1", "build"]
build-backend = "setuptools.build_meta"

[project]
name = "rodeo-bufr-tools"
description = "Tools for working with JSON-BUFR conversion in the E-SOH proejct."
readme = "README.md"
requires-python = ">=3.11"
dynamic = ["version"]
authors = [
    {name = "Istvan Sebök"}
]
maintainers = [
    {name = "Istavn Sebök"},
    {name = "Amund Isaksen"}
]
classifiers = [
  "Programming Language :: Python :: 3",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: Implementation :: CPython",
]

dependencies = ["pybind11 ~= 2.11.1"]


[tool.uv]
dev-dependencies = ['coverage', 'pre-commit', 'pytest', 'debugpy', 'ipython']

[tool.setuptools]
packages = [
  "bufr_tools",
  "bufr_tools.data.tables.opera",
  "bufr_tools.data.schemas",
  "bufr_tools.data.tables.wmo",
  "bufr_tools.data.oscar",
] #, "bufr_tools.data"]
package-dir = { "bufr_tools" = "src/bufr_tools" }
include-package-data = true

[tool.setuptools.package-data]
bufr_tools = ["**.json", "**.txt", "**.csv"]

[tool.setuptools_scm]
write_to = "src/bufr_tools/_version.py" # Optional: writes version to a file


[tool.setuptools.exclude-package-data]
bufr_tools = [
  "bufresohmsg.cpp",
  "bufrprint.cpp",
  "covjson2bufr_main.cpp",
  "bufrenc.cpp",
]

[tool.cibuildwheel]
build-frontend = "build"
manylinux-x86_64-image = "quay.io/pypa/manylinux_2_28_x86_64"
manylinux-i686-image = "quay.io/pypa/manylinux_2_28_i686"

[tool.cibuildwheel.windows]

[tool.cibuildwheel.linux]
environment = { CXX="/opt/rh/gcc-toolset-13/root/usr/bin/c++" }
skip = "*-musllinux*"

before-all = [
  "yum install -y gcc-toolset-13-*",
  "curl -L -s -o /tmp/rapidjson.tar.gz https://github.com/Tencent/rapidjson/archive/refs/tags/v1.1.0.tar.gz",
  "tar xvf /tmp/rapidjson.tar.gz -C /usr/  --strip-components=1  rapidjson-1.1.0/include",
  "rm -f /tmp/rapidjson.tar.gz"
]
