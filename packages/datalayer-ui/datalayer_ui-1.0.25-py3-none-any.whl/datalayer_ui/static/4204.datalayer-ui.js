"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[4204],{44204:(e,t,n)=>{n.r(t),n.d(t,{default:()=>q});var i=n(4279),o=n(84939),r=n(52556);const s="CompletionProvider:context";class l{constructor(){this.identifier=s,this.rank=500,this.renderer=null}async isApplicable(e){return!0}fetch(e,t){const n=t.editor;return n?new Promise(e=>{e(a.contextHint(n))}):Promise.reject("No editor")}}var a;!function(e){e.contextHint=function(e){const t=e.getTokenAtCursor(),n=function(e,t){return t.getTokens().filter(t=>0===t.value.indexOf(e.value)&&t.value!==e.value)}(t,e).filter(e=>e.type).map(e=>e.value),i=new Set(n),o=new Array;return i.forEach(e=>o.push({label:e})),{start:t.offset,end:t.offset+t.value.length,items:o}}}(a||(a={}));var c=n(71784),d=n(85181),p=n(87725);class m{constructor(e){this.options=e,this.identifier="@jupyterlab/inline-completer:history",this._maxSuggestions=100;const t=e.translator||d.wK;this._trans=t.load("jupyterlab")}get name(){return this._trans.__("History")}get icon(){return p.oc}get schema(){return{properties:{maxSuggestions:{title:this._trans.__("Maximum number of suggestions"),description:this._trans.__("The maximum number of suggestions to retrieve from history."),type:"number"}},default:{enabled:!1,maxSuggestions:100}}}configure(e){var t;this._maxSuggestions=null!==(t=e.maxSuggestions)&&void 0!==t?t:100}async fetch(e,t,n){var i;const o=null===(i=t.session)||void 0===i?void 0:i.kernel;if(!o)throw new Error("No kernel for completion request.");const r=e.text.slice(0,e.offset).split("\n").slice(-1)[0],s=e.text.slice(e.offset).split("\n")[0];let l;const a=[];if(""===r){l={output:!1,raw:!0,hist_access_type:"tail",n:this._maxSuggestions};const e=await o.requestHistory(l);if("ok"===e.content.status){let t=e.content.history;const n=new Map;for(const e of t.reverse()){const t=e[2];n.set(t,(n.get(t)||0)+1)}const i=Array.from(n.entries()).sort((e,t)=>e[1]>t[1]?-1:e[1]<t[1]?1:0);for(const e of i)a.push({insertText:e[0]})}}else{l={output:!1,raw:!0,hist_access_type:"search",pattern:r+"*"+(s?s+"*":""),unique:!0,n:this._maxSuggestions};const e=await o.requestHistory(l);if("ok"===e.content.status)for(const t of e.content.history){const e=t[2].split("\n");for(let t=0;t<e.length;t++){const n=e[t];if(n.startsWith(r)){let i=n.slice(r.length);t+1<e.length&&(i+="\n"+e.slice(t+1).join("\n")),s&&(i=i.slice(0,i.indexOf(s))),a.push({insertText:i})}}}}return{items:a}}}var u=n(77128),h=n(72490),v=n(14809),f=n(89492),g=n(44623),_=n(62097),y=n(37706);class C{constructor(){this._activeProviders=new Set([c.c,s]),this._inlineCompleterSettings=u.B.defaultSettings,this._providers=new Map,this._inlineProviders=new Map,this._panelHandlers=new Map,this._mostRecentContext=new Map,this._activeProvidersChanged=new h.Signal(this),this._selected=new h.Signal(this),this._inlineCompleterFactory=null}get activeProvidersChanged(){return this._activeProvidersChanged}get selected(){return this._selected}setTimeout(e){this._timeout=e}setShowDocumentationPanel(e){this._panelHandlers.forEach(t=>t.completer.showDocsPanel=e),this._showDoc=e}setSuppressIfInlineCompleterActive(e){this._panelHandlers.forEach(t=>t.completer.suppressIfInlineCompleterActive=e),this._suppressIfInlineCompleterActive=e}setContinuousHinting(e){this._panelHandlers.forEach(t=>t.autoCompletion=e),this._autoCompletion=e}registerProvider(e){const t=e.identifier;this._providers.has(t)?console.warn(`Completion provider with identifier ${t} is already registered`):(this._providers.set(t,e),this._panelHandlers.forEach((e,t)=>{this.updateCompleter(this._mostRecentContext.get(t))}))}registerInlineProvider(e){const t=e.identifier;this._inlineProviders.has(t)?console.warn(`Completion provider with identifier ${t} is already registered`):(this._inlineProviders.set(t,e),this._panelHandlers.forEach((e,t)=>{this.updateCompleter(this._mostRecentContext.get(t))}))}getProviders(){return this._providers}activateProvider(e){this._activeProviders=new Set([]),e.forEach(e=>{this._providers.has(e)&&this._activeProviders.add(e)}),0===this._activeProviders.size&&(this._activeProviders.add(c.c),this._activeProviders.add(s)),this._activeProvidersChanged.emit()}async updateCompleter(e){var t,n;const{widget:i,editor:o,sanitizer:r}=e,s=i.id,l=this._panelHandlers.get(s),a=[...this._activeProviders][0],c=this._providers.get(a);let d=null!==(t=null==c?void 0:c.renderer)&&void 0!==t?t:y.A.getDefaultRenderer(r);const p=null==c?void 0:c.modelFactory;let m;m=p?await p.call(c,e):new _.X,this._mostRecentContext.set(i.id,e);const u={model:m,editor:o,renderer:d,sanitizer:r,showDoc:this._showDoc};if(l){const t=l.completer;null===(n=t.model)||void 0===n||n.dispose(),t.model=u.model,t.renderer=u.renderer,t.showDocsPanel=u.showDoc,t.suppressIfInlineCompleterActive=this._suppressIfInlineCompleterActive,l.autoCompletion=this._autoCompletion,o&&(l.editor=o,l.reconciliator=await this.generateReconciliator(e))}else{const t=await this._generateHandler(e,u);this._panelHandlers.set(i.id,t),t.completer.selected.connect((e,t)=>this._selected.emit({insertText:t})),i.disposed.connect(e=>{this.disposeHandler(e.id,t),this._mostRecentContext.delete(s)})}}invoke(e){const t=this._panelHandlers.get(e);t&&t.invoke()}select(e){const t=this._panelHandlers.get(e);t&&t.completer.selectActive()}setInlineCompleterFactory(e){this._inlineCompleterFactory=e,this._panelHandlers.forEach((e,t)=>{this.updateCompleter(this._mostRecentContext.get(t))}),this.inline||(this.inline={invoke:e=>{const t=this._panelHandlers.get(e);t&&t.inlineCompleter&&t.invokeInline()},isActive:e=>{const t=this._panelHandlers.get(e);return!(!t||!t.inlineCompleter)&&t.inlineCompleter.isActive},cycle:(e,t)=>{const n=this._panelHandlers.get(e);n&&n.inlineCompleter&&n.inlineCompleter.cycle(t)},accept:e=>{const t=this._panelHandlers.get(e);t&&t.inlineCompleter&&t.inlineCompleter.accept()},configure:e=>{this._inlineCompleterSettings=e;for(const[t,n]of this._inlineProviders.entries())n.configure&&n.configure(e.providers[t]);this._panelHandlers.forEach((t,n)=>{t.inlineCompleter&&t.inlineCompleter.configure(e),this.updateCompleter(this._mostRecentContext.get(n))})}})}get inlineProviders(){return[...this._inlineProviders.values()]}async generateReconciliator(e){const t=[];for(const[e,n]of Object.entries(this._inlineCompleterSettings.providers))!0===n.enabled&&t.push(e);const n=[...this._inlineProviders.values()].filter(e=>t.includes(e.identifier)),i=[];for(const e of this._activeProviders){const t=this._providers.get(e);t&&i.push(t)}return new f.C({context:e,providers:i,inlineProviders:n,inlineProvidersSettings:this._inlineCompleterSettings.providers,timeout:this._timeout})}disposeHandler(e,t){var n,i,o,r;null===(n=t.completer.model)||void 0===n||n.dispose(),t.completer.dispose(),null===(o=null===(i=t.inlineCompleter)||void 0===i?void 0:i.model)||void 0===o||o.dispose(),null===(r=t.inlineCompleter)||void 0===r||r.dispose(),t.dispose(),this._panelHandlers.delete(e)}async _generateHandler(e,t){const n=new y.A(t),i=this._inlineCompleterFactory?this._inlineCompleterFactory.factory({...t,model:new u.B.Model}):void 0;n.hide(),v.x0.attach(n,document.body),i&&(v.x0.attach(i,document.body),i.hide(),i.configure(this._inlineCompleterSettings));const o=await this.generateReconciliator(e),r=new g.$({completer:n,inlineCompleter:i,reconciliator:o});return r.editor=e.editor,r}}var b=n(69584),I=n(61110),w=n(16950),x=n(9387);const P="availableProviders";function k(e){const{schema:t}=e,n=t.title,i=t.description,o=e.formContext.settings,r=o.get(P).user,s={...t.default};if(r)for(const e of Object.keys(s))s[e]=e in r?r[e]:-1;const[l,a]=(0,x.useState)(s);return x.createElement("div",null,x.createElement("fieldset",null,x.createElement("legend",null,n),x.createElement("p",{className:"field-description"},i),Object.keys(s).map(e=>x.createElement("div",{key:e,className:"form-group small-field"},x.createElement("div",null,x.createElement("h3",null," ",e),x.createElement("div",{className:"inputFieldWrapper"},x.createElement("input",{className:"form-control",type:"number",value:l[e],onChange:t=>{((e,t)=>{const n={...l,[e]:parseInt(t.target.value)};o.set(P,n).catch(console.error),a(n)})(e,t)}})))))))}const S="@jupyterlab/completer-extension:manager",E="@jupyterlab/completer-extension:inline-completer";var H;!function(e){e.nextInline="inline-completer:next",e.previousInline="inline-completer:previous",e.acceptInline="inline-completer:accept",e.invokeInline="inline-completer:invoke"}(H||(H={}));const A={id:"@jupyterlab/completer-extension:base-service",description:"Adds context and kernel completion providers.",requires:[r.qx],autoStart:!0,activate:(e,t)=>{t.registerProvider(new l),t.registerProvider(new c.G)}},j={id:"@jupyterlab/completer-extension:inline-history",description:"Adds inline completion provider suggesting code from execution history.",requires:[r.qx],optional:[d.sQ],autoStart:!0,activate:(e,t,n)=>{t.registerInlineProvider(new m({translator:null!=n?n:d.wK}))}},F={id:"@jupyterlab/completer-extension:inline-completer-factory",description:"Provides a factory for inline completer.",provides:r.CF,optional:[d.sQ],autoStart:!0,activate:(e,t)=>{const n=(t||d.wK).load("jupyterlab");return{factory:t=>{const i=new u.B({...t,trans:n}),r=t=>{const n=e.commands.keyBindings.find(e=>e.command===t),i=n?w.J.formatKeystroke(n.keys):"";return i?`${i}`:""},s={[H.previousInline]:r(H.previousInline),[H.nextInline]:r(H.nextInline),[H.acceptInline]:r(H.acceptInline)};return e.commands.keyBindingChanged.connect((t,n)=>{const i=n.binding.command;if(s.hasOwnProperty(i)){const t=s[i],n=r(i);n!==t&&(s[i]=n,e.commands.notifyCommandChanged(i))}}),i.toolbar.addItem("previous-inline-completion",new o.Fu({commands:e.commands,icon:p.SW,id:H.previousInline,label:()=>s[H.previousInline],caption:n.__("Previous")})),i.toolbar.addItem("next-inline-completion",new o.Fu({commands:e.commands,icon:p.XU,id:H.nextInline,label:()=>s[H.nextInline],caption:n.__("Next")})),i.toolbar.addItem("accept-inline-completion",new o.Fu({commands:e.commands,icon:p.oE,id:H.acceptInline,label:()=>s[H.acceptInline],caption:n.__("Accept")})),i.model.suggestionsChanged.connect(()=>{for(const t of[H.previousInline,H.nextInline,H.acceptInline])e.commands.notifyCommandChanged(t)}),i}}}},R={id:E,description:"Registers the inline completer factory; adds inline completer commands, shortcuts and settings.",requires:[r.qx,r.CF,b.X],optional:[d.sQ],autoStart:!0,activate:(e,t,n,o,r)=>{t.setInlineCompleterFactory(n);const s=(r||d.wK).load("jupyterlab"),l=()=>!!e.shell.currentWidget&&!!t.inline;let a;e.commands.addCommand(H.nextInline,{execute:()=>{var n;null===(n=t.inline)||void 0===n||n.cycle(e.shell.currentWidget.id,"next")},label:s.__("Next Inline Completion"),isEnabled:l,describedBy:{args:{type:"object",properties:{}}}}),e.commands.addCommand(H.previousInline,{execute:()=>{var n;null===(n=t.inline)||void 0===n||n.cycle(e.shell.currentWidget.id,"previous")},label:s.__("Previous Inline Completion"),isEnabled:l,describedBy:{args:{type:"object",properties:{}}}}),e.commands.addCommand(H.acceptInline,{execute:()=>{var n;null===(n=t.inline)||void 0===n||n.accept(e.shell.currentWidget.id)},label:s.__("Accept Inline Completion"),isEnabled:()=>l()&&t.inline.isActive(e.shell.currentWidget.id),describedBy:{args:{type:"object",properties:{}}}}),e.commands.addCommand(H.invokeInline,{execute:()=>{var n;null===(n=t.inline)||void 0===n||n.invoke(e.shell.currentWidget.id)},label:s.__("Invoke Inline Completer"),isEnabled:l,describedBy:{args:{type:"object",properties:{}}}});const c=e=>{var n;a=e.composite,null===(n=t.inline)||void 0===n||n.configure(a)};e.restored.then(()=>{var e;const n=null!==(e=t.inlineProviders)&&void 0!==e?e:[],i=e=>{var t,n;return{enabled:!0,autoFillInMiddle:!1,timeout:5e3,debouncerDelay:0,...null!==(n=null===(t=e.schema)||void 0===t?void 0:t.default)&&void 0!==n?n:{}}};o.transform(E,{compose:e=>{var t,o;const r=null!==(t=e.data.composite.providers)&&void 0!==t?t:{};for(const e of n){const t=i(e);r[e.identifier]={...t,...null!==(o=r[e.identifier])&&void 0!==o?o:{}}}return e.data.composite.providers=r,e},fetch:e=>{var t,o;const r=e.schema.properties,l={};for(const e of n)l[e.identifier]={title:s.__("%1 provider",e.name),properties:{...null!==(o=null===(t=e.schema)||void 0===t?void 0:t.properties)&&void 0!==o?o:{},timeout:{title:s.__("Timeout"),description:s.__("Timeout for %1 provider (in milliseconds).",e.name),type:"number",minimum:0},debouncerDelay:{title:s.__("Debouncer delay"),minimum:0,description:s.__("Time since the last key press to wait before requesting completions from %1 provider (in milliseconds).",e.name),type:"number"},enabled:{title:s.__("Enabled"),description:s.__("Whether to fetch completions %1 provider.",e.name),type:"boolean"},autoFillInMiddle:{title:s.__("Fill in middle on typing"),description:s.__("Whether to show completions in the middle of the code line from %1 provider on typing.",e.name),type:"boolean"}},default:i(e),type:"object"};return r.providers.properties=l,e}}),o.load(E).then(e=>{c(e),e.changed.connect(e=>{c(e)})}).catch(console.error)}).catch(console.error);const p=t=>e.commands.keyBindings.find(e=>e.command===t),m={[H.acceptInline]:p(H.acceptInline),[H.invokeInline]:p(H.invokeInline)};e.commands.keyBindingChanged.connect((e,t)=>{const n=t.binding.command;m.hasOwnProperty(n)&&(m[n]=p(n))}),document.addEventListener("keydown",t=>{if(!(t.target instanceof Element))return;const n=t.target;switch(t.keyCode){case 9:{const o=[m[H.acceptInline],m[H.invokeInline]];for(const r of o)if(r&&1===r.keys.length&&"Tab"===r.keys[0]&&n.closest(r.selector)&&e.commands.isEnabled(r.command)){const o=n.closest("."+i.Qr);if((null==a?void 0:a.suppressIfTabCompleterActive)&&o)return;return e.commands.execute(r.command).catch(console.error),t.preventDefault(),t.stopPropagation(),void t.stopImmediatePropagation()}break}default:return}},!0)}},T={id:S,description:"Provides the completion provider manager.",requires:[b.X],optional:[I.g],provides:r.qx,autoStart:!0,activate:(e,t,n)=>{const i="availableProviders",o=new C,r=(e,t)=>{var n;const r=e.get(i),s=e.composite;o.setTimeout(s.providerTimeout),o.setShowDocumentationPanel(s.showDocumentationPanel),o.setContinuousHinting(s.autoCompletion),o.setSuppressIfInlineCompleterActive(s.suppressIfInlineCompleterActive);const l=null!==(n=r.user)&&void 0!==n?n:r.composite,a=Object.entries(null!=l?l:{}).filter(e=>e[1]>=0&&t.includes(e[0])).sort(([,e],[,t])=>t-e).map(e=>e[0]);o.activateProvider(a)};if(e.restored.then(()=>{const e=[...o.getProviders().entries()],n=e.map(([e,t])=>e);t.transform(S,{fetch:t=>{const n=t.schema.properties,o={};return e.forEach(([e,t],n)=>{var i;o[e]=null!==(i=t.rank)&&void 0!==i?i:10*(n+1)}),n[i].default=o,t}}),t.load(S).then(e=>{r(e,n),e.changed.connect(e=>{r(e,n)})}).catch(console.error)}).catch(console.error),n){const e={fieldRenderer:e=>k(e)};n.addRenderer(`${S}.availableProviders`,e)}return o}},q=[T,A,j,F,R]},61110:(e,t,n)=>{n.d(t,{J:()=>r,g:()=>o});var i=n(98238);const o=new i.Token("@jupyterlab/ui-components:IFormRendererRegistry","A service for settings form renderer registration."),r=new i.Token("@jupyterlab/ui-components:ILabIconManager","A service to register and request icons.")}}]);