"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[4776],{94776:(e,t,n)=>{n.r(t),n.d(t,{ToolbarItems:()=>te,default:()=>ee,downloadPlugin:()=>J,openBrowserTabPlugin:()=>Y,pathStatusPlugin:()=>X,savingStatusPlugin:()=>z});var o,a=n(19823),i=n(80955),s=n(68122),r=n(59179),c=n(80578),d=n(2335),l=n(84939),h=n(88037),u=n(8522),g=n(25385),p=n(63711),m=n(60872),_=n(48561),v=n(14377),f=n(85181),y=n(38921),w=n(98238),b=n(15503),C=n(72490),x=n(45427),F=n(39203);class S{constructor(e){var t,n;this._activateRequested=new C.Signal(this),this._contexts=[],this._isDisposed=!1,this._autosave=!0,this._autosaveInterval=120,this._lastModifiedCheckMargin=500,this._renameUntitledFileOnSave=!0,this._stateChanged=new C.Signal(this),this.translator=e.translator||f.wK,this.registry=e.registry,this.services=e.manager,this._docManagerDialogs=null!==(t=e.docManagerDialogs)&&void 0!==t?t:new _.S0({translator:this.translator}),this._dialogs=null!==(n=e.sessionDialogs)&&void 0!==n?n:new c.V({translator:e.translator}),this._isConnectedCallback=e.isConnectedCallback||(()=>!0),this._opener=e.opener,this._when=e.when||e.manager.ready;const o=new F.p({registry:this.registry,translator:this.translator,recentsManager:e.recentsManager,dialogs:this._docManagerDialogs});o.activateRequested.connect(this._onActivateRequested,this),o.stateChanged.connect(this._onWidgetStateChanged,this),this._widgetManager=o,this._setBusy=e.setBusy,this._urlResolverFactory=e.urlResolverFactory}get activateRequested(){return this._activateRequested}get autosave(){return this._autosave}set autosave(e){if(this._autosave!==e){const t=this._autosave;this._autosave=e,this._contexts.forEach(t=>{const n=o.saveHandlerProperty.get(t);n&&(!0!==e||n.isActive?!1===e&&n.isActive&&n.stop():n.start())}),this._stateChanged.emit({name:"autosave",oldValue:t,newValue:e})}}get autosaveInterval(){return this._autosaveInterval}set autosaveInterval(e){if(this._autosaveInterval!==e){const t=this._autosaveInterval;this._autosaveInterval=e,this._contexts.forEach(t=>{const n=o.saveHandlerProperty.get(t);n&&(n.saveInterval=e||120)}),this._stateChanged.emit({name:"autosaveInterval",oldValue:t,newValue:e})}}get confirmClosingDocument(){return this._widgetManager.confirmClosingDocument}set confirmClosingDocument(e){if(this._widgetManager.confirmClosingDocument!==e){const t=this._widgetManager.confirmClosingDocument;this._widgetManager.confirmClosingDocument=e,this._stateChanged.emit({name:"confirmClosingDocument",oldValue:t,newValue:e})}}get lastModifiedCheckMargin(){return this._lastModifiedCheckMargin}set lastModifiedCheckMargin(e){if(this._lastModifiedCheckMargin!==e){const t=this._lastModifiedCheckMargin;this._lastModifiedCheckMargin=e,this._contexts.forEach(t=>{t.lastModifiedCheckMargin=e}),this._stateChanged.emit({name:"lastModifiedCheckMargin",oldValue:t,newValue:e})}}get renameUntitledFileOnSave(){return this._renameUntitledFileOnSave}set renameUntitledFileOnSave(e){if(this._renameUntitledFileOnSave!==e){const t=this._renameUntitledFileOnSave;this._renameUntitledFileOnSave=e,this._stateChanged.emit({name:"renameUntitledFileOnSave",oldValue:t,newValue:e})}}get stateChanged(){return this._stateChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,C.Signal.clearData(this),this._contexts.forEach(e=>this._widgetManager.closeWidgets(e)),this._widgetManager.dispose(),this._contexts.length=0)}cloneWidget(e){return this._widgetManager.cloneWidget(e)}closeAll(){return Promise.all(this._contexts.map(e=>this._widgetManager.closeWidgets(e))).then(()=>{})}closeFile(e){const t=this._contextsForPath(e).map(e=>this._widgetManager.closeWidgets(e));return Promise.all(t).then(e=>{})}contextForWidget(e){return this._widgetManager.contextForWidget(e)}copy(e,t){return this.services.contents.copy(e,t)}createNew(e,t="default",n){return this._createOrOpenDocument("create",e,t,n)}deleteFile(e){return this.services.sessions.stopIfNeeded(e).then(()=>this.services.contents.delete(e)).then(()=>(this._contextsForPath(e).forEach(e=>this._widgetManager.deleteWidgets(e)),Promise.resolve(void 0)))}duplicate(e){const t=p.PathExt.dirname(e);return this.services.contents.copy(e,t)}findWidget(e,t="default"){const n=p.PathExt.normalize(e);let o=[t];if("default"===t){const e=this.registry.defaultWidgetFactory(n);if(!e)return;o=[e.name]}else null===t&&(o=this.registry.preferredWidgetFactories(n).map(e=>e.name));for(const e of this._contextsForPath(n))for(const t of o)if(null!==t){const n=this._widgetManager.findWidget(e,t);if(n)return n}}newUntitled(e){return"file"===e.type&&(e.ext=e.ext||".txt"),this.services.contents.newUntitled(e)}open(e,t="default",n,o,a){return this._createOrOpenDocument("open",e,t,n,o,a)}openOrReveal(e,t=null,n,o,a){const i=this.findWidget(e,t);return i?(this._opener.open(i,{type:t||"default",...o}),i):this.open(e,t||"default",n,null!=o?o:{},a)}overwrite(e,t){const n=`${t}.${w.UUID.uuid4()}`,o=()=>this.rename(n,t);return this.rename(e,n).then(()=>this.deleteFile(t)).then(o,o)}rename(e,t){return this.services.contents.rename(e,t)}_findContext(e,t){const n=this.services.contents.normalize(e);return(0,y.find)(this._contexts,e=>e.path===n&&e.factoryName===t)}_contextsForPath(e){const t=this.services.contents.normalize(e);return this._contexts.filter(e=>e.path===t)}_createContext(e,t,n,a){const i=new v.o({opener:(e,t)=>{this._widgetManager.adoptWidget(i,e),this._opener.open(e,t)},manager:this.services,factory:t,path:e,kernelPreference:n,setBusy:this._setBusy,sessionDialogs:this._dialogs,lastModifiedCheckMargin:this._lastModifiedCheckMargin,translator:this.translator,contentProviderId:a,urlResolverFactory:this._urlResolverFactory}),s=new x.I({context:i,isConnectedCallback:this._isConnectedCallback,saveInterval:this.autosaveInterval});return o.saveHandlerProperty.set(i,s),i.ready.then(()=>{this.autosave&&s.start()}),i.disposed.connect(this._onContextDisposed,this),this._contexts.push(i),i}_onContextDisposed(e){y.ArrayExt.removeFirstOf(this._contexts,e)}_widgetFactoryFor(e,t){const{registry:n}=this;if("default"===t){const o=n.defaultWidgetFactory(e);if(!o)return;t=o.name}return n.getWidgetFactory(t)}_createOrOpenDocument(e,t,n="default",o,a,i){const s=this._widgetFactoryFor(t,n);if(!s)return;const r=s.modelName||"text",c=this.registry.getModelFactory(r);if(!c)return;const d={...this.registry.getKernelPreference(t,s.name,o),...i};let l,h=Promise.resolve(void 0);if("open"===e)l=this._findContext(t,c.name)||null,l||(l=this._createContext(t,c,d,s.contentProviderId),h=this._when.then(()=>l.initialize(!1)));else{if("create"!==e)throw new Error(`Invalid argument 'which': ${e}`);l=this._createContext(t,c,d,s.contentProviderId),h=this._when.then(()=>l.initialize(!0))}const u=this._widgetManager.createWidget(s,l);return this._opener.open(u,{type:s.name,...a}),h.catch(e=>{console.error(`Failed to initialize the context with '${c.name}' for ${t}`,e),u.close()}),u}_onActivateRequested(e,t){this._activateRequested.emit(t)}_onWidgetStateChanged(e,t){"confirmClosingDocument"===t.name&&this._stateChanged.emit(t)}}!function(e){e.saveHandlerProperty=new b.AttachedProperty({name:"saveHandler",create:()=>{}})}(o||(o={}));var M=n(62939),k=n(9387);function D(e){return k.createElement(M.pC,{source:e.fileStatus})}class R extends h.QX{constructor(e){super(new R.Model(e.docManager));const t=(e.translator||f.wK).load("jupyterlab");this._statusMap={completed:t.__("Saving completed"),started:t.__("Saving started"),failed:t.__("Saving failed")}}render(){return null===this.model||null===this.model.status?null:k.createElement(D,{fileStatus:this._statusMap[this.model.status]})}}function W(e){return k.createElement(M.pC,{source:e.name,title:e.fullPath})}!function(e){class t extends h.AF{constructor(e){super(),this._onStatusChange=(e,t)=>{this._status=t,"completed"===this._status?(setTimeout(()=>{this._status=null,this.stateChanged.emit(void 0)},2e3),this.stateChanged.emit(void 0)):this.stateChanged.emit(void 0)},this._status=null,this._widget=null,this._status=null,this.widget=null,this._docManager=e}get status(){return this._status}get widget(){return this._widget}set widget(e){var t,n;const o=this._widget;if(null!==o){const e=this._docManager.contextForWidget(o);e?e.saveState.disconnect(this._onStatusChange):(null===(t=this._widget.content)||void 0===t?void 0:t.saveStateChanged)&&this._widget.content.saveStateChanged.disconnect(this._onStatusChange)}if(this._widget=e,null===this._widget)this._status=null;else{const e=this._docManager.contextForWidget(this._widget);e?e.saveState.connect(this._onStatusChange):(null===(n=this._widget.content)||void 0===n?void 0:n.saveStateChanged)&&this._widget.content.saveStateChanged.connect(this._onStatusChange)}}}e.Model=t}(R||(R={}));class B extends h.QX{constructor(e){super(new B.Model(e.docManager)),this.node.title=this.model.path}render(){return k.createElement(W,{fullPath:this.model.path,name:this.model.name})}}!function(e){class t extends h.AF{constructor(e){super(),this._onTitleChange=e=>{const t=this._getAllState();this._name=e.label,this._triggerChange(t,this._getAllState())},this._onPathChange=(e,t)=>{const n=this._getAllState();this._path=t,this._name=p.PathExt.basename(t),this._triggerChange(n,this._getAllState())},this._path="",this._name="",this._widget=null,this._docManager=e}get path(){return this._path}get name(){return this._name}get widget(){return this._widget}set widget(e){const t=this._widget;if(null!==t){const e=this._docManager.contextForWidget(t);e?e.pathChanged.disconnect(this._onPathChange):t.title.changed.disconnect(this._onTitleChange)}const n=this._getAllState();if(this._widget=e,null===this._widget)this._path="",this._name="";else{const e=this._docManager.contextForWidget(this._widget);e?(this._path=e.path,this._name=p.PathExt.basename(e.path),e.pathChanged.connect(this._onPathChange)):(this._path="",this._name=this._widget.title.label,this._widget.title.changed.connect(this._onTitleChange))}this._triggerChange(n,this._getAllState())}_getAllState(){return[this._path,this._name]}_triggerChange(e,t){e[0]===t[0]&&e[1]===t[1]||this.stateChanged.emit(void 0)}}e.Model=t}(B||(B={}));var P,E=n(5279),A=n(69584),j=n(87725),I=n(14809),T=n(49267);class O{constructor(e){this._recentsChanged=new C.Signal(this),this._recents={opened:[],closed:[]},this._isDisposed=!1,this._maxRecentsLength=10,this._saveDebouncer=new T.Debouncer(this._save.bind(this),500),this._stateDB=e.stateDB,this._contentsManager=e.contents,this.updateRootDir(),this._loadRecents().catch(e=>{console.error(`Failed to load recent list from state:\n${e}`)})}get isDisposed(){return this._isDisposed}get recentlyOpened(){return(this._recents.opened||[]).filter(e=>e.root===this._serverRoot)}get recentlyClosed(){return(this._recents.closed||[]).filter(e=>e.root===this._serverRoot)}get changed(){return this._recentsChanged}get maximalRecentsLength(){return this._maxRecentsLength}set maximalRecentsLength(e){this._maxRecentsLength=Math.round(Math.max(1,e));let t=!1;for(const e of["opened","closed"])this._recents[e].length>this._maxRecentsLength&&(this._recents[e].length=this._maxRecentsLength,t=!0);t&&this._recentsChanged.emit(void 0)}dispose(){this.isDisposed||(this._isDisposed=!0,C.Signal.clearData(this),this._saveDebouncer.dispose())}addRecent(e,t){const n={...e,root:this._serverRoot},o=this._recents[t],a=o.findIndex(t=>t.path===e.path);a>=0&&o.splice(a,1),o.unshift(n),this._setRecents(o,t),this._recentsChanged.emit(void 0)}clearRecents(){this._setRecents([],"opened"),this._setRecents([],"closed"),this._recentsChanged.emit(void 0)}removeRecent(e,t){this._removeRecent(e.path,[t])}async validate(e){const t=await this._isValid(e);return t||this._removeRecent(e.path),t}updateRootDir(){this._serverRoot=p.PageConfig.getOption("serverRoot")}_removeRecent(e,t=["opened","closed"]){let n=!1;for(const o of t){const t=this._recents[o],a=t.filter(t=>e!==t.path);t.length!==a.length&&(this._setRecents(a,o),n=!0)}n&&this._recentsChanged.emit(void 0)}async _isValid(e){var t;try{await this._contentsManager.get(e.path,{content:!1})}catch(e){if(404===(null===(t=e.response)||void 0===t?void 0:t.status))return!1}return!0}_setRecents(e,t){this._recents[t]=e.slice(0,this.maximalRecentsLength).sort((e,t)=>e.root===t.root?0:e.root!==this._serverRoot?1:-1),this._saveDebouncer.invoke().catch(console.warn)}async _loadRecents(){const e=await this._stateDB.fetch(P.stateDBKey)||{opened:[],closed:[]},t=[...e.opened,...e.closed],n=new Set(await this._getInvalidPaths(t));for(const t of["opened","closed"])this._setRecents(e[t].filter(e=>!n.has(e.path)),t);this._recentsChanged.emit(void 0)}async _getInvalidPaths(e){return(await Promise.all(e.map(async e=>await this._isValid(e)?null:e.path))).filter(e=>"string"==typeof e)}async _save(){try{await this._stateDB.save(P.stateDBKey,this._recents)}catch(e){console.log("Saving recents failed",e)}}}!function(e){e.stateDBKey="docmanager:recents"}(P||(P={}));var V,U,N=n(19080);!function(e){e.clearRecents="docmanager:clear-recents"}(V||(V={})),function(e){e.recentsManager="@jupyterlab/docmanager-extension:recents",e.reopenClosed="@jupyterlab/docmanager-extension:reopen-recently-closed",e.mainPlugin="@jupyterlab/docmanager-extension:plugin"}(U||(U={}));const $={id:U.recentsManager,description:"Provides a manager of recently opened and closed documents.",autoStart:!0,requires:[N.IStateDB],optional:[A.X,f.sQ],provides:m.fA,activate:(e,t,n,o)=>{const{serviceManager:a}=e,i=(null!=o?o:f.wK).load("jupyterlab"),s=new O({stateDB:t,contents:a.contents}),r=e=>{s.maximalRecentsLength=e.get("maxNumberRecents").composite};return n&&Promise.all([e.restored,n.load(U.mainPlugin)]).then(([e,t])=>{t.changed.connect(r),r(t)}),e.commands.addCommand(V.clearRecents,{execute:()=>{s.clearRecents()},isEnabled:()=>0!=s.recentlyOpened.length||0!=s.recentlyClosed.length,label:i.__("Clear Recent Documents"),caption:i.__("Clear the list of recently opened items."),describedBy:{args:{type:"object",properties:{}}}}),s}};var q;!function(e){e.clone="docmanager:clone",e.deleteFile="docmanager:delete-file",e.newUntitled="docmanager:new-untitled",e.open="docmanager:open",e.openBrowserTab="docmanager:open-browser-tab",e.reload="docmanager:reload",e.rename="docmanager:rename",e.del="docmanager:delete",e.duplicate="docmanager:duplicate",e.restoreCheckpoint="docmanager:restore-checkpoint",e.save="docmanager:save",e.saveAll="docmanager:save-all",e.saveAs="docmanager:save-as",e.download="docmanager:download",e.toggleAutosave="docmanager:toggle-autosave",e.showInFileBrowser="docmanager:show-in-file-browser"}(q||(q={}));const K="@jupyterlab/docmanager-extension:plugin",G={id:"@jupyterlab/docmanager-extension:opener",description:"Provides the widget opener.",autoStart:!0,provides:m.gi,activate:e=>{const{shell:t}=e;return new class{constructor(){this._opened=new C.Signal(this)}open(e,n){e.id||(e.id="document-manager-"+ ++ne.id),e.title.dataset={type:"document-title",...e.title.dataset},e.isAttached||t.add(e,"main",n||{}),t.activateById(e.id),this._opened.emit(e)}get opened(){return this._opened}}}},L={id:"@jupyterlab/docmanager-extension:contexts",description:"Adds the handling of opened documents dirty state.",autoStart:!0,requires:[m.cR,m.gi],optional:[a.n3],activate:(e,t,n,o)=>{const a=new WeakSet;n.opened.connect((e,n)=>{const i=t.contextForWidget(n);i&&!a.has(i)&&(o&&function(e,t){let n=null;const o=(t,o)=>{"dirty"===o.name&&(!0===o.newValue?n||(n=e.setDirty()):n&&(n.dispose(),n=null))};t.ready.then(()=>{t.model.stateChanged.connect(o),t.model.dirty&&(n=e.setDirty())}),t.disposed.connect(()=>{n&&n.dispose()})}(o,i),a.add(i))})}},Q={id:"@jupyterlab/docmanager-extension:manager",description:"Provides the document manager.",provides:m.cR,requires:[m.gi],optional:[f.sQ,a.n3,r.i_,i.n.IInfo,m.fA,E.D8,m.N],activate:(e,t,n,o,a,i,s,r,d)=>{var l;const{serviceManager:h,docRegistry:u}=e,g=null!=n?n:f.wK,p=null!=a?a:new c.V({translator:g}),m=null!=d?d:new _.S0({translator:g}),v=e.restored.then(()=>{});return new S({registry:u,manager:h,opener:t,when:v,setBusy:null!==(l=o&&(()=>o.setBusy()))&&void 0!==l?l:void 0,sessionDialogs:p,translator:null!=g?g:f.wK,isConnectedCallback:()=>!i||i.isConnected,recentsManager:null!=s?s:void 0,urlResolverFactory:null!=r?r:void 0,docManagerDialogs:m})}},H={id:K,description:"Adds commands and settings to the document manager.",autoStart:!0,requires:[m.cR,m.gi,A.X],optional:[f.sQ,r.kn,s.V,m.N],activate:(e,t,n,o,a,i,s,r)=>{const c=(a=null!=a?a:f.wK).load("jupyterlab"),l=e.docRegistry;!function(e,t,n,o,a,i,s,r){var c;const l=a.load("jupyterlab"),{commands:h,shell:m}=e,v=l.__("File Operations"),f=()=>{const{currentWidget:e}=m;return!(!e||!t.contextForWidget(e))},w=()=>{var e;const{currentWidget:n}=m;if(!n)return!1;const o=t.contextForWidget(n);return!!(null===(e=null==o?void 0:o.contentsModel)||void 0===e?void 0:e.writable)},b=e=>u.E.warning(l.__('%1 is read-only. Use "Save as…" instead.',e),{autoClose:5e3});i&&(r||(r=new _.S0({translator:a})),function(e,t,n,o,a,i){const s=a.load("jupyterlab"),{commands:r}=e,c=()=>{var o;const a=/[Pp]ath:\s?(.*)\n?/,i=e.contextMenuHitTest(e=>{var t;return!!(null===(t=e.title)||void 0===t?void 0:t.match(a))}),s=null==i?void 0:i.title.match(a);return null!==(o=s&&t.findWidget(s[1],null))&&void 0!==o?o:n.currentWidget},l=()=>{const{currentWidget:e}=n;return!(!e||!t.contextForWidget(e))};r.addCommand(q.clone,{label:()=>s.__("New View for %1",ae(c(),t)),isEnabled:l,execute:e=>{const n=c(),a=e.options||{mode:"split-right"};if(!n)return;const i=t.cloneWidget(n);i&&o.open(i,a)},describedBy:{args:{type:"object",properties:{options:{type:"object",description:s.__("Options for opening the cloned document")}}}}}),r.addCommand(q.rename,{label:()=>{let e=ae(c(),t);return e&&(e=" "+e),s.__("Rename%1…",e)},isEnabled:l,execute:()=>{if(l()){const e=t.contextForWidget(c());return i.rename(e)}},describedBy:{args:{type:"object",properties:{}}}}),r.addCommand(q.duplicate,{label:()=>s.__("Duplicate %1",ae(c(),t)),isEnabled:l,execute:()=>{if(l()){const e=t.contextForWidget(c());if(!e)return;return t.duplicate(e.path)}},describedBy:{args:{type:"object",properties:{}}}}),r.addCommand(q.del,{label:()=>s.__("Delete %1",ae(c(),t)),isEnabled:l,execute:async()=>{if(l()){const n=t.contextForWidget(c());if(!n)return;(await(0,d.ui)({title:s.__("Delete"),body:s.__("Are you sure you want to delete %1",n.path),buttons:[d.lG.cancelButton(),d.lG.warnButton({label:s.__("Delete")})]})).button.accept&&await e.commands.execute("docmanager:delete-file",{path:n.path})}},describedBy:{args:{type:"object",properties:{}}}}),r.addCommand(q.showInFileBrowser,{label:()=>s.__("Show in File Browser"),isEnabled:l,execute:async()=>{const e=c(),n=e&&t.contextForWidget(e);n&&(await r.execute("filebrowser:activate",{path:n.path}),await r.execute("filebrowser:go-to-path",{path:n.path}))},describedBy:{args:{type:"object",properties:{}}}}),n.currentChanged.connect(()=>{[q.clone,q.rename,q.duplicate,q.del,q.showInFileBrowser].forEach(t=>{e.commands.notifyCommandChanged(t)})})}(e,t,i,n,a,r)),h.addCommand(q.deleteFile,{label:()=>`Delete ${ae(m.currentWidget,t)}`,describedBy:{args:{type:"object",properties:{path:{type:"string",description:"The path of the file to delete"}},required:["path"]}},execute:e=>{const n=void 0===e.path?"":e.path;if(!n){const e=q.deleteFile;throw new Error(`A non-empty path is required for ${e}.`)}return t.deleteFile(n)}}),h.addCommand(q.newUntitled,{execute:async e=>{const n=e.error||l.__("Error"),o=void 0===e.path?"":e.path,a={type:e.type,path:o};return"file"===e.type&&(a.ext=e.ext||".txt"),t.services.contents.newUntitled(a).catch(e=>(0,d.f1)(n,e))},label:e=>e.label||`New ${e.type}`,describedBy:{args:{type:"object",properties:{error:{type:"string",description:"The error title to display"},path:{type:"string",description:"The path where to create the file"},type:{type:"string",description:"The type of content to create",enum:["file","directory","notebook"]},ext:{type:"string",description:"The file extension (for file type)"},label:{type:"string",description:"The label for the command"}}}}}),h.addCommand(q.open,{execute:async e=>{const n=void 0===e.path?"":e.path,o=e.factory||void 0,a=null==e?void 0:e.kernel,i=null==e?void 0:e.kernelPreference,s=e.options||void 0;return t.services.contents.get(n,{content:!1}).then(()=>t.openOrReveal(n,o,a,s,i))},iconClass:e=>e.icon||"",label:e=>{var t;return null!==(t=e.label||e.factory)&&void 0!==t?t:l.__("Open the provided `path`.")},mnemonic:e=>e.mnemonic||-1,describedBy:{args:{type:"object",properties:{path:{type:"string",description:"The path of the file to open"},factory:{type:"string",description:"The widget factory name"},kernel:{type:"object",description:"The kernel model to use"},kernelPreference:{type:"object",description:"Override kernel preferences, see [`IKernelPreference`](https://jupyterlab.readthedocs.io/en/latest/api/interfaces/apputils.ISessionContext.IKernelPreference.html) for possible values"},options:{type:"object",description:"Additional options for opening"},icon:{type:"string",description:"The icon class for the command"},label:{type:"string",description:"The label for the command"},mnemonic:{type:"number",description:"The mnemonic index for the command"}}}}}),h.addCommand(q.reload,{label:()=>l.__("Reload %1 from Disk",ae(m.currentWidget,t)),caption:l.__("Reload contents from disk"),isEnabled:f,describedBy:{args:{type:"object",properties:{}}},execute:()=>{if(!f())return;const e=t.contextForWidget(m.currentWidget),n=ae(m.currentWidget,t);return e?e.model.dirty?(0,d.ui)({title:l.__("Reload %1 from Disk",n),body:l.__("Are you sure you want to reload the %1 from the disk?",n),buttons:[d.lG.cancelButton(),d.lG.warnButton({label:l.__("Reload")})]}).then(t=>{if(t.button.accept&&!e.isDisposed)return e.revert()}):e.isDisposed?void 0:e.revert():(0,d.ui)({title:l.__("Cannot Reload"),body:l.__("No context found for current widget!"),buttons:[d.lG.okButton()]})}}),h.addCommand(q.restoreCheckpoint,{label:()=>l.__("Revert %1 to Checkpoint…",ae(m.currentWidget,t)),caption:l.__("Revert contents to previous checkpoint"),isEnabled:f,describedBy:{args:{type:"object",properties:{}}},execute:()=>{if(!f())return;const e=t.contextForWidget(m.currentWidget);return e?e.listCheckpoints().then(async n=>{const o=ae(m.currentWidget,t);if(n.length<1)return void await(0,d.f1)(l.__("No checkpoints"),l.__("No checkpoints are available for this %1.",o));const a=1===n.length?n[0]:await ne.getTargetCheckpoint(n.reverse(),l);return a?(0,d.ui)({title:l.__("Revert %1 to checkpoint",o),body:new oe(a,l,o),buttons:[d.lG.cancelButton(),d.lG.warnButton({label:l.__("Revert"),ariaLabel:l.__("Revert to Checkpoint")})]}).then(t=>{if(!e.isDisposed)return t.button.accept?e.model.readOnly?e.revert():e.restoreCheckpoint(a.id).then(()=>e.revert()):void 0}):void 0}):(0,d.ui)({title:l.__("Cannot Revert"),body:l.__("No context found for current widget!"),buttons:[d.lG.okButton()]})}});const C=new WeakSet;h.addCommand(q.save,{label:()=>l.__("Save %1",ae(m.currentWidget,t)),caption:()=>m.currentWidget&&!w()?l.__('Document is read-only. "Save" is disabled; use "Save as…" instead'):l.__("Save and create checkpoint"),icon:e=>e.toolbar?j.DL:void 0,isEnabled:e=>e._luminoEvent&&"keybinding"===e._luminoEvent.type||w(),describedBy:{args:{type:"object",properties:{toolbar:{type:"boolean",description:"Whether executed from toolbar"},_luminoEvent:{type:"object",description:"The lumino event object"}}}},execute:async e=>{var n,a,i,s,r;const c=m.currentWidget,h=t.contextForWidget(c);if(f()){if(!h)return(0,d.ui)({title:l.__("Cannot Save"),body:l.__("No context found for current widget!"),buttons:[d.lG.okButton()]});{if(C.has(h))return;if(!(null===(n=h.contentsModel)||void 0===n?void 0:n.writable)){let t=null===(a=e._luminoEvent)||void 0===a?void 0:a.type;return e._luminoEvent&&"keybinding"===t?void b(h.path):(0,d.ui)({title:l.__("Cannot Save"),body:l.__("Document is read-only"),buttons:[d.lG.okButton()]})}C.add(h);const u=p.PathExt.basename(null!==(s=null===(i=h.contentsModel)||void 0===i?void 0:i.path)&&void 0!==s?s:"");let m=u;if(t.renameUntitledFileOnSave&&!0===c.isUntitled){const e=await g.f.getText({title:l.__("Rename file"),okLabel:l.__("Rename and Save"),placeholder:l.__("File name"),text:u,selectionRange:u.length-p.PathExt.extname(u).length,checkbox:{label:l.__("Do not ask for rename on first save."),caption:l.__("If checked, you will not be asked to rename future untitled files when saving them.")}});if(e.button.accept&&(m=null!==(r=e.value)&&void 0!==r?r:u,c.isUntitled=!1,"boolean"==typeof e.isChecked)){const t=(await o.get(K,"renameUntitledFileOnSave")).composite;e.isChecked===t&&o.set(K,"renameUntitledFileOnSave",!e.isChecked).catch(e=>{console.error(`Fail to set 'renameUntitledFileOnSave:\n${e}`)})}}try{await h.save(),m!==u&&await h.rename(m),(null==c?void 0:c.isDisposed)||await h.createCheckpoint()}catch(e){if("ModalCancelError"===e.name)return;throw e}finally{C.delete(h)}}}}}),h.addCommand(q.saveAll,{label:()=>l.__("Save All"),caption:l.__("Save all open documents"),isEnabled:()=>(0,y.some)(m.widgets("main"),e=>{var n,o,a;return null!==(a=null===(o=null===(n=t.contextForWidget(e))||void 0===n?void 0:n.contentsModel)||void 0===o?void 0:o.writable)&&void 0!==a&&a}),describedBy:{args:{type:"object",properties:{}}},execute:()=>{var e;const n=[],o=new Set;for(const a of m.widgets("main")){const i=t.contextForWidget(a);i&&!o.has(i.path)&&((null===(e=i.contentsModel)||void 0===e?void 0:e.writable)?(o.add(i.path),n.push(i.save())):b(i.path))}return Promise.all(n)}}),h.addCommand(q.saveAs,{label:()=>l.__("Save %1 As…",ae(m.currentWidget,t)),caption:l.__("Save with new path"),isEnabled:f,describedBy:{args:{type:"object",properties:{}}},execute:()=>{if(f()){const e=t.contextForWidget(m.currentWidget);if(!e)return(0,d.ui)({title:l.__("Cannot Save"),body:l.__("No context found for current widget!"),buttons:[d.lG.okButton()]});const n=(n,o)=>{"save"===o.type&&o.newValue&&o.newValue.path!==e.path&&(t.closeFile(e.path),h.execute(q.open,{path:o.newValue.path}))};t.services.contents.fileChanged.connect(n),e.saveAs().finally(()=>t.services.contents.fileChanged.disconnect(n))}}}),null===(c=e.shell.currentChanged)||void 0===c||c.connect(()=>{[q.reload,q.restoreCheckpoint,q.save,q.saveAll,q.saveAs].forEach(t=>{e.commands.notifyCommandChanged(t)})}),h.addCommand(q.toggleAutosave,{label:l.__("Autosave Documents"),isToggled:()=>t.autosave,execute:()=>{const e=!t.autosave,n="autosave";return o.set(K,n,e).catch(e=>{console.error(`Failed to set ${K}:${n} - ${e.message}`)})},describedBy:{args:{type:"object",properties:{}}}}),s&&[q.reload,q.restoreCheckpoint,q.save,q.saveAs,q.toggleAutosave,q.duplicate].forEach(e=>{s.addItem({command:e,category:v})})}(e,t,n,o,a,s,i,r);const h=n=>{const o=n.get("autosave").composite;t.autosave=!0!==o&&!1!==o||o,e.commands.notifyCommandChanged(q.toggleAutosave);const a=n.get("confirmClosingDocument").composite;t.confirmClosingDocument=null==a||a;const i=n.get("autosaveInterval").composite;t.autosaveInterval=i||120;const s=n.get("lastModifiedCheckMargin").composite;t.lastModifiedCheckMargin=s||500;const r=n.get("renameUntitledFileOnSave").composite;t.renameUntitledFileOnSave=null==r||r;const c=n.get("defaultViewers").composite,d={};Object.keys(c).forEach(e=>{l.getFileType(e)?(l.getWidgetFactory(c[e])||console.warn(`Document viewer ${c[e]} not found`),d[e]=c[e]):console.warn(`File Type ${e} not found`)});for(const e of l.fileTypes())try{l.setDefaultWidgetFactory(e.name,d[e.name])}catch(t){console.warn(`Failed to set default viewer ${d[e.name]} for file type ${e.name}`)}};Promise.all([o.load(K),e.restored]).then(([e])=>{e.changed.connect(h),h(e),t.stateChanged.connect((t,n)=>{["autosave","autosaveInterval","confirmClosingDocument","lastModifiedCheckMargin","renameUntitledFileOnSave"].includes(n.name)&&e.get(n.name).composite!==n.newValue&&e.set(n.name,n.newValue).catch(e=>{console.error(`Failed to set the setting '${n.name}':\n${e}`)})})}).catch(e=>{console.error(e.message)}),o.transform(K,{fetch:e=>{const t=Array.from(l.fileTypes()).map(e=>e.name).join("    \n"),n=Array.from(l.widgetFactories()).map(e=>e.name).join("    \n"),o=c.__('Overrides for the default viewers for file types.\nSpecify a mapping from file type name to document viewer name, for example:\n\ndefaultViewers: {\n  markdown: "Markdown Preview"\n}\n\nIf you specify non-existent file types or viewers, or if a viewer cannot\nopen a given file type, the override will not function.\n\nAvailable viewers:\n%1\n\nAvailable file types:\n%2',n,t),a=w.JSONExt.deepCopy(e.schema);return a.properties.defaultViewers.description=o,{...e,schema:a}}}),l.changed.connect(()=>o.load(K,!0))}},z={id:"@jupyterlab/docmanager-extension:saving-status",description:"Adds a saving status indicator.",autoStart:!0,requires:[m.cR,s.V],optional:[f.sQ,M.$O],activate:(e,t,n,o,a)=>{if(!a)return;const i=new R({docManager:t,translator:null!=o?o:f.wK});i.model.widget=n.currentWidget,n.currentChanged.connect(()=>{i.model.widget=n.currentWidget}),a.registerStatusItem(z.id,{item:i,align:"middle",isActive:()=>null!==i.model&&null!==i.model.status,activeStateChanged:i.model.stateChanged})}},X={id:"@jupyterlab/docmanager-extension:path-status",description:"Adds a file path indicator in the status bar.",autoStart:!0,requires:[m.cR,s.V],optional:[M.$O],activate:(e,t,n,o)=>{if(!o)return;const a=new B({docManager:t});a.model.widget=n.currentWidget,n.currentChanged.connect(()=>{a.model.widget=n.currentWidget}),o.registerStatusItem(X.id,{item:a,align:"right",rank:0})}},J={id:"@jupyterlab/docmanager-extension:download",description:"Adds command to download files.",autoStart:!0,requires:[m.cR],optional:[f.sQ,r.kn],activate:(e,t,n,o)=>{var a;const i=(null!=n?n:f.wK).load("jupyterlab"),{commands:s,shell:r}=e,c=()=>{const{currentWidget:e}=r;return!(!e||!t.contextForWidget(e))};s.addCommand(q.download,{label:i.__("Download"),caption:i.__("Download the file to your computer"),isEnabled:c,describedBy:{args:{type:"object",properties:{}}},execute:()=>{if(c()){const e=t.contextForWidget(r.currentWidget);return e?e.download():(0,d.ui)({title:i.__("Cannot Download"),body:i.__("No context found for current widget!"),buttons:[d.lG.okButton()]})}}}),null===(a=e.shell.currentChanged)||void 0===a||a.connect(()=>{e.commands.notifyCommandChanged(q.download)});const l=i.__("File Operations");o&&o.addItem({command:q.download,category:l})}},Y={id:"@jupyterlab/docmanager-extension:open-browser-tab",description:"Adds command to open a browser tab.",autoStart:!0,requires:[m.cR],optional:[f.sQ],activate:(e,t,n)=>{const o=(null!=n?n:f.wK).load("jupyterlab"),{commands:a}=e;a.addCommand(q.openBrowserTab,{execute:e=>{const n=void 0===e.path?"":e.path;if(n)return t.services.contents.getDownloadUrl(n).then(e=>{const t=window.open();if(!t)throw new Error("Failed to open new browser tab.");t.opener=null,t.location.href=e})},iconClass:e=>e.icon||"",label:()=>o.__("Open in New Browser Tab"),describedBy:{args:{type:"object",properties:{path:{type:"string",description:o.__("The path of the file to open in browser tab")},icon:{type:"string",description:o.__("The icon class for the command")}},required:["path"]}}})}},Z={id:"@jupyterlab/docmanager-extension:dialogs",description:"Provides default dialogs for document management operations.",autoStart:!0,provides:m.N,requires:[f.sQ],activate:(e,t)=>new _.S0({translator:t})},ee=[Q,H,L,X,z,J,Y,G,$,Z];var te,ne;!function(e){e.createSaveButton=function(e,t){return(0,l.SC)(h._Q.create(k.createElement(h.mE,{signal:t},()=>k.createElement(l.gB,{commands:e,id:q.save,label:"",args:{toolbar:!0}}))))}}(te||(te={}));class oe extends I.x0{constructor(e,t,n="notebook"){super({node:ne.createRevertConfirmNode(e,n,t)})}}function ae(e,t){if(!e)return"File";const n=t.contextForWidget(e);if(!n)return"";const o=t.registry.getFileTypesForPath(n.path);return o.length&&o[0].displayName?o[0].displayName:"File"}!function(e){e.id=0,e.createRevertConfirmNode=function(e,t,n){const o=document.createElement("div"),a=document.createElement("p"),i=document.createTextNode(n.__("Are you sure you want to revert the %1 to checkpoint? ",t)),s=document.createElement("strong");s.textContent=n.__("This cannot be undone."),a.appendChild(i),a.appendChild(s);const r=document.createElement("p"),c=document.createTextNode(n.__("The checkpoint was last updated at: ")),d=document.createElement("p"),l=new Date(e.last_modified);return d.style.textAlign="center",d.textContent=p.Time.format(l)+" ("+p.Time.formatHuman(l)+")",r.appendChild(c),r.appendChild(d),o.appendChild(a),o.appendChild(r),o},e.getTargetCheckpoint=async function(e,t){const n=e.map((e,t)=>`${t}. ${p.Time.format(e.last_modified)} (${p.Time.formatHuman(e.last_modified)})`),o=(await g.f.getItem({items:n,title:t.__("Choose a checkpoint")})).value;if(!o)return;const a=o.split(".",1)[0];return e[parseInt(a,10)]}}(ne||(ne={}))}}]);