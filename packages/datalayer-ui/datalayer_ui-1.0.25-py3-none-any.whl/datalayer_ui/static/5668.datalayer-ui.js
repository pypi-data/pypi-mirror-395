"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[5668],{75345:(e,s,t)=>{t.d(s,{E:()=>c});var n=t(18683),a=t(71791),i=t(99251),o=t(38621),r=t(9387);function c(e){const{commandRegistry:s,runtimeDesc:t,sessionConnection:c}=e,[l,d]=(0,r.useState)();return(0,r.useEffect)(()=>{const e=()=>{d(c?.kernel?.status)};return e(),c?.statusChanged.connect(e),c?.connectionStatusChanged.connect(e),()=>{c?.statusChanged.disconnect(e),c?.connectionStatusChanged.disconnect(e)}},[c]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.Q,{variant:"invisible",size:"small",leadingVisual:o.udU,disabled:!t?.location||"busy"===l,onClick:e=>s?.execute(a.nx.runAll),children:"Run all"}),(0,n.jsx)(i.Q,{variant:"invisible",size:"small",leadingVisual:o.wFz,disabled:!t?.location||"busy"!==l,onClick:e=>s?.execute(a.nx.interrupt),children:"Interrupt"})]})}},95668:(e,s,t)=>{t.r(s),t.d(s,{LessonEdit:()=>E,default:()=>I});var n=t(9387),a=t(20568),i=t(3345),o=t(92584),r=t(98754),c=t(3556),l=t(92243),d=t(84514),u=t(24860),h=t(49261),m=t(99180),p=t(38621),x=t(12338),g=t(2159),v=t(16476),f=t(75345),y=t(93159),j=t(17788),b=t(41273),k=t(99179),A=t(23267),S=t(72085),C=t(18683);const E=()=>{const e=(0,n.useMemo)(()=>[new g._],[]),{lessonId:s}=(0,a.g)();if(!s)return(0,C.jsx)(C.Fragment,{});const t=(0,k.J)(),E=(0,i.S)(),I=(0,j.Z)(),w=(0,A.mt)(),N=(0,v.Gx)(),R=w.layout().space,B=(0,S.OK)().saveRequest,L=N.selectNotebookModel(s),{useCloneLesson:z,useLesson:O,useRefreshLesson:T,useUpdateNotebook:F,useUpdateNotebookModel:V}=(0,y.E6)(),_=O(s),D=T(),M=F(),P=V(),Q=z(),{data:U}=_,[J,q]=(0,n.useState)(U);(0,n.useEffect)(()=>{U&&(q(U),w.layout().setItem(U),Z({name:U.name,description:U.description}))},[U]);const[$,G]=(0,n.useState)("editor"),{enqueueToast:H}=(0,b.d)(),[K,Z]=(0,n.useState)({name:"",description:""}),[W,X]=(0,n.useState)({name:void 0,description:void 0}),Y=(e,s)=>{s.preventDefault(),w.layout().resetRightPortal(),G(e)};(0,n.useEffect)(()=>(w.layout().showBackdrop(),D.mutate(s,{onSuccess:e=>{if(e.success){const{data:e}=O(s);e||I("/")}},onSettled:()=>{w.layout().hideBackdrop()}}),()=>{q(void 0),N.reset(),w.layout().setItem(void 0)}),[s]);const ee=()=>{L?.model?.cells&&(w.layout().showBackdrop("Saving the lesson..."),P.mutate({notebookId:s,nbformat:L.model.toJSON()},{onSuccess:e=>{e.success&&(H("The lesson is successfully updated.",{variant:"success"}),w.layout().triggerItemsRefresh(),q({...J,nbformat:L.model.toJSON()}))},onSettled:()=>{w.layout().hideBackdrop()}}))};(0,n.useEffect)(()=>{B&&J&&ee()},[B]),(0,n.useEffect)(()=>{X({...W,name:void 0===K.name?void 0:K.name.length>2,description:void 0===K.description?void 0:K.description.length>2})},[K]);const se=(0,n.useCallback)(async e=>{E({title:"Are you sure?",content:"Please confirm you want to clone this lesson in your private library."}).then(e=>{e&&(w.layout().showBackdrop(),Q.mutate(s,{onSuccess:e=>{e.success&&(H(e.message,{variant:"success"}),w.layout().triggerItemsRefresh(),I(`/${t?.handle}/library/lessons`))},onSettled:()=>{w.layout().hideBackdrop()}}))})},[E,J,Q,s,H,I,t?.handle]);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(h.z,{children:(0,C.jsxs)(r.A,{display:"flex",children:[(0,C.jsx)(r.A,{flex:1,children:(0,C.jsx)(c.A,{sx:{fontSize:3},children:"Lesson editor"})}),"editor"===$&&(0,C.jsx)(r.A,{children:(0,C.jsx)(f.E,{commandRegistry:N.selectNotebookAdapter(s)?.commands,save:ee})}),J&&R&&(0,C.jsx)(r.A,{children:(0,C.jsx)(m.Q,{variant:"invisible",size:"small",leadingVisual:p.Nc$,onClick:se,children:"Clone"})})]})}),J&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(o.O,{sx:{mt:3,mb:3},children:[(0,C.jsx)(o.O.Item,{href:"","aria-label":"","aria-current":"editor"===$?"page":void 0,onClick:e=>Y("editor",e),children:"Editor"}),(0,C.jsx)(o.O.Item,{href:"","aria-label":"","aria-current":"properties"===$?"page":void 0,onClick:e=>Y("properties",e),children:"Properties"})]}),"editor"===$&&(0,C.jsx)(r.A,{children:J.nbformat&&(0,C.jsx)(x.g,{id:s,height:"calc(100vh - 240px)",maxHeight:"calc(100vh - 240px)",cellMetadataPanel:!0,nbformat:J.nbformat,extensions:e})}),"properties"===$&&(0,C.jsx)(r.A,{display:"grid",gridTemplateColumns:"1fr 1fr",children:(0,C.jsx)(r.A,{children:(0,C.jsxs)(r.A,{sx:{label:{marginTop:2}},children:[(0,C.jsxs)(d.A,{children:[(0,C.jsx)(d.A.Label,{children:"Name"}),(0,C.jsx)(u.A,{block:!0,value:K.name,onChange:e=>{Z(s=>({...s,name:e.target.value}))}}),!1===W.name&&(0,C.jsx)(d.A.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,C.jsxs)(d.A,{children:[(0,C.jsx)(d.A.Label,{children:"Description"}),(0,C.jsx)(l.Ay,{block:!0,value:K.description,onChange:e=>{Z(s=>({...s,description:e.target.value}))}}),!1===W.description&&(0,C.jsx)(d.A.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,C.jsx)(d.A,{children:(0,C.jsx)(m.Q,{variant:"primary",disabled:!W.name||!W.description,sx:{marginTop:2},onClick:async()=>{w.layout().showBackdrop(),M.mutate({id:s,name:K.name,description:K.description},{onSuccess:e=>{e.success&&(H("The lesson is successfully updated.",{variant:"success"}),w.layout().triggerItemsRefresh(),q({...J,name:K.name,description:K.description}))},onSettled:()=>{w.layout().hideBackdrop()}})},children:"Update lesson"})})]})})})]})]})},I=E}}]);