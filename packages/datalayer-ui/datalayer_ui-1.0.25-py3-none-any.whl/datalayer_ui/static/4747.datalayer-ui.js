"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[4747],{77128:(e,t,s)=>{s.d(t,{B:()=>T});var i=s(84939),n=s(87725),o=s(60639),r=s(72490),a=s(14809),h=s(20137),l=s(66087);const d="jp-GhostText-streamingIndicator",c="jp-GhostText-errorIndicator";class m{constructor(e){this.options=e}placeGhost(e,t){const s=[_.addMark.of(t)];e.state.field(_.markField,!1)||(s.push(l.Pe.appendConfig.of([_.markField])),s.push(l.Pe.appendConfig.of([h.Lz.domEventHandlers({blur:t=>{if(!1===this.options.onBlur(t))return!0;const s=[_.removeMark.of(null)];setTimeout(()=>{e.dispatch({effects:s})},0)}})]))),e.dispatch({effects:s})}clearGhosts(e){const t=[_.removeMark.of(null)];e.dispatch({effects:t})}}m.streamingAnimation="uncover",m.spacerRemovalDelay=700,m.spacerRemovalDuration=300;class u extends h.xO{constructor(e){super(),this.options=e,this.isSpacer=!1,this._clearErrorTimeout=null}eq(e){return e.content==this.content&&e.options.streaming===this.options.streaming&&e.options.error===this.options.error}get lineBreaks(){return(this.content.match(/\n/g)||"").length}updateDOM(e,t){return this._updateDOM(e),!0}get content(){return this.options.content}toDOM(){let e=document.createElement("span");return this.options.onPointerOver&&e.addEventListener("pointerover",this.options.onPointerOver),this.options.onPointerLeave&&e.addEventListener("pointerleave",this.options.onPointerLeave),e.classList.add("jp-GhostText"),e.dataset.animation=m.streamingAnimation,e.dataset.providedBy=this.options.providerId,this._updateDOM(e),e}_removeErrorAnimation(e){e.querySelectorAll(`.${c}`).forEach(e=>{e.remove()})}_mountErrorAnimation(e){const t=document.createElement("span");t.className=c;const s=this.options.error;(null==s?void 0:s.message)&&(t.title=null==s?void 0:s.message),e.querySelectorAll(`.${d}, .${c}`).forEach(e=>{e.remove()}),e.appendChild(t)}_updateDOM(e){var t,s;if(this.options.error)return this._mountErrorAnimation(e),void(this._clearErrorTimeout=setTimeout(()=>{this._removeErrorAnimation(e),this._clearErrorTimeout=null},5e3));null!==this._clearErrorTimeout&&(clearTimeout(this._clearErrorTimeout),this._removeErrorAnimation(e),this._clearErrorTimeout=null);let i=this.content,n="",o=this.options.addedPart;if(o&&(o.startsWith("\n")&&(o=o.substring(1)),i=i.substring(0,i.length-o.length)),this.options.maxLines){const e=i.split("\n");i=e.slice(0,this.options.maxLines).join("\n"),n=e.slice(this.options.maxLines).join("\n")}const r=Math.min(null!==(t=this.options.minLines)&&void 0!==t?t:0,null!==(s=this.options.maxLines)&&void 0!==s?s:1/0),a=Math.max(0,r-i.split("\n").length+1),h=new Array(a).fill("").join("\n");if(this.isSpacer)return void(e.innerText=i+h);e.innerText=i;let l=e;if(n.length>0){const t=document.createElement("span");t.className="jp-GhostText-hiddenWrapper",e.appendChild(t);const s=document.createElement("span");s.className="jp-GhostText-expandHidden",s.innerText="â‡“";const i=document.createElement("span");t.appendChild(s),i.className="jp-GhostText-hiddenLines",i.innerText="\n"+n,t.appendChild(i),l=i}if(o){const e=document.createElement("span");e.className="jp-GhostText-streamedToken",e.innerText=o,l.appendChild(e)}if(this.options.streaming){const e=document.createElement("span");e.className=d,l.appendChild(e)}if(h.length>0){const e=document.createTextNode(h);l.appendChild(e)}}destroy(e){this.options.onPointerOver&&e.removeEventListener("pointerover",this.options.onPointerOver),this.options.onPointerLeave&&e.removeEventListener("pointerleave",this.options.onPointerLeave),super.destroy(e)}}class p extends u{constructor(){super(...arguments),this.isSpacer=!0}}class g extends p{toDOM(){const e=super.toDOM();return e.classList.add("jp-GhostText-lineSpacer"),e.style.animationDelay=m.spacerRemovalDelay+"ms",e.style.animationDuration=m.spacerRemovalDuration+"ms",e}}class v extends p{get content(){return this.options.content[0]}toDOM(){const e=super.toDOM();return e.classList.add("jp-GhostText-letterSpacer"),e}}var _;!function(e){let t;function s(e,t){return h.NZ.widget({widget:new u(e),side:1,ghostSpec:e}).range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length))}!function(e){e[e.Set=0]="Set",e[e.Remove=1]="Remove",e[e.FilterAndUpdate=2]="FilterAndUpdate"}(t||(t={})),e.addMark=l.Pe.define({map:(e,t)=>({...e,from:t.mapPos(e.from),to:t.mapPos(e.from+e.content.length)})}),e.removeMark=l.Pe.define(),e.markField=l.sU.define({create:()=>h.NZ.none,update(i,n){const o=function(s){for(let i of s.effects){if(i.is(e.addMark))return{action:t.Set,spec:i.value};if(i.is(e.removeMark))return{action:t.Remove}}return s.docChanged||s.selection?{action:t.FilterAndUpdate}:null}(n);if(i=i.update({filter:(e,t,s)=>!(s.spec.widget instanceof p&&s.spec.timeoutInfo.elapsed)}),!o)return i.map(n.changes);switch(o.action){case t.Set:{const e=s(o.spec,n);return i.update({add:[e],filter:(t,s,i)=>i===e.value})}case t.Remove:return i.update({filter:()=>!1});case t.FilterAndUpdate:{let e=i.iter();for(;e.value&&e.value.spec.widget instanceof p;)e.next();if(!e.value)return i.map(n.changes);const t=e.value.spec.ghostSpec,o={...t};let r=!1;n.changes.iterChanges((e,t,s,i,n)=>{if(!r)if(e===t&&s!==i)for(let e=0;e<n.lines;e++){const t=n.lineAt(e).text,s=e>0?"\n"+t:t;if(!o.content.startsWith(s)){r=!0;break}o.content=o.content.slice(s.length),o.from+=s.length}else r=!0});const a=r?function(e,t,s=1e3){if(e.content.length<2)return[];const i={elapsed:!1};setTimeout(()=>{i.elapsed=!0},s);const n=h.NZ.widget({widget:new v(e),side:1,timeoutInfo:i}),o=h.NZ.widget({widget:new g(e),side:1,timeoutInfo:i});return[n.range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length)),o.range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length))]}(t,n):[s(o,n)],l=a.map(e=>e.value);if(i=i.update({add:a,filter:(e,t,s)=>l.includes(s)}),r)try{i=i.map(n.changes)}catch(e){return console.warn(e),h.NZ.none}return i}}},provide:e=>h.Lz.decorations.from(e)})}(_||(_={}));const f="jp-mod-inline-completer-active",x="jp-InlineCompleter-hover";class T extends a.x0{constructor(e){var t,s;super({node:document.createElement("div")}),this._clearHoverTimeout=null,this._current=0,this._editor=null,this._lastItem=null,this._model=null,this._providerWidget=new a.x0,this._showShortcuts=T.defaultSettings.showShortcuts,this._showWidget=T.defaultSettings.showWidget,this._suggestionsCounter=new a.x0,this._toolbar=new i.M7,this.model=null!==(t=e.model)&&void 0!==t?t:null,this.editor=null!==(s=e.editor)&&void 0!==s?s:null,this.addClass("jp-InlineCompleter"),this.addClass("jp-ThemedContainer"),this._ghostManager=new m({onBlur:this._onEditorBlur.bind(this)}),this._trans=e.trans;const n=this.layout=new a.DG;n.addWidget(this._suggestionsCounter),n.addWidget(this.toolbar),n.addWidget(this._providerWidget),this._progressBar=document.createElement("div"),this._progressBar.className="jp-InlineCompleter-progressBar",this.node.appendChild(this._progressBar),this._updateShortcutsVisibility(),this._updateDisplay(),this.node.tabIndex=0}get toolbar(){return this._toolbar}get editor(){return this._editor}set editor(e){var t;null===(t=this.model)||void 0===t||t.reset(),this._editor=e}get model(){return this._model}set model(e){(e||this._model)&&e!==this._model&&(this._model&&(this._model.suggestionsChanged.disconnect(this._onModelSuggestionsChanged,this),this._model.filterTextChanged.disconnect(this._onModelFilterTextChanged,this),this._model.provisionProgress.disconnect(this._onProvisionProgress,this)),this._model=e,this._model&&(this._model.suggestionsChanged.connect(this._onModelSuggestionsChanged,this),this._model.filterTextChanged.connect(this._onModelFilterTextChanged,this),this._model.provisionProgress.connect(this._onProvisionProgress,this)))}cycle(e){var t,s;const i=null===(s=null===(t=this.model)||void 0===t?void 0:t.completions)||void 0===s?void 0:s.items;if(i){if("next"===e){const e=this._current+1;this._current=e===i.length?0:e}else{const e=this._current-1;this._current=-1===e?i.length-1:e}this._updateStreamTracking(),this._render()}}accept(){const e=this.model,t=this.current,s=this._editor;if(!s||!e||!t)return;const i=e.cursor,n=t.insertText,o=s.getOffsetAt(s.getCursorPosition()),r=s.getOffsetAt(i),a={changes:{from:r,to:o,insert:n}};o<=o&&o>=r&&(a.selection={anchor:r+n.length}),s.editor.dispatch(a),e.reset(),this.update()}get current(){var e;const t=null===(e=this.model)||void 0===e?void 0:e.completions;return t?t.items[this._current]:null}_updateStreamTracking(){this._lastItem&&this._lastItem.stream.disconnect(this._onStream,this);const e=this.current;e&&e.stream.connect(this._onStream,this),this._lastItem=e}_onStream(e,t){var s;const i=null===(s=this.model)||void 0===s?void 0:s.completions;if(!i||!i.items||0===i.items.length)return;if(this.isHidden)return;const n=i.items[this._current];this._setText(n)}configure(e){this._showWidget=e.showWidget,this._updateDisplay(),e.showShortcuts!==this._showShortcuts&&(this._showShortcuts=e.showShortcuts,this._updateShortcutsVisibility()),m.streamingAnimation=e.streamingAnimation,m.spacerRemovalDelay=Math.max(0,e.editorResizeDelay-300),m.spacerRemovalDuration=Math.max(0,Math.min(300,e.editorResizeDelay-300)),this._minLines=e.minLines,this._maxLines=e.maxLines,this._reserveSpaceForLongest=e.reserveSpaceForLongest,this._suppressIfTabCompleterActive=e.suppressIfTabCompleterActive}get suppressIfTabCompleterActive(){return this._suppressIfTabCompleterActive}get isActive(){var e;return!!(null===(e=this.editor)||void 0===e?void 0:e.host.classList.contains(f))}handleEvent(e){if(!this.isHidden&&this._editor)switch(e.type){case"pointerdown":this._evtPointerdown(e);break;case"scroll":this._evtScroll(e)}}onUpdateRequest(e){super.onUpdateRequest(e);const t=this._model;if(!t)return;let s=t.completions;s&&s.items&&0!==s.items.length?this.isHidden&&(this.show(),this._setGeometry()):this.isHidden||this.hide()}onAfterAttach(e){document.addEventListener("scroll",this,!0),document.addEventListener("pointerdown",this,!0)}onBeforeDetach(e){document.removeEventListener("scroll",this,!0),document.removeEventListener("pointerdown",this,!0)}_evtPointerdown(e){var t;if(this.isHidden||!this._editor)return;const s=e.target;if(this.node.contains(s))return!0;this.hide(),null===(t=this.model)||void 0===t||t.reset()}_evtScroll(e){if(this.isHidden||!this._editor)return;const{node:t}=this;t.contains(e.target)||requestAnimationFrame(()=>{this._setGeometry()})}_onEditorBlur(e){var t;if(this.node.contains(e.relatedTarget))return!1;null===(t=this._editor)||void 0===t||t.host.classList.remove(f),this.hide()}_onModelSuggestionsChanged(e,t){var s;if(this.isAttached){if("set"===t.event)this._current=null!==(s=t.indexMap.get(this._current))&&void 0!==s?s:0;else if("clear"===t.event){const e=this.editor;e&&(this._ghostManager.clearGhosts(e.editor),e.host.classList.remove(f))}this._updateStreamTracking(),this.update(),this._render()}else this.update()}_onModelFilterTextChanged(e,t){var s,i;const n=null===(s=this.model)||void 0===s?void 0:s.completions;n&&n.items&&0!==n.items.length&&(this._current=null!==(i=t.get(this._current))&&void 0!==i?i:0,this._updateStreamTracking(),setTimeout(()=>{this._render(),this._setGeometry()},0))}_onProvisionProgress(e,t){requestAnimationFrame(()=>{0===t.pendingProviders?this._progressBar.style.display="none":(this._progressBar.style.display="",this._progressBar.style.width=100*t.pendingProviders/t.totalProviders+"%")})}_render(){var e,t;const s=null===(e=this.model)||void 0===e?void 0:e.completions;if(!s||!s.items||0===s.items.length)return;const i=s.items[this._current];this._setText(i),"never"!==this._showWidget&&(this._suggestionsCounter.node.innerText=this._trans.__("%1/%2",this._current+1,s.items.length),this._providerWidget.node.title=this._trans.__("Provider: %1",i.provider.name),(null!==(t=i.provider.icon)&&void 0!==t?t:n.XF).render(this._providerWidget.node))}_setText(e){var t,s,i;const n=e.insertText,o=this._editor,r=this._model;if(!r||!o)return;const a=o.editor;let h;if(this._reserveSpaceForLongest){const e=null!==(i=null===(s=null===(t=this.model)||void 0===t?void 0:t.completions)||void 0===s?void 0:s.items)&&void 0!==i?i:[],n=Math.max(...e.map(e=>e.insertText.split("\n").length));h=Math.max(this._minLines,n)}else h=this._minLines;this._ghostManager.placeGhost(a,{from:o.getOffsetAt(r.cursor),content:n,providerId:e.provider.identifier,addedPart:e.lastStreamed,streaming:e.streaming,minLines:h,maxLines:this._maxLines,onPointerOver:this._onPointerOverGhost.bind(this),onPointerLeave:this._onPointerLeaveGhost.bind(this),error:e.error}),o.host.classList.add(f)}_onPointerOverGhost(){null!==this._clearHoverTimeout&&(window.clearTimeout(this._clearHoverTimeout),this._clearHoverTimeout=null),this.node.classList.add(x)}_onPointerLeaveGhost(){this._clearHoverTimeout=window.setTimeout(()=>this.node.classList.remove(x),500)}_setGeometry(){const{node:e}=this,t=this._model,s=this._editor;if(!s||!t||!t.cursor)return;const i=s.host.closest(".jp-MainAreaWidget > .lm-Widget")||s.host;let n;try{const e=s.getCoordinateForPosition(t.cursor);if(!e)throw Error("No coordinates for cursor position");n=e}catch(e){return void this.hide()}o.e.setGeometry({anchor:n,host:i,maxHeight:40,minHeight:20,node:e,privilege:"forceAbove",outOfViewDisplay:{top:"stick-outside",bottom:"stick-inside",left:"stick-inside",right:"stick-outside"}})}_updateShortcutsVisibility(){this.node.dataset.showShortcuts=this._showShortcuts+""}_updateDisplay(){this.node.dataset.display=this._showWidget}}!function(e){e.defaultSettings={showWidget:"onHover",showShortcuts:!0,streamingAnimation:"uncover",providers:{},minLines:2,maxLines:4,editorResizeDelay:1e3,reserveSpaceForLongest:!1,suppressIfTabCompleterActive:!0},e.Model=class{constructor(){this.suggestionsChanged=new r.Signal(this),this.filterTextChanged=new r.Signal(this),this.provisionProgress=new r.Signal(this),this._isDisposed=!1,this._completions=null}setCompletions(e){var t,s;const i=new Map(null===(s=null===(t=this._completions)||void 0===t?void 0:t.items)||void 0===s?void 0:s.map((e,t)=>[e.insertText,t]));this._completions=e;const n=new Map(e.items.map((e,t)=>[i.get(e.insertText),t]));this.suggestionsChanged.emit({event:"set",indexMap:n})}appendCompletions(e){this._completions&&this._completions.items?(this._completions.items.push(...e.items),this.suggestionsChanged.emit({event:"append"})):console.warn("No completions to append to")}notifyProgress(e){this.provisionProgress.emit(e)}get cursor(){return this._cursor}set cursor(e){this._cursor=e}get completions(){return this._completions}reset(){this._completions=null,this.suggestionsChanged.emit({event:"clear"})}get isDisposed(){return this._isDisposed}handleTextChange(e){var t;const s=this._completions;if(!s||!s.items||0===s.items.length)return;const i=new Map(s.items.map((e,t)=>[e,t]));for(let i of null!==(t=e.sourceChange)&&void 0!==t?t:[]){const e=i.insert;if(e){const t=s.items.filter(t=>{var s;const i=null!==(s=t.filterText)&&void 0!==s?s:t.insertText;return!!i.startsWith(e)&&(t.filterText=i.substring(e.length),t.insertText=t.insertText.substring(e.length),!0)});0===t.length&&(this._completions=null),s.items=t}else i.retain||(this._completions=null)}const n=new Map(s.items.map((e,t)=>[i.get(e),t]));this.filterTextChanged.emit(n)}handleSelectionChange(e){const t=this.cursor;if(!t)return;const{start:s,end:i}=e;s.column===i.column&&s.line===i.line||this.reset(),(s.line!==t.line||s.column<t.column)&&this.reset()}dispose(){this._isDisposed||(this._isDisposed=!0,r.Signal.clearData(this))}}}(T||(T={}))}}]);