"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[4035],{66416:(e,t,s)=>{s.r(t),s.d(t,{CellEdit:()=>N,default:()=>Z});var l=s(9387),i=s(45222),a=s(20568),r=s(3345),n=s(49261),c=s(98754),o=s(99180),d=s(38621),u=s(99179),h=s(17788),p=s(41273),m=s(93159),x=s(23267),j=s(80736),g=s(55388),f=s(47769),v=s(18683);const b=()=>{const{useDatasetsBySpace:e,useRefreshSpaceDatasets:t}=(0,m.E6)(),s=(0,x.mt)(),i=(0,g.LC)(),a=s.layout().space,r=(s.layout().organization,e(a?.id??"")),n=t(),{data:c}=r,[o,u]=(0,l.useState)(c??[]);(0,l.useEffect)(()=>{c&&u(c)},[c]);const h=o.filter(e=>e.public),p=o.filter(e=>!e.public);return(0,l.useEffect)(()=>{a&&n.mutate(a.id,{onSuccess:t=>{if(t.success){const{data:t}=e(a.id);u(t??[])}}})},[a]),(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(j.l,{showDividers:!0,role:"menu",children:[(0,v.jsxs)(j.l.Group,{children:[(0,v.jsx)(j.l.GroupHeading,{children:"My public datasets"}),h.map(e=>(0,v.jsxs)(j.l.Item,{onClick:t=>{t.preventDefault(),i.setDataset("cell",e)},children:[(0,v.jsx)(j.l.LeadingVisual,{children:(0,v.jsx)(d.bN0,{})}),e.name,(0,v.jsx)(j.l.Description,{children:(0,f.b)(e.description)})]},e.id)),0===h.length&&(0,v.jsx)(j.l.Item,{disabled:!0,children:"No public dataset"})]}),(0,v.jsxs)(j.l.Group,{children:[(0,v.jsx)(j.l.GroupHeading,{children:"My private datasets"}),p.map(e=>(0,v.jsxs)(j.l.Item,{onClick:t=>{t.preventDefault(),i.setDataset("cell",e)},children:[(0,v.jsx)(j.l.LeadingVisual,{children:(0,v.jsx)(d.bN0,{})}),e.name,(0,v.jsx)(j.l.Description,{children:(0,f.b)(e.description)})]},e.id)),0===p.length&&(0,v.jsx)(j.l.Item,{disabled:!0,children:"No private dataset"})]})]})})};var y=s(84514),A=s(24860),C=s(92243),D=s(14032),k=s(27322),S=s(78084),I=s(14178),E=s(80006),T=s(9448);const w=e=>{const{cell:t}=e,s=((0,h.Z)(),t.outputshotUrl||t.outputshotData);return(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(T.Zp,{border:!0,rounded:"medium",shadow:"medium",sx:{maxWidth:360},children:[(0,v.jsx)(T.Zp.Header,{title:"Cell",description:(0,f.b)(t.name,100)}),(0,v.jsx)(T.Zp.Image,{height:200,image:s}),(0,v.jsx)(T.Zp.Content,{children:(0,v.jsx)(E.A,{color:"fg.muted",children:(0,f.b)(t.description,100)})})]})})},z=(0,D.t)((0,k.Y)(()=>Promise.all([s.e(7583),s.e(3367),s.e(7080)]).then(s.bind(s,57080)))),U=()=>{const{cell:e,update:t}=(0,S.Xp)();if(!e)return(0,v.jsx)(v.Fragment,{});const{useUpdateCell:s}=(0,m.E6)(),i=s(),{space:a,showBackdrop:r,triggerItemsRefresh:n,hideBackdrop:d}=(0,I.l5)(),{enqueueToast:u}=(0,p.d)(),[h,x]=(0,l.useState)(!1),[j,g]=(0,l.useState)({name:e.name,description:e.description}),[f,b]=(0,l.useState)({name:!0,description:!0});return(0,l.useEffect)(()=>{b({...f,name:void 0===j.name?void 0:j.name.length>2,description:void 0===j.description?void 0:j.description.length>2})},[j]),(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(c.A,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr"},children:[(0,v.jsxs)(c.A,{sx:{label:{marginTop:2}},children:[(0,v.jsxs)(y.A,{children:[(0,v.jsx)(y.A.Label,{children:"Name"}),(0,v.jsx)(A.A,{block:!0,value:j.name,onChange:e=>{g(t=>({...t,name:e.target.value})),t({name:e.target.value})}}),!1===f.name&&(0,v.jsx)(y.A.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,v.jsxs)(y.A,{children:[(0,v.jsx)(y.A.Label,{children:"Description"}),(0,v.jsx)(C.Ay,{block:!0,value:j.description,onChange:e=>{g(t=>({...t,description:e.target.value})),t({description:e.target.value})}}),!1===f.description&&(0,v.jsx)(y.A.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,v.jsx)(y.A,{sx:{marginTop:3},children:(0,v.jsxs)(c.A,{display:"flex",children:[(0,v.jsx)(o.Q,{variant:"primary",disabled:h||!f.name||!f.description,onClick:()=>{e?.outputshotData.length>3e5?u(`Output screenshot is too large (actual size is ${e?.outputshotData.length}, the maximum allowed is 300000)`,{variant:"error"}):(r(),x(!0),i.mutate({id:e?.id,name:e?.name,description:e?.description,source:e.source,outputshotUrl:e.outputshotUrl,outputshotData:e?.outputshotUrl?void 0:e?.outputshotData,spaceId:a?.id},{onSuccess:s=>{if(x(!1),s.success){const s={...e,public:e.public,description:e.description,source:e.source,outputshotUrl:e.outputshotUrl,outputshotData:e.outputshotData};n(),t(s),u("The cell is successfully updated.",{variant:"success"})}},onSettled:()=>{x(!1),d()}}))},children:h?"Updating cell...":"Update cell"}),(0,v.jsx)(c.A,{ml:3,children:(0,v.jsx)(z,{})})]})})]}),(0,v.jsx)(c.A,{ml:3,children:(0,v.jsx)(w,{cell:e})})]})})};var R=s(6180);const F=e=>{const{source:t,outputshotRef:s,cellId:l}=e;return(0,v.jsx)(c.A,{ref:s,style:{marginTop:"8px"},children:(0,v.jsx)(R.f,{startDefaultKernel:!0,source:t,id:l,autoStart:!0,showToolbar:!1})})},N=()=>{const{cellId:e}=(0,a.g)();if(!e)return(0,v.jsx)(v.Fragment,{});const t=(0,u.J)(),s=(0,x.mt)(),j=s.layout().space,g=s.cell().cell,f=(0,r.S)(),y=(0,h.Z)(),{enqueueToast:A}=(0,p.d)(),{useCell:C,useRefreshCell:D,useCloneCell:k}=(0,m.E6)(),{data:S}=C(e),I=D(),E=k(),[T,w]=(0,l.useState)(S?.source),[z,R]=(0,l.useState)(!1),N=(0,l.useMemo)(()=>(0,l.createRef)(),[]);(0,l.useEffect)(()=>{S&&(w(S.source),s.cell().update(S),s.layout().setItem(S))},[S]),(0,l.useEffect)(()=>{const t=document.getElementById("right-panel-id"),l=(0,i.createPortal)((0,v.jsx)(b,{}),t);return s.layout().setRightPortal({portal:l,pinned:!1}),I.mutate(e),()=>{s.layout().setItem(void 0)}},[e]);const Z=(0,l.useCallback)(async l=>{f({title:"Are you sure?",content:"Please confirm you want to clone this cell in your private library."}).then(l=>{l&&E.mutate(e,{onSuccess:e=>{e.success&&(A(e.message,{variant:"success"}),s.layout().triggerItemsRefresh(),y(`/${t?.handle}/library/cells`))}})})},[f,g]);return(0,v.jsx)(v.Fragment,{children:g&&T&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(n.z,{"aria-label":"Cell Editor",children:[(0,v.jsx)(n.z.TitleArea,{variant:"subtitle",children:(0,v.jsx)(n.z.Title,{children:"Cell Editor"})}),(0,v.jsxs)(n.z.Actions,{children:[(0,v.jsx)(c.A,{children:z?(0,v.jsx)(o.Q,{variant:"invisible",size:"small",onClick:()=>R(!1),children:"Hide details"}):(0,v.jsx)(o.Q,{variant:"invisible",size:"small",onClick:()=>R(!0),children:"Show details"})}),(0,v.jsx)(c.A,{ml:1,children:t&&j&&(0,v.jsx)(o.Q,{variant:"invisible",size:"small",leadingVisual:d.Nc$,onClick:Z,children:"Clone"})})]})]}),(0,v.jsxs)(c.A,{children:[z&&(0,v.jsx)(c.A,{children:(0,v.jsx)(U,{})}),(0,v.jsx)(c.A,{children:(0,v.jsx)(F,{source:T,outputshotRef:N,cellId:g?.id})})]})]})})},Z=N}}]);