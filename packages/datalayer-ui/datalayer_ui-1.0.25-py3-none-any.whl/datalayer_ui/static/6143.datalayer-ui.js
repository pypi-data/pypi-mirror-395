"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[6143],{6143:(e,t,s)=>{s.r(t),s.d(t,{ExerciseNew:()=>E,default:()=>S});var n=s(9387),i=s(49261),a=s(98754),r=s(84514),o=s(24860),c=s(92243),l=s(80736),d=s(48453),h=s(80006),u=s(99180),p=s(38621),x=s(42968),m=s(55388),g=s(9663);function j(e){const t=e.match(/^[ \t]*(?=\S)/gm);if(!t)return e;let s=Number.POSITIVE_INFINITY;for(const e of t)s=Math.min(s,e.length);return 0===s||s===Number.POSITIVE_INFINITY?e:e.replace(new RegExp(`^[ \\t]{${s}}`,"gm"),"")}var b=s(47769),A=s(99179),v=s(17788),f=s(41273),y=s(93159),k=s(53277),w=s(23267),T=s(9570),C=s(18683);const E=()=>{const e=(0,A.J)(),t=(0,w.mt)(),s=(0,T._O)(),E=(0,m.LC)(),S=(0,v.Z)(),{enqueueToast:_}=(0,f.d)(),{kernelManager:I,defaultKernel:D}=(0,x.PD)(),N=t.layout().leftSidebarVariant,$=t.layout().organization,L=t.layout().space,P=(0,n.useMemo)(()=>D,[I]),{useDatasetsBySpace:R,useRefreshSpaceDatasets:z}=(0,y.E6)(),V=R(L?.id??""),q=z(),{data:Q}=V,[F,O]=(0,n.useState)(Q??[]);(0,n.useEffect)(()=>{Q&&O(Q)},[Q]);const B=E.outputs?.get("exercise-pre")?.input,M=E.outputs?.get("exercise-solution")?.input,Y=E.outputs?.get("exercise-question")?.input,H=E.outputs?.get("exercise-test")?.input,[U,W]=(0,n.useState)({name:void 0,description:void 0,help:'Use the assignment operator "=" to create the variable "x".'}),[J,K]=(0,n.useState)({name:void 0,description:void 0,help:!0});(0,n.useEffect)(()=>{L&&q.mutate(L.id,{onSuccess:e=>{if(e.success){const{data:e}=R(L.id);O(e??[])}}})},[L]),(0,n.useEffect)(()=>{K({...J,name:void 0===U.name?void 0:U.name.length>2,description:void 0===U.description?void 0:U.description.length>2,help:void 0===U.help?void 0:U.help.length>2})},[U]);const{isLoading:Z,isSuccess:G,uploadAndSubmit:X,progress:ee}=(0,k.P)(`${s.configuration.spacerRunUrl}/api/spacer/v1/exercises`);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(i.z,{children:(0,C.jsx)(i.z.TitleArea,{variant:"large",children:(0,C.jsx)(i.z.Title,{children:"New Exercise"})})}),(0,C.jsxs)(a.A,{children:[(0,C.jsxs)(a.A,{sx:{label:{marginTop:2},"label + span":{marginBottom:2}},children:[(0,C.jsxs)(r.A,{children:[(0,C.jsx)(r.A.Label,{children:"Name"}),(0,C.jsx)(r.A.Caption,{children:"Name of the exercise."}),(0,C.jsx)(o.A,{block:!0,value:U.name,onChange:e=>{W(t=>({...t,name:e.target.value}))}}),!1===J.name&&(0,C.jsx)(r.A.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,C.jsxs)(r.A,{children:[(0,C.jsx)(r.A.Label,{children:"Description"}),(0,C.jsx)(r.A.Caption,{children:"Description of the exercise."}),(0,C.jsx)(c.Ay,{block:!0,value:U.description,onChange:e=>{W(t=>({...t,description:e.target.value}))}}),!1===J.description&&(0,C.jsx)(r.A.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,C.jsxs)(a.A,{display:"grid",gridTemplateColumns:"1fr 1fr",sx:{gap:3},children:[(0,C.jsxs)(a.A,{children:[(0,C.jsxs)(r.A,{children:[(0,C.jsx)(r.A.Label,{children:"Preliminary code"}),(0,C.jsx)(r.A.Caption,{children:"This is the preliminary code that will be run before the exercise is taken."})]}),(0,C.jsx)(g.k,{showEditor:!0,autoRun:!0,kernel:P,code:"# Insert your preliminary code here.",id:"exercise-pre"})]}),(0,C.jsxs)(a.A,{children:[(0,C.jsxs)(r.A,{children:[(0,C.jsx)(r.A.Label,{children:"Datasets"}),(0,C.jsx)(r.A.Caption,{children:"Select the datasets to be used in the prelimary code."})]}),(0,C.jsx)(l.l,{showDividers:!0,role:"listbox","aria-label":"Select assignees",children:F.map(e=>(0,C.jsxs)(l.l.Item,{role:"option",onClick:t=>{t.preventDefault(),E.setDataset("exercise-pre",e)},children:[(0,C.jsx)(l.l.LeadingVisual,{children:(0,C.jsx)(p.bN0,{})}),e.name,(0,C.jsxs)(l.l.Description,{children:[e.mimeType," ",(0,b.b)(e.description)]})]},e.id))})]})]}),(0,C.jsxs)(r.A,{children:[(0,C.jsx)(r.A.Label,{children:"Solution Code"}),(0,C.jsx)(r.A.Caption,{children:"This is the expected solution code. The student will never see this content."})]}),(0,C.jsx)(g.k,{showEditor:!0,autoRun:!0,kernel:P,id:"exercise-solution",code:"# Create a variable x, equals to 3.\nx = 3\n\n# Print x.\nprint(x)"}),(0,C.jsxs)(r.A,{children:[(0,C.jsx)(r.A.Label,{children:"Question code"}),(0,C.jsx)(r.A.Caption,{children:"This the question code that will be shown to the student."})]}),(0,C.jsx)(g.k,{showEditor:!0,autoRun:!1,kernel:P,id:"exercise-question",code:j("# Create a variable x, equals to 3.\n...\n\n# Print x.\n...\n").trim()}),(0,C.jsx)(a.A,{children:(0,C.jsxs)(r.A,{children:[(0,C.jsx)(r.A.Label,{children:"Help for the student"}),(0,C.jsx)(r.A.Caption,{children:"This a help that will be shown to the student if he asks for it."}),(0,C.jsx)(c.Ay,{block:!0,value:U.help,onChange:e=>{W(t=>({...t,help:e.target.value}))}}),!1===J.help&&(0,C.jsx)(r.A.Validation,{variant:"error",children:"Help must have more than 2 characters"})]})}),(0,C.jsxs)(r.A,{children:[(0,C.jsx)(r.A.Label,{children:"Test the Solution code"}),(0,C.jsxs)(r.A.Caption,{children:["Write the test code that will be run on the student's code during the exercise. Please refer to the ",(0,C.jsx)(d.A,{href:"https://nbgrader.readthedocs.io/en/latest/user_guide/autograding_resources.html",target:"_blank",children:"nbgrader"})," documentation."]})]}),(0,C.jsx)(g.k,{showEditor:!0,autoRun:!1,disableRun:!0,kernel:P,id:"exercise-test",code:'Ex().check_object("x")\nEx().check_object("x").has_equal_value()\nEx().has_output("3")\nprint(\'Congratulations. You have successfully passed this exercise.\')'})]}),(0,C.jsx)(h.A,{as:"p",color:"fg.onEmphasis",bg:"neutral.emphasis",p:2,children:'Validate you tests with this button. It will run the "Preliminary code", then will run the "Test code" on the "Solution code". When a student will take the exercise, the "Test code" will be run on the "Student code".'}),(0,C.jsx)(u.Q,{variant:"danger",leadingVisual:p.Qvf,sx:{marginTop:2,marginBottom:2},onClick:e=>{e.preventDefault(),E.setExecuteRequest("exercise-test",`\nsetup_state(stu_code = """${B}\n${M}""", sol_code = """${B}\n${M}""")\n${H}\n`)},children:"Test"}),(0,C.jsx)(h.A,{as:"p",color:"fg.onEmphasis",bg:"neutral.emphasis",p:2,children:"Once you are confident with your test, you can create the exercise. Don't worry, you can still update it before making it public."}),(0,C.jsx)(u.Q,{variant:"primary",disabled:Z||!J.name||!J.description,sx:{marginTop:2},onClick:async()=>{const s=new FormData;s.append("name",U.name),s.append("description",U.description),s.append("help",U.help),s.append("codePre",B??""),s.append("codeSolution",M??""),s.append("codeQuestion",Y??""),s.append("codeTest",H??""),s.append("accountType","organization-space"===N?"organization":"user"),s.append("accountId","organization-space"===N?$?.id:e?.id),s.append("spaceId",L?.id),X(s).then(s=>{s.success&&(_("The exercise has been created.",{variant:"success"}),"organization"===N||"organization-space"===N?(S(`/${$?.handle}/${L?.handle}/exercises/${s.exercise.uid}`),t.layout().triggerItemsRefresh()):S(`/${e?.handle}/${L?.handle}/exercises`))})},children:"Create an exercise"})]})]})},S=E}}]);