"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[5388],{15388:(e,t,s)=>{s.r(t),s.d(t,{AssignmentEdit:()=>O,default:()=>R});var n=s(9387),a=s(20568),i=s(3345),r=s(92584),o=s(98754),c=s(46508),l=s(94706),d=s(10680),u=s(3556),m=s(92243),h=s(84514),p=s(24860),g=s(49261),x=s(99180),v=s(38621),f=s(85383),y=s(12338),b=s(2159),j=s(84271),k=s(16476),A=s(93159),S=s(17788),C=s(41273),w=s(99179),B=s(23267),I=s(72085),N=s(75345),E=s(18683);const O=()=>{const{assignmentId:e}=(0,a.g)();if(!e)return(0,E.jsx)(E.Fragment,{});const t=(0,w.J)(),s=(0,i.S)(),O=(0,S.Z)(),R=(0,B.mt)(),V=(0,k.Gx)(),z=(0,I.OK)(),_=R.layout().space,D=z.saveRequest,F=V.selectNotebookModel(e),{useCloneAssignment:Q,useAssignment:T,useAssignmentStudentVersion:U,useRefreshAssignment:J,useUpdateNotebookModel:M,useUpdateNotebook:L}=(0,A.E6)(),{enqueueToast:P}=(0,C.d)(),$=Q(),{data:q}=T(e??""),G=J(),H=M(),K=L(),{data:Z}=U(e??"",{enabled:!1}),[W,X]=(0,n.useState)("editor"),[Y,ee]=(0,n.useState)(!1),[te,se]=(0,n.useState)(void 0),[ne,ae]=(0,n.useState)([]),[ie,re]=(0,n.useState)(q),[oe,ce]=(0,n.useState)({name:q?.name??"",description:q?.description??""}),[le,de]=(0,n.useState)({name:void 0,description:void 0}),ue=(0,n.useMemo)(()=>[new b._],[]),me=(0,n.useMemo)(()=>[new b._({factory:j.a})],[]),he=(e,t)=>{t.preventDefault(),R.layout().resetRightPortal(),ae([]),X(e)};(0,n.useEffect)(()=>{q&&(re(q),ce({name:q.name,description:q.description}))},[q]),(0,n.useEffect)(()=>{if(e&&"editor"===W)return R.layout().showBackdrop("Loading the assignment..."),G.mutate(e,{onSuccess:t=>{if(t.success){const{data:t}=T(e);t?R.layout().setItem(t):O("/")}},onSettled:()=>{R.layout().hideBackdrop()}}),()=>{V.reset(),R.layout().setItem(void 0)}},[e,W]);const pe=()=>{F?.model?.cells&&(R.layout().showBackdrop("Saving the assignment..."),H.mutate({notebookId:e,nbformat:F.model.toJSON()},{onSuccess:e=>{e.success&&(P("The assignment is successfully updated.",{variant:"success"}),R.layout().triggerItemsRefresh(),re({...ie,nbformat:F.model.toJSON()}))},onSettled:()=>{R.layout().hideBackdrop()}}))},ge=async t=>{F?.model?.cells&&(t.preventDefault(),R.layout().showBackdrop("Generating the student version of the assignment..."),H.mutate({notebookId:e,nbformat:F.model.toJSON()},{onSuccess:async()=>{const s=await U(e??"",{enabled:!0}).refetch();ee(!0),he("student",t),s.data&&s.data.success?se(JSON.parse(s.data.notebook)):s.data?.errors&&ae(s.data.errors),R.layout().hideBackdrop()},onError:()=>{R.layout().hideBackdrop()}}))};(0,n.useEffect)(()=>{D&&ie&&pe()},[D]),(0,n.useEffect)(()=>{de({...le,name:void 0===oe.name?void 0:oe.name.length>2,description:void 0===oe.description?void 0:oe.description.length>2})},[oe]);const xe=(0,n.useCallback)(async n=>{s({title:"Are you sure?",content:"Please confirm you want to clone this assignment in your private library."}).then(s=>{s&&(R.layout().showBackdrop(),$.mutate(e,{onSuccess:e=>{e.success&&(P(e.message,{variant:"success"}),R.layout().triggerItemsRefresh(),O(`/${t?.handle}/library/assignments`))},onSettled:()=>{R.layout().hideBackdrop()}}))})},[s,ie]);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(g.z,{children:(0,E.jsxs)(o.A,{display:"flex",children:[(0,E.jsx)(o.A,{flex:1,children:(0,E.jsx)(u.A,{sx:{fontSize:3},children:"Assignment editor"})}),"student"!==W&&(0,E.jsxs)(o.A,{display:"flex",children:[(0,E.jsx)(N.E,{commandRegistry:V.selectNotebookAdapter(e)?.commands,save:pe}),(0,E.jsx)(c.A,{children:(0,E.jsx)(x.Q,{variant:"invisible",size:"small",leadingVisual:f.A,onClick:e=>ge(e),children:"Student version"})}),ie&&_&&(0,E.jsx)(x.Q,{variant:"invisible",size:"small",leadingVisual:v.Nc$,onClick:xe,children:"Clone"})]})]})}),ie&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(r.O,{sx:{mt:3,mb:3},children:[(0,E.jsx)(r.O.Item,{href:"","aria-label":"","aria-current":"editor"===W?"page":void 0,onClick:e=>he("editor",e),children:"Editor"}),(0,E.jsx)(r.O.Item,{href:"","aria-label":"","aria-current":"properties"===W?"page":void 0,onClick:e=>he("properties",e),children:"Properties"}),(0,E.jsx)(r.O.Item,{href:"","aria-label":"","aria-current":"student"===W?"page":void 0,onClick:e=>ge(e),children:"Student version"})]}),"editor"===W&&(0,E.jsx)(o.A,{children:ie.nbformat&&(0,E.jsx)(y.g,{id:e,height:"calc(100vh - 240px)",maxHeight:"calc(100vh - 240px)",nbformat:ie.nbformat,extensions:ue,cellSidebarMargin:200})}),"properties"===W&&(0,E.jsx)(o.A,{display:"grid",gridTemplateColumns:"1fr 1fr",children:(0,E.jsx)(o.A,{children:(0,E.jsxs)(o.A,{sx:{label:{marginTop:2}},children:[(0,E.jsxs)(h.A,{children:[(0,E.jsx)(h.A.Label,{children:"Name"}),(0,E.jsx)(p.A,{block:!0,value:oe.name,onChange:e=>{ce(t=>({...t,name:e.target.value}))}}),!1===le.name&&(0,E.jsx)(h.A.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,E.jsxs)(h.A,{children:[(0,E.jsx)(h.A.Label,{children:"Description"}),(0,E.jsx)(m.Ay,{block:!0,value:oe.description,onChange:e=>{ce(t=>({...t,description:e.target.value}))}}),!1===le.description&&(0,E.jsx)(h.A.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,E.jsx)(h.A,{children:(0,E.jsx)(x.Q,{variant:"primary",disabled:!le.name||!le.description,sx:{marginTop:2},onClick:async()=>{R.layout().showBackdrop("Updating assignment..."),K.mutate({id:e,name:oe.name,description:oe.description},{onSuccess:e=>{e.success&&(P("The assignment is successfully updated.",{variant:"success"}),R.layout().triggerItemsRefresh(),re({...ie,name:oe.name,description:oe.description}))},onSettled:()=>{R.layout().hideBackdrop()}})},children:"Update assignment"})})]})})}),"student"===W&&(0,E.jsxs)(o.A,{ml:3,mr:3,children:[(0,E.jsx)(d.A,{variant:"warning",children:"Student version of the assignment."}),ne.map(e=>(0,E.jsxs)(d.A,{variant:"danger",children:[(0,E.jsx)(l.A,{icon:v._0O}),e]})),te&&0===ne.length&&(0,E.jsx)(y.g,{id:`${e}-student`,height:"calc(100vh - 240px)",maxHeight:"calc(100vh - 240px)",nbformat:te,readonly:!0,extensions:me})]})]})]})},R=O},75345:(e,t,s)=>{s.d(t,{E:()=>c});var n=s(18683),a=s(71791),i=s(99251),r=s(38621),o=s(9387);function c(e){const{commandRegistry:t,runtimeDesc:s,sessionConnection:c}=e,[l,d]=(0,o.useState)();return(0,o.useEffect)(()=>{const e=()=>{d(c?.kernel?.status)};return e(),c?.statusChanged.connect(e),c?.connectionStatusChanged.connect(e),()=>{c?.statusChanged.disconnect(e),c?.connectionStatusChanged.disconnect(e)}},[c]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.Q,{variant:"invisible",size:"small",leadingVisual:r.udU,disabled:!s?.location||"busy"===l,onClick:e=>t?.execute(a.nx.runAll),children:"Run all"}),(0,n.jsx)(i.Q,{variant:"invisible",size:"small",leadingVisual:r.wFz,disabled:!s?.location||"busy"!==l,onClick:e=>t?.execute(a.nx.interrupt),children:"Interrupt"})]})}},84271:(e,t,s)=>{s.d(t,{a:()=>l});var n=s(18683),a=s(38621),i=s(98754),r=s(99180),o=s(71791),c=s(84604);function l(e){const{commands:t}=e;return(0,n.jsx)(i.A,{className:c.VL,sx:{"& p":{marginBottom:"0 !important"}},children:(0,n.jsx)(r.Q,{trailingVisual:a.udU,size:"small",variant:"invisible",onClick:e=>{e.preventDefault(),t.execute(o.nx.run).catch(e=>{console.error("Failed to run cell.",e)})},children:"Run"})})}}}]);