"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[264,5003],{5700:(e,t,n)=>{n.d(t,{N:()=>c});var o=n(18683),r=n(38621),a=n(98754),s=n(58875),i=n(71791),l=n(84604);function c(e){const{commands:t,model:n}=e;return(0,o.jsxs)(a.A,{className:l.VL,sx:{width:16,position:"relative",marginTop:4,marginLeft:"16px !important","& p":{marginBottom:"0 !important"}},children:[(0,o.jsx)(s.K,{size:"small",color:"secondary","aria-label":"Run cell",title:"Run cell",onClick:e=>{e.preventDefault(),t.execute(i.nx.run).catch(e=>{console.error("Failed to run cell.",e)})},icon:r.udU,variant:"invisible"}),(0,o.jsx)(s.K,{size:"small",color:"secondary","aria-label":"Add code cell above",title:"Add code cell above",onClick:e=>{e.preventDefault(),t.execute(i.nx.insertAbove).catch(e=>{console.error("Failed to insert code cell above.",e)})},icon:r.Mtm,variant:"invisible"}),(0,o.jsx)(s.K,{size:"small",color:"secondary","aria-label":"Add markdown cell above",title:"Add markdown cell above",onClick:e=>{e.preventDefault(),t.execute(i.nx.insertAbove,{cellType:"markdown"}).catch(e=>{console.error("Failed to insert markdown cell above.",e)})},icon:r.Mtm,variant:"invisible"}),"code"===n.type?(0,o.jsx)(s.K,{"aria-label":"Convert to markdow cell",title:"Convert to markdow cell",icon:r.dHM,size:"small",variant:"invisible",onClick:e=>{e.preventDefault(),t.execute(i.nx.changeCellTypeToMarkdown).catch(e=>{console.error("Failed to change cell type to markdown.",e)})}}):(0,o.jsx)(s.K,{"aria-label":"Convert to code cell",title:"Convert to code cell",icon:r.dHM,variant:"invisible",size:"small",onClick:e=>{e.preventDefault(),t.execute(i.nx.changeCellTypeToCode).catch(e=>{console.error("Failed to change cell type to code.",e)})}}),(0,o.jsx)(s.K,{size:"small",color:"secondary","aria-label":"Add markdown cell below",title:"Add markdown cell below",onClick:e=>{e.preventDefault(),t.execute(i.nx.insertBelow,{cellType:"markdown"}).catch(e=>{console.error("Failed to insert markdown cell below.",e)})},icon:r.D3D,variant:"invisible"}),(0,o.jsx)(s.K,{size:"small",color:"secondary","aria-label":"Add code cell below",title:"Add code cell below",onClick:e=>{e.preventDefault(),t.execute(i.nx.insertBelow).catch(e=>{console.error("Failed to insert code cell below.",e)})},icon:r.D3D,variant:"invisible"}),(0,o.jsx)(s.K,{size:"small",color:"error","aria-label":"Delete cell",title:"Delete cell",onClick:e=>{e.preventDefault(),t.execute(i.nx.deleteCells).catch(e=>{console.error("Failed to delete cells.",e)})},icon:r.uv5,variant:"invisible"})]})}},6543:(e,t,n)=>{n.d(t,{C:()=>y});var o=n(18683),r=n(9387),a=n(46343),s=n(71860),i=n(4104),l=n(76068),c=n(90385),d=n(11692),u=n(56801),h=n(13383),p=n(9448),m=n(41273),v=n(36687),f=n(5362),g=n(92131),w=n(33872);function y({children:e,connection:t,podName:n,multiServiceManager:y,disabled:b=!1}){const{addRuntimeSnapshot:k,runtimesRunUrl:x,runtimeSnapshots:C,setRuntimeSnapshots:S}=(0,g.c6)(),{enqueueToast:T,trackAsyncTask:A}=(0,m.d)(),[V,I]=(0,r.useState)(!1),[_,E]=(0,r.useState)(!1),[j,N]=(0,r.useState)(!1),[R,P]=(0,r.useState)(C[0]?.id??""),[z,M]=(0,r.useState)();(0,r.useEffect)(()=>{(0,v.Ay)().then(e=>{S(e),!R&&e.length>0&&P(e[0].id)}).catch(e=>{console.error(`Failed to fetch remote kernel snapshots; ${e}`)})},[x]);const L=(0,r.useCallback)(()=>{M(void 0),I(!0)},[]),D=(0,r.useCallback)(e=>{P(e.target.value)},[]),$=(0,r.useCallback)(async({id:e,connection:t,podName:n})=>{n?(await(0,v.Pk)({id:n,from:e}),T(`Runtime snapshot ${n} is loaded.`,{variant:"success"})):t&&(await(0,f.j)({connection:t,id:e}),T(`Runtime snapshot ${e} is loaded.`,{variant:"success"}))},[]),F=(0,r.useCallback)(async()=>{try{let e,o;N(!0);let r="",a="";if(n&&y?.remote)a=(0,w.u)("cloud"),o=y.remote.runtimesManager.snapshotRuntime({podName:n,name:a,description:a,stop:!1}),r=n.split("-",2).reverse()[0],o.then(t=>{e=t});else if(t&&y?.browser){const n=t.model;r=n.id,a=(0,w.u)("browser");let s=!0;o=(0,f.T)({connection:y.browser.kernels.connectTo({model:n}),metadata:{filename:`${a}.data`},onUploadProgress:()=>{s&&(s=!1,(0,v.Ay)().then(t=>{e=t.find(e=>e.name===a)}))}})}o&&(A(o,{error:{message:(e,t)=>"Empty snapshot"===e?`Runtime ${r} will not be snapshotted as it does not contain any serializable state.`:`Failed to snapshot runtime ${r} - ${e}`},pending:{message:`Taking a snapshot of runtime ${r}…`},success:{message:()=>`Runtime ${r} successfully snapshotted as ${a}.`}}),await o,e&&k(e))}finally{N(!1)}},[t,n,y]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(c.W,{children:[(0,o.jsx)(c.W.Button,{leadingVisual:a.A,variant:"invisible",size:"small",disabled:_||j||b,children:e}),(0,o.jsx)(c.W.Overlay,{children:(0,o.jsxs)(s.l,{children:[(0,o.jsx)(s.l.Item,{onSelect:L,disabled:_||0===C.length,children:"Load a runtime snapshot…"}),(0,o.jsx)(s.l.Item,{onSelect:F,disabled:j,children:"Take a runtime snapshot"})]})})]}),V&&(0,o.jsx)(h.l,{title:(0,o.jsx)("span",{style:{color:"var(--fgColor-default)"},children:"Choose a runtime snapshot to load"}),onClose:()=>{I(!1)},footerButtons:[{buttonType:"default",content:"Cancel",onClick:e=>{e.defaultPrevented||(e.preventDefault(),I(!1))}},{buttonType:"primary",content:_?(0,o.jsx)(l.A,{size:"small"}):"Load",disabled:_,onClick:async e=>{if(!e.defaultPrevented){e.preventDefault(),E(!0);try{M(void 0);const e=C.find(e=>e.id===R);e&&(t||n)?await $({connection:t,id:e.id,podName:n}):M("No runtime snapshot found.")}finally{E(!1),I(!1)}}},autoFocus:!0}],children:(0,o.jsxs)(p.az,{as:"form",children:[(0,o.jsxs)(d.A,{children:[(0,o.jsx)(d.A.Label,{children:"Snapshot"}),(0,o.jsx)(u.A,{name:"snapshot",value:R,onChange:D,block:!0,children:C.map(e=>(0,o.jsx)(u.A.Option,{value:e.id,children:e.name?`${e.name} (${e.id})`:e.id},e.id))})]}),z&&(0,o.jsx)(i.A,{variant:"danger",children:z})]})})]})}},7384:(e,t,n)=>{n.r(t),n.d(t,{createMarkdownParser:()=>c,default:()=>d});var o=n(98238),r=n(63711),a=n(1290),s=n(5279);new o.Token("@jupyterlab/mermaid:IMermaidManager","a manager for rendering mermaid text-based diagrams");const i=new o.Token("@jupyterlab/mermaid:IMermaidMarkdown","a manager for rendering mermaid text-based diagrams in markdown fenced code blocks"),l="```~~~";function c(e,t){return{render:n=>u.render(n,e,t)}}const d={id:"@jupyterlab/markedparser-extension:plugin",description:"Provides the Markdown parser.",autoStart:!0,provides:s.co,requires:[a.SW],optional:[i],activate:(e,t,n)=>c(t,{blocks:n?[n]:[]})};var u;!function(e){let t=null,a=null,s=[],i=null,c={},d=new r.LruCache;async function u(e){if(a)return a;if(t)return await t.promise;s=(null==e?void 0:e.blocks)||[],s=s.sort((e,t)=>{var n,o;return(null!==(n=e.rank)&&void 0!==n?n:1/0)-(null!==(o=t.rank)&&void 0!==o?o:1/0)}),t=new o.PromiseDelegate;const[{marked:r,Renderer:i},l]=await Promise.all([n.e(5846).then(n.bind(n,55846)),h()]);for(const e of l)r.use(e);return c={async:!0,gfm:!0,walkTokens:m,renderer:p(i)},a=r,t.resolve(a),a}async function h(){return Promise.all([(async()=>(await n.e(529).then(n.bind(n,90529))).gfmHeadingId())(),(async()=>(await n.e(9741).then(n.bind(n,59741))).mangle())()])}function p(e){const t=new e,n=t.code;return t.code=({text:e,lang:o,escaped:r})=>{for(const t of s)if(o&&t.languages.includes(o)){const n=t.render(e);if(null!=n)return n}const a=`${o}${l}${e}${l}`,i=d.get(a);return null!=i?i:n.call(t,{text:e,lang:o,escaped:r})},t}async function m(e){if("code"===e.type){if(e.lang)for(const t of s)if(t.languages.includes(e.lang))return void await t.walk(e.text);await async function(e){const{lang:t,text:n}=e;if(!t||!i)return;const o=`${t}${l}${n}${l}`;if(d.get(o))return;const r=document.createElement("div");try{await i.highlight(n,i.findBest(t),r);const e=`<pre><code class="language-${t}">${r.innerHTML}</code></pre>`;d.set(o,e)}catch(e){console.error(`Failed to highlight ${t} code`,e)}finally{r.remove()}}(e)}}e.render=async function(e,t,n){return i=t,a||(a=await u(n)),a(e,c)},e.initializeMarked=u}(u||(u={}))},10069:(e,t,n)=>{n.d(t,{Ks:()=>s});var o=n(97283),r=n(7282);const a=(0,o.y)(e=>({aiAgents:[],addAIAgent:t=>{e(e=>e.aiAgents.includes(t)?{}:{aiAgents:e.aiAgents.concat([t])})},deleteAIAgent:t=>{e(e=>({aiAgents:e.aiAgents.filter(e=>e.documentId===t)}))},updateAIAgent:(t,n)=>{e(e=>{const o=e.aiAgents.findIndex(e=>e.documentId===t);return o>=0?(e.aiAgents[o].runtimeId=n,{aiAgents:[...e.aiAgents]}):{}})}}));function s(e){return(0,r.Pj)(a,e)}},17468:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(52908),r=n.n(o),a=n(10293),s=n.n(a)()(r());s.push([e.id,'.prc-AvatarStack-AvatarStack-N-r3C{--avatar-border-width:1px;--mask-size:calc(100% + var(--avatar-border-width)*2);--mask-start:-1;--opacity-step:15%;display:flex;height:var(--avatar-stack-size);isolation:isolate;min-width:var(--avatar-stack-size);position:relative}.prc-AvatarStack-AvatarStack-N-r3C:where([data-variant=cascade]){--overlap-size:calc(var(--avatar-stack-size)*0.55);--overlap-size-avatar-three-plus:calc(var(--avatar-stack-size)*0.85)}.prc-AvatarStack-AvatarStack-N-r3C:where([data-variant=stack]){--overlap-size:calc(var(--avatar-stack-size)*0.55);--overlap-size-avatar-three-plus:calc(var(--avatar-stack-size)*0.55)}@media screen and (max-width:calc(48rem - 0.02px)){.prc-AvatarStack-AvatarStack-N-r3C:where([data-responsive]){--avatar-stack-size:var(--stackSize-narrow)}}@media screen and (min-width:48rem){.prc-AvatarStack-AvatarStack-N-r3C:where([data-responsive]){--avatar-stack-size:var(--stackSize-regular)}}@media screen and (min-width:87.5rem){.prc-AvatarStack-AvatarStack-N-r3C:where([data-responsive]){--avatar-stack-size:var(--stackSize-wide)}}.prc-AvatarStack-AvatarStack-N-r3C:where([data-avatar-count="1"][data-shape=circle]) .prc-AvatarStack-AvatarItem-nS1mt{box-shadow:0 0 0 var(--avatar-border-width) var(--avatar-borderColor,var(--color-avatar-border))}.prc-AvatarStack-AvatarStack-N-r3C:where([data-avatar-count="1"][data-shape=square]) .prc-AvatarStack-AvatarItem-nS1mt{box-shadow:1px 0 #000}.prc-AvatarStack-AvatarStack-N-r3C:where([data-avatar-count="1"][data-shape=square][data-align-right]) .prc-AvatarStack-AvatarItem-nS1mt{box-shadow:-1px 0 #000}.prc-AvatarStack-AvatarStack-N-r3C:where([data-avatar-count="2"]){min-width:calc(var(--avatar-stack-size) + var(--avatar-stack-size) - var(--overlap-size))}.prc-AvatarStack-AvatarStack-N-r3C:where([data-avatar-count="3"][data-variant=cascade]){min-width:calc(var(--avatar-stack-size) + var(--avatar-stack-size) - var(--overlap-size) + var(--avatar-stack-size) - var(--overlap-size-avatar-three-plus))}.prc-AvatarStack-AvatarStack-N-r3C:where([data-avatar-count="3"][data-variant=stack]){min-width:calc(var(--avatar-stack-size) + (var(--avatar-stack-size) - var(--overlap-size-avatar-three-plus))*2)}.prc-AvatarStack-AvatarStack-N-r3C:where([data-avatar-count="3+"][data-variant=cascade]){min-width:calc(var(--avatar-stack-size) + var(--avatar-stack-size) - var(--overlap-size) + (var(--avatar-stack-size) - var(--overlap-size-avatar-three-plus))*2)}.prc-AvatarStack-AvatarStack-N-r3C:where([data-avatar-count="3+"][data-variant=stack]){min-width:calc(var(--avatar-stack-size) + (var(--avatar-stack-size) - var(--overlap-size-avatar-three-plus))*3);--overlap-size:var(--overlap-size-avatar-three-plus)}.prc-AvatarStack-AvatarStack-N-r3C:where([data-align-right]){--mask-start:1;direction:rtl}.prc-AvatarStack-AvatarStackBody-mSyoJ{display:flex;position:absolute}.prc-AvatarStack-AvatarStackBody-mSyoJ:where([data-disable-expand]){position:relative}.prc-AvatarStack-AvatarItem-nS1mt{--avatarSize-regular:var(--avatar-stack-size);display:flex;flex-shrink:0;height:var(--avatar-stack-size);overflow:hidden;position:relative;transition:margin .2s ease-in-out,opacity .2s ease-in-out,mask-position .2s ease-in-out,mask-size .2s ease-in-out;width:var(--avatar-stack-size)}.prc-AvatarStack-AvatarStack-N-r3C:where([data-shape=circle]) .prc-AvatarStack-AvatarItem-nS1mt:is(img){box-shadow:0 0 0 var(--avatar-border-width) transparent}.prc-AvatarStack-AvatarStack-N-r3C:where([data-shape=square]) .prc-AvatarStack-AvatarItem-nS1mt:is(img){box-shadow:1px 0 #fff}.prc-AvatarStack-AvatarStack-N-r3C:where([data-shape=square][data-align-right]) .prc-AvatarStack-AvatarItem-nS1mt:is(img){box-shadow:-1px 0 #fff}.prc-AvatarStack-AvatarItem-nS1mt:first-child{margin-inline-start:0}.prc-AvatarStack-AvatarItem-nS1mt:nth-child(n+2){margin-inline-start:calc(var(--overlap-size)*-1);mask-composite:exclude;mask-position:calc((var(--avatar-stack-size) - var(--overlap-size))*var(--mask-start) - var(--avatar-border-width)) center,0 0;mask-repeat:no-repeat,no-repeat;mask-size:var(--mask-size) var(--mask-size),auto;padding:.1px}.prc-AvatarStack-AvatarStack-N-r3C:where([data-shape=circle]) .prc-AvatarStack-AvatarItem-nS1mt:nth-child(n+2){mask-image:radial-gradient(at 50% 50%,#000 70%,transparent 71%),linear-gradient(#000 0 0)}.prc-AvatarStack-AvatarStack-N-r3C:where([data-shape=square]) .prc-AvatarStack-AvatarItem-nS1mt:nth-child(n+2){mask-image:linear-gradient(at 50% 50%,#000 70%,transparent 71%),linear-gradient(#000 0 0)}.prc-AvatarStack-AvatarStack-N-r3C:where([data-variant=cascade]) .prc-AvatarStack-AvatarItem-nS1mt:nth-child(n+3){--overlap-size:var(--overlap-size-avatar-three-plus);opacity:calc(100% - var(--opacity-step)*2)}.prc-AvatarStack-AvatarStack-N-r3C:where([data-variant=cascade]) .prc-AvatarStack-AvatarItem-nS1mt:nth-child(n+4){opacity:calc(100% - var(--opacity-step)*3)}.prc-AvatarStack-AvatarStack-N-r3C:where([data-variant=cascade]) .prc-AvatarStack-AvatarItem-nS1mt:nth-child(n+5){opacity:calc(100% - var(--opacity-step)*4)}.prc-AvatarStack-AvatarStack-N-r3C:where([data-shape=square]) .prc-AvatarStack-AvatarItem-nS1mt:first-child{z-index:5}.prc-AvatarStack-AvatarStack-N-r3C:where([data-shape=square]) .prc-AvatarStack-AvatarItem-nS1mt:nth-child(2){z-index:4}.prc-AvatarStack-AvatarStack-N-r3C:where([data-shape=square]) .prc-AvatarStack-AvatarItem-nS1mt:nth-child(3){z-index:3}.prc-AvatarStack-AvatarStack-N-r3C:where([data-shape=square]) .prc-AvatarStack-AvatarItem-nS1mt:nth-child(4){z-index:2}.prc-AvatarStack-AvatarStack-N-r3C:where([data-shape=square]) .prc-AvatarStack-AvatarItem-nS1mt:nth-child(5){z-index:1}.prc-AvatarStack-AvatarItem-nS1mt:nth-child(n+6){opacity:0;visibility:hidden}.prc-AvatarStack-AvatarStackBody-mSyoJ:not([data-disable-expand]):focus-within,.prc-AvatarStack-AvatarStackBody-mSyoJ:not([data-disable-expand]):hover{width:auto}:is(.prc-AvatarStack-AvatarStackBody-mSyoJ:not([data-disable-expand]):hover,.prc-AvatarStack-AvatarStackBody-mSyoJ:not([data-disable-expand]):focus-within) .prc-AvatarStack-AvatarItem-nS1mt{--mask-size:100%;margin-inline-start:var(--base-size-4,.25rem);mask-position:calc(var(--avatar-stack-size)*var(--mask-start)) center,0 0;opacity:1;visibility:visible}:is(:is(.prc-AvatarStack-AvatarStackBody-mSyoJ:not([data-disable-expand]):hover,.prc-AvatarStack-AvatarStackBody-mSyoJ:not([data-disable-expand]):focus-within) .prc-AvatarStack-AvatarItem-nS1mt):first-child{margin-inline-start:0}',""]);const i=s},20232:(e,t,n)=>{n.d(t,{k:()=>I});var o=n(29886),r=n(38229),a=n(39189),s=n(50809),i=n(9366);const l=(e,t)=>{a.zd(e,0);const n=i.FX(t);a.Gu(e,n)},c=(e,t,n)=>{a.zd(e,1),a.Gu(e,i.PR(t,n))},d=(e,t,n)=>{try{i.QE(t,s.bo(e),n)}catch(e){console.error("Caught error while handling a Yjs update",e)}},u=d;var h=n(54195),p=n(48201),m=n(51318),v=n(10531),f=n(8417),g=n(42165);const w=[];w[0]=(e,t,n,o,r)=>{a.zd(e,0);const i=((e,t,n,o)=>{const r=s.cw(e);switch(r){case 0:((e,t,n)=>{c(t,n,s.bo(e))})(e,t,n);break;case 1:d(e,n,o);break;case 2:u(e,n,o);break;default:throw new Error("Unknown message type")}return r})(t,e,n.doc,n);o&&1===i&&!n.synced&&(n.synced=!0)},w[3]=(e,t,n,o,r)=>{a.zd(e,1),a.Gu(e,h.X3(n.awareness,Array.from(n.awareness.getStates().keys())))},w[1]=(e,t,n,o,r)=>{h.tQ(n.awareness,s.bo(t),n)},w[2]=(e,t,n,o,r)=>{((e,t,n)=>{0===s.cw(e)&&n(0,s.t3(e))})(t,n.doc,(e,t)=>y(n,t))};const y=(e,t)=>console.warn(`Permission denied to access ${e.url}.\n${t}`),b=(e,t,n)=>{const o=s.$C(t),r=a.xv(),i=s.cw(o),l=e.messageHandlers[i];return l?l(r,o,e,n,i):console.error("Unable to compute message"),r},k=(e,t,n)=>{t===e.ws&&(e.emit("connection-close",[n,e]),e.ws=null,t.close(),e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,h._g(e.awareness,Array.from(e.awareness.getStates().keys()).filter(t=>t!==e.doc.clientID),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(x,m.jk(100*m.n7(2,e.wsUnsuccessfulReconnects),e.maxBackoffTime),e))},x=e=>{if(e.shouldConnect&&null===e.ws){const t=new e._WS(e.url,e.protocols);t.binaryType="arraybuffer",e.ws=t,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,t.onmessage=n=>{e.wsLastMessageReceived=r._g();const o=b(e,new Uint8Array(n.data),!0);a.Bw(o)>1&&t.send(a.Fo(o))},t.onerror=t=>{e.emit("connection-error",[t,e])},t.onclose=n=>{k(e,t,n)},t.onopen=()=>{e.wsLastMessageReceived=r._g(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const n=a.xv();if(a.zd(n,0),l(n,e.doc),t.send(a.Fo(n)),null!==e.awareness.getLocalState()){const n=a.xv();a.zd(n,1),a.Gu(n,h.X3(e.awareness,[e.doc.clientID])),t.send(a.Fo(n))}},e.emit("status",[{status:"connecting"}])}},C=(e,t)=>{const n=e.ws;e.wsconnected&&n&&n.readyState===n.OPEN&&n.send(t),e.bcconnected&&o.mk(e.bcChannel,t,e)};class S extends p.W{constructor(e,t,n,{connect:s=!0,awareness:i=new h.ww(n),params:c={},protocols:d=[],WebSocketPolyfill:u=WebSocket,resyncInterval:p=-1,maxBackoffTime:m=2500,disableBc:v=!1}={}){for(super();"/"===e[e.length-1];)e=e.slice(0,e.length-1);this.serverUrl=e,this.bcChannel=e+"/"+t,this.maxBackoffTime=m,this.params=c,this.protocols=d,this.roomname=t,this.doc=n,this._WS=u,this.awareness=i,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=v,this.wsUnsuccessfulReconnects=0,this.messageHandlers=w.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=s,this._resyncInterval=0,p>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const e=a.xv();a.zd(e,0),l(e,n),this.ws.send(a.Fo(e))}},p)),this._bcSubscriber=(e,t)=>{if(t!==this){const t=b(this,new Uint8Array(e),!1);a.Bw(t)>1&&o.mk(this.bcChannel,a.Fo(t),this)}},this._updateHandler=(e,t)=>{if(t!==this){const t=a.xv();a.zd(t,0),((e,t)=>{a.zd(e,2),a.Gu(e,t)})(t,e),C(this,a.Fo(t))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:e,updated:t,removed:n},o)=>{const r=e.concat(t).concat(n),s=a.xv();a.zd(s,1),a.Gu(s,h.X3(i,r)),C(this,a.Fo(s))},this._exitHandler=()=>{h._g(this.awareness,[n.clientID],"app closed")},f.Ll&&void 0!==g&&g.on("exit",this._exitHandler),i.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&3e4<r._g()-this.wsLastMessageReceived&&k(this,this.ws,null)},3e3),s&&this.connect()}get url(){const e=v.V(this.params);return this.serverUrl+"/"+this.roomname+(0===e.length?"":"?"+e)}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),f.Ll&&void 0!==g&&g.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(o.B1(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);const e=a.xv();a.zd(e,0),l(e,this.doc),o.mk(this.bcChannel,a.Fo(e),this);const t=a.xv();a.zd(t,0),c(t,this.doc),o.mk(this.bcChannel,a.Fo(t),this);const n=a.xv();a.zd(n,3),o.mk(this.bcChannel,a.Fo(n),this);const r=a.xv();a.zd(r,1),a.Gu(r,h.X3(this.awareness,[this.doc.clientID])),o.mk(this.bcChannel,a.Fo(r),this)}disconnectBc(){const e=a.xv();a.zd(e,1),a.Gu(e,h.X3(this.awareness,[this.doc.clientID],new Map)),C(this,a.Fo(e)),this.bcconnected&&(o.al(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&k(this,this.ws,null)}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(x(this),this.connectBc())}}var T,A=n(63711),V=n(72490);!function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Error="error"}(T||(T={}));class I{type="datalayer";_status=T.Disconnected;_provider=null;_sharedModel=null;_statusChanged=new V.Signal(this);_errorOccurred=new V.Signal(this);_syncStateChanged=new V.Signal(this);_isDisposed=!1;_config;_onSync=null;_onConnectionClose=null;constructor(e){this._config=e}get status(){return this._status}get isConnected(){return this._status===T.Connected}get isDisposed(){return this._isDisposed}get events(){return{statusChanged:this._statusChanged,errorOccurred:this._errorOccurred,syncStateChanged:this._syncStateChanged}}setStatus(e){this._status!==e&&(this._status=e,this._statusChanged.emit(e))}async connect(e,t,n){if(this.isConnected)console.warn("Already connected to Datalayer collaboration service");else{this.setStatus(T.Connecting);try{const o=this._config.runUrl,r=this._config.token;if(!o)throw new Error("Datalayer runUrl is not configured - must be explicitly provided in DatalayerCollaborationProvider config");if(!r)throw new Error("Datalayer token is not configured - must be explicitly provided in DatalayerCollaborationProvider config");const{ydoc:a,awareness:s}=e,i=A.URLExt.join(o,"/api/spacer/v1/documents"),l=A.URLExt.join(o,"/api/spacer/v1/documents/ws").replace(/^http/,"ws"),c=await async function({url:e,token:t,fetchFn:n=fetch}){const o={Accept:"application/json"};t&&(o.Authorization=`Bearer ${t}`);const r=await n(e,{method:"GET",headers:o,credentials:t?"include":"omit",mode:"cors",cache:"no-store"});if(r.ok)return(await r.json()).sessionId;throw console.error("Failed to fetch session ID.",r),new Error("Failed to fetch session ID.")}({url:A.URLExt.join(i,t),token:r,fetchFn:this._config.fetchFn});this._provider=new S(l,t,a,{disableBc:!0,params:{sessionId:c,token:r},awareness:s,...n}),this._sharedModel=e,this._onSync=e=>{this.handleSync(e)},this._onConnectionClose=e=>{e&&this.handleConnectionClose(e)},this._provider.on("sync",this._onSync),this._provider.on("connection-close",this._onConnectionClose),console.log("Connected to Datalayer collaboration service")}catch(e){throw this.setStatus(T.Error),this._errorOccurred.emit(e),e}}}disconnect(){this._provider&&(this._onSync&&this._provider.off("sync",this._onSync),this._onConnectionClose&&this._provider.off("connection-close",this._onConnectionClose),this._provider.disconnect(),this._provider=null),this._sharedModel=null,this.setStatus(T.Disconnected)}getProvider(){return this._provider}getSharedModel(){return this._sharedModel}handleConnectionClose(e){console.warn("Collaboration connection closed:",e),this.setStatus(T.Disconnected),4002===e.code&&console.warn("Datalayer collaboration session expired")}handleSync(e){this._syncStateChanged.emit(e),e&&this.setStatus(T.Connected)}dispose(){this._isDisposed||(this.disconnect(),this._isDisposed=!0)}}},21606:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(52908),r=n.n(o),a=n(10293),s=n.n(a)()(r());s.push([e.id,'.prc-TreeView-TreeViewRootUlStyles-eZtxW{list-style:none;margin:0;padding:0}.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItem-ShJr0{outline:none}:is(.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItem-ShJr0):focus-visible>div,:is(.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItem-ShJr0).focus-visible>div{box-shadow:var(--boxShadow-thick,inset 0 0 0 .125rem) var(--fgColor-accent,var(--color-accent-fg))}@media (forced-colors:active){:is(.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItem-ShJr0):focus-visible>div,:is(.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItem-ShJr0).focus-visible>div{outline:2px solid HighlightText;outline-offset:-2}}[data-has-leading-action]:is(.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItem-ShJr0){--has-leading-action:1}.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemContainer--2Rkn{--level:1;--toggle-width:1rem;--min-item-height:2rem;border-radius:var(--borderRadius-medium,.375rem);color:var(--fgColor-default,var(--color-fg-default));cursor:pointer;display:grid;font-size:var(--text-body-size-medium,.875rem);grid-template-areas:"spacer leadingAction toggle content";grid-template-columns:var(--spacer-width) var(--leading-action-width) var(--toggle-width) 1fr;position:relative;width:100%;--leading-action-width:calc(var(--has-leading-action, 0)*1.5rem);--spacer-width:calc((var(--level) - 1)*(var(--toggle-width)/2))}:is(.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemContainer--2Rkn):hover{background-color:var(--control-transparent-bgColor-hover,var(--color-action-list-item-default-hover-bg))}@media (forced-colors:active){:is(.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemContainer--2Rkn):hover{outline:2px solid transparent;outline-offset:-2px}}@media (pointer:coarse){.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemContainer--2Rkn{--toggle-width:1.5rem;--min-item-height:2.75rem}}:is(.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemContainer--2Rkn):has(.prc-TreeView-TreeViewItemSkeleton-fqk59):hover{background-color:transparent;cursor:default}@media (forced-colors:active){:is(.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemContainer--2Rkn):has(.prc-TreeView-TreeViewItemSkeleton-fqk59):hover{outline:none}}.prc-TreeView-TreeViewRootUlStyles-eZtxW:where([data-omit-spacer=true]) .prc-TreeView-TreeViewItemContainer--2Rkn{grid-template-columns:0 0 0 1fr}.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItem-ShJr0[aria-current=true]>.prc-TreeView-TreeViewItemContainer--2Rkn{background-color:var(--control-transparent-bgColor-selected,var(--color-action-list-item-default-selected-bg))}:is(.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItem-ShJr0[aria-current=true]>.prc-TreeView-TreeViewItemContainer--2Rkn):after{background-color:var(--fgColor-accent,var(--color-accent-fg));border-radius:var(--borderRadius-medium,.375rem);content:"";height:1.5rem;left:calc(var(--base-size-8,.5rem)*-1);position:absolute;top:calc(50% - var(--base-size-12,.75rem));width:.25rem}@media (forced-colors:active){:is(.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItem-ShJr0[aria-current=true]>.prc-TreeView-TreeViewItemContainer--2Rkn):after{background-color:HighlightText}}.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemToggle-gWUdE{align-items:flex-start;color:var(--fgColor-muted,var(--color-fg-muted));display:flex;grid-area:toggle;height:100%;justify-content:center;padding-top:calc(var(--min-item-height)/2 - var(--base-size-12,.75rem)/2)}.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemToggleHover-nEgP-:hover{background-color:var(--control-transparent-bgColor-hover,var(--color-action-list-item-default-hover-bg))}.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemToggleEnd-t-AEB{border-bottom-left-radius:var(--borderRadius-medium,.375rem);border-top-left-radius:var(--borderRadius-medium,.375rem)}.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemContent-f0r0b{display:flex;gap:var(--stack-gap-condensed,.5rem);grid-area:content;height:100%;line-height:var(--custom-line-height,var(--text-body-lineHeight-medium,1.4285));padding:0 var(--base-size-8,.5rem);padding-bottom:calc((var(--min-item-height) - var(--custom-line-height, 1.3rem))/2);padding-top:calc((var(--min-item-height) - var(--custom-line-height, 1.3rem))/2)}.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemContentText-smZM-{flex:1 1 auto;width:0}.prc-TreeView-TreeViewRootUlStyles-eZtxW:where([data-truncate-text=true]) .prc-TreeView-TreeViewItemContentText-smZM-{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.prc-TreeView-TreeViewRootUlStyles-eZtxW:where([data-truncate-text=false]) .prc-TreeView-TreeViewItemContentText-smZM-{word-break:break-word}.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemVisual-dRlGq{align-items:center;color:var(--fgColor-muted,var(--color-fg-muted));display:flex;height:var(--custom-line-height,1.3rem)}.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemLeadingAction-VXx8I{color:var(--fgColor-muted,var(--color-fg-muted));display:flex;grid-area:leadingAction}:is(.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemLeadingAction-VXx8I)>button{flex-shrink:1}.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemLevelLine-KPSSL{border-color:var(--borderColor-muted,var(--color-border-muted));border-right:var(--borderWidth-thin,.0625rem) solid;height:100%;width:100%}@media (hover:hover){.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewItemLevelLine-KPSSL{border-color:transparent}.prc-TreeView-TreeViewRootUlStyles-eZtxW:focus-within .prc-TreeView-TreeViewItemLevelLine-KPSSL,.prc-TreeView-TreeViewRootUlStyles-eZtxW:hover .prc-TreeView-TreeViewItemLevelLine-KPSSL{border-color:var(--borderColor-muted,var(--color-border-muted))}}.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewDirectoryIcon-PHbeP{color:var(--treeViewItem-leadingVisual-iconColor-rest,var(--color-tree-view-item-directory-fill));display:grid}.prc-TreeView-TreeViewRootUlStyles-eZtxW .prc-TreeView-TreeViewVisuallyHidden-4-mPv{height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;clip:rect(0,0,0,0);border-width:0;white-space:nowrap}.prc-TreeView-TreeViewSkeletonItemContainerStyle-EB7p0{align-items:center;column-gap:.5rem;display:flex;height:2rem}@media (pointer:coarse){.prc-TreeView-TreeViewSkeletonItemContainerStyle-EB7p0{height:2.75rem}}.prc-TreeView-TreeViewSkeletonItemContainerStyle-EB7p0:nth-of-type(5n+1){--tree-item-loading-width:67%}.prc-TreeView-TreeViewSkeletonItemContainerStyle-EB7p0:nth-of-type(5n+2){--tree-item-loading-width:47%}.prc-TreeView-TreeViewSkeletonItemContainerStyle-EB7p0:nth-of-type(5n+3){--tree-item-loading-width:73%}.prc-TreeView-TreeViewSkeletonItemContainerStyle-EB7p0:nth-of-type(5n+4){--tree-item-loading-width:64%}.prc-TreeView-TreeViewSkeletonItemContainerStyle-EB7p0:nth-of-type(5n+5){--tree-item-loading-width:50%}.prc-TreeView-TreeItemSkeletonTextStyles-wnBY9{width:var(--tree-item-loading-width,67%)}',""]);const i=s},27446:(e,t,n)=>{n.d(t,{R:()=>i});var o=n(18683),r=n(99251),a=n(38621),s=n(18316);const i=({data:e,fileName:t,variant:n="default",extension:i="json"})=>(0,o.jsx)(r.Q,{variant:n,leadingVisual:a.s3U,onClick:n=>(0,s.xD)(e,t,i),children:"Download"})},32916:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(9387);const r={small:16,medium:32,large:64};function a({title:e,titleId:t,size:n,colored:a,...s},i){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:a?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor",fillRule:"evenodd",style:{width:n?"string"==typeof n?r[n]:n:"16px",flex:"none",lineHeight:1},viewBox:"0 0 24 24","aria-hidden":"true",ref:i,"aria-labelledby":t},s),e?o.createElement("title",{id:t},e):null,o.createElement("path",{d:"M15.688 2.343a2.588 2.588 0 00-3.61 0l-9.626 9.44a.863.863 0 01-1.203 0 .823.823 0 010-1.18l9.626-9.44a4.313 4.313 0 016.016 0 4.116 4.116 0 011.204 3.54 4.3 4.3 0 013.609 1.18l.05.05a4.115 4.115 0 010 5.9l-8.706 8.537a.274.274 0 000 .393l1.788 1.754a.823.823 0 010 1.18.863.863 0 01-1.203 0l-1.788-1.753a1.92 1.92 0 010-2.754l8.706-8.538a2.47 2.47 0 000-3.54l-.05-.049a2.588 2.588 0 00-3.607-.003l-7.172 7.034-.002.002-.098.097a.863.863 0 01-1.204 0 .823.823 0 010-1.18l7.273-7.133a2.47 2.47 0 00-.003-3.537z"}),o.createElement("path",{d:"M14.485 4.703a.823.823 0 000-1.18.863.863 0 00-1.204 0l-7.119 6.982a4.115 4.115 0 000 5.9 4.314 4.314 0 006.016 0l7.12-6.982a.823.823 0 000-1.18.863.863 0 00-1.204 0l-7.119 6.982a2.588 2.588 0 01-3.61 0 2.47 2.47 0 010-3.54l7.12-6.982z"}))}const s=o.forwardRef(a)},35903:(e,t,n)=>{n.d(t,{Gr:()=>s});var o=n(97283),r=n(7282);const a=(0,o.y)((e,t)=>({datasources:[],updateDatasources:t=>e(e=>({datasources:t}))}));function s(e){return(0,r.Pj)(a,e)}},45077:(e,t,n)=>{n.d(t,{O:()=>r});var o=n(18683);const r=e=>{const{code:t}=e;return(0,o.jsx)("pre",{style:{fontSize:"12px",wordBreak:"break-all",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:t})}},56944:(e,t,n)=>{n.d(t,{w:()=>s});var o=n(63711),r=n(9570),a=n(76199);const s=(e="api/ai-agents/v1")=>{const{configuration:t}=(0,r._O)(),{requestDatalayer:n}=(0,a.F)({notifyOnError:!1});return{createAIAgent:(r,a,s,i,l,{signal:c,baseUrl:d=e}={})=>n({url:o.URLExt.join(t.aiagentsRunUrl,d,"agents"),method:"POST",body:{document_id:r,document_type:a,runtime:{ingress:s,token:i,kernel_id:l}},signal:c}),getAIAgents:({signal:r,baseUrl:a=e}={})=>n({url:o.URLExt.join(t.aiagentsRunUrl,a,"agents"),method:"GET",signal:r}),deleteAIAgent:(r,{signal:a,baseUrl:s=e}={})=>n({url:o.URLExt.join(t.aiagentsRunUrl,s,"agents",r),method:"DELETE",signal:a}),getAIAgent:(r,{signal:a,baseUrl:s=e}={})=>n({url:o.URLExt.join(t.aiagentsRunUrl,s,"agents",r),method:"GET",signal:a}),patchAIAgent:(r,a,s,i,{signal:l,baseUrl:c=e}={})=>n({url:o.URLExt.join(t.aiagentsRunUrl,c,"agents",r),method:"PATCH",body:{runtime:a&&s&&i?{ingress:a,token:s,kernel_id:i}:null},signal:l})}}},66210:(e,t,n)=>{n.d(t,{G:()=>s});var o=n(9387),r=n(10069),a=n(56944);function s(e){const{getAIAgent:t}=(0,a.w)(),{aiAgents:n,addAIAgent:s,deleteAIAgent:i,updateAIAgent:l}=(0,r.Ks)();return(0,o.useEffect)(()=>{let o;const r=setInterval(async()=>{o=new AbortController;try{const r=await t(e,{signal:o.signal});if(!r.success)return void i(e);const a=n.find(t=>t.documentId===e),c=r.agent.runtime?.id;a?a.runtimeId!==c&&l(e,c):s({documentId:e,runtimeId:c})}catch(t){i(e)}},6e4);return()=>{o?.abort("Component unmounted"),clearInterval(r)}},[n,e]),n.find(t=>t.documentId===e)}},75345:(e,t,n)=>{n.d(t,{E:()=>l});var o=n(18683),r=n(71791),a=n(99251),s=n(38621),i=n(9387);function l(e){const{commandRegistry:t,runtimeDesc:n,sessionConnection:l}=e,[c,d]=(0,i.useState)();return(0,i.useEffect)(()=>{const e=()=>{d(l?.kernel?.status)};return e(),l?.statusChanged.connect(e),l?.connectionStatusChanged.connect(e),()=>{l?.statusChanged.disconnect(e),l?.connectionStatusChanged.disconnect(e)}},[l]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.Q,{variant:"invisible",size:"small",leadingVisual:s.udU,disabled:!n?.location||"busy"===c,onClick:e=>t?.execute(r.nx.runAll),children:"Run all"}),(0,o.jsx)(a.Q,{variant:"invisible",size:"small",leadingVisual:s.wFz,disabled:!n?.location||"busy"!==c,onClick:e=>t?.execute(r.nx.interrupt),children:"Interrupt"})]})}},75860:(e,t,n)=>{n.d(t,{k:()=>ke});var o=n(18683),r=n(9387),a=n(22462),s=n(9448),i=n(90117),l=n(1290),c=n(37706),d=n(62097),u=n(89492),h=n(71784),p=n(77128),m=n(44623),v=n(85181),f=n(63711),g=n(14377),w=n(47501),y=n(83303),b=n(7384),k=n(30574),x=n(14738),C=n(29028),S=n(47798),T=n(39756),A=n(11796),V=n(70639),I=n(89915),_=n(53054),E=n(75987),j=n(38921),N=n(16950),R=n(79246),P=n(72490),z=n(14809),M=n(4537),L=n(20137),D=n(45458),$=n(89462),F=n(66698),U=n(17402),B=n(66087),H=n(98238),W=n(9366);const O=B.sj.define({combine:e=>e[e.length-1]}),K=L.Lz.baseTheme({".jp-remote-cursor":{borderLeft:"1px solid black",marginLeft:"-1px"},".jp-remote-cursor.jp-mod-primary":{borderLeftWidth:"2px"},".jp-remote-selection":{opacity:.5},".cm-tooltip":{border:"none"},".cm-tooltip.jp-remote-userInfo":{color:"var(--jp-ui-inverse-font-color0)",padding:"0px 2px"}}),q=B.YH.define();class Z{style;marker;constructor(e,t){this.style=e,this.marker=t}draw(){const e=this.marker.draw();for(const[t,n]of Object.entries(this.style))e.style[t]=n;return e}eq(e){return this.marker.eq(e.marker)&&H.JSONExt.deepEqual(this.style,e.style)}update(e,t){for(const[t,n]of Object.entries(this.style))e.style[t]=n;return this.marker.update(e,t.marker)}}const J=(0,L.qd)({above:!0,markers(e){const{awareness:t,ytext:n}=e.state.facet(O),o=n.doc,r=[];return t.getStates().forEach((a,s)=>{if(s===t.doc.clientID)return;const i=a.cursors;for(const t of i??[]){if(!t?.anchor||!t?.head)return;const s=(0,W.IT)(t.anchor,o),i=(0,W.IT)(t.head,o);if(s?.type!==n||i?.type!==n)return;const l=t.primary??1?"jp-remote-cursor jp-mod-primary":"jp-remote-cursor",c=B.OF.cursor(i.index,i.index>s.index?-1:1);for(const t of L.Ip.forRange(e,l,c))r.push(new Z({borderLeftColor:a.user?.color??"black"},t))}}),r},update:(e,t)=>!!e.transactions.find(e=>e.annotation(q)),class:"jp-remote-cursors"});function G(e){const t=new Array,{awareness:n,ytext:o}=e.facet(O),r=o.doc;for(const[e,a]of n.getStates())if(e!==n.doc.clientID)for(const e of a.cursors??[]){if(!e?.head)continue;const n=(0,W.IT)(e.head,r);n?.type===o&&t.push({pos:n.index,above:!0,create:()=>{const e=document.createElement("div");return e.classList.add("jp-remote-userInfo"),e.style.backgroundColor=a.user?.color??"darkgrey",e.textContent=a.user?.display_name??"Anonymous",{dom:e}}})}return t}const X=B.sU.define({create:G,update:(e,t)=>t.annotation(q)?G(t.state):e,provide:e=>L.DK.computeN([e],t=>t.field(e))}),Y=(0,L.qd)({above:!1,markers(e){const{awareness:t,ytext:n}=e.state.facet(O),o=n.doc,r=[];return t.getStates().forEach((a,s)=>{if(s===t.doc.clientID)return;const i=a.cursors;for(const t of i??[]){if((t.empty??1)||!t?.anchor||!t?.head)return;const s=(0,W.IT)(t.anchor,o),i=(0,W.IT)(t.head,o);if(s?.type!==n||i?.type!==n)return;const l="jp-remote-selection";for(const t of L.Ip.forRange(e,l,B.OF.range(s.index,i.index)))r.push(new Z({backgroundColor:a.user?.color??"black"},t))}}),r},update:(e,t)=>!!e.transactions.find(e=>e.annotation(q)),class:"jp-remote-selections"}),Q=L.Z9.fromClass(class{editorAwareness;_listener;constructor(e){this.editorAwareness=e.state.facet(O),this._listener=({added:t,updated:n,removed:o})=>{t.concat(n).concat(o).findIndex(e=>e!==this.editorAwareness.awareness.doc.clientID)>=0&&e.dispatch({annotations:[q.of([])]})},this.editorAwareness.awareness.on("change",this._listener)}destroy(){this.editorAwareness.awareness.off("change",this._listener)}update(e){if(!e.docChanged&&!e.selectionSet)return;const{awareness:t,ytext:n}=this.editorAwareness,o=t.getLocalState();if(o){const r=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),a=e.state.selection,s=new Array;if(r&&a){for(const e of a.ranges){const t=e===a.main,o=(0,W.SF)(n,e.anchor),r=(0,W.SF)(n,e.head);s.push({anchor:o,head:r,primary:t,empty:e.empty})}if(!o.cursors||s.length>0){const e=o.cursors?.map(e=>({...e,anchor:e?.anchor?(0,W.sH)(e.anchor):null,head:e?.head?(0,W.sH)(e.head):null}));H.JSONExt.deepEqual(s,e)||t.setLocalStateField("cursors",s)}}}}},{provide:()=>[K,J,Y,X,(0,L.vX)({position:"absolute",parent:document.body})]});var ee=n(50059),te=n(71791),ne=n(51671);class oe{diff(e,t,n={}){let o;"function"==typeof n?(o=n,n={}):"callback"in n&&(o=n.callback);const r=this.castInput(e,n),a=this.castInput(t,n),s=this.removeEmpty(this.tokenize(r,n)),i=this.removeEmpty(this.tokenize(a,n));return this.diffWithOptionsObj(s,i,n,o)}diffWithOptionsObj(e,t,n,o){var r;const a=e=>(e=this.postProcess(e,n),o?void setTimeout(function(){o(e)},0):e),s=t.length,i=e.length;let l=1,c=s+i;null!=n.maxEditLength&&(c=Math.min(c,n.maxEditLength));const d=null!==(r=n.timeout)&&void 0!==r?r:1/0,u=Date.now()+d,h=[{oldPos:-1,lastComponent:void 0}];let p=this.extractCommon(h[0],t,e,0,n);if(h[0].oldPos+1>=i&&p+1>=s)return a(this.buildValues(h[0].lastComponent,t,e));let m=-1/0,v=1/0;const f=()=>{for(let o=Math.max(m,-l);o<=Math.min(v,l);o+=2){let r;const l=h[o-1],c=h[o+1];l&&(h[o-1]=void 0);let d=!1;if(c){const e=c.oldPos-o;d=c&&0<=e&&e<s}const u=l&&l.oldPos+1<i;if(d||u){if(r=!u||d&&l.oldPos<c.oldPos?this.addToPath(c,!0,!1,0,n):this.addToPath(l,!1,!0,1,n),p=this.extractCommon(r,t,e,o,n),r.oldPos+1>=i&&p+1>=s)return a(this.buildValues(r.lastComponent,t,e))||!0;h[o]=r,r.oldPos+1>=i&&(v=Math.min(v,o-1)),p+1>=s&&(m=Math.max(m,o+1))}else h[o]=void 0}l++};if(o)!function e(){setTimeout(function(){if(l>c||Date.now()>u)return o(void 0);f()||e()},0)}();else for(;l<=c&&Date.now()<=u;){const e=f();if(e)return e}}addToPath(e,t,n,o,r){const a=e.lastComponent;return a&&!r.oneChangePerToken&&a.added===t&&a.removed===n?{oldPos:e.oldPos+o,lastComponent:{count:a.count+1,added:t,removed:n,previousComponent:a.previousComponent}}:{oldPos:e.oldPos+o,lastComponent:{count:1,added:t,removed:n,previousComponent:a}}}extractCommon(e,t,n,o,r){const a=t.length,s=n.length;let i=e.oldPos,l=i-o,c=0;for(;l+1<a&&i+1<s&&this.equals(n[i+1],t[l+1],r);)l++,i++,c++,r.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return c&&!r.oneChangePerToken&&(e.lastComponent={count:c,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=i,l}equals(e,t,n){return n.comparator?n.comparator(e,t):e===t||!!n.ignoreCase&&e.toLowerCase()===t.toLowerCase()}removeEmpty(e){const t=[];for(let n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}castInput(e,t){return e}tokenize(e,t){return Array.from(e)}join(e){return e.join("")}postProcess(e,t){return e}get useLongestToken(){return!1}buildValues(e,t,n){const o=[];let r;for(;e;)o.push(e),r=e.previousComponent,delete e.previousComponent,e=r;o.reverse();const a=o.length;let s=0,i=0,l=0;for(;s<a;s++){const e=o[s];if(e.removed)e.value=this.join(n.slice(l,l+e.count)),l+=e.count;else{if(!e.added&&this.useLongestToken){let o=t.slice(i,i+e.count);o=o.map(function(e,t){const o=n[l+t];return o.length>e.length?o:e}),e.value=this.join(o)}else e.value=this.join(t.slice(i,i+e.count));i+=e.count,e.added||(l+=e.count)}}return o}}const re=new class extends oe{constructor(){super(...arguments),this.tokenize=se}equals(e,t,n){return n.ignoreWhitespace?(n.newlineIsToken&&e.includes("\n")||(e=e.trim()),n.newlineIsToken&&t.includes("\n")||(t=t.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(e.endsWith("\n")&&(e=e.slice(0,-1)),t.endsWith("\n")&&(t=t.slice(0,-1))),super.equals(e,t,n)}};function ae(e,t,n){return re.diff(e,t,n)}function se(e,t){t.stripTrailingCr&&(e=e.replace(/\r\n/g,"\n"));const n=[],o=e.split(/(\n|\r\n)/);o[o.length-1]||o.pop();for(let e=0;e<o.length;e++){const r=o[e];e%2&&!t.newlineIsToken?n[n.length-1]+=r:n.push(r)}return n}function ie(e,t,n,o,r,a,s){let i;i=s?"function"==typeof s?{callback:s}:s:{},void 0===i.context&&(i.context=4);const l=i.context;if(i.newlineIsToken)throw new Error("newlineIsToken may not be used with patch-generation functions, only with diffing functions");if(!i.callback)return c(ae(n,o,i));{const{callback:e}=i;ae(n,o,Object.assign(Object.assign({},i),{callback:t=>{const n=c(t);e(n)}}))}function c(n){if(!n)return;function o(e){return e.map(function(e){return" "+e})}n.push({value:"",lines:[]});const s=[];let i=0,c=0,d=[],u=1,h=1;for(let e=0;e<n.length;e++){const t=n[e],r=t.lines||ce(t.value);if(t.lines=r,t.added||t.removed){if(!i){const t=n[e-1];i=u,c=h,t&&(d=l>0?o(t.lines.slice(-l)):[],i-=d.length,c-=d.length)}for(const e of r)d.push((t.added?"+":"-")+e);t.added?h+=r.length:u+=r.length}else{if(i)if(r.length<=2*l&&e<n.length-2)for(const e of o(r))d.push(e);else{const e=Math.min(r.length,l);for(const t of o(r.slice(0,e)))d.push(t);const t={oldStart:i,oldLines:u-i+e,newStart:c,newLines:h-c+e,lines:d};s.push(t),i=0,c=0,d=[]}u+=r.length,h+=r.length}}for(const e of s)for(let t=0;t<e.lines.length;t++)e.lines[t].endsWith("\n")?e.lines[t]=e.lines[t].slice(0,-1):(e.lines.splice(t+1,0,"\\ No newline at end of file"),t++);return{oldFileName:e,newFileName:t,oldHeader:r,newHeader:a,hunks:s}}}function le(e){if(Array.isArray(e))return e.map(le).join("\n");const t=[];e.oldFileName==e.newFileName&&t.push("Index: "+e.oldFileName),t.push("==================================================================="),t.push("--- "+e.oldFileName+(void 0===e.oldHeader?"":"\t"+e.oldHeader)),t.push("+++ "+e.newFileName+(void 0===e.newHeader?"":"\t"+e.newHeader));for(let n=0;n<e.hunks.length;n++){const o=e.hunks[n];0===o.oldLines&&(o.oldStart-=1),0===o.newLines&&(o.newStart-=1),t.push("@@ -"+o.oldStart+","+o.oldLines+" +"+o.newStart+","+o.newLines+" @@");for(const e of o.lines)t.push(e)}return t.join("\n")+"\n"}function ce(e){const t=e.endsWith("\n"),n=e.split("\n").map(e=>e+"\n");return t?n.pop():n.push(n.pop().slice(0,-1)),n}class de{_commands;_panel;_notebook;_context;_defaultCellType="code";constructor(e,t,n){this._commands=e,this._panel=t,this._notebook=t.content,this._context=n}get commands(){return this._commands}get panel(){return this._panel}get notebook(){return this._notebook}get context(){return this._context}setDefaultCellType(e){this._defaultCellType=e}get defaultCellType(){return this._defaultCellType}insertAbove(e){const t=this._notebook;ne.Ft.insertAbove(t),ne.Ft.changeCellType(t,this._defaultCellType),e&&t.activeCell&&t.activeCell.model.sharedModel.setSource(e),t.mode="edit"}insertBelow(e){const t=this._notebook;ne.Ft.insertBelow(t),ne.Ft.changeCellType(t,this._defaultCellType),e&&t.activeCell&&t.activeCell.model.sharedModel.setSource(e),t.mode="edit"}changeCellType(e){const t=this._notebook;t.activeCell&&t.activeCell.model.type!==e&&ne.Ft.changeCellType(t,e)}deleteCells(){const e=this._notebook;ne.Ft.deleteCells(e)}get model(){return this._context.model}undo(){const e=this._notebook;if("edit"===e.mode&&e.activeCell?.editor){const t=e.activeCell.editor;if(t&&"function"==typeof t.undo)return void t.undo()}ne.Ft.undo(e)}redo(){const e=this._notebook;if("edit"===e.mode&&e.activeCell?.editor){const t=e.activeCell.editor;if(t&&"function"==typeof t.redo)return void t.redo()}ne.Ft.redo(e)}setActiveCell(e){const t=this._notebook,n=t.model?.cells.length??0;e>=0&&e<n&&(t.activeCellIndex=e)}getCells(){console.log("[Notebook2Adapter.getCells] Called");const e=this._notebook.model?.cells;if(!e)return console.log("[Notebook2Adapter.getCells] No cells model, returning empty array"),[];console.log(`[Notebook2Adapter.getCells] Found ${e.length} cells`);const t=[];for(let n=0;n<e.length;n++){const o=e.get(n);if(o){const e={index:n,type:o.type,source:o.sharedModel.getSource(),outputs:"code"===o.type?o.outputs?.toJSON():void 0};console.log(`[Notebook2Adapter.getCells] Cell ${n}:`,{type:e.type,sourceLength:e.source.length}),t.push(e)}}return console.log(`[Notebook2Adapter.getCells] Returning ${t.length} cells`),t}readAllCells(e="brief"){return this.getCells().map((t,n)=>{const o=this._notebook.model?.cells.get(n),r="code"===o?.type?o.executionCount??null:null;return"brief"===e?{index:n,type:t.type,preview:t.source.substring(0,40)}:{index:n,type:t.type,source:t.source,execution_count:r,outputs:t.outputs}})}getCellCount(){return this._notebook.model?.cells.length??0}insertAt(e,t){const n=this.getCellCount();if(console.log("[Notebook2Adapter.insertAt] Called with:",{cellIndex:e,sourceLength:t?.length||0,sourcePreview:t?.substring(0,50),currentActiveCell:this._notebook.activeCellIndex,cellCount:n,defaultCellType:this._defaultCellType}),e<-1||e>n)throw new Error(`Index ${e} is outside valid range [-1, ${n}]. Use -1 to append at end.`);const o=-1===e?n:e;console.log("[Notebook2Adapter.insertAt] Normalized index:",{originalIndex:e,actualIndex:o,cellCount:n}),o>=n?(console.log("[Notebook2Adapter.insertAt] Appending at end"),n>0&&this.setActiveCell(n-1),this.insertBelow(t)):(console.log(`[Notebook2Adapter.insertAt] Inserting at index ${o}`),this.setActiveCell(o),this.insertAbove(t)),console.log("[Notebook2Adapter.insertAt] After insertion:",{cellCount:this.getCellCount(),activeCell:this._notebook.activeCellIndex})}insertCell(e,t,n){this.setDefaultCellType(e);const o=t??this.getCellCount();this.insertAt(o,n)}insertCells(e,t){let n=t;for(const t of e)this.setDefaultCellType(t.type),this.insertAt(n,t.source),n++}deleteCell(e){const t=this._notebook.model?.cells,n=t?.length??0;if(void 0!==e){const t=Array.isArray(e)?e:[e];for(const e of t)if(e<0||e>=n)throw console.error(`[Notebook2Adapter.deleteCell] Index ${e} is out of range (cell count: ${n})`),new Error(`Cell index ${e} is out of range. Notebook has ${n} cells.`);const o=[...t].sort((e,t)=>t-e);console.log(`[Notebook2Adapter.deleteCell] Deleting ${o.length} cell(s) in reverse order:`,o);for(const e of o)this.setActiveCell(e),this.deleteCells()}else{if(!this._notebook.activeCell)return void console.warn("[Notebook2Adapter.deleteCell] No active cell to delete");this.deleteCells()}}updateCell(e,t){const n=this._notebook.model?.sharedModel.cells.length??0;if(e<0||e>=n)throw new Error(`Cell index ${e} is out of range. Notebook has ${n} cells.`);const o=this._notebook.model?.cells.get(e);if(!o)throw new Error(`Cell at index ${e} not found.`);const r=o.sharedModel.getSource();return o.sharedModel.setSource(t),function(e,t,n,o,r,a,s){if("function"==typeof s&&(s={callback:s}),!(null==s?void 0:s.callback)){const i=ie(e,t,n,o,r,a,s);if(!i)return;return le(i)}{const{callback:i}=s;ie(e,t,n,o,r,a,Object.assign(Object.assign({},s),{callback:e=>{i(e?le(e):void 0)}}))}}(a=`cell_${e}`,a,r,t,"before","after",{context:3});var a}getCell(e,t=!0){if(void 0!==e){const n=this.getCells()[e];if(!n)return;const o=this._notebook.model?.cells.get(e),r="code"===o?.type?o.executionCount??null:null;return{type:n.type,source:n.source,execution_count:r,outputs:t?n.outputs:void 0}}{const e=this._notebook.activeCell;if(!e)return;const n="code"===e.model.type?e.model.executionCount??null:null;return{type:e.model.type,source:e.model.sharedModel.getSource(),execution_count:n,outputs:t&&"code"===e.model.type?e.model.outputs?.toJSON():void 0}}}async runCell(e){const{index:t}=e||{};void 0!==t&&this.setActiveCell(t);const n=t??this._notebook.activeCellIndex;if(-1===n)throw new Error("No active cell to execute");await ne.Ft.run(this._notebook,this._context.sessionContext),await new Promise(e=>setTimeout(e,100));const o=this.getCell(n,!0);if(!o)return{execution_count:null,outputs:[]};const r=[];if(o.outputs&&Array.isArray(o.outputs))for(const e of o.outputs)if("string"==typeof e)r.push(e);else if(e&&"object"==typeof e){const t=e;if("stream"===t.output_type){const e=t.text;"string"==typeof e?r.push(e):Array.isArray(e)&&r.push(e.join(""))}else if("execute_result"===t.output_type||"display_data"===t.output_type){const e=t.data;if(e&&e["text/plain"]){const t=e["text/plain"];"string"==typeof t?r.push(t):Array.isArray(t)&&r.push(t.join(""))}}else if("error"===t.output_type){const e=t.ename??"Error",n=t.evalue??"",o=t.traceback;Array.isArray(o)&&o.length>0?r.push(`[ERROR: ${e}: ${n}]\n${o.join("\n")}`):r.push(`[ERROR: ${e}: ${n}]`)}}return{execution_count:o.execution_count,outputs:r}}runAllCells(){this._commands.execute(te.nx.runAll)}async executeCode(e,t={}){const n=this._panel.sessionContext;if(!n||!n.session?.kernel)return{success:!1,error:"No active kernel session"};const o=n.session.kernel;try{const n=o.requestExecute({code:e,stop_on_error:!0,store_history:!1,silent:!1,allow_stdin:!1}),r=[];let a;n.onIOPub=e=>{const t=e.header.msg_type;"stream"===t?r.push({type:"stream",content:e.content}):"execute_result"===t?(r.push({type:"execute_result",content:e.content}),a=e.content.execution_count):"display_data"===t?r.push({type:"display_data",content:e.content}):"error"===t&&r.push({type:"error",content:e.content})};const s=1e3*(t.timeout??30),i=n.done,l=new Promise((e,n)=>{setTimeout(()=>{n(new Error(`Execution timeout after ${t.timeout??30} seconds`))},s)});try{await Promise.race([i,l])}catch(e){try{await o.interrupt()}catch(e){console.error("Failed to interrupt kernel:",e)}return{success:!1,error:`Execution exceeded ${t.timeout??30} seconds and was interrupted`,outputs:r}}return{success:!0,outputs:r,executionCount:a}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}dispose(){}}const ue=(0,n(97283).y)((e,t)=>({notebooks:new Map,setNotebooks2:t=>e(e=>({notebooks:t})),selectNotebook2:e=>t().notebooks.get(e),selectNotebookAdapter2:e=>{const n=t().notebooks.get(e);if(n)return n.adapter},insertCell:(e,n,o,r)=>{const a="object"==typeof e?e:{id:e,type:n,index:o,source:r};t().notebooks.get(a.id)?.adapter?.insertCell(a.type,a.index,a.source)},insertCells:(e,n,o)=>{const r="object"==typeof e?e:{id:e,cells:n,index:o};t().notebooks.get(r.id)?.adapter?.insertCells(r.cells,r.index)},deleteCell:(e,n)=>{const o="object"==typeof e?e:{id:e,index:n};t().notebooks.get(o.id)?.adapter?.deleteCell(o.index)},updateCell:(e,n,o)=>{const r="object"==typeof e?e:{id:e,index:n,source:o};t().notebooks.get(r.id)?.adapter?.updateCell(r.index,r.source)},readCell:(e,n,o)=>{const r="object"==typeof e?e:{id:e,index:n,includeOutputs:o};return t().notebooks.get(r.id)?.adapter?.getCell(r.index,r.includeOutputs??!0)},readAllCells:(e,n)=>{const o="object"==typeof e?e:{id:e,format:n};return t().notebooks.get(o.id)?.adapter?.readAllCells(o.format)??[]},executeCode:async(e,n)=>{const o="object"==typeof e?e:{id:e,code:n};return await(t().notebooks.get(o.id)?.adapter?.executeCode(o.code))??{success:!1,error:"Adapter not found"}},runCell:async e=>{const n="object"==typeof e?e:{id:e},o=t().notebooks.get(n.id)?.adapter;if(o)return await o.runCell(n)},runAllCells:e=>{const n="object"==typeof e?e:{id:e};t().notebooks.get(n.id)?.adapter?.runAllCells()},run:e=>{t().notebooks.get(e)?.adapter?.runCell()},runAll:e=>{t().notebooks.get(e)?.adapter?.runAllCells()},interrupt:e=>{t().notebooks.get(e)?.adapter?.commands.execute(te.nx.interrupt)},insertAbove:(e,n,o)=>{t().notebooks.get(e)?.adapter?.setDefaultCellType(n),t().notebooks.get(e)?.adapter?.insertAbove(o)},insertBelow:(e,n,o)=>{t().notebooks.get(e)?.adapter?.setDefaultCellType(n),t().notebooks.get(e)?.adapter?.insertBelow(o)},delete:e=>{t().notebooks.get(e)?.adapter?.deleteCell()},changeCellType:(e,n)=>{t().notebooks.get(e)?.adapter?.changeCellType(n)},undo:e=>{t().notebooks.get(e)?.adapter?.undo()},redo:e=>{t().notebooks.get(e)?.adapter?.redo()},reset:()=>e(e=>({notebooks:new Map}))})),he=1e3,pe=new Array,me=".datalayer/ping.ipynb";function ve(e){const t={};return e&&e.forEach(e=>{const n=e.schema?.default;t[e.identifier]={enabled:!0,debouncerDelay:n?.debouncerDelay??200,timeout:n?.timeout??15e3,autoFillInMiddle:!0}}),t}function fe(e){console.log("[Notebook2Base] Component rendering with props:",{hasInlineProviders:!!e.inlineProviders,inlineProvidersCount:e.inlineProviders?.length,inlineProviders:e.inlineProviders});const{commands:t,extensions:n=pe,kernelId:a,renderers:l,serviceManager:f,model:w,onSessionConnection:y}=e,[b,k]=(0,r.useState)(!0),[A,V]=(0,r.useState)(new Array),[I,_]=(0,r.useState)(null),[E,N]=(0,r.useState)(null),R=(0,r.useMemo)(()=>e.id||(0,U.YG)(),[e.id]),L=(0,r.useMemo)(()=>e.path||me,[e.path]),B=(0,r.useMemo)(()=>new ge({commands:t,renderers:l}),[t,l]),H=(0,r.useMemo)(()=>new x.S.ContentFactory({editorFactory:B.editorServices.factoryService.newInlineEditor}),[B.editorServices.factoryService.newInlineEditor]);(0,r.useEffect)(()=>{console.log("[Notebook2Base] Setting up completer with inlineProviders:",e.inlineProviders);const t=new c.A({model:new d.X}),n=new z.x0,o=ve(e.inlineProviders);console.log("[Notebook2Base] Generated settings for providers:",o);const r=new u.C({context:{widget:n},providers:[new h.G],inlineProviders:e.inlineProviders,inlineProvidersSettings:o,timeout:he});let a;if(console.log("[Notebook2Base] ProviderReconciliator created with inlineProviders:",e.inlineProviders),console.log("[Notebook2Base] ProviderReconciliator object:",r),e.inlineProviders&&e.inlineProviders.length>0){console.log("[Notebook2Base] Creating InlineCompleter widget");const t=v.wK.load("jupyterlab");a=new p.B({model:new p.B.Model,trans:t});const n={};e.inlineProviders?.forEach(e=>{n[e.identifier]={enabled:!0}}),a.configure({showWidget:"always",showShortcuts:!0,streamingAnimation:"none",suppressIfTabCompleterActive:!1,minLines:1,maxLines:10,editorResizeDelay:250,reserveSpaceForLongest:!1,providers:n}),z.x0.attach(a,document.body);const o=e=>!("Tab"!==e.key||e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)&&a&&a.model&&a.current?(console.log("[Notebook2Base] Tab pressed - accepting inline completion"),e.preventDefault(),e.stopPropagation(),a.accept(),!1):"Escape"===e.key&&a&&a.model&&a.current?(console.log("[Notebook2Base] Escape pressed - rejecting inline completion"),e.preventDefault(),e.stopPropagation(),a.model.reset(),!1):void 0;document.addEventListener("keydown",o,!0);const r=()=>{document.removeEventListener("keydown",o,!0)};console.log("[Notebook2Base] InlineCompleter created, configured, attached, and keyboard handlers set up"),a._keyboardCleanup=r}const s=new m.$({completer:t,reconciliator:r,inlineCompleter:a});return t.hide(),z.x0.attach(t,document.body),_(s),()=>{s.dispose(),t.dispose(),a&&(a._keyboardCleanup&&a._keyboardCleanup(),a.dispose()),n.dispose()}},[e.inlineProviders]);const[W,O]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e=new C.k({name:"Notebook",label:"Notebook",modelName:"notebook",fileTypes:["notebook"],defaultFor:["notebook"],preferKernel:!0,autoStartDefault:!1,canStartKernel:!1,shutdownOnClose:!1,rendermime:B.rendermime,contentFactory:H,mimeTypeService:B.editorServices.mimeTypeService,notebookConfig:{...S.a.defaultNotebookConfig,recordTiming:!0}});return O(e),()=>{e.dispose(),O(t=>t===e?null:t)}},[H,B]);const[K,q]=(0,r.useState)(null);(0,r.useEffect)(()=>{const t=I?new T.G({namespace:R}):null,n=I?(0,te.VV)(B.commands,I,t,e.path):null;return q(t),()=>{n?.dispose(),t?.dispose(),q(e=>e===t?null:e)}},[I,R,B.commands,e.path]);const[Z,J]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e=new we(w),t=new g.o({factory:e,manager:f??new ye,path:L,kernelPreference:{shouldStart:!1,canStart:!1,autoStartDefault:!1,shutdownOnDispose:!1}});return function(e,t,n,o,r=!1){const a=!n;e.sessionContext._initialize=async()=>{const t=e.sessionContext.sessionManager;await t.ready,await t.refreshRunning();const o=(0,j.find)(t.running(),t=>t.kernel?.id===(e.sessionContext.kernelPreference.id??""));if(o)try{const r=t.connectTo({model:{...o,path:n??o.path,name:n??o.name},kernelConnectionOptions:{handleComms:!0}});e.sessionContext._handleNewSession(r),this._kernel?.connection?.dispose()}catch(t){return e.sessionContext._handleSessionError(t),Promise.reject(t)}return await e.sessionContext._startIfNecessary()},e.dispose=()=>{e.isDisposed||(e._isDisposed=!0,e.sessionContext.dispose(),e._disposed.emit(void 0),P.Signal.clearData(this))},a&&(e._populate=async()=>{if(e._isPopulated=!0,e._isReady=!0,e._populatedPromise.resolve(void 0),e.isDisposed)return;const t=e._model.defaultKernelName||e.sessionContext.kernelPreference.name;e.sessionContext.kernelPreference={...e.sessionContext.kernelPreference,name:t,language:e._model.defaultKernelLanguage},r||e.sessionContext.initialize().then(t=>{t&&e._dialogs.selectKernel(e.sessionContext.sessionContext)})},e.initialize=async n=>{e.model.dirty=!1;const o=(new Date).toISOString(),r={path:t,name:t,type:"notebook",content:void 0,writable:!0,created:o,last_modified:o,mimetype:"application/x-ipynb+json",format:"json"};e._updateContentsModel(r),await e._populate(),e.model.sharedModel.clearUndoHistory()}),e.sessionContext.sessionChanged.connect((e,t)=>{const n=t.newValue;console.log("Current Jupyter Session Connection.",n),o?.(n??void 0)}),e.sessionContext.kernelChanged.connect((e,t)=>{const n=t.newValue;console.log("Current Jupyter Kernel Connection.",n),n&&!n.handleComms&&(console.log("Updating the current Kernel Connection to enforce Comms support.",n.handleComms),n.handleComms=!0)}),e.sessionContext.ready.then(()=>{o?.(e?.sessionContext.session??void 0)}),e.initialize(!n)}(t,R,L!==me?L:void 0,y,!f),J(t),()=>{t.dispose(),e.dispose(),J(e=>e===t?null:e)}},[R,f,w,y,L]),(0,r.useEffect)(()=>{Z&&a&&!Z.sessionContext.isDisposed&&Z.sessionContext.changeKernel({id:a}).catch(e=>{console.error("Failed to change kernel model.",e)})},[Z,a]);const[G,X]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=null,t=null,r=null;if(Z&&(e=W?.createNew(Z)??null,e)){t=new de(B.commands,e,Z),N(t),V(n.map(t=>(t.init({notebookId:R,commands:B.commands,panel:e}),t.createNew(e,Z),t.component??(0,o.jsx)(o.Fragment,{}))));const a=e.content.rendermime;r=new D.SS(Z,a,{saveState:!1}),a.addFactory({safe:!0,mimeTypes:[$.a],defaultRank:1,createRenderer:e=>new F.X(e,r)},1);for(const t of e.content.widgets)if("code"===t.model.type)for(const e of t.outputArea.widgets)for(const t of Array.from(e.children()))t instanceof F.X&&(t.manager=r);k(!1)}return X(e),e||(V([]),N(null)),()=>{if(r?.dispose(),t&&t.dispose(),e){e.content&&P.Signal.clearData(e.content);try{e.dispose()}catch(e){}}X(t=>t===e?null:t),N(e=>e===t?null:e)}},[Z,n,B.commands,W]),(0,r.useEffect)(()=>{if(E){console.log(`[Notebook2Base] ✅ Registering adapter for notebook: ${R}`),console.log("[Notebook2Base] Adapter has getCells:",typeof E.getCells),console.log("[Notebook2Base] Adapter cell count:",E.getCellCount());const e=ue.getState().notebooks,t=new Map(e);t.set(R,{adapter:E}),ue.getState().setNotebooks2(t),console.log(`[Notebook2Base] Store now has ${t.size} notebooks`),console.log("[Notebook2Base] Notebook IDs:",Array.from(t.keys()))}else{console.log(`[Notebook2Base] ⚠️  No adapter yet for notebook: ${R}`);const e=ue.getState().notebooks;if(e.has(R)){const t=new Map(e);t.delete(R),ue.getState().setNotebooks2(t)}}},[E,R]),(0,r.useEffect)(()=>{let t=!0,n=null,o=null;return G&&(K&&(K.has(G)||K.add(G).catch(e=>{console.error(`Failed to track the notebook panel '${R}'.`)})),I&&(n=(e,t)=>{t&&t.ready.then(()=>{I.editor=t?.editor})},o=(n,o)=>{if(!t)return;const r=G.content.activeCell?.editor,a=new h.G,s=ve(e.inlineProviders),i=o.newValue||{};console.log("[Notebook2Base] Creating ProviderReconciliator with editor and session",{hasEditor:!!r,hasSession:!!o.newValue,usingDummySession:!o.newValue,inlineProviders:e.inlineProviders,inlineProvidersSettings:s});const l=new u.C({context:{widget:G,editor:r,session:i},providers:[a],inlineProviders:e.inlineProviders,inlineProvidersSettings:s,timeout:he});console.log("[Notebook2Base] ProviderReconciliator with editor created:",l),I.inlineCompleter&&(I.inlineCompleter.editor=r,console.log("[Notebook2Base] Updated InlineCompleter editor")),I.editor=r,I.reconciliator=l},G.context.sessionContext.sessionChanged.connect(o),G.context.sessionContext.ready.then(()=>{o?.(G.context.sessionContext,{name:"session",oldValue:null,newValue:G.context.sessionContext.session})}),G.content.activeCellChanged.connect(n))),()=>{if(t=!1,I){n&&G?.content.activeCellChanged.disconnect(n),o&&G?.context.sessionContext.sessionChanged.connect(o),I.editor=null;const t=ve(e.inlineProviders);I.reconciliator=new u.C({context:{widget:new z.x0},providers:[new h.G],inlineProviders:e.inlineProviders,inlineProvidersSettings:t,timeout:he})}}},[I,G,K]),(0,r.useEffect)(()=>{const e=e=>{B.commands.processKeydownEvent(e)};return document.addEventListener("keydown",e,!0),()=>{document.removeEventListener("keydown",e,!0)}},[B.commands]),(0,r.useEffect)(()=>()=>{const e=ue.getState().notebooks;if(e.has(R)){const t=new Map(e);t.delete(R),ue.getState().setNotebooks2(t)}},[R]),(0,o.jsxs)(o.Fragment,{children:[A.map((e,t)=>(0,o.jsx)(s.az,{children:e},`${e}-${t}`)),b?(0,o.jsx)(i.a,{},"notebook-loader"):G?(0,o.jsx)(s.az,{sx:{height:"100%"},children:(0,o.jsx)(ee.j,{id:R,children:G},"notebook-container")}):(0,o.jsx)(M.l,{variant:"critical",description:"Unable to create the notebook view.",hideTitle:!0,title:"Error"},"notebook-error")]})}class ge{_commands;_editorServices;_rendermime;constructor(e={}){this._commands=e.commands??new N.J;const t=new l.T9;for(const e of l.T9.getDefaultLanguages())t.addLanguage(e);t.addLanguage({name:"ipythongfm",mime:"text/x-ipythongfm",load:async()=>(await Promise.all([n.e(6636),n.e(9946),n.e(2899),n.e(5949)]).then(n.bind(n,15949))).markdown({codeLanguages:e=>t.findBest(e)})});const o=I.dn.filter(e=>"text/javascript"!==e.mimeTypes[0]).concat([y.rendererFactory,w.rendererFactory]).concat(e.renderers??[]);this._rendermime=new _.K({initialFactories:o,latexTypesetter:new k.p,markdownParser:(0,b.createMarkdownParser)(t)});const r=new l.mN(t),a=new l.k8;for(const e of l.k8.getDefaultThemes())a.addTheme(e);const s=new l.AG;for(const e of l.AG.getDefaultExtensions({themes:a}))s.addExtension(e);s.addExtension({name:"shared-model-binding",factory:e=>{const t=e.model.sharedModel;return l.AG.createImmutableExtension((0,l.rX)({ytext:t.ysource,undoManager:t.undoManager??void 0}))}}),s.addExtension({name:"remote-user-cursors",factory(e){const{awareness:t,ysource:n}=e.model.sharedModel;return l.AG.createImmutableExtension((o={awareness:t,ytext:n},[O.of(o),Q]));var o}});const i=function(){const e=document.querySelector('meta[property="csp-nonce"]');return e?e.getAttribute("content"):null}();i&&s.addExtension({name:"csp-nonce",factory:()=>l.AG.createImmutableExtension(L.Lz.cspNonce.of(i))});const c=new l.Ez({extensions:s,languages:t});this._editorServices={factoryService:c,mimeTypeService:r}}get commands(){return this._commands}get editorServices(){return this._editorServices}get rendermime(){return this._rendermime}}class we extends V.p{model;constructor(e){super(),this.model=e}createNew(e){return this.model}}class ye{contents=Object.freeze({fileChanged:{connect:()=>{}},getSharedModelFactory:e=>null,localPath(e){const t=e.split("/"),n=t[0].split(":");return 1!==n.length&&this._additionalDrives.has(n[0])?f.PathExt.join(n.slice(1).join(":"),...t.slice(1)):f.PathExt.removeSlash(e)},normalize(e){const t=e.split(":");return 1===t.length?f.PathExt.normalize(e):`${t[0]}:${f.PathExt.normalize(t.slice(1).join(":"))}`}});kernelspecs=Object.freeze({ready:new Promise(()=>{})});sessions=Object.freeze({ready:new Promise(()=>{})});ready=Promise.resolve()}const be=a.DU`
  .dla-Box-Notebook .jp-Cell .dla-CellSidebar-Container {
    display: none;
  }
  .dla-Box-Notebook .jp-Cell.jp-mod-active .dla-CellSidebar-Container {
    display: block;
  }
`;function ke(e){const{Toolbar:t,children:n,cellSidebarMargin:a=120,collaborationProvider:l,commands:c,extensions:d,height:u="100vh",maxHeight:h="100vh",id:p,inlineProviders:m,nbformat:v,onNotebookModelChanged:f,onSessionConnection:g,path:w,readonly:y=!1,renderers:b,serviceManager:k,startDefaultKernel:x=!1,url:C}=e,[S,T]=(0,r.useState)(!0),V=function(e={}){const{kernels:t,requestedKernelId:n,startDefaultKernel:o=!1}=e,[a,s]=(0,r.useState)(void 0);return(0,r.useEffect)(()=>{let e,r=!0;return t&&(async()=>{let a;if(await t.ready,n)for(const e of t.running())if(e.id===n){a=n;break}!a&&o&&r&&(console.log("Starting new kernel."),e=await t.startNew(),r?a=e.id:e.dispose()),r&&s(a)})(),()=>{r=!1,e&&(console.log(`Shutting down kernel '${e.id}'.`),e.shutdown().catch(t=>{console.warn(`Failed to shutdown kernel '${e?.id}'.`,t)}).finally(()=>{e?.dispose()}))}},[t,n,o]),a}({requestedKernelId:e.kernelId,kernels:k.kernels,startDefaultKernel:x}),I=function(e){const{collaborationProvider:t,nbformat:n,readonly:o=!1,url:a,path:s,serviceManager:i,id:l}=e;console.log("[useNotebookModel] Hook called with options:",{hasCollaborationProvider:!!t,hasNbformat:!!n,readonly:o,hasUrl:!!a,path:s,hasServiceManager:!!i,id:l});const[c,d]=(0,r.useState)(null);return(0,r.useEffect)(()=>{console.log("[useNotebookModel] useEffect running");let e=!0;const r=new R.DisposableSet;if(t&&i&&l){console.log("[useNotebookModel] Setting up collaboration");const n=async()=>{try{const n=new E.Xn;if(await t.connect(n,l,{serviceManager:i,path:s}),e){console.log("[useNotebookModel] Creating collaboration model");const e=new A.x({collaborationEnabled:!0,disableDocumentWideUndoRedo:!0,sharedModel:n});e.readOnly=o,console.log("[useNotebookModel] Calling setModel with collaboration model"),d(e),r.add({dispose:()=>{t.disconnect()},get isDisposed(){return!1}})}}catch(e){console.error("Failed to setup collaboration:",e)}};n()}else{console.log("[useNotebookModel] No collaboration, creating standard model");const t=e=>{console.log("[useNotebookModel] createModel called with nbformat:",!!e);try{const t=new A.x;console.log("[useNotebookModel] NotebookModel created"),e&&(e.cells.forEach(e=>{e.metadata.editable=!o}),console.log("[useNotebookModel] About to call model.fromJSON"),t.fromJSON(e),console.log("[useNotebookModel] model.fromJSON completed successfully")),t.readOnly=o,console.log("[useNotebookModel] Calling setModel with standard model"),d(t)}catch(e){throw console.error("[useNotebookModel] Error creating model:",e),e}};!n&&a?(console.log("[useNotebookModel] Loading from URL:",a),async function(e){return fetch(e).then(e=>e.text()).then(e=>JSON.parse(e))}(a).then(n=>{e&&t(n)})):(console.log("[useNotebookModel] Creating model directly (nbformat provided or no URL)"),t(n))}return()=>{e=!1,r.dispose()}},[t,n,o,a,s,i,l]),console.log("[useNotebookModel] Returning model:",!!c),c}({collaborationProvider:l,nbformat:v,readonly:y,url:C,path:w,serviceManager:k,id:p});return(0,r.useEffect)(()=>{console.log("[Notebook2] useEffect - model changed:",{model:!!I,isLoading:S}),I&&(console.log("[Notebook2] Setting isLoading to false"),T(!1)),f?.(I)},[I,f]),(0,r.useEffect)(()=>{const e=()=>{l&&I&&I.sharedModel.awareness.setLocalStateField("user",k.user.identity)};return e(),k.user.userChanged.connect(e),()=>{k.user.userChanged.disconnect(e)}},[l,I,k]),console.log("[Notebook2] Rendering:",{isLoading:S,hasModel:!!I,hasServiceManager:!!k,hasInlineProviders:!!m}),S?(0,o.jsx)(i.a,{},"notebook-loader"):(0,o.jsxs)(s.az,{style:{height:u,width:"100%",position:"relative"},id:"dla-Jupyter-Notebook",children:[t&&(0,o.jsx)(t,{notebookId:p}),(0,o.jsxs)(s.az,{className:"dla-Box-Notebook",sx:{height:u,maxHeight:h,width:"100%",overflowY:"hidden","& .datalayer-NotebookPanel-header":{minHeight:"50px"},"& .jp-Notebook":{flex:"1 1 auto !important",height:"100%",overflowY:"scroll"},"& .jp-NotebookPanel":{},"& .jp-Toolbar":{display:"none",zIndex:0},"& .jp-Toolbar .jp-HTMLSelect.jp-DefaultStyle select":{fontSize:"14px"},"& .jp-Toolbar > .jp-Toolbar-responsive-opener":{display:"none"},"& .jp-Toolbar-kernelName":{display:"none"},"& .jp-Cell":{width:`calc(100% - ${a}px)`},"& .jp-Notebook-footer":{width:`calc(100% - ${a+82}px)`},"& .jp-CodeMirrorEditor":{cursor:"text !important"},".dla-Box-Notebook":{position:"relative"}},children:[n,(0,o.jsx)(be,{}),I&&k&&(0,o.jsx)(fe,{commands:c,id:p,extensions:d,inlineProviders:m,kernelId:V,model:I,path:w,renderers:b,serviceManager:k,onSessionConnection:g})]})]})}},87474:(e,t,n)=>{n.d(t,{XV:()=>fe});var o=n(18683),r=n(9387),a=n(63711),s=n(98238),i=n(50825),l=n(57657),c=n(76068),d=n(87319),u=n(38621),h=n(34164),p=n(46186),m=n.n(p),v=n(21606);m()(v.A,{insert:"head",singleton:!1}),v.A.locals;var f="prc-TreeView-TreeViewItemVisual-dRlGq",g="prc-TreeView-TreeViewVisuallyHidden-4-mPv",w=n(63859),y=n(18336),b=n(93479),k=n(22856),x=n(9297);function C(e){var t,n,o;const r=e.getAttribute("aria-label"),a=e.getAttribute("aria-labelledby");return r||(a?null!==(t=null===(n=document.getElementById(a))||void 0===n?void 0:n.textContent)&&void 0!==t?t:"":null!==(o=e.textContent)&&void 0!==o?o:"")}var S=n(91034);function T(e){return e&&e!==document.body?function(e){return e.scrollHeight>e.clientHeight&&!(-1!==window.getComputedStyle(e).overflowY.indexOf("hidden"))}(e)?e:T(e.parentElement):null}var A=n(94761);function V(e,t,n){var o;if(t instanceof HTMLElement){try{if(t.closest("dialog:modal"))return}catch{}return null!==(o=function(e,t){switch(`${function(e){if("treeitem"!==e.getAttribute("role"))throw new Error("Element is not a treeitem");switch(e.getAttribute("aria-expanded")){case"true":return"open";case"false":return"closed";default:return"end"}}(e)} ${t.key}`){case"open ArrowRight":return _(e);case"open ArrowLeft":case"closed ArrowRight":case"end ArrowRight":return;case"closed ArrowLeft":case"end ArrowLeft":return E(e)}switch(t.key){case"ArrowUp":return I(e,"previous");case"ArrowDown":return I(e,"next");case"Backspace":return E(e);case"Home":return function(e){const t=e.closest("[role=tree]"),n=null==t?void 0:t.querySelector("[role=treeitem]");return n instanceof HTMLElement?n:void 0}(e);case"End":return function(e){const t=e.closest("[role=tree]"),n=Array.from((null==t?void 0:t.querySelectorAll("[role=treeitem]"))||[]);if(0===n.length)return;let o=n.length-1,r=n[o];for(;o>0&&r instanceof HTMLElement&&null!==(a=r.parentElement)&&void 0!==a&&a.closest("[role=treeitem][aria-expanded=false]");){var a;o-=1,r=n[o]}return r instanceof HTMLElement?r:void 0}(e);case"PageUp":return function(e){const t=e.closest('[role="tree"]');if(!t)return;const n=Array.from(t.querySelectorAll('[role="treeitem"]'));if(0===n.length)return;const o=N(t,n[0].firstElementChild),r=Math.floor(n.indexOf(e)/o),a=n.indexOf(e)-o*r;return n[Math.max(0,(r-1)*o+a)]}(e);case"PageDown":return function(e){const t=e.closest('[role="tree"]');if(!t)return;const n=Array.from(t.querySelectorAll('[role="treeitem"]'));if(0===n.length)return;const o=N(t,n[0].firstElementChild),r=Math.floor(n.indexOf(e)/o),a=n.indexOf(e)-o*r;return n[Math.min(n.length-1,(r+1)*o+a)]}(e)}}(t,n))&&void 0!==o?o:t}}function I(e,t){const n=e.closest("[role=tree]");if(!n)return;const o=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,e=>e instanceof HTMLElement&&"treeitem"===e.getAttribute("role")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP);let r=o.firstChild();for(;r!==e;)r=o.nextNode();let a="next"===t?o.nextNode():o.previousNode();for(;a instanceof HTMLElement&&null!==(s=a.parentElement)&&void 0!==s&&s.closest("[role=treeitem][aria-expanded=false]");){var s;a="next"===t?o.nextNode():o.previousNode()}return a instanceof HTMLElement?a:void 0}function _(e){const t=e.querySelector("[role=treeitem]");return t instanceof HTMLElement?t:void 0}function E(e){const t=e.closest("[role=group]"),n=null==t?void 0:t.closest("[role=treeitem]");return n instanceof HTMLElement?n:void 0}const j={height:32};function N(e,t){var n,o;const r=T(e),{height:a}=null!==(n=null==t?void 0:t.getBoundingClientRect())&&void 0!==n?n:j,s=null!==(o=null==r?void 0:r.clientHeight)&&void 0!==o?o:window.innerHeight;return Math.floor(s/a)}function R(e){return e===document.activeElement}var P=n(21496),z=n(66619),M=n(83536);const L=r.createContext({announceUpdate:()=>{},expandedStateCache:{current:new Map}}),D=r.createContext({itemId:"",level:1,isSubTreeEmpty:!1,setIsSubTreeEmpty:()=>{},isExpanded:!1,setIsExpanded:()=>{},leadingVisualId:"",trailingVisualId:""}),$=e=>{const t=(0,d.c)(23),{"aria-label":n,"aria-labelledby":a,children:s,flat:i,truncate:l,className:c,style:u}=e,p=void 0===l||l,m=r.useRef(null),v=r.useRef(!1),[f,g]=r.useState("");let w;t[0]===Symbol.for("react.memo_cache_sentinel")?(w=e=>{g(e)},t[0]=w):w=t[0];const b=w;let x;t[1]===Symbol.for("react.memo_cache_sentinel")?(x=()=>{v.current=!0},t[1]=x):x=t[1];const T=x;let I,_,E,j;t[2]===Symbol.for("react.memo_cache_sentinel")?(I=()=>{const e=function(){v.current=!1};return document.addEventListener("mouseup",e),()=>{document.removeEventListener("mouseup",e)}},_=[],t[2]=I,t[3]=_):(I=t[2],_=t[3]),(0,r.useEffect)(I,_),t[4]===Symbol.for("react.memo_cache_sentinel")?(E={containerRef:m,mouseDownRef:v},t[4]=E):E=t[4],function(e){const t=(0,d.c)(6),{containerRef:n,mouseDownRef:o}=e;let r,a;t[0]!==n||t[1]!==o?(r=()=>{var e,t,r;if(o.current)return;const a=null===(e=n.current)||void 0===e?void 0:e.querySelector("[aria-current]"),s=null===(t=n.current)||void 0===t?void 0:t.querySelector('[role="treeitem"]');return a instanceof HTMLElement?a:document.activeElement instanceof HTMLElement&&null!==(r=n.current)&&void 0!==r&&r.contains(document.activeElement)&&"treeitem"===document.activeElement.getAttribute("role")?document.activeElement:s instanceof HTMLElement?s:void 0},t[0]=n,t[1]=o,t[2]=r):r=t[2],t[3]!==n||t[4]!==r?(a={containerRef:n,bindKeys:A.z0.ArrowVertical|A.z0.ArrowHorizontal|A.z0.HomeAndEnd|A.z0.Backspace|A.z0.PageUpDown,preventScroll:!0,getNextFocusable:V,focusInStrategy:r},t[3]=n,t[4]=r,t[5]=a):a=t[5],(0,S.G)(a)}(E),t[5]===Symbol.for("react.memo_cache_sentinel")?(j={containerRef:m,onFocusChange:Q},t[5]=j):j=t[5],function(e){const t=(0,d.c)(11),{containerRef:n,onFocusChange:o}=e,a=r.useRef(""),s=r.useRef(0),i=r.useRef(o),{safeSetTimeout:l,safeClearTimeout:c}=(0,k.A)();let u,h,p;t[0]!==o?(u=()=>{i.current=o},h=[o],t[0]=o,t[1]=u,t[2]=h):(u=t[1],h=t[2]),r.useEffect(u,h),t[3]!==n?(p=e=>{if(!e)return;if(!n.current)return;const t=n.current,o=Array.from(t.querySelectorAll('[role="treeitem"]')),r=o.findIndex(R);let a=(l=r,(s=o).map((e,t)=>s[(l+t)%s.length]));var s,l;1===e.length&&(a=a.slice(1));const c=a.find(t=>C(t).toLowerCase().startsWith(e.toLowerCase()));c&&i.current(c)},t[3]=n,t[4]=p):p=t[4];const m=p;let v,f;t[5]!==n||t[6]!==m||t[7]!==c||t[8]!==l?(v=()=>{if(!n.current)return;const e=n.current,t=function(e){!e.key||e.key.length>1||" "===e.key||e.ctrlKey||e.altKey||e.metaKey||(a.current=a.current+e.key,m(a.current),c(s.current),s.current=l(()=>a.current="",300),e.preventDefault(),e.stopPropagation())};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)},f=[n,m,c,l],t[5]=n,t[6]=m,t[7]=c,t[8]=l,t[9]=v,t[10]=f):(v=t[9],f=t[10]),r.useEffect(v,f)}(j);const N=r.useRef(null);if(null===N.current){let e;t[6]===Symbol.for("react.memo_cache_sentinel")?(e=new Map,t[6]=e):e=t[6],N.current=e}let P,z;t[7]===Symbol.for("react.memo_cache_sentinel")?(P={announceUpdate:b,expandedStateCache:N},t[7]=P):P=t[7],t[8]!==f?(z=(0,o.jsx)(y.A,{role:"status","aria-live":"polite","aria-atomic":"true",children:f}),t[8]=f,t[9]=z):z=t[9];const M=p||!1;let D,$,F;return t[10]!==c?(D=(0,h.$)(c,"prc-TreeView-TreeViewRootUlStyles-eZtxW"),t[10]=c,t[11]=D):D=t[11],t[12]!==n||t[13]!==a||t[14]!==s||t[15]!==i||t[16]!==u||t[17]!==M||t[18]!==D?($=(0,o.jsx)("ul",{ref:m,role:"tree","aria-label":n,"aria-labelledby":a,"data-omit-spacer":i,"data-truncate-text":M,onMouseDown:T,className:D,style:u,children:s}),t[12]=n,t[13]=a,t[14]=s,t[15]=i,t[16]=u,t[17]=M,t[18]=D,t[19]=$):$=t[19],t[20]!==$||t[21]!==z?(F=(0,o.jsx)(L.Provider,{value:P,children:(0,o.jsxs)(o.Fragment,{children:[z,$]})}),t[20]=$,t[21]=z,t[22]=F):F=t[22],F};$.displayName="TreeView";const F=r.forwardRef(({id:e,containIntrinsicSize:t,current:n=!1,defaultExpanded:a,expanded:s,onExpandedChange:i,onSelect:l,children:c,className:p,"aria-label":m,"aria-labelledby":v},f)=>{const[g,w]=(0,x.H)(c,{leadingAction:G,leadingVisual:Z,trailingVisual:J}),{expandedStateCache:y}=r.useContext(L),k=(0,b.B)(),C=(0,b.B)(),S=(0,b.B)(),[T,A]=function({name:e="custom",defaultValue:t,value:n,onChange:o}){const[a,s]=r.useState(null!=n?n:t),i=r.useRef(null),l=r.useRef(o);r.useEffect(()=>{l.current=o}),null===i.current&&(i.current=void 0!==n);const c=r.useCallback(e=>{var t;const n="function"==typeof e?e(a):e;!1===i.current&&s(n),null===(t=l.current)||void 0===t||t.call(l,n)},[a]);return r.useEffect(()=>{i.current,i.current},[e,n]),!0===i.current?[n,c]:[a,c]}({name:e,defaultValue:()=>{var t,o,r;return null!==(t=null!==(o=null===(r=y.current)||void 0===r?void 0:r.get(e))&&void 0!==o?o:a)&&void 0!==t?t:n},value:null!==s&&s,onChange:i}),{level:V}=r.useContext(D),{hasSubTree:I,subTree:_,childrenWithoutSubTree:E}=function(e){const t=(0,d.c)(8);let n,o;t[0]!==e?(o=r.Children.toArray(e).find(q),t[0]=e,t[1]=o):o=t[1];const a=o;let s;t[2]!==e?(s=r.Children.toArray(e).filter(K),t[2]=e,t[3]=s):s=t[3];const i=s,l=Boolean(a);let c;return t[4]!==i||t[5]!==a||t[6]!==l?(c={subTree:a,childrenWithoutSubTree:i,hasSubTree:l},t[4]=i,t[5]=a,t[6]=l,t[7]=c):c=t[7],n=c,n}(w),[j,N]=r.useState(!I),[R,P]=r.useState(!1),z=r.useCallback(t=>{var n;A(t),null===(n=y.current)||void 0===n||n.set(e,t)},[e,A,y]),M=r.useCallback(e=>{z(!T),null==e||e.stopPropagation()},[T,z]),$=r.useCallback(e=>{switch(e.key){case"Enter":case" ":l?l(e):M(e),e.stopPropagation();break;case"ArrowRight":if(e.altKey||e.metaKey)return;e.preventDefault(),e.stopPropagation(),z(!0);break;case"ArrowLeft":if(e.altKey||e.metaKey)return;e.preventDefault(),e.stopPropagation(),z(!1)}},[l,z,M]),F=[g.leadingVisual?C:null,g.trailingVisual?S:null].filter(Boolean);return(0,o.jsx)(D.Provider,{value:{itemId:e,level:V+1,isSubTreeEmpty:j,setIsSubTreeEmpty:N,isExpanded:T,setIsExpanded:z,leadingVisualId:C,trailingVisualId:S},children:(0,o.jsxs)("li",{className:(0,h.$)("PRIVATE_TreeView-item",p,"prc-TreeView-TreeViewItem-ShJr0"),ref:f,tabIndex:0,id:e,role:"treeitem","aria-label":m,"aria-labelledby":m?void 0:v||k,"aria-describedby":F.length?F.join(" "):void 0,"aria-level":V,"aria-expanded":(!j||T&&I)&&null!==s?T:void 0,"aria-current":n?"true":void 0,"aria-selected":R?"true":"false","data-has-leading-action":!!g.leadingAction||void 0,onKeyDown:$,onFocus:e=>{var t;null===(t=e.currentTarget.firstElementChild)||void 0===t||t.scrollIntoView({block:"nearest",inline:"nearest"}),P(!0),e.stopPropagation()},onBlur:()=>P(!1),onClick:e=>{l?l(e):M(e),e.stopPropagation()},onAuxClick:e=>{l&&1===e.button&&l(e),e.stopPropagation()},children:[(0,o.jsxs)("div",{className:(0,h.$)("PRIVATE_TreeView-item-container","prc-TreeView-TreeViewItemContainer--2Rkn"),style:{"--level":V,contentVisibility:t?"auto":void 0,containIntrinsicSize:t},children:[(0,o.jsx)("div",{style:{gridArea:"spacer",display:"flex"},children:(0,o.jsx)(U,{level:V})}),g.leadingAction,I?(0,o.jsx)("div",{className:(0,h.$)("PRIVATE_TreeView-item-toggle",l&&"PRIVATE_TreeView-item-toggle--hover",1===V&&"PRIVATE_TreeView-item-toggle--end","prc-TreeView-TreeViewItemToggle-gWUdE","prc-TreeView-TreeViewItemToggleHover-nEgP-","prc-TreeView-TreeViewItemToggleEnd-t-AEB"),onClick:e=>{l&&M(e)},children:T?(0,o.jsx)(u.D3D,{size:12}):(0,o.jsx)(u.vKP,{size:12})}):null,(0,o.jsxs)("div",{id:k,className:(0,h.$)("PRIVATE_TreeView-item-content","prc-TreeView-TreeViewItemContent-f0r0b"),children:[g.leadingVisual,(0,o.jsx)("span",{className:(0,h.$)("PRIVATE_TreeView-item-content-text","prc-TreeView-TreeViewItemContentText-smZM-"),children:E}),g.trailingVisual]})]}),_]})})}),U=e=>{const t=(0,d.c)(3),{level:n}=e;let r,a;return t[0]===Symbol.for("react.memo_cache_sentinel")?(r={width:"100%",display:"flex"},t[0]=r):r=t[0],t[1]!==n?(a=(0,o.jsx)("div",{style:r,children:Array.from({length:n-1}).map(ee)}),t[1]=n,t[2]=a):a=t[2],a};F.displayName="TreeView.Item";const B=e=>{const t=(0,d.c)(29),{count:n,state:a,children:s,"aria-label":i}=e,{announceUpdate:l}=r.useContext(L),{itemId:c,isExpanded:u,isSubTreeEmpty:h,setIsSubTreeEmpty:p}=r.useContext(D),m=r.useRef(null),v=r.useRef(null),[f,g]=r.useState(!1),[w,y]=r.useState(""),b=function(e){const t=r.useRef(e);return r.useEffect(()=>{t.current=e},[e]),t.current}(a),{safeSetTimeout:x}=(0,k.A)();let S,T,A,V,I,E,j;if(t[0]!==s||t[1]!==h||t[2]!==p||t[3]!==a?(S=()=>{void 0!==a&&"done"!==a||(h||s?h&&s&&p(!1):p(!0))},T=[a,h,p,s],t[0]=s,t[1]=h,t[2]=p,t[3]=a,t[4]=S,t[5]=T):(S=t[4],T=t[5]),r.useEffect(S,T),t[6]!==l||t[7]!==c||t[8]!==f||t[9]!==b||t[10]!==x||t[11]!==a?(A=()=>{const e=document.getElementById(c);if(e)if(y(C(e)),"loading"===b&&"done"===a){var t;const n=C(e);if(null!==(t=v.current)&&void 0!==t&&t.childElementCount?l(`${n} content loaded`):l(`${n} is empty`),f){const t=_(e);x(t?()=>{t.focus()}:()=>{e.focus()}),g(!1)}}else if("loading"===a){const t=C(e);l(`${t} content loading`)}},V=[f,b,a,c,l,v,x],t[6]=l,t[7]=c,t[8]=f,t[9]=b,t[10]=x,t[11]=a,t[12]=A,t[13]=V):(A=t[12],V=t[13]),r.useEffect(A,V),t[14]===Symbol.for("react.memo_cache_sentinel")?(I=()=>{const e=function(){g(!0)},t=function(e){e.relatedTarget&&g(!1)},n=m.current;if(n)return n.addEventListener("focus",e),n.addEventListener("blur",t),()=>{n.removeEventListener("focus",e),n.removeEventListener("blur",t)}},t[14]=I):I=t[14],t[15]!==a?(E=[m,a],t[15]=a,t[16]=E):E=t[16],r.useEffect(I,E),!u)return null;t[17]===Symbol.for("react.memo_cache_sentinel")?(j={listStyle:"none",padding:0,margin:0},t[17]=j):j=t[17];const N=i||w;let R,P,z;return t[18]!==s||t[19]!==n||t[20]!==a?(R="loading"===a?(0,o.jsx)(W,{ref:m,count:n}):s,t[18]=s,t[19]=n,t[20]=a,t[21]=R):R=t[21],t[22]!==h||t[23]!==a?(P=h&&"loading"!==a?(0,o.jsx)(O,{}):null,t[22]=h,t[23]=a,t[24]=P):P=t[24],t[25]!==P||t[26]!==N||t[27]!==R?(z=(0,o.jsxs)("ul",{role:"group",style:j,ref:v,"aria-label":N,children:[R,P]}),t[25]=P,t[26]=N,t[27]=R,t[28]=z):z=t[28],z};B.displayName="TreeView.SubTree";const H=()=>{const e=(0,d.c)(1);let t;return e[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,o.jsxs)("span",{className:(0,h.$)("prc-TreeView-TreeViewSkeletonItemContainerStyle-EB7p0","prc-TreeView-TreeViewItemSkeleton-fqk59","PRIVATE_TreeView-item-skeleton"),children:[(0,o.jsx)(z.N,{size:16,square:!0}),(0,o.jsx)(M.r,{className:"prc-TreeView-TreeItemSkeletonTextStyles-wnBY9"})]}),e[0]=t):t=e[0],t},W=r.forwardRef((e,t)=>{const n=(0,d.c)(15),{count:r}=e,a=(0,b.B)();if(r){let e,s,i,l;return n[0]!==r?(e=Array.from({length:r}).map(te),n[0]=r,n[1]=e):e=n[1],n[2]===Symbol.for("react.memo_cache_sentinel")?(s=(0,h.$)("PRIVATE_VisuallyHidden",g),n[2]=s):s=n[2],n[3]!==r?(i=(0,o.jsxs)("div",{className:s,children:["Loading ",r," items"]}),n[3]=r,n[4]=i):i=n[4],n[5]!==a||n[6]!==t||n[7]!==e||n[8]!==i?(l=(0,o.jsxs)(F,{id:a,ref:t,children:[e,i]}),n[5]=a,n[6]=t,n[7]=e,n[8]=i,n[9]=l):l=n[9],l}let s,i,l;return n[10]===Symbol.for("react.memo_cache_sentinel")?(s=(0,o.jsx)(Z,{children:(0,o.jsx)(c.A,{size:"small"})}),i=(0,o.jsx)(P.A,{className:"fgColor-muted",children:"Loading..."}),n[10]=s,n[11]=i):(s=n[10],i=n[11]),n[12]!==a||n[13]!==t?(l=(0,o.jsxs)(F,{id:a,ref:t,children:[s,i]}),n[12]=a,n[13]=t,n[14]=l):l=n[14],l}),O=r.forwardRef((e,t)=>{const n=(0,d.c)(4),r=(0,b.B)();let a,s;return n[0]===Symbol.for("react.memo_cache_sentinel")?(a=(0,o.jsx)(P.A,{className:"fgColor-muted",children:"No items found"}),n[0]=a):a=n[0],n[1]!==t||n[2]!==r?(s=(0,o.jsx)(F,{expanded:null,id:r,ref:t,children:a}),n[1]=t,n[2]=r,n[3]=s):s=n[3],s});function K(e){return!(r.isValidElement(e)&&e.type===B)}function q(e){return r.isValidElement(e)&&e.type===B}const Z=e=>{const t=(0,d.c)(13),{isExpanded:n,leadingVisualId:a}=r.useContext(D);let s;t[0]!==n||t[1]!==e.children?(s="function"==typeof e.children?e.children({isExpanded:n}):e.children,t[0]=n,t[1]=e.children,t[2]=s):s=t[2];const i=s;let l,c,u,p,m;return t[3]===Symbol.for("react.memo_cache_sentinel")?(l=(0,h.$)("PRIVATE_VisuallyHidden",g),t[3]=l):l=t[3],t[4]!==a||t[5]!==e.label?(c=(0,o.jsx)("div",{className:l,"aria-hidden":!0,id:a,children:e.label}),t[4]=a,t[5]=e.label,t[6]=c):c=t[6],t[7]===Symbol.for("react.memo_cache_sentinel")?(u=(0,h.$)("PRIVATE_TreeView-item-visual",f),t[7]=u):u=t[7],t[8]!==i?(p=(0,o.jsx)("div",{className:u,"aria-hidden":!0,children:i}),t[8]=i,t[9]=p):p=t[9],t[10]!==c||t[11]!==p?(m=(0,o.jsxs)(o.Fragment,{children:[c,p]}),t[10]=c,t[11]=p,t[12]=m):m=t[12],m};Z.displayName="TreeView.LeadingVisual";const J=e=>{const t=(0,d.c)(13),{isExpanded:n,trailingVisualId:a}=r.useContext(D);let s;t[0]!==n||t[1]!==e.children?(s="function"==typeof e.children?e.children({isExpanded:n}):e.children,t[0]=n,t[1]=e.children,t[2]=s):s=t[2];const i=s;let l,c,u,p,m;return t[3]===Symbol.for("react.memo_cache_sentinel")?(l=(0,h.$)("PRIVATE_VisuallyHidden",g),t[3]=l):l=t[3],t[4]!==e.label||t[5]!==a?(c=(0,o.jsx)("div",{className:l,"aria-hidden":!0,id:a,children:e.label}),t[4]=e.label,t[5]=a,t[6]=c):c=t[6],t[7]===Symbol.for("react.memo_cache_sentinel")?(u=(0,h.$)("PRIVATE_TreeView-item-visual",f),t[7]=u):u=t[7],t[8]!==i?(p=(0,o.jsx)("div",{className:u,"aria-hidden":!0,children:i}),t[8]=i,t[9]=p):p=t[9],t[10]!==c||t[11]!==p?(m=(0,o.jsxs)(o.Fragment,{children:[c,p]}),t[10]=c,t[11]=p,t[12]=m):m=t[12],m};J.displayName="TreeView.TrailingVisual";const G=e=>{const t=(0,d.c)(12),{isExpanded:n}=r.useContext(D);let a;t[0]!==n||t[1]!==e.children?(a="function"==typeof e.children?e.children({isExpanded:n}):e.children,t[0]=n,t[1]=e.children,t[2]=a):a=t[2];const s=a;let i,l,c,u,p;return t[3]===Symbol.for("react.memo_cache_sentinel")?(i=(0,h.$)("PRIVATE_VisuallyHidden",g),t[3]=i):i=t[3],t[4]!==e.label?(l=(0,o.jsx)("div",{className:i,"aria-hidden":!0,children:e.label}),t[4]=e.label,t[5]=l):l=t[5],t[6]===Symbol.for("react.memo_cache_sentinel")?(c=(0,h.$)("PRIVATE_TreeView-item-leading-action","prc-TreeView-TreeViewItemLeadingAction-VXx8I"),t[6]=c):c=t[6],t[7]!==s?(u=(0,o.jsx)("div",{className:c,"aria-hidden":!0,children:s}),t[7]=s,t[8]=u):u=t[8],t[9]!==l||t[10]!==u?(p=(0,o.jsxs)(o.Fragment,{children:[l,u]}),t[9]=l,t[10]=u,t[11]=p):p=t[11],p};G.displayName="TreeView.LeadingAction";const X=e=>{const t=(0,d.c)(9),{title:n,children:a,onRetry:s,onDismiss:i}=e,l=void 0===n?"Error":n,{itemId:c,setIsExpanded:u}=r.useContext(D);let h,p;return t[0]!==c||t[1]!==i||t[2]!==s||t[3]!==u?(h=e=>{setTimeout(()=>{const e=document.getElementById(c);null==e||e.focus()}),"confirm"===e?null==s||s():(u(!1),null==i||i())},t[0]=c,t[1]=i,t[2]=s,t[3]=u,t[4]=h):h=t[4],t[5]!==a||t[6]!==h||t[7]!==l?(p=(0,o.jsx)("div",{onKeyDown:ne,children:(0,o.jsx)(w.K,{title:l,onClose:h,confirmButtonContent:"Retry",cancelButtonContent:"Dismiss",children:a})}),t[5]=a,t[6]=h,t[7]=l,t[8]=p):p=t[8],p};X.displayName="TreeView.ErrorDialog";const Y=Object.assign($,{Item:F,SubTree:B,LeadingAction:G,LeadingVisual:Z,TrailingVisual:J,DirectoryIcon:()=>{const e=(0,d.c)(3),{isExpanded:t}=r.useContext(D),n=t?u.OpE:u.mL$;let a,s;return e[0]===Symbol.for("react.memo_cache_sentinel")?(a=(0,h.$)("PRIVATE_TreeView-directory-icon","prc-TreeView-TreeViewDirectoryIcon-PHbeP"),e[0]=a):a=e[0],e[1]!==n?(s=(0,o.jsx)("div",{className:a,children:(0,o.jsx)(n,{})}),e[1]=n,e[2]=s):s=e[2],s},ErrorDialog:X});function Q(e){e instanceof HTMLElement&&e.focus()}function ee(e,t){return(0,o.jsx)("div",{className:(0,h.$)("PRIVATE_TreeView-item-level-line","prc-TreeView-TreeViewItemLevelLine-KPSSL")},t)}function te(e,t){return(0,o.jsx)(H,{"aria-hidden":!0},t)}function ne(e){["Backspace","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter"].includes(e.key)&&e.stopPropagation()}ee.displayName="_temp2",te.displayName="_temp3";var oe=n(90385),re=n(71860),ae=n(9448),se=n(13383),ie=n(79107),le=n(48461),ce=n(55285),de=n(41273),ue=n(80258);function he(e,t){let n=e.map(e=>({...e,fileType:t?.getFileTypeForModel(e)}));return n=n.filter(e=>!e.name.startsWith(".")),n.sort((e,t)=>"directory"===e.type&&"directory"!==t.type?-1:"directory"!==e.type&&"directory"===t.type?1:e.name.localeCompare(t.name)),n}function pe(e){const{item:t,contents:n,current:a,documentRegistry:s,onContextMenu:i,onSelect:l}=e,c=(0,r.useRef)(null),[d,u]=(0,r.useState)(null),[h,p]=(0,r.useState)(!1),m=(0,r.useCallback)(()=>{p(!0),n.get(t.path).then(e=>{p(!1),u(he(e.content,s))}).catch(()=>{p(!1)})},[n,t,s]),v=(0,r.useCallback)(async e=>{null===d&&e&&m()},[d,t,n]);return(0,o.jsxs)(Y.Item,{ref:c,id:`${t.type}-${t.name}`,onExpandedChange:v,onSelect:()=>{l(t,m)},current:t.path===a?.path,children:[(0,o.jsx)(Y.LeadingVisual,{children:(0,o.jsx)(Y.DirectoryIcon,{})}),(0,o.jsx)("span",{onContextMenu:e=>{e.preventDefault(),a?.path!==t.path&&l(t,m),i(c)},children:t.name}),(0,o.jsx)(Y.SubTree,{state:h?"loading":(d?.length??-1)>=0?"done":"initial",children:d?.map(e=>"directory"===e.type?(0,o.jsx)(pe,{item:e,contents:n,current:a,documentRegistry:s,onContextMenu:i,onSelect:l},e.name):(0,o.jsx)(me,{item:e,current:e.path===a?.path,onSelect:e=>l(e,m),onContextMenu:i},e.name))})]})}function me(e){const{item:t,current:n,onSelect:a,onContextMenu:s}=e,i=(0,r.useRef)(null),l=t.fileType?.icon;return(0,o.jsxs)(Y.Item,{ref:i,id:`${t.type}-${t.name}`,current:n,onSelect:()=>{a(t)},children:[(0,o.jsx)(Y.LeadingVisual,{children:l?(0,o.jsx)(l.react,{tag:"span"}):(0,o.jsx)(u.oSV,{})}),(0,o.jsx)("span",{onContextMenu:e=>{e.preventDefault(),n||a(t),s(i)},children:t.name})]},t.name)}const ve=1048576;function fe(e){const{contents:t,localContents:n,documentRegistry:d}=e,u=(0,ce.aq)(),{trackAsyncTask:h}=(0,de.d)(),[p,m]=(0,r.useState)(null),[v,f]=(0,r.useState)(!0),[g,w]=(0,r.useState)(null),[y,b]=(0,r.useState)(null),[k,x]=(0,r.useState)(!1),[C,S]=(0,r.useState)(!1),T=(0,r.useCallback)(()=>{t.get("").then(e=>{f(!1),m(he(e.content,d))}).catch(e=>{f(!1),console.error(`Failed to fetch folder '' content for manager ${t.serverSettings.appUrl}.`,e)})},[t]);(0,r.useEffect)(()=>{T()},[T]);const A=(0,r.useCallback)(async e=>{const n=()=>{if(!u())return Promise.reject(`Failed to upload ${e.name}; StorageBrowser component is unmounted.`)};n();const o=e.size>ve,r=g?"directory"===g.type?g.path:a.PathExt.dirname(g.path):"",i=r?a.PathExt.join(r,e.name):e.name,l=e.name,c=async(o,r)=>{n();const a=new FileReader;a.readAsDataURL(o),await new Promise((t,n)=>{a.onload=t,a.onerror=t=>n(`Failed to upload "${e.name}":`+t)}),n();const s=a.result.split(",")[1],c={type:"file",format:"base64",name:l,chunk:r,content:s};return await t.save(i,c)},d={error:{message:t=>{const n=`Failed to upload ${e.name}.`;return console.error(n,t),n}},pending:{message:`Uploading ${e.name}…`},success:{message:()=>`${e.name} uploaded.`}};if(!o){const t=c(e);return h(t,d),t.then(()=>{g?g.refresh():T()}),t}{const t=new s.PromiseDelegate;h(t.promise,d);try{let n;for(let o=0;!n;o+=ve){const r=o+ve,a=r>=e.size,s=a?-1:r/ve,i=await c(e.slice(o,r),s);a&&(n=i,t.resolve(n))}return g?g.refresh():T(),n}catch(e){throw t.reject(e),e}}},[t,g,T]),V=(0,r.useCallback)(e=>{b(y===e?null:e)},[y]),I=(0,r.useCallback)(()=>{x(!0)},[]),_=(0,r.useCallback)(()=>{if(g){const e=t.delete(g.path);h(e,{success:{message:()=>`${g.path} deleted.`},pending:{message:`Deleting ${g.path}…`},error:{message:e=>{const t=`Failed to delete ${g.path}.`;return console.error(t,e),t}}}),e.finally(()=>{g.refresh()})}x(!1)},[t,g]),E=(0,r.useCallback)(()=>{S(!0)},[]),j=(0,r.useCallback)(()=>{g&&n&&t.get(g.path).then(e=>{const t=n?.save(e.path,e);h(t,{success:{message:()=>`${g.path} copied to local.`},pending:{message:`Copying to local ${g.path}…`},error:{message:e=>{const t=`Failed to copy to local ${g.path}.`;return console.error(t,e),t}}}),t.finally(()=>{g.refresh()}),S(!1)})},[n,g]),N=(0,r.useCallback)((e,t)=>{w(e.path===g?.path?null:{...e,refresh:t})},[g]);return(0,o.jsxs)(ae.az,{sx:{display:"grid",gridTemplateAreas:'"header" "content"'},children:[(0,o.jsxs)(ae.az,{sx:{gridArea:"header",display:"flex",alignItems:"center"},children:[(0,o.jsx)(i.A,{as:"h4",sx:{fontSize:"var(--text-title-size-small)",lineHeight:"var(--text-title-lineHeight-medium)",fontWeight:"var(--text-title-weight-medium)",flex:"1 1 auto"},children:"Contents Browser"}),(0,o.jsxs)(ae.az,{children:[(0,o.jsx)(l.K,{variant:"invisible","aria-label":"Refresh contents browser.",title:"Refresh contents browser.",icon:le.A,onClick:T}),(0,o.jsx)(ue.HF,{label:"Upload a file",multiple:!0,upload:A})]})]}),v?(0,o.jsx)(ae.az,{sx:{gridArea:"content",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px",height:"100vh"},children:(0,o.jsx)(c.A,{})}):(0,o.jsx)(ae.az,{sx:{gridArea:"content"},children:p?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Y,{children:p?.map(e=>"directory"===e.type?(0,o.jsx)(pe,{item:e,contents:t,current:g,documentRegistry:d,onContextMenu:V,onSelect:N},e.name):(0,o.jsx)(me,{item:e,current:g?.path===e.path,onSelect:e=>{N(e,T)},onContextMenu:V},e.name))}),(0,o.jsx)(oe.W,{anchorRef:y??void 0,open:null!==y?.current,onOpenChange:()=>{b(null)},children:(0,o.jsx)(oe.W.Overlay,{children:(0,o.jsxs)(re.l,{children:[(0,o.jsx)(re.l.Item,{title:"Delete the active item.",onSelect:I,children:"Delete…"}),n&&(0,o.jsx)(re.l.Item,{title:"Copy the active item to the local drive.",onSelect:E,children:"Copy to local drive…"})]})})}),k&&(0,o.jsx)(se.l,{title:(0,o.jsx)("span",{style:{color:"var(--fgColor-default)"},children:"Confirm deletion"}),onClose:()=>{x(!1)},footerButtons:[{buttonType:"default",content:"Cancel",onClick:()=>{x(!1)}},{buttonType:"danger",content:"Delete",onClick:()=>{_()}}],children:`Are you sure you want to delete ${g?.path}?`}),C&&(0,o.jsx)(se.l,{title:(0,o.jsx)("span",{style:{color:"var(--fgColor-default)"},children:"Confirm copy to local"}),onClose:()=>{S(!1)},footerButtons:[{buttonType:"default",content:"Cancel",onClick:()=>{S(!1)}},{buttonType:"danger",content:"Copy to local",onClick:()=>{j()}}],children:`Are you sure you want to copy to local ${g?.path}?`})]}):(0,o.jsx)(ie.E,{children:(0,o.jsx)(ie.E.Heading,{children:"No contents"})})})]})}},96834:(e,t,n)=>{n.d(t,{P:()=>V});var o=n(18683),r=n(9387),a=n(34164),s=n(26676),i=n(18987),l=n(46186),c=n.n(l),d=n(17468);c()(d.A,{insert:"head",singleton:!1}),d.A.locals;const u={disabled:"[disabled]",hidden:"[hidden]",inert:"[inert]",negativeTabIndex:'[tabindex="-1"]'},h=["a[href]","button","summary","select","input:not([type=hidden])","textarea",'[tabindex="0"]',"audio[controls]","video[controls]","[contenteditable]"].map(e=>`${e}:not(${Object.values(u).join("):not(")})`);function p(e,t){if(!e||m(e))return!1;const n=v(e,[e]);return Boolean(n)}function m(e){const t=getComputedStyle(e),n=e.matches("[disabled], [hidden], [inert]"),o="none"===t.display||"hidden"===t.visibility;return n||o}function v(e,t){if(!e)return;const n=t.find(t=>t===e),o=m(e);if(e.matches(h.join(", "))&&!n&&!o)return e;for(const n of e.children)if(v(n,t))return!0}var f=n(49180);const g=(e,t)=>r.Children.map(e,e=>r.isValidElement(e)?r.cloneElement(e,{...e.props,square:"square"===t||void 0,className:(0,a.$)(e.props.className,"pc-AvatarItem","prc-AvatarStack-AvatarItem-nS1mt")}):e),w=({disableExpand:e,hasInteractiveChildren:t,stackContainer:n,children:r})=>(0,o.jsx)("div",{"data-disable-expand":e?"":void 0,className:(0,a.$)({"pc-AvatarStack--disableExpand":e},"pc-AvatarStackBody","prc-AvatarStack-AvatarStackBody-mSyoJ"),tabIndex:t||e?void 0:0,ref:n,children:r});w.displayName="AvatarStackBody";const y=({children:e,variant:t="cascade",shape:n="circle",alignRight:l,disableExpand:c,size:d,className:u,style:h,sx:m})=>{const[v,y]=(0,r.useState)(!1),b=(0,r.useRef)(null),k=r.Children.count(e),x=(()=>{const t={narrow:[],regular:[],wide:[]};return r.Children.toArray(e).reduce((e,n)=>{if(!r.isValidElement(n))return e;for(const o of Object.keys(t))(0,i.W8)(n.props.size)?t[o].push(n.props.size[o]||s.E):t[o].push(n.props.size||s.E),e[o]=Math.min(...t[o]);return e},{narrow:s.E,regular:s.E,wide:s.E})})();return(0,r.useEffect)(()=>{if(b.current){const e=()=>{y(p(b.current))},t=new MutationObserver(e);return t.observe(b.current,{childList:!0}),e(),()=>{t.disconnect()}}},[]),(0,o.jsx)(f._,{as:"span","data-variant":t,"data-shape":n,"data-avatar-count":k>3?"3+":k,"data-align-right":l?"":void 0,"data-responsive":!d||(0,i.W8)(d)?"":void 0,className:(0,a.$)({"pc-AvatarStack--variant":t,"pc-AvatarStack--shape":n,"pc-AvatarStack--two":2===k,"pc-AvatarStack--three":3===k,"pc-AvatarStack--three-plus":k>3,"pc-AvatarStack--right":l},u,"prc-AvatarStack-AvatarStack-N-r3C"),style:{...d?(0,i.W8)(d)?{"--stackSize-narrow":`${d.narrow||s.E}px`,"--stackSize-regular":`${d.regular||s.E}px`,"--stackSize-wide":`${d.wide||s.E}px`}:{"--avatar-stack-size":`${d}px`}:{"--stackSize-narrow":`${x.narrow}px`,"--stackSize-regular":`${x.regular}px`,"--stackSize-wide":`${x.wide}px`},...h},sx:m,children:(0,o.jsxs)(w,{disableExpand:c,hasInteractiveChildren:v,stackContainer:b,children:[" ",g(e,n)]})})};y.displayName="AvatarStack";var b=n(45724),k=n(20061);const x=28,C="DatalayerSpacer",S=3e4;var T;!function(e){e.PROGRESS="var(--borderColor-accent-emphasis)",e.ERROR="var(--borderColor-danger-emphasis)",e.SUCCESS="var(--borderColor-success-emphasis)"}(T||(T={}));const A={"-1":T.ERROR,0:T.PROGRESS,1:T.SUCCESS};function V({awareness:e,currentUserHandle:t}){const[n,a]=(0,r.useState)([]);return(0,r.useEffect)(()=>{const n=()=>{const n=e.getStates();a(Array.from(n.values()).filter(e=>e.user&&e.user?.name!==t&&!(e.user?.agent??"").startsWith(C)).reduce((e,t)=>{const n=t.user,o=!((t.notification?.timestamp??0)+S<Date.now()),r=n.agent?{avatarUrl:"https://static.vecteezy.com/system/resources/previews/006/662/139/large_2x/artificial-intelligence-ai-processor-chip-icon-symbol-for-graphic-design-logo-web-site-social-media-mobile-app-ui-illustration-free-vector.jpg",color:n.color,displayName:n.agent,handle:"agent",initials:"AI",username:n.agent,notification:o?`${t.notification?.message} ${(0,b.g)(new Date(t.notification.timestamp))}`:void 0,notificationType:o&&void 0!==t.notification?.message_type?A[t.notification?.message_type.toString()]:void 0}:{avatarUrl:n.avatar_url,color:n.color,displayName:n.display_name,handle:n.name,initials:n.initials,username:n.username};return e.map(e=>e.username).includes(r.username)||e.push(r),e},[]))};n(),e.on("change",n);const o=setInterval(n,S/3);return()=>{clearInterval(o),e.off("change",n)}},[e,t]),(0,o.jsx)(y,{children:n.map(e=>{let t=`${e.displayName}\n${e.handle}`;return e.notification&&(t+=`\n${e.notification}`),(0,o.jsx)(s.A,{sx:{border:e.notificationType?`var(--borderWidth-thick) solid ${e.notificationType}`:"none"},title:t,src:e.avatarUrl?(0,k.$K)(e.avatarUrl):(n=e.color,r=e.initials,"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="12" fill="${n}" stroke="none" /><text x="12" y="12" fill="black">${r}</text></svg>`)),size:x},e.displayName);var n,r})})}}}]);