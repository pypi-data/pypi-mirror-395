[tox]
envlist = typecheck,lint,format,func
# Before 4.3.3, the requires for tox plugins didnt work properly
# See: https://github.com/tox-dev/tox/issues/2862
min_version = 4.3.3
requires =
    tox-ignore-env-name-mismatch ~= 0.2.0
no_package=true

[pytest]
minversion = 6.0
addopts = -vs

[testenv]
envdir = {work_dir}/common
runner = ignore_env_name_mismatch
deps =
    .
    .[test]
    .[doc]

[testenv:typecheck]
commands =
    mypy --strict pydantic_modelable tests/

[testenv:lint]
commands =
    ruff check ./pydantic_modelable tests/ {posargs}

[testenv:format]
commands =
    ruff format ./pydantic_modelable tests/ {posargs}

[testenv:func]
envdir = {work_dir}/autoreset
allowlist_externals = sh
deps =
    -e .[test]
commands =
    pip install -e ./tests/python_packages/core
    pip install -e ./tests/python_packages/ext1
    pip install -e ./tests/python_packages/ext2
    pytest tests/func

[testenv:doc]
commands =
    mkdocs {posargs:build}
