"use strict";(self.webpackChunkjupyterlab_chat_toy=self.webpackChunkjupyterlab_chat_toy||[]).push([[509],{94:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useStreaming=void 0;const a=o(893);t.useStreaming=()=>{const[e,t]=a.useState(!1),[o,r]=a.useState(null),n=a.useRef(null);return{isLoading:e,currentStreamingMessageId:o,streamToAI:async e=>{n.current=new AbortController;try{t(!0);const o=Date.now()+1;e.onNewMessage({id:o,content:"",sender:"ai",timestamp:new Date,type:"text"}),r(o);const a={model:"custom"===e.config.modelName?e.config.customModelName:e.config.modelName,messages:[...e.messages.slice(-10).map(e=>({role:"user"===e.sender?"user":"assistant",content:e.content})),{role:"user",content:e.message}],stream:!0,temperature:e.config.temperature,max_tokens:e.config.maxTokens},l=await fetch(e.config.backendUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),mode:"cors",signal:n.current.signal});if(!l.ok){const e=await l.text();throw new Error(`HTTP ${l.status}: ${l.statusText}. ${e}`)}await(async(e,t,o)=>{var a;const r=null===(a=e.body)||void 0===a?void 0:a.getReader(),n=new TextDecoder;if(!r)throw new Error("No reader available for stream");let l="",i="";try{for(;;){const{done:e,value:a}=await r.read();if(e)break;i+=n.decode(a,{stream:!0});const s=i.split("\n");i=s.pop()||"";for(const e of s){const a=e.trim();if(""!==a){if("data: [DONE]"===a)return;if(a.startsWith("data: "))try{const e=a.slice(6),r=JSON.parse(e);if(r.choices&&r.choices[0].delta){const e=r.choices[0].delta;e.content&&(l+=e.content,o(t,l))}}catch(e){console.warn("Failed to parse stream data:",e,"Data:",a)}}}}}finally{r.releaseLock()}})(l,o,e.onUpdateMessage)}catch(t){if("AbortError"===t.name)return void console.log("Request was aborted");console.error("Error in streaming AI call:",t),e.onError(t)}finally{n.current=null,r(null),t(!1)}},stopStreaming:()=>{n.current&&n.current.abort()},setIsLoading:t}}},117:function(e,t,o){var a=this&&this.__createBinding||(Object.create?function(e,t,o,a){void 0===a&&(a=o),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,a){void 0===a&&(a=o),e[a]=t[o]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&a(t,e,o);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatComponent=void 0;const l=n(o(893)),i=o(481),s=o(483),d=o(368),c=o(463),u=o(797),p=o(766),m=o(94),f=o(605),g=[{value:"gpt-3.5-turbo",label:"GPT-3.5 Turbo"},{value:"gpt-4",label:"GPT-4"},{value:"gpt-4-turbo",label:"GPT-4 Turbo"},{value:"claude-3-sonnet",label:"Claude 3 Sonnet"},{value:"claude-3-opus",label:"Claude 3 Opus"},{value:"llama-2-7b",label:"Llama 2 7B"},{value:"llama-2-13b",label:"Llama 2 13B"},{value:"llama-2-70b",label:"Llama 2 70B"},{value:"custom",label:"è‡ªå®šä¹‰æ¨¡å‹"}];t.ChatComponent=({notebookTracker:e})=>{const[t,o]=l.useState(""),[a,r]=l.useState(!0),{messages:n,config:x,addMessage:b,updateMessage:v,clearMessages:y,updateConfig:h,resetConfig:j,getActualModelName:k}=p.useChat(),{isLoading:E,currentStreamingMessageId:S,streamToAI:C,stopStreaming:w,setIsLoading:_}=m.useStreaming(),{shouldAutoScroll:I,messagesEndRef:M,messagesContainerRef:T,smartScrollToBottom:z,scrollToBottomManually:R}=f.useScroll(),N=()=>{r(e=>!e)},B=async()=>{if(!t.trim()||E)return;const e={id:Date.now(),content:t,sender:"user",timestamp:new Date,type:"text"};b(e),o(""),_(!0),z("smooth");try{await C({message:t,messages:[...n,e],config:x,onNewMessage:b,onUpdateMessage:v,onStreamingStart:e=>{},onStreamingEnd:()=>{},onError:e=>{const t={id:Date.now()+1,content:`è¯·æ±‚å¤±è´¥: ${e instanceof Error?e.message:"æœªçŸ¥é”™è¯¯"}`,sender:"ai",timestamp:new Date,type:"text"};b(t)}})}catch(e){console.error("Streaming failed:",e)}finally{_(!1)}},A=k();return l.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column",fontFamily:"var(--jp-ui-font-family)",fontSize:"var(--jp-ui-font-size1)",background:"var(--jp-layout-color0)"}},l.default.createElement(s.Header,{modelName:A,isLoading:E,onStop:w,onClear:()=>{w(),y()},onToggleConfig:N,isConfigVisible:a}),l.default.createElement(d.ConfigPanel,{config:x,modelOptions:g,onConfigChange:h,onReset:j,isVisible:a,onToggleVisibility:N}),l.default.createElement(c.MessageList,{messages:n,isLoading:E,currentStreamingMessageId:S,onInsertCode:(t,o)=>{if(!e)return console.error("Notebook tracker not available"),void alert("é”™è¯¯ï¼šæœªæ‰¾åˆ°æ´»åŠ¨çš„Notebook");const a=e.currentWidget;if(!a)return void alert("é”™è¯¯ï¼šè¯·å…ˆæ‰“å¼€ä¸€ä¸ªNotebook");const{content:r}=a,{activeCellIndex:n}=r;try{i.NotebookActions.insertBelow(r);const e=n+1,o=r.widgets[e];if(o&&"code"===o.model.type){if(o.model.value&&void 0!==o.model.value.text)o.model.value.text=t;else{if(!o.model.sharedModel||!o.model.sharedModel.setSource)return void alert("æ— æ³•è®¾ç½®ä»£ç å†…å®¹");o.model.sharedModel.setSource(t)}r.activeCellIndex=e}}catch(e){console.error("æ’å…¥ä»£ç å¤±è´¥:",e),alert("æ’å…¥ä»£ç å¤±è´¥ï¼Œè¯·é‡è¯•")}},onScrollToBottom:R,shouldAutoScroll:I,messagesEndRef:M,messagesContainerRef:T}),l.default.createElement(u.InputArea,{value:t,isLoading:E,modelName:A,temperature:x.temperature,maxTokens:x.maxTokens,onChange:o,onSend:B,onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),B())}}),l.default.createElement("style",null,"\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n        \n        @keyframes blink {\n          0%, 100% { opacity: 1; }\n          50% { opacity: 0; }\n        }\n\n        @keyframes slideDown {\n          from {\n            opacity: 0;\n            max-height: 0;\n            transform: translateY(-10px);\n          }\n          to {\n            opacity: 1;\n            max-height: 300px;\n            transform: translateY(0);\n          }\n        }\n\n        .jp-ChatWidget * {\n          scroll-behavior: smooth;\n        }\n      "))}},368:function(e,t,o){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigPanel=void 0;const r=a(o(893));t.ConfigPanel=({config:e,modelOptions:t,onConfigChange:o,onReset:a,isVisible:n,onToggleVisibility:l})=>{const i=()=>"custom"===e.modelName?e.customModelName:e.modelName;return n?r.default.createElement("div",{style:{padding:"8px 12px",borderBottom:"1px solid var(--jp-border-color1)",background:"var(--jp-layout-color1)",animation:"slideDown 0.2s ease-out"}},r.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",paddingBottom:"4px",borderBottom:"1px solid var(--jp-border-color2)"}},r.default.createElement("div",{style:{fontSize:"11px",color:"var(--jp-ui-font-color1)",fontWeight:"bold"}},"æ¨¡å‹é…ç½®"),r.default.createElement("button",{onClick:l,style:{background:"transparent",border:"1px solid var(--jp-border-color2)",color:"var(--jp-ui-font-color2)",borderRadius:"4px",padding:"1px 6px",fontSize:"9px",cursor:"pointer"},title:"éšè—é…ç½®é¢æ¿"},"éšè— â–²")),r.default.createElement("div",{style:{marginBottom:"8px"}},r.default.createElement("div",{style:{fontSize:"12px",marginBottom:"4px",color:"var(--jp-ui-font-color2)"}},"åç«¯æœåŠ¡åœ°å€:"),r.default.createElement("input",{type:"text",value:e.backendUrl,onChange:e=>{o({backendUrl:e.target.value})},style:{width:"100%",padding:"4px 8px",border:"1px solid var(--jp-border-color1)",borderRadius:"4px",fontSize:"12px",background:"var(--jp-input-background)",color:"var(--jp-ui-font-color1)"},placeholder:"è¾“å…¥åç«¯æœåŠ¡ URL"})),r.default.createElement("div",{style:{marginBottom:"8px"}},r.default.createElement("div",{style:{fontSize:"12px",marginBottom:"4px",color:"var(--jp-ui-font-color2)"}},"æ¨¡å‹é€‰æ‹©:"),r.default.createElement("select",{value:e.modelName,onChange:e=>{o({modelName:e.target.value})},style:{width:"100%",padding:"4px 8px",border:"1px solid var(--jp-border-color1)",borderRadius:"4px",fontSize:"12px",background:"var(--jp-input-background)",color:"var(--jp-ui-font-color1)"}},t.map(e=>r.default.createElement("option",{key:e.value,value:e.value},e.label)))),"custom"===e.modelName&&r.default.createElement("div",{style:{marginBottom:"8px"}},r.default.createElement("div",{style:{fontSize:"12px",marginBottom:"4px",color:"var(--jp-ui-font-color2)"}},"è‡ªå®šä¹‰æ¨¡å‹åç§°:"),r.default.createElement("input",{type:"text",value:e.customModelName,onChange:e=>{o({customModelName:e.target.value})},style:{width:"100%",padding:"4px 8px",border:"1px solid var(--jp-border-color1)",borderRadius:"4px",fontSize:"12px",background:"var(--jp-input-background)",color:"var(--jp-ui-font-color1)"},placeholder:"è¾“å…¥è‡ªå®šä¹‰æ¨¡å‹åç§°"})),r.default.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"}},r.default.createElement("div",null,r.default.createElement("div",{style:{fontSize:"12px",marginBottom:"4px",color:"var(--jp-ui-font-color2)"}},"æ¸©åº¦: ",e.temperature),r.default.createElement("input",{type:"range",min:"0",max:"2",step:"0.1",value:e.temperature,onChange:e=>{o({temperature:parseFloat(e.target.value)})},style:{width:"100%"}}),r.default.createElement("div",{style:{fontSize:"10px",color:"var(--jp-ui-font-color2)",display:"flex",justifyContent:"space-between"}},r.default.createElement("span",null,"ç²¾ç¡®"),r.default.createElement("span",null,"å¹³è¡¡"),r.default.createElement("span",null,"åˆ›æ„"))),r.default.createElement("div",null,r.default.createElement("div",{style:{fontSize:"12px",marginBottom:"4px",color:"var(--jp-ui-font-color2)"}},"æœ€å¤§é•¿åº¦: ",e.maxTokens),r.default.createElement("input",{type:"range",min:"100",max:"4000",step:"100",value:e.maxTokens,onChange:e=>{o({maxTokens:parseInt(e.target.value,10)})},style:{width:"100%"}}),r.default.createElement("div",{style:{fontSize:"10px",color:"var(--jp-ui-font-color2)",display:"flex",justifyContent:"space-between"}},r.default.createElement("span",null,"ç®€æ´"),r.default.createElement("span",null,"é€‚ä¸­"),r.default.createElement("span",null,"è¯¦ç»†")))),r.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px"}},r.default.createElement("button",{onClick:a,style:{background:"transparent",border:"1px solid var(--jp-border-color1)",color:"var(--jp-ui-font-color2)",borderRadius:"4px",padding:"2px 8px",fontSize:"10px",cursor:"pointer"}},"é‡ç½®è®¾ç½®"),r.default.createElement("div",{style:{fontSize:"10px",color:"var(--jp-ui-font-color2)"}},"å½“å‰æ¨¡å‹: ",i()))):r.default.createElement("div",{style:{padding:"4px 12px",borderBottom:"1px solid var(--jp-border-color1)",background:"var(--jp-layout-color1)",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:l,title:"ç‚¹å‡»å±•å¼€é…ç½®é¢æ¿"},r.default.createElement("div",{style:{fontSize:"11px",color:"var(--jp-ui-font-color2)",display:"flex",alignItems:"center",gap:"8px"}},r.default.createElement("span",{style:{fontSize:"10px"}},"â–¼"),r.default.createElement("span",null,"é…ç½®é¢æ¿å·²éšè—")),r.default.createElement("div",{style:{fontSize:"10px",color:"var(--jp-ui-font-color2)",background:"var(--jp-layout-color2)",padding:"2px 6px",borderRadius:"10px"}},i()," | T:",e.temperature," | L:",e.maxTokens))}},463:function(e,t,o){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageList=void 0;const r=a(o(893)),n=o(612);t.MessageList=({messages:e,isLoading:t,currentStreamingMessageId:o,onInsertCode:a,onScrollToBottom:l,shouldAutoScroll:i,messagesEndRef:s,messagesContainerRef:d})=>r.default.createElement("div",{ref:d,style:{flex:1,overflow:"auto",padding:"8px",background:"var(--jp-layout-color0)",position:"relative"}},e.map(e=>r.default.createElement(n.MessageItem,{key:e.id,message:e,isStreaming:o===e.id,onInsertCode:a})),t&&!o&&r.default.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:"12px"}},r.default.createElement("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"var(--jp-accent-color1)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",marginRight:"6px",flexShrink:0}},"ğŸ¤–"),r.default.createElement("div",{style:{background:"var(--jp-layout-color2)",padding:"6px 10px",borderRadius:"12px",border:"1px solid var(--jp-border-color1)",color:"var(--jp-ui-font-color2)",fontSize:"12px",display:"flex",alignItems:"center"}},r.default.createElement("div",{style:{width:"12px",height:"12px",border:"2px solid var(--jp-ui-font-color3)",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite",marginRight:"6px"}}),"AIæ­£åœ¨æ€è€ƒ...")),!i&&r.default.createElement("button",{onClick:l,style:{position:"sticky",bottom:"16px",left:"50%",transform:"translateX(-50%)",background:"var(--jp-brand-color1)",color:"white",border:"none",borderRadius:"20px",padding:"8px 16px",fontSize:"12px",cursor:"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",zIndex:100,display:"flex",alignItems:"center",gap:"6px"}},r.default.createElement("span",null,"â†“"),"æœ‰æ–°æ¶ˆæ¯"),r.default.createElement("div",{ref:s}))},483:function(e,t,o){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=void 0;const r=a(o(893));t.Header=({modelName:e,isLoading:t,onStop:o,onClear:a,onToggleConfig:n,isConfigVisible:l})=>r.default.createElement("div",{style:{background:"var(--jp-brand-color1)",color:"white",padding:"8px 12px",display:"flex",alignItems:"center",borderBottom:"1px solid var(--jp-border-color1)",justifyContent:"space-between"}},r.default.createElement("div",{style:{display:"flex",alignItems:"center"}},r.default.createElement("span",{style:{fontWeight:"bold",fontSize:"14px",marginRight:"8px"}},"ğŸ¤– AI èŠå¤© (æµå¼è¾“å‡º)"),r.default.createElement("div",{style:{background:"rgba(255,255,255,0.2)",padding:"2px 6px",borderRadius:"8px",fontSize:"11px"}},e)),r.default.createElement("div",{style:{display:"flex",gap:"8px",alignItems:"center"}},r.default.createElement("button",{onClick:n,style:{background:l?"rgba(255,255,255,0.3)":"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:"4px",padding:"2px 6px",fontSize:"11px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},title:l?"éšè—é…ç½®":"æ˜¾ç¤ºé…ç½®"},r.default.createElement("span",{style:{fontSize:"10px"}},l?"â–²":"â–¼"),"é…ç½®"),t&&r.default.createElement("button",{onClick:o,style:{background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:"4px",padding:"2px 6px",fontSize:"11px",cursor:"pointer"},title:"åœæ­¢ç”Ÿæˆ"},"åœæ­¢"),r.default.createElement("button",{onClick:a,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:"4px",padding:"2px 6px",fontSize:"11px",cursor:"pointer"},title:"æ¸…ç©ºå¯¹è¯"},"æ¸…ç©º")))},509:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=o(932),r=o(878),n=o(602),l=o(51),i=o(481),s=o(751),d=o(885);var c;!function(e){e.open="jupyterlab-chat:open"}(c||(c={}));const u={id:"jupyterlab-chat:plugin",autoStart:!0,requires:[r.ICommandPalette,i.INotebookTracker],optional:[n.ILauncher,a.ILayoutRestorer,l.ISettingRegistry],activate:(e,t,o,a,n,l)=>{const{commands:i,shell:p}=e,m=new r.WidgetTracker({namespace:"jupyterlab-chat-sidebar"});let f=null;i.addCommand(c.open,{label:"AI Chat",caption:"Open AI Chat Interface in Sidebar",icon:s.chatIcon,execute:()=>{f&&!f.isDisposed||(f=new d.ChatWidget(o),f.id="jupyterlab-chat-sidebar",f.title.label="AI Chat",f.title.closable=!0,f.title.icon=s.chatIcon,m.add(f),p.add(f,"left",{rank:800})),p.activateById(f.id)}}),t.addItem({command:c.open,category:"AI"}),a&&a.add({command:c.open,category:"AI"}),n&&n.restore(m,{command:c.open,name:()=>"jupyterlab-chat-sidebar"}),l&&Promise.all([l.load(u.id),e.restored]).then(([e])=>{console.log("jupyterlab-chat settings loaded:",e.composite)}).catch(e=>{console.warn("Failed to load settings for jupyterlab-chat, using defaults.",e)})}};t.default=u},526:function(e,t,o){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageContent=void 0;const r=a(o(893));t.MessageContent=({content:e,onInsertCode:t})=>r.default.createElement("div",{style:{lineHeight:"1.5",fontSize:"13px",fontFamily:"var(--jp-ui-font-family)"}},(()=>{if(!e)return null;try{return e.split(/(```[\s\S]*?```)/g).map((e,o)=>{if(e.startsWith("```")&&e.endsWith("```")){const a=e.match(/```(\w+)?\n?([\s\S]*?)```/);if(a){const e=a[1]||"text",n=a[2].trim();return r.default.createElement("div",{key:o},((e,o="text")=>r.default.createElement("div",{style:{position:"relative",margin:"8px 0"}},t&&r.default.createElement("button",{onClick:()=>((e,o)=>{t&&t(e,o)})(e,o),style:{position:"absolute",top:"4px",right:"4px",background:"var(--jp-brand-color1)",color:"white",border:"none",borderRadius:"3px",padding:"2px 6px",fontSize:"10px",cursor:"pointer",zIndex:10},title:"æ’å…¥åˆ°Jupyterå•å…ƒæ ¼"},"æ’å…¥ä»£ç "),r.default.createElement("pre",{style:{background:"var(--jp-code-cell-background)",border:"1px solid var(--jp-border-color1)",borderRadius:"4px",padding:"8px",overflowX:"auto",fontFamily:"var(--jp-code-font-family)",fontSize:"var(--jp-code-font-size)",lineHeight:"var(--jp-code-line-height)",margin:0}},r.default.createElement("code",{style:{color:"var(--jp-content-font-color1)",display:"block"}},e))))(n,e))}}const a=e.match(/(\|[^\n]+\|\r?\n\|[-:\s|]+\|\r?\n(?:\|[^\n]+\|\r?\n)*)/);return a?r.default.createElement("div",{key:o},(e=>{const t=e.split("\n").filter(e=>e.trim());if(t.length<2)return null;try{const e=t[0].split("|").filter(e=>""!==e.trim()).map(e=>e.trim()),o=t.slice(2).map(e=>e.split("|").filter(e=>""!==e.trim()).map(e=>e.trim())).filter(e=>e.length>0);return r.default.createElement("div",{style:{overflowX:"auto",margin:"12px 0"}},r.default.createElement("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:"400px",border:"1px solid var(--jp-border-color1)",fontSize:"12px"}},r.default.createElement("thead",null,r.default.createElement("tr",{style:{backgroundColor:"var(--jp-layout-color2)"}},e.map((e,t)=>r.default.createElement("th",{key:t,style:{border:"1px solid var(--jp-border-color1)",padding:"8px 12px",textAlign:"left",fontWeight:"bold"}},e)))),r.default.createElement("tbody",null,o.map((e,t)=>r.default.createElement("tr",{key:t,style:{borderBottom:"1px solid var(--jp-border-color2)"}},e.map((e,t)=>r.default.createElement("td",{key:t,style:{border:"1px solid var(--jp-border-color1)",padding:"8px 12px",textAlign:"left"}},e)))))))}catch(t){return console.error("è¡¨æ ¼æ¸²æŸ“é”™è¯¯:",t),r.default.createElement("div",{style:{whiteSpace:"pre-wrap"}},e)}})(a[0])):r.default.createElement("div",{key:o,style:{lineHeight:"1.5",margin:"4px 0",whiteSpace:"pre-wrap"}},e)})}catch(t){return console.error("å†…å®¹æ¸²æŸ“é”™è¯¯:",t),r.default.createElement("div",{style:{whiteSpace:"pre-wrap"}},e)}})())},605:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useScroll=void 0;const a=o(893);t.useScroll=()=>{const[e,t]=a.useState(!0),o=a.useRef(null),r=a.useRef(null),n=a.useRef(!0);a.useEffect(()=>()=>{n.current=!1},[]);const l=a.useCallback(()=>{if(!r.current)return!0;const e=r.current;return e.scrollHeight-e.scrollTop-e.clientHeight<=100},[]),i=a.useCallback((t="smooth")=>{n.current&&e&&requestAnimationFrame(()=>{o.current&&n.current&&o.current.scrollIntoView({behavior:t,block:"nearest"})})},[e]),s=a.useCallback(()=>{if(!r.current)return;const o=l();o&&!e?t(!0):!o&&e&&t(!1)},[e,l]);return a.useEffect(()=>{const e=r.current;if(e)return e.addEventListener("scroll",s),()=>{e.removeEventListener("scroll",s)}},[s]),{shouldAutoScroll:e,messagesEndRef:o,messagesContainerRef:r,smartScrollToBottom:i,scrollToBottomManually:()=>{t(!0),i("smooth")},handleMessagesScroll:s}}},612:function(e,t,o){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageItem=void 0;const r=a(o(893)),n=o(526);t.MessageItem=({message:e,isStreaming:t,onInsertCode:o})=>r.default.createElement("div",{style:{display:"flex",flexDirection:"user"===e.sender?"row-reverse":"row",alignItems:"flex-start",marginBottom:"12px"}},r.default.createElement("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"user"===e.sender?"var(--jp-brand-color1)":"var(--jp-accent-color1)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",margin:"user"===e.sender?"0 0 0 6px":"0 6px 0 0",flexShrink:0}},"user"===e.sender?"ğŸ‘¤":"ğŸ¤–"),r.default.createElement("div",{style:{maxWidth:"85%",textAlign:"user"===e.sender?"right":"left"}},r.default.createElement("div",{style:{background:"user"===e.sender?"var(--jp-brand-color1)":"var(--jp-layout-color2)",color:"user"===e.sender?"white":"var(--jp-ui-font-color1)",padding:"6px 10px",borderRadius:"12px",border:"1px solid var(--jp-border-color1)",wordBreak:"break-word",position:"relative"}},r.default.createElement(n.MessageContent,{content:e.content,onInsertCode:o}),t&&r.default.createElement("span",{style:{display:"inline-block",width:"2px",height:"1em",background:"var(--jp-ui-font-color1)",marginLeft:"2px",animation:"blink 1s infinite"}})),r.default.createElement("div",{style:{fontSize:"10px",color:"var(--jp-ui-font-color2)",marginTop:"2px"}},e.timestamp.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),t&&" Â· ç”Ÿæˆä¸­...")))},751:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.chatIcon=void 0;const a=o(901);t.chatIcon=new a.LabIcon({name:"jupyterlab-chat:chat",svgstr:'\n<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n</svg>\n'})},766:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useChat=void 0;const a=o(893);t.useChat=e=>{const[t,o]=a.useState([{id:1,content:"ä½ å¥½ï¼æˆ‘æ˜¯ AI åŠ©æ‰‹ã€‚ç°åœ¨æ”¯æŒæµå¼è¾“å‡ºå’Œæ¨¡å‹åˆ‡æ¢ï¼Œä½“éªŒæ›´ä½³ã€‚",sender:"ai",timestamp:new Date,type:"text"}]),[r,n]=a.useState({backendUrl:"http://localhost:8888/v1/chat/completions",modelName:"gpt-3.5-turbo",customModelName:"",temperature:.7,maxTokens:2e3,...e});return{messages:t,config:r,addMessage:e=>{o(t=>[...t,e])},updateMessage:(e,t)=>{o(o=>o.map(o=>o.id===e?{...o,content:t,timestamp:new Date}:o))},clearMessages:()=>{o([{id:1,content:"å¯¹è¯å·²æ¸…ç©ºã€‚ç°åœ¨æ”¯æŒæµå¼è¾“å‡ºå’Œæ¨¡å‹åˆ‡æ¢ï¼Œä½“éªŒæ›´ä½³ã€‚",sender:"ai",timestamp:new Date,type:"text"}])},updateConfig:e=>{n(t=>({...t,...e}))},resetConfig:()=>{n({backendUrl:"http://localhost:8888/v1/chat/completions",modelName:"gpt-3.5-turbo",customModelName:"",temperature:.7,maxTokens:2e3,...e})},getActualModelName:()=>"custom"===r.modelName?r.customModelName:r.modelName}}},797:function(e,t,o){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InputArea=void 0;const r=a(o(893));t.InputArea=({value:e,isLoading:t,modelName:o,temperature:a,maxTokens:n,onChange:l,onSend:i,onKeyPress:s})=>r.default.createElement("div",{style:{borderTop:"1px solid var(--jp-border-color1)",padding:"10px",background:"var(--jp-layout-color1)"}},r.default.createElement("div",{style:{display:"flex",alignItems:"flex-end",gap:"6px"}},r.default.createElement("textarea",{style:{flex:1,minHeight:"36px",maxHeight:"100px",padding:"6px 10px",border:"1px solid var(--jp-border-color1)",borderRadius:"4px",background:"var(--jp-input-background)",color:"var(--jp-ui-font-color1)",fontFamily:"inherit",fontSize:"13px",resize:"vertical",outline:"none"},placeholder:"è¾“å…¥ä½ çš„é—®é¢˜...",value:e,onChange:e=>l(e.target.value),onKeyPress:s,disabled:t,rows:1}),r.default.createElement("button",{style:{background:e.trim()&&!t?"var(--jp-brand-color1)":"var(--jp-layout-color3)",color:"white",border:"none",borderRadius:"4px",padding:"6px 12px",cursor:e.trim()&&!t?"pointer":"not-allowed",height:"36px",fontSize:"12px",fontWeight:"bold"},onClick:i,disabled:!e.trim()||t},t?"ç”Ÿæˆä¸­...":"å‘é€")),r.default.createElement("div",{style:{fontSize:"10px",color:"var(--jp-ui-font-color2)",marginTop:"4px",textAlign:"center"}},"æµå¼è¾“å‡º | æ¨¡å‹: ",o," | æ¸©åº¦: ",a," | æœ€å¤§é•¿åº¦: ",n))},885:function(e,t,o){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatWidget=void 0;const r=a(o(893)),n=o(878),l=o(117);class i extends n.ReactWidget{constructor(e){super(),this.notebookTracker=e,this.id="ai-chat-widget",this.title.label="AI Chat",this.title.closable=!0,this.addClass("jp-ChatWidget")}render(){return r.default.createElement(l.ChatComponent,{notebookTracker:this.notebookTracker})}}t.ChatWidget=i}}]);