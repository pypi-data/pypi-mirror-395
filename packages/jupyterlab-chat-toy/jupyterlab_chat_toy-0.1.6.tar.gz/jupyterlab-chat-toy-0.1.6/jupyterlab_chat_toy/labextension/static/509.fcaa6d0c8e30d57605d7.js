"use strict";(self.webpackChunkjupyterlab_chat_toy=self.webpackChunkjupyterlab_chat_toy||[]).push([[509],{94:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useStreaming=void 0;const r=o(893);t.useStreaming=()=>{const[e,t]=r.useState(!1),[o,n]=r.useState(null),a=r.useRef(null);return{isLoading:e,currentStreamingMessageId:o,streamToAI:async e=>{a.current=new AbortController;try{t(!0);const o=Date.now()+1;e.onNewMessage({id:o,content:"",sender:"ai",timestamp:new Date,type:"text"}),n(o);const r={model:"custom"===e.config.modelName?e.config.customModelName:e.config.modelName,messages:[...e.messages.slice(-10).map(e=>({role:"user"===e.sender?"user":"assistant",content:e.content})),{role:"user",content:e.message}],stream:!0,temperature:e.config.temperature,max_tokens:e.config.maxTokens},l=await fetch(e.config.backendUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),mode:"cors",signal:a.current.signal});if(!l.ok){const e=await l.text();throw new Error(`HTTP ${l.status}: ${l.statusText}. ${e}`)}await(async(e,t,o)=>{var r;const n=null===(r=e.body)||void 0===r?void 0:r.getReader(),a=new TextDecoder;if(!n)throw new Error("No reader available for stream");let l="",i="";try{for(;;){const{done:e,value:r}=await n.read();if(e)break;i+=a.decode(r,{stream:!0});const s=i.split("\n");i=s.pop()||"";for(const e of s){const r=e.trim();if(""!==r){if("data: [DONE]"===r)return;if(r.startsWith("data: "))try{const e=r.slice(6),n=JSON.parse(e);if(n.choices&&n.choices[0].delta){const e=n.choices[0].delta;e.content&&(l+=e.content,o(t,l))}}catch(e){console.warn("Failed to parse stream data:",e,"Data:",r)}}}}}finally{n.releaseLock()}})(l,o,e.onUpdateMessage)}catch(t){if("AbortError"===t.name)return void console.log("Request was aborted");console.error("Error in streaming AI call:",t),e.onError(t)}finally{a.current=null,n(null),t(!1)}},stopStreaming:()=>{a.current&&a.current.abort()},setIsLoading:t}}},117:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&r(t,e,o);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatComponent=void 0;const l=a(o(893)),i=o(481),s=o(483),d=o(368),c=o(463),u=o(797),p=o(766),m=o(94),f=o(605),g=o(471),x=[{value:"gpt-3.5-turbo",label:"GPT-3.5 Turbo"},{value:"gpt-4",label:"GPT-4"},{value:"gpt-4-turbo",label:"GPT-4 Turbo"},{value:"claude-3-sonnet",label:"Claude 3 Sonnet"},{value:"claude-3-opus",label:"Claude 3 Opus"},{value:"llama-2-7b",label:"Llama 2 7B"},{value:"llama-2-13b",label:"Llama 2 13B"},{value:"llama-2-70b",label:"Llama 2 70B"},{value:"custom",label:"è‡ªå®šä¹‰æ¨¡å‹"}];t.ChatComponent=({notebookTracker:e})=>{const[t,o]=l.useState(""),[r,n]=l.useState(!0),[a,y]=l.useState(!0),{messages:b,config:v,addMessage:h,updateMessage:E,clearMessages:k,updateConfig:C,resetConfig:j,getActualModelName:S}=p.useChat(),{isLoading:w,currentStreamingMessageId:M,streamToAI:_,stopStreaming:I,setIsLoading:T}=m.useStreaming(),{shouldAutoScroll:z,messagesEndRef:A,messagesContainerRef:R,smartScrollToBottom:N,scrollToBottomManually:D}=f.useScroll();l.useEffect(()=>{const t=g.isErrorDetectionSupported(e);y(t),t||console.warn("é”™è¯¯æ£€æµ‹åŠŸèƒ½åœ¨å½“å‰JupyterLabç‰ˆæœ¬ä¸­å¯èƒ½ä¸å¯ç”¨")},[e]);const P=()=>{n(e=>!e)},B=async()=>{if(!t.trim()||w)return;if("/help"===t.trim())return L(),void o("");if(t.trim().startsWith("/fix")){if(!a){const e={id:Date.now(),content:"âš ï¸ é”™è¯¯æ£€æµ‹åŠŸèƒ½åœ¨å½“å‰JupyterLabç‰ˆæœ¬ä¸­ä¸å¯ç”¨ã€‚è¯·å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬æˆ–ä½¿ç”¨å…¶ä»–æ–¹æ³•åˆ†æé”™è¯¯ã€‚",sender:"ai",timestamp:new Date,type:"text"};return h(e),o(""),void N("smooth")}const r=g.handleFixCommand(e,t);if(!r.shouldContinue){if(r.error){const e={id:Date.now(),content:r.error,sender:"ai",timestamp:new Date,type:"text"};return h(e),o(""),void N("smooth")}if(r.analysisPrompt){const e={id:Date.now(),content:t,sender:"user",timestamp:new Date,type:"text"};h(e),o(""),T(!0),N("smooth");try{await _({message:r.analysisPrompt,messages:[...b,e],config:v,onNewMessage:h,onUpdateMessage:E,onStreamingStart:e=>{},onStreamingEnd:()=>{},onError:e=>{const t={id:Date.now()+1,content:`è¯·æ±‚å¤±è´¥: ${e instanceof Error?e.message:"æœªçŸ¥é”™è¯¯"}`,sender:"ai",timestamp:new Date,type:"text"};h(t)}})}catch(e){console.error("Streaming failed:",e)}finally{T(!1)}return}}}const r={id:Date.now(),content:t,sender:"user",timestamp:new Date,type:"text"};h(r),o(""),T(!0),N("smooth");try{await _({message:t,messages:[...b,r],config:v,onNewMessage:h,onUpdateMessage:E,onStreamingStart:e=>{},onStreamingEnd:()=>{},onError:e=>{const t={id:Date.now()+1,content:`è¯·æ±‚å¤±è´¥: ${e instanceof Error?e.message:"æœªçŸ¥é”™è¯¯"}`,sender:"ai",timestamp:new Date,type:"text"};h(t)}})}catch(e){console.error("Streaming failed:",e)}finally{T(!1)}},L=()=>{let e="ğŸ› ï¸ **å¯ç”¨å‘½ä»¤**\n\n`/fix` - åˆ†æå¹¶ä¿®å¤å½“å‰æ´»åŠ¨å•å…ƒæ ¼çš„é”™è¯¯\n   ç”¨æ³•: `/fix [é¢å¤–æè¿°]`\n   ç¤ºä¾‹: `/fix è¿™ä¸ªå‡½æ•°ä¸ºä»€ä¹ˆæŠ¥é”™ï¼Ÿ`\n   \n`/help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯";e+=a?"\n\n**é”™è¯¯ä¿®å¤åŠŸèƒ½è¯´æ˜**ï¼š\n1. ç¡®ä¿ä½ å·²ç»æ‰§è¡Œäº†åŒ…å«é”™è¯¯çš„ä»£ç å•å…ƒæ ¼\n2. å°†å…‰æ ‡æ”¾åœ¨æœ‰é”™è¯¯çš„å•å…ƒæ ¼ä¸Š\n3. è¾“å…¥ `/fix` å‘½ä»¤è·å–é”™è¯¯åˆ†æå’Œä¿®å¤æ–¹æ¡ˆ\n4. å¯ä»¥åœ¨å‘½ä»¤åæ·»åŠ é¢å¤–æè¿°ï¼Œå¦‚ `/fix è¿™ä¸ªæ•°æ®å¤„ç†çš„é”™è¯¯æ€ä¹ˆè§£å†³ï¼Ÿ`":"\n\nâš ï¸ **æ³¨æ„**: é”™è¯¯ä¿®å¤åŠŸèƒ½(`/fix`)åœ¨å½“å‰JupyterLabç‰ˆæœ¬ä¸­å¯èƒ½ä¸å¯ç”¨ã€‚\n   è¯·ç¡®ä¿ï¼š\n   1. ä½ ä½¿ç”¨çš„æ˜¯ JupyterLab 3.2.9 æˆ–æ›´é«˜ç‰ˆæœ¬\n   2. ä»£ç å•å…ƒæ ¼å·²æ‰§è¡Œå¹¶äº§ç”Ÿäº†é”™è¯¯\n   3. åŒ…å«é”™è¯¯çš„å•å…ƒæ ¼å¤„äºæ´»åŠ¨çŠ¶æ€",e+="\n\nğŸ’¡ æç¤ºï¼šå½“ä½ åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ `/` æ—¶ï¼Œä¼šæ˜¾ç¤ºå‘½ä»¤æç¤ºã€‚";const t={id:Date.now(),content:e,sender:"ai",timestamp:new Date,type:"text"};h(t),N("smooth")},[O,W]=l.useState(!1);l.useEffect(()=>{"/"===t.trim()?W(!0):(t.trim().startsWith("/fix"),W(!1))},[t]);const F=S();return l.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column",fontFamily:"var(--jp-ui-font-family)",fontSize:"var(--jp-ui-font-size1)",background:"var(--jp-layout-color0)",position:"relative"}},l.default.createElement(s.Header,{modelName:F,isLoading:w,onStop:I,onClear:()=>{I(),k()},onToggleConfig:P,isConfigVisible:r}),l.default.createElement(d.ConfigPanel,{config:v,modelOptions:x,onConfigChange:C,onReset:j,isVisible:r,onToggleVisibility:P}),l.default.createElement(c.MessageList,{messages:b,isLoading:w,currentStreamingMessageId:M,onInsertCode:(t,o)=>{if(!e)return console.error("Notebook tracker not available"),void alert("é”™è¯¯ï¼šæœªæ‰¾åˆ°æ´»åŠ¨çš„Notebook");const r=e.currentWidget;if(!r)return void alert("é”™è¯¯ï¼šè¯·å…ˆæ‰“å¼€ä¸€ä¸ªNotebook");const{content:n}=r,{activeCellIndex:a}=n;try{i.NotebookActions.insertBelow(n);const e=a+1,o=n.widgets[e];if(o&&"code"===o.model.type){const r=o.model;if(r.value&&void 0!==r.value.text)r.value.text=t;else if(r.sharedModel)if("function"==typeof r.sharedModel.setSource)r.sharedModel.setSource(t);else{if(void 0===r.sharedModel.source)return void alert("æ— æ³•è®¾ç½®ä»£ç å†…å®¹ï¼šsharedModel æ ¼å¼ä¸æ”¯æŒ");r.sharedModel.source=t}else{if(void 0===r.source)return void alert("æ— æ³•è®¾ç½®ä»£ç å†…å®¹ï¼šä¸æ”¯æŒçš„å•å…ƒæ ¼æ¨¡å‹");r.source=t}n.activeCellIndex=e}}catch(e){console.error("æ’å…¥ä»£ç å¤±è´¥:",e),alert("æ’å…¥ä»£ç å¤±è´¥ï¼Œè¯·é‡è¯•")}},onScrollToBottom:D,shouldAutoScroll:z,messagesEndRef:A,messagesContainerRef:R}),O&&l.default.createElement("div",{style:{position:"absolute",bottom:"80px",left:"10px",right:"10px",background:"var(--jp-layout-color1)",border:"1px solid var(--jp-border-color1)",borderRadius:"6px",padding:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:100,fontSize:"12px"}},l.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"}},l.default.createElement("span",{style:{fontWeight:"bold",color:"var(--jp-ui-font-color1)"}},"å¯ç”¨å‘½ä»¤"),l.default.createElement("button",{onClick:()=>W(!1),style:{background:"transparent",border:"none",color:"var(--jp-ui-font-color2)",cursor:"pointer",fontSize:"12px"}},"âœ•")),l.default.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},l.default.createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"4px",borderRadius:"4px",background:a?"var(--jp-layout-color2)":"var(--jp-layout-color3)",cursor:a?"pointer":"not-allowed",opacity:a?1:.6},onClick:()=>{a&&(o("/fix "),W(!1))},title:a?"":"é”™è¯¯æ£€æµ‹åŠŸèƒ½ä¸å¯ç”¨"},l.default.createElement("code",{style:{background:a?"var(--jp-brand-color1)":"var(--jp-ui-font-color3)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"11px"}},"/fix"),l.default.createElement("div",{style:{flex:1}},l.default.createElement("div",{style:{color:"var(--jp-ui-font-color1)"}},"åˆ†æå¹¶ä¿®å¤å½“å‰å•å…ƒæ ¼çš„é”™è¯¯"),!a&&l.default.createElement("div",{style:{fontSize:"10px",color:"var(--jp-ui-font-color3)",marginTop:"2px"}},"å½“å‰ç‰ˆæœ¬ä¸å¯ç”¨"))),l.default.createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"4px",borderRadius:"4px",background:"var(--jp-layout-color2)",cursor:"pointer"},onClick:()=>{o("/help"),W(!1)}},l.default.createElement("code",{style:{background:"var(--jp-accent-color1)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"11px"}},"/help"),l.default.createElement("span",{style:{color:"var(--jp-ui-font-color1)"}},"æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯")))),l.default.createElement(u.InputArea,{value:t,isLoading:w,modelName:F,temperature:v.temperature,maxTokens:v.maxTokens,onChange:o,onSend:B,onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),B())}}),l.default.createElement("style",null,"\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n        \n        @keyframes blink {\n          0%, 100% { opacity: 1; }\n          50% { opacity: 0; }\n        }\n\n        @keyframes slideDown {\n          from {\n            opacity: 0;\n            max-height: 0;\n            transform: translateY(-10px);\n          }\n          to {\n            opacity: 1;\n            max-height: 300px;\n            transform: translateY(0);\n          }\n        }\n\n        .jp-ChatWidget * {\n          scroll-behavior: smooth;\n        }\n      "))}},368:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigPanel=void 0;const n=r(o(893));t.ConfigPanel=({config:e,modelOptions:t,onConfigChange:o,onReset:r,isVisible:a,onToggleVisibility:l})=>{const i=()=>"custom"===e.modelName?e.customModelName:e.modelName;return a?n.default.createElement("div",{style:{padding:"8px 12px",borderBottom:"1px solid var(--jp-border-color1)",background:"var(--jp-layout-color1)",animation:"slideDown 0.2s ease-out"}},n.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",paddingBottom:"4px",borderBottom:"1px solid var(--jp-border-color2)"}},n.default.createElement("div",{style:{fontSize:"11px",color:"var(--jp-ui-font-color1)",fontWeight:"bold"}},"æ¨¡å‹é…ç½®"),n.default.createElement("button",{onClick:l,style:{background:"transparent",border:"1px solid var(--jp-border-color2)",color:"var(--jp-ui-font-color2)",borderRadius:"4px",padding:"1px 6px",fontSize:"9px",cursor:"pointer"},title:"éšè—é…ç½®é¢æ¿"},"éšè— â–²")),n.default.createElement("div",{style:{marginBottom:"8px"}},n.default.createElement("div",{style:{fontSize:"12px",marginBottom:"4px",color:"var(--jp-ui-font-color2)"}},"åç«¯æœåŠ¡åœ°å€:"),n.default.createElement("input",{type:"text",value:e.backendUrl,onChange:e=>{o({backendUrl:e.target.value})},style:{width:"100%",padding:"4px 8px",border:"1px solid var(--jp-border-color1)",borderRadius:"4px",fontSize:"12px",background:"var(--jp-input-background)",color:"var(--jp-ui-font-color1)"},placeholder:"è¾“å…¥åç«¯æœåŠ¡ URL"})),n.default.createElement("div",{style:{marginBottom:"8px"}},n.default.createElement("div",{style:{fontSize:"12px",marginBottom:"4px",color:"var(--jp-ui-font-color2)"}},"æ¨¡å‹é€‰æ‹©:"),n.default.createElement("select",{value:e.modelName,onChange:e=>{o({modelName:e.target.value})},style:{width:"100%",padding:"4px 8px",border:"1px solid var(--jp-border-color1)",borderRadius:"4px",fontSize:"12px",background:"var(--jp-input-background)",color:"var(--jp-ui-font-color1)"}},t.map(e=>n.default.createElement("option",{key:e.value,value:e.value},e.label)))),"custom"===e.modelName&&n.default.createElement("div",{style:{marginBottom:"8px"}},n.default.createElement("div",{style:{fontSize:"12px",marginBottom:"4px",color:"var(--jp-ui-font-color2)"}},"è‡ªå®šä¹‰æ¨¡å‹åç§°:"),n.default.createElement("input",{type:"text",value:e.customModelName,onChange:e=>{o({customModelName:e.target.value})},style:{width:"100%",padding:"4px 8px",border:"1px solid var(--jp-border-color1)",borderRadius:"4px",fontSize:"12px",background:"var(--jp-input-background)",color:"var(--jp-ui-font-color1)"},placeholder:"è¾“å…¥è‡ªå®šä¹‰æ¨¡å‹åç§°"})),n.default.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"}},n.default.createElement("div",null,n.default.createElement("div",{style:{fontSize:"12px",marginBottom:"4px",color:"var(--jp-ui-font-color2)"}},"æ¸©åº¦: ",e.temperature),n.default.createElement("input",{type:"range",min:"0",max:"2",step:"0.1",value:e.temperature,onChange:e=>{o({temperature:parseFloat(e.target.value)})},style:{width:"100%"}}),n.default.createElement("div",{style:{fontSize:"10px",color:"var(--jp-ui-font-color2)",display:"flex",justifyContent:"space-between"}},n.default.createElement("span",null,"ç²¾ç¡®"),n.default.createElement("span",null,"å¹³è¡¡"),n.default.createElement("span",null,"åˆ›æ„"))),n.default.createElement("div",null,n.default.createElement("div",{style:{fontSize:"12px",marginBottom:"4px",color:"var(--jp-ui-font-color2)"}},"æœ€å¤§é•¿åº¦: ",e.maxTokens),n.default.createElement("input",{type:"range",min:"100",max:"4000",step:"100",value:e.maxTokens,onChange:e=>{o({maxTokens:parseInt(e.target.value,10)})},style:{width:"100%"}}),n.default.createElement("div",{style:{fontSize:"10px",color:"var(--jp-ui-font-color2)",display:"flex",justifyContent:"space-between"}},n.default.createElement("span",null,"ç®€æ´"),n.default.createElement("span",null,"é€‚ä¸­"),n.default.createElement("span",null,"è¯¦ç»†")))),n.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"8px"}},n.default.createElement("button",{onClick:r,style:{background:"transparent",border:"1px solid var(--jp-border-color1)",color:"var(--jp-ui-font-color2)",borderRadius:"4px",padding:"2px 8px",fontSize:"10px",cursor:"pointer"}},"é‡ç½®è®¾ç½®"),n.default.createElement("div",{style:{fontSize:"10px",color:"var(--jp-ui-font-color2)"}},"å½“å‰æ¨¡å‹: ",i()))):n.default.createElement("div",{style:{padding:"4px 12px",borderBottom:"1px solid var(--jp-border-color1)",background:"var(--jp-layout-color1)",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:l,title:"ç‚¹å‡»å±•å¼€é…ç½®é¢æ¿"},n.default.createElement("div",{style:{fontSize:"11px",color:"var(--jp-ui-font-color2)",display:"flex",alignItems:"center",gap:"8px"}},n.default.createElement("span",{style:{fontSize:"10px"}},"â–¼"),n.default.createElement("span",null,"é…ç½®é¢æ¿å·²éšè—")),n.default.createElement("div",{style:{fontSize:"10px",color:"var(--jp-ui-font-color2)",background:"var(--jp-layout-color2)",padding:"2px 6px",borderRadius:"10px"}},i()," | T:",e.temperature," | L:",e.maxTokens))}},463:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageList=void 0;const n=r(o(893)),a=o(612);t.MessageList=({messages:e,isLoading:t,currentStreamingMessageId:o,onInsertCode:r,onScrollToBottom:l,shouldAutoScroll:i,messagesEndRef:s,messagesContainerRef:d})=>n.default.createElement("div",{ref:d,style:{flex:1,overflow:"auto",padding:"8px",background:"var(--jp-layout-color0)",position:"relative"}},e.map(e=>n.default.createElement(a.MessageItem,{key:e.id,message:e,isStreaming:o===e.id,onInsertCode:r})),t&&!o&&n.default.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:"12px"}},n.default.createElement("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"var(--jp-accent-color1)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",marginRight:"6px",flexShrink:0}},"ğŸ¤–"),n.default.createElement("div",{style:{background:"var(--jp-layout-color2)",padding:"6px 10px",borderRadius:"12px",border:"1px solid var(--jp-border-color1)",color:"var(--jp-ui-font-color2)",fontSize:"12px",display:"flex",alignItems:"center"}},n.default.createElement("div",{style:{width:"12px",height:"12px",border:"2px solid var(--jp-ui-font-color3)",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite",marginRight:"6px"}}),"AIæ­£åœ¨æ€è€ƒ...")),!i&&n.default.createElement("button",{onClick:l,style:{position:"sticky",bottom:"16px",left:"50%",transform:"translateX(-50%)",background:"var(--jp-brand-color1)",color:"white",border:"none",borderRadius:"20px",padding:"8px 16px",fontSize:"12px",cursor:"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",zIndex:100,display:"flex",alignItems:"center",gap:"6px"}},n.default.createElement("span",null,"â†“"),"æœ‰æ–°æ¶ˆæ¯"),n.default.createElement("div",{ref:s}))},471:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.debugCellStructure=t.isErrorDetectionSupported=t.handleFixCommand=t.buildErrorAnalysisPrompt=t.getCurrentCellCode=t.getCurrentCellErrors=void 0,t.getCurrentCellErrors=e=>{if(!e)return console.warn("Notebook tracker not available"),null;const t=e.currentWidget;if(!t)return console.warn("No active notebook found"),null;const{content:o}=t,r=o.activeCell;if(!r)return console.warn("No active cell found"),null;const n=(e=>{if(!e||"object"!=typeof e)return[];const t=e.outputs;if(!t)return[];if(Array.isArray(t))return t;try{if("function"==typeof t.toArray){const e=t.toArray();return Array.isArray(e)?e:[]}if(void 0!==t.length)return Array.from(t);if("object"==typeof t)return[t]}catch(e){console.error("Failed to convert outputs to array:",e)}return[]})(r.model);if(console.log("Cell outputs:",n),0===n.length)return null;const a=[];return n.forEach(e=>{try{if("error"===e.output_type){const t={ename:e.ename||"UnknownError",evalue:e.evalue||"Unknown error occurred",traceback:e.traceback||[]};a.push(t)}if("stream"===e.output_type&&"stderr"===e.name){let t="";Array.isArray(e.text)?t=e.text.join(""):"string"==typeof e.text&&(t=e.text),t.trim()&&a.push({ename:"StreamError",evalue:t.trim(),traceback:[]})}if("display_data"===e.output_type&&e.data){const t=e.data["text/plain"]||e.data["text/html"];"string"==typeof t&&(t.includes("Error")||t.includes("Exception"))&&a.push({ename:"DisplayError",evalue:t.substring(0,500),traceback:[]})}}catch(t){console.warn("Error processing cell output:",t,e)}}),a.length>0?a:null},t.getCurrentCellCode=e=>{if(!e)return null;const t=e.currentWidget;if(!t)return null;const o=t.content.activeCell;if(!o||"code"!==o.model.type)return null;const r=o.model;let n="";try{r.value&&void 0!==r.value.text?n=r.value.text:r.sharedModel?"function"==typeof r.sharedModel.getSource?n=r.sharedModel.getSource():void 0!==r.sharedModel.source&&(n=r.sharedModel.source):void 0!==r.source?n="string"==typeof r.source?r.source:"":r.getSource&&"function"==typeof r.getSource&&(n=r.getSource())}catch(e){console.warn("Error getting cell code:",e)}return n||null},t.buildErrorAnalysisPrompt=(e,t,o)=>{let r="è¯·å¸®æˆ‘åˆ†æå¹¶è§£å†³ä»¥ä¸‹Pythonä»£ç é”™è¯¯ï¼š\n\n";return r+=`é”™è¯¯ç±»å‹ï¼š${e.ename}\n`,r+=`é”™è¯¯ä¿¡æ¯ï¼š${e.evalue}\n\n`,e.traceback&&e.traceback.length>0&&(r+="å †æ ˆè·Ÿè¸ªï¼ˆæœ€è¿‘çš„éƒ¨åˆ†ï¼‰ï¼š\n",e.traceback.slice(-3).forEach(e=>{r+=`${e}\n`}),r+="\n"),o&&(r+=`ç›¸å…³ä»£ç ï¼š\n\`\`\`python\n${o}\n\`\`\`\n\n`),t&&(r+=`é¢å¤–ä¸Šä¸‹æ–‡ï¼š${t}\n\n`),r+="è¯·æŒ‰ä»¥ä¸‹æ ¼å¼å›ç­”ï¼š\n1. é”™è¯¯åŸå› åˆ†æ\n2. è§£å†³æ–¹æ¡ˆï¼ˆæ­¥éª¤æ¸…æ™°ï¼‰\n3. ä¿®å¤åçš„ä»£ç ç¤ºä¾‹ï¼ˆå¦‚æœæœ‰ï¼‰\n4. é¢„é˜²ç±»ä¼¼é”™è¯¯çš„å»ºè®®\n\nå¦‚æœé”™è¯¯ä¿¡æ¯ä¸è¶³ï¼Œè¯·å‘Šè¯‰æˆ‘éœ€è¦å“ªäº›é¢å¤–ä¿¡æ¯æ¥è¿›ä¸€æ­¥åˆ†æã€‚",r},t.handleFixCommand=(e,o)=>{if(console.log("handleFixCommand called with input:",o),!o.trim().startsWith("/fix"))return{shouldContinue:!0};const r=o.trim().substring(4).trim();if(!e||!e.currentWidget)return{shouldContinue:!1,error:"æ²¡æœ‰æ´»åŠ¨çš„Notebookã€‚è¯·å…ˆæ‰“å¼€ä¸€ä¸ªNotebookæ–‡ä»¶ã€‚"};const n=e.currentWidget;if(!n.content.activeCell)return{shouldContinue:!1,error:"æ²¡æœ‰æ´»åŠ¨çš„å•å…ƒæ ¼ã€‚è¯·å…ˆç‚¹å‡»ä¸€ä¸ªä»£ç å•å…ƒæ ¼ã€‚"};if("code"!==n.content.activeCell.model.type)return{shouldContinue:!1,error:"å½“å‰å•å…ƒæ ¼ä¸æ˜¯ä»£ç å•å…ƒæ ¼ã€‚è¯·é€‰æ‹©ä¸€ä¸ªä»£ç å•å…ƒæ ¼ã€‚"};const a=t.getCurrentCellErrors(e);if(console.log("Found errors:",a),!a||0===a.length){const o=t.getCurrentCellCode(e);return o?{shouldContinue:!1,analysisPrompt:`è¯·å¸®æˆ‘åˆ†æä»¥ä¸‹Pythonä»£ç ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰æ½œåœ¨é—®é¢˜æˆ–æ”¹è¿›å»ºè®®ï¼š\n\n\`\`\`python\n${o}\n\`\`\`\n\n${r?`é¢å¤–ä¸Šä¸‹æ–‡ï¼š${r}\n\n`:""}è¯·æä¾›ä»£ç åˆ†æå’Œæ”¹è¿›å»ºè®®ã€‚`}:{shouldContinue:!1,error:"å½“å‰æ´»åŠ¨å•å…ƒæ ¼æ²¡æœ‰é”™è¯¯ä¿¡æ¯ã€‚è¯·å…ˆæ‰§è¡ŒåŒ…å«é”™è¯¯çš„ä»£ç å•å…ƒæ ¼ï¼Œå¹¶ç¡®ä¿å®ƒå¤„äºæ´»åŠ¨çŠ¶æ€ã€‚"}}const l=a[0],i=t.getCurrentCellCode(e);return{shouldContinue:!1,analysisPrompt:t.buildErrorAnalysisPrompt(l,r,i)}},t.isErrorDetectionSupported=e=>{if(!e)return!1;try{const t=e.currentWidget;if(!t)return!0;const o=t.content.activeCell;if(!o)return!0;const r=o.model;if(void 0!==r.outputs){const e=r.outputs;return null!==e&&(Array.isArray(e)||"object"==typeof e&&void 0!==e.length)}return!1}catch(e){return console.warn("Error detection compatibility check failed:",e),!1}},t.debugCellStructure=e=>{if(!e||!e.currentWidget)return null;const t=e.currentWidget;if(!t.content.activeCell)return null;const o=t.content.activeCell.model;return{type:o.type,hasOutputs:void 0!==o.outputs,outputsType:typeof o.outputs,outputsIsArray:Array.isArray(o.outputs),outputsLength:o.outputs?Array.isArray(o.outputs)?o.outputs.length:"not an array":0,hasValue:void 0!==o.value,hasSharedModel:void 0!==o.sharedModel,hasSource:void 0!==o.source,keys:Object.keys(o).filter(e=>!e.startsWith("_"))}}},483:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=void 0;const n=r(o(893));t.Header=({modelName:e,isLoading:t,onStop:o,onClear:r,onToggleConfig:a,isConfigVisible:l})=>n.default.createElement("div",{style:{background:"var(--jp-brand-color1)",color:"white",padding:"8px 12px",display:"flex",alignItems:"center",borderBottom:"1px solid var(--jp-border-color1)",justifyContent:"space-between"}},n.default.createElement("div",{style:{display:"flex",alignItems:"center"}},n.default.createElement("span",{style:{fontWeight:"bold",fontSize:"14px",marginRight:"8px"}},"ğŸ¤– AI èŠå¤© (æµå¼è¾“å‡º)"),n.default.createElement("div",{style:{background:"rgba(255,255,255,0.2)",padding:"2px 6px",borderRadius:"8px",fontSize:"11px"}},e)),n.default.createElement("div",{style:{display:"flex",gap:"8px",alignItems:"center"}},n.default.createElement("button",{onClick:a,style:{background:l?"rgba(255,255,255,0.3)":"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:"4px",padding:"2px 6px",fontSize:"11px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},title:l?"éšè—é…ç½®":"æ˜¾ç¤ºé…ç½®"},n.default.createElement("span",{style:{fontSize:"10px"}},l?"â–²":"â–¼"),"é…ç½®"),t&&n.default.createElement("button",{onClick:o,style:{background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:"4px",padding:"2px 6px",fontSize:"11px",cursor:"pointer"},title:"åœæ­¢ç”Ÿæˆ"},"åœæ­¢"),n.default.createElement("button",{onClick:r,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:"4px",padding:"2px 6px",fontSize:"11px",cursor:"pointer"},title:"æ¸…ç©ºå¯¹è¯"},"æ¸…ç©º")))},509:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=o(932),n=o(878),a=o(602),l=o(51),i=o(481),s=o(751),d=o(885);var c;!function(e){e.open="jupyterlab-chat:open"}(c||(c={}));const u={id:"jupyterlab-chat:plugin",autoStart:!0,requires:[n.ICommandPalette,i.INotebookTracker],optional:[a.ILauncher,r.ILayoutRestorer,l.ISettingRegistry],activate:(e,t,o,r,a,l)=>{const{commands:i,shell:p}=e,m=new n.WidgetTracker({namespace:"jupyterlab-chat-sidebar"});let f=null;i.addCommand(c.open,{label:"AI Chat",caption:"Open AI Chat Interface in Sidebar",icon:s.chatIcon,execute:()=>{f&&!f.isDisposed||(f=new d.ChatWidget(o),f.id="jupyterlab-chat-sidebar",f.title.label="AI Chat",f.title.closable=!0,f.title.icon=s.chatIcon,m.add(f),p.add(f,"left",{rank:800})),p.activateById(f.id)}}),t.addItem({command:c.open,category:"AI"}),r&&r.add({command:c.open,category:"AI"}),a&&a.restore(m,{command:c.open,name:()=>"jupyterlab-chat-sidebar"}),l&&Promise.all([l.load(u.id),e.restored]).then(([e])=>{console.log("jupyterlab-chat settings loaded:",e.composite)}).catch(e=>{console.warn("Failed to load settings for jupyterlab-chat, using defaults.",e)})}};t.default=u},526:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageContent=void 0;const n=r(o(893));t.MessageContent=({content:e,onInsertCode:t})=>n.default.createElement("div",{style:{lineHeight:"1.5",fontSize:"13px",fontFamily:"var(--jp-ui-font-family)"}},(()=>{if(!e)return null;try{return e.split(/(```[\s\S]*?```)/g).map((e,o)=>{if(e.startsWith("```")&&e.endsWith("```")){const r=e.match(/```(\w+)?\n?([\s\S]*?)```/);if(r){const e=r[1]||"text",a=r[2].trim();return n.default.createElement("div",{key:o},((e,o="text")=>n.default.createElement("div",{style:{position:"relative",margin:"8px 0"}},t&&n.default.createElement("button",{onClick:()=>((e,o)=>{t&&t(e,o)})(e,o),style:{position:"absolute",top:"4px",right:"4px",background:"var(--jp-brand-color1)",color:"white",border:"none",borderRadius:"3px",padding:"2px 6px",fontSize:"10px",cursor:"pointer",zIndex:10},title:"æ’å…¥åˆ°Jupyterå•å…ƒæ ¼"},"æ’å…¥ä»£ç "),n.default.createElement("pre",{style:{background:"var(--jp-code-cell-background)",border:"1px solid var(--jp-border-color1)",borderRadius:"4px",padding:"8px",overflowX:"auto",fontFamily:"var(--jp-code-font-family)",fontSize:"var(--jp-code-font-size)",lineHeight:"var(--jp-code-line-height)",margin:0}},n.default.createElement("code",{style:{color:"var(--jp-content-font-color1)",display:"block"}},e))))(a,e))}}const r=e.match(/(\|[^\n]+\|\r?\n\|[-:\s|]+\|\r?\n(?:\|[^\n]+\|\r?\n)*)/);return r?n.default.createElement("div",{key:o},(e=>{const t=e.split("\n").filter(e=>e.trim());if(t.length<2)return null;try{const e=t[0].split("|").filter(e=>""!==e.trim()).map(e=>e.trim()),o=t.slice(2).map(e=>e.split("|").filter(e=>""!==e.trim()).map(e=>e.trim())).filter(e=>e.length>0);return n.default.createElement("div",{style:{overflowX:"auto",margin:"12px 0"}},n.default.createElement("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:"400px",border:"1px solid var(--jp-border-color1)",fontSize:"12px"}},n.default.createElement("thead",null,n.default.createElement("tr",{style:{backgroundColor:"var(--jp-layout-color2)"}},e.map((e,t)=>n.default.createElement("th",{key:t,style:{border:"1px solid var(--jp-border-color1)",padding:"8px 12px",textAlign:"left",fontWeight:"bold"}},e)))),n.default.createElement("tbody",null,o.map((e,t)=>n.default.createElement("tr",{key:t,style:{borderBottom:"1px solid var(--jp-border-color2)"}},e.map((e,t)=>n.default.createElement("td",{key:t,style:{border:"1px solid var(--jp-border-color1)",padding:"8px 12px",textAlign:"left"}},e)))))))}catch(t){return console.error("è¡¨æ ¼æ¸²æŸ“é”™è¯¯:",t),n.default.createElement("div",{style:{whiteSpace:"pre-wrap"}},e)}})(r[0])):n.default.createElement("div",{key:o,style:{lineHeight:"1.5",margin:"4px 0",whiteSpace:"pre-wrap"}},e)})}catch(t){return console.error("å†…å®¹æ¸²æŸ“é”™è¯¯:",t),n.default.createElement("div",{style:{whiteSpace:"pre-wrap"}},e)}})())},605:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useScroll=void 0;const r=o(893);t.useScroll=()=>{const[e,t]=r.useState(!0),o=r.useRef(null),n=r.useRef(null),a=r.useRef(!0);r.useEffect(()=>()=>{a.current=!1},[]);const l=r.useCallback(()=>{if(!n.current)return!0;const e=n.current;return e.scrollHeight-e.scrollTop-e.clientHeight<=100},[]),i=r.useCallback((t="smooth")=>{a.current&&e&&requestAnimationFrame(()=>{o.current&&a.current&&o.current.scrollIntoView({behavior:t,block:"nearest"})})},[e]),s=r.useCallback(()=>{if(!n.current)return;const o=l();o&&!e?t(!0):!o&&e&&t(!1)},[e,l]);return r.useEffect(()=>{const e=n.current;if(e)return e.addEventListener("scroll",s),()=>{e.removeEventListener("scroll",s)}},[s]),{shouldAutoScroll:e,messagesEndRef:o,messagesContainerRef:n,smartScrollToBottom:i,scrollToBottomManually:()=>{t(!0),i("smooth")},handleMessagesScroll:s}}},612:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageItem=void 0;const n=r(o(893)),a=o(526);t.MessageItem=({message:e,isStreaming:t,onInsertCode:o})=>n.default.createElement("div",{style:{display:"flex",flexDirection:"user"===e.sender?"row-reverse":"row",alignItems:"flex-start",marginBottom:"12px"}},n.default.createElement("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"user"===e.sender?"var(--jp-brand-color1)":"var(--jp-accent-color1)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",margin:"user"===e.sender?"0 0 0 6px":"0 6px 0 0",flexShrink:0}},"user"===e.sender?"ğŸ‘¤":"ğŸ¤–"),n.default.createElement("div",{style:{maxWidth:"85%",textAlign:"user"===e.sender?"right":"left"}},n.default.createElement("div",{style:{background:"user"===e.sender?"var(--jp-brand-color1)":"var(--jp-layout-color2)",color:"user"===e.sender?"white":"var(--jp-ui-font-color1)",padding:"6px 10px",borderRadius:"12px",border:"1px solid var(--jp-border-color1)",wordBreak:"break-word",position:"relative"}},n.default.createElement(a.MessageContent,{content:e.content,onInsertCode:o}),t&&n.default.createElement("span",{style:{display:"inline-block",width:"2px",height:"1em",background:"var(--jp-ui-font-color1)",marginLeft:"2px",animation:"blink 1s infinite"}})),n.default.createElement("div",{style:{fontSize:"10px",color:"var(--jp-ui-font-color2)",marginTop:"2px"}},e.timestamp.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),t&&" Â· ç”Ÿæˆä¸­...")))},751:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.chatIcon=void 0;const r=o(901);t.chatIcon=new r.LabIcon({name:"jupyterlab-chat:chat",svgstr:'\n<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n</svg>\n'})},766:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useChat=void 0;const r=o(893);t.useChat=e=>{const[t,o]=r.useState([{id:1,content:"ä½ å¥½ï¼æˆ‘æ˜¯ AI åŠ©æ‰‹ã€‚ç°åœ¨æ”¯æŒæµå¼è¾“å‡ºå’Œæ¨¡å‹åˆ‡æ¢ï¼Œä½“éªŒæ›´ä½³ã€‚",sender:"ai",timestamp:new Date,type:"text"}]),[n,a]=r.useState({backendUrl:"http://localhost:8888/v1/chat/completions",modelName:"gpt-3.5-turbo",customModelName:"",temperature:.7,maxTokens:2e3,...e});return{messages:t,config:n,addMessage:e=>{o(t=>[...t,e])},updateMessage:(e,t)=>{o(o=>o.map(o=>o.id===e?{...o,content:t,timestamp:new Date}:o))},clearMessages:()=>{o([{id:1,content:"å¯¹è¯å·²æ¸…ç©ºã€‚ç°åœ¨æ”¯æŒæµå¼è¾“å‡ºå’Œæ¨¡å‹åˆ‡æ¢ï¼Œä½“éªŒæ›´ä½³ã€‚",sender:"ai",timestamp:new Date,type:"text"}])},updateConfig:e=>{a(t=>({...t,...e}))},resetConfig:()=>{a({backendUrl:"http://localhost:8888/v1/chat/completions",modelName:"gpt-3.5-turbo",customModelName:"",temperature:.7,maxTokens:2e3,...e})},getActualModelName:()=>"custom"===n.modelName?n.customModelName:n.modelName}}},797:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InputArea=void 0;const n=r(o(893));t.InputArea=({value:e,isLoading:t,modelName:o,temperature:r,maxTokens:a,onChange:l,onSend:i,onKeyPress:s})=>n.default.createElement("div",{style:{borderTop:"1px solid var(--jp-border-color1)",padding:"10px",background:"var(--jp-layout-color1)"}},n.default.createElement("div",{style:{display:"flex",alignItems:"flex-end",gap:"6px"}},n.default.createElement("textarea",{style:{flex:1,minHeight:"36px",maxHeight:"100px",padding:"6px 10px",border:"1px solid var(--jp-border-color1)",borderRadius:"4px",background:"var(--jp-input-background)",color:"var(--jp-ui-font-color1)",fontFamily:"inherit",fontSize:"13px",resize:"vertical",outline:"none"},placeholder:"è¾“å…¥ä½ çš„é—®é¢˜...",value:e,onChange:e=>l(e.target.value),onKeyPress:s,disabled:t,rows:1}),n.default.createElement("button",{style:{background:e.trim()&&!t?"var(--jp-brand-color1)":"var(--jp-layout-color3)",color:"white",border:"none",borderRadius:"4px",padding:"6px 12px",cursor:e.trim()&&!t?"pointer":"not-allowed",height:"36px",fontSize:"12px",fontWeight:"bold"},onClick:i,disabled:!e.trim()||t},t?"ç”Ÿæˆä¸­...":"å‘é€")),n.default.createElement("div",{style:{fontSize:"10px",color:"var(--jp-ui-font-color2)",marginTop:"4px",textAlign:"center"}},"æµå¼è¾“å‡º | æ¨¡å‹: ",o," | æ¸©åº¦: ",r," | æœ€å¤§é•¿åº¦: ",a))},885:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatWidget=void 0;const n=r(o(893)),a=o(878),l=o(117);class i extends a.ReactWidget{constructor(e){super(),this.notebookTracker=e,this.id="ai-chat-widget",this.title.label="AI Chat",this.title.closable=!0,this.addClass("jp-ChatWidget")}render(){return n.default.createElement(l.ChatComponent,{notebookTracker:this.notebookTracker})}}t.ChatWidget=i}}]);