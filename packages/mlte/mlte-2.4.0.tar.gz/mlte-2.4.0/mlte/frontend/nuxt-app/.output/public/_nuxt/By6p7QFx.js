import{j as L,m as x,c as s,o as a,a as u,F as E,v as F,t as i,b as G,w as f,d as h,r as w,l as P,s as $,q as k,n as D,z as R,y as N}from"./B-k8Z1tc.js";import{q as S,m as T,r as j,s as I,t as M}from"./CBhitsNU.js";import{P as z,b as H,a as q}from"./CpBh97f4.js";import{r as J}from"./DueXm2QC.js";const K={class:"table usa-table usa-table--borderless"},Q=u("thead",null,[u("tr",null,[u("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Name"),u("th",{"data-sortable":"",scope:"col",role:"columnheader"},[h(" Permissions "),u("br"),h(" (Resource Type - Resource ID - Method) ")]),u("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Actions")])],-1),W={class:"inline-input-left",style:{"max-width":"50ch"}},X={key:0},Y={key:1},Z=L({__name:"group-list",props:{modelValue:{type:Array,required:!0}},emits:["addGroup","editGroup","deleteGroup"],setup(y,{emit:m}){const c=m,v=y;return(b,n)=>{const _=x("UsaButton");return a(),s("table",K,[Q,(a(!0),s(E,null,F(v.modelValue,(p,V)=>(a(),s("tr",{key:V},[u("td",null,i(p.name),1),u("td",null,[(a(!0),s(E,null,F(p.permissions,(d,C)=>(a(),s("div",{key:C},[u("div",W,[d.resource_id===null?(a(),s("span",X,i(d.resource_type)+" - (All) - "+i(d.method),1)):(a(),s("span",Y,i(d.resource_type)+" - "+i(d.resource_id)+" - "+i(d.method),1))])]))),128))]),u("td",null,[G(_,{class:"secondary-button",onClick:d=>c("editGroup",p)},{default:f(()=>[h(" Edit ")]),_:2},1032,["onClick"]),G(_,{class:"usa-button usa-button--secondary",onClick:d=>c("deleteGroup",p.name)},{default:f(()=>[h(" Delete ")]),_:2},1032,["onClick"])])]))),128))])}}}),O={key:0},ee={class:"section-header"},te={key:1},oe=u("label",{class:"usa-label"},"Permissions",-1),ae={class:"multi-line-checkbox-div"},se={key:0},le={key:1},ue={class:"submit-footer"},ne=L({__name:"group-edit",props:{modelValue:{type:Object,required:!0},newGroupFlag:{type:Boolean,required:!0,default:!1}},emits:["cancel","submit"],async setup(y,{emit:m}){let c,v;const b=m,n=y,_=w({name:!1}),p=w([]),V=w([]);V.value=([c,v]=P(()=>S()),c=await c,v(),c),V.value&&V.value.forEach(e=>{p.value.push(new z(e.resource_type,e.resource_id,e.method,!1))}),p.value.forEach(e=>{n.modelValue.permissions.find(t=>t.resource_type===e.resource_type&&t.resource_id===e.resource_id&&t.method===e.method)&&(e.selected=!0)});function d(e,t){if(e)n.modelValue.permissions.push(new H(t.resource_type,t.resource_id,t.method));else{const r=n.modelValue.permissions.find(o=>o.resource_type===t.resource_type&&o.resource_id===t.resource_id&&o.method===t.method);if(r){const o=n.modelValue.permissions.indexOf(r);n.modelValue.permissions.splice(o,1)}}}function C(){_.value=J(_.value);let e=!1;n.newGroupFlag&&n.modelValue.name.trim()===""&&(_.value.name=!0,e=!0),!e&&b("submit",n.modelValue)}return(e,t)=>{const r=x("UsaTextInput"),o=x("UsaCheckbox"),g=x("UsaButton");return a(),s("div",null,[y.newGroupFlag?$("",!0):(a(),s("div",O,[u("h1",ee,i(y.modelValue.name),1)])),y.newGroupFlag?(a(),s("div",te,[G(r,{modelValue:y.modelValue.name,"onUpdate:modelValue":t[0]||(t[0]=l=>y.modelValue.name=l),error:k(_).name},{label:f(()=>[h(" Group Name ")]),"error-message":f(()=>[h(" Group name is required ")]),_:1},8,["modelValue","error"])])):$("",!0),oe,u("div",ae,[(a(!0),s(E,null,F(k(p),(l,A)=>(a(),s("span",{key:A,class:"multiple-per-line-checkbox"},[G(o,{modelValue:l.selected,"onUpdate:modelValue":[U=>l.selected=U,U=>d(l.selected,l)]},{default:f(()=>[l.resource_id===null?(a(),s("span",se,i(l.resource_type)+" - (All) - "+i(l.method),1)):(a(),s("span",le,i(l.resource_type)+" - "+i(l.resource_id)+" - "+i(l.method),1))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))]),u("div",ue,[G(g,{class:"primary-button",onClick:t[1]||(t[1]=l=>b("cancel"))},{default:f(()=>[h(" Cancel ")]),_:1}),G(g,{class:"primary-button",onClick:C},{default:f(()=>[h(" Save ")]),_:1})])])}}}),re=u("title",null,"Manage Groups",-1),ce={key:0},de={key:1},fe=L({__name:"manage-groups",setup(y){const m=w(!1),c=w(!1),v=w([]),b=w(new q);n();async function n(){v.value=await T()}function _(){b.value=new q}function p(){_(),m.value=!0,c.value=!0}function V(r){b.value=r,m.value=!0,c.value=!1}async function d(r){if(!confirm("Are you sure you want to delete the group: "+r+"?"))return;await j(r)&&n()}function C(){m.value&&e()}function e(){confirm("Are you sure you want to cancel? All changes will be lost.")&&(m.value=!1,_())}async function t(r){let o=!0;c.value?await I(r)&&(o=!1):await M(r)&&(o=!1),o||(n(),_(),m.value=!1)}return(r,o)=>{const g=x("UsaButton"),l=Z,A=ne,U=R;return a(),D(U,{name:"base-layout",onNav:C},{"page-title":f(()=>[h("Manage Groups")]),default:f(()=>[re,k(m)?$("",!0):(a(),s("div",ce,[G(g,{class:"secondary-button sub-header-float-button",onClick:p},{default:f(()=>[h(" Add Group ")]),_:1}),G(l,{modelValue:k(v),"onUpdate:modelValue":o[0]||(o[0]=B=>N(v)?v.value=B:null),onEditGroup:V,onDeleteGroup:d},null,8,["modelValue"])])),k(m)?(a(),s("div",de,[G(A,{modelValue:k(b),"onUpdate:modelValue":o[1]||(o[1]=B=>N(b)?b.value=B:null),"new-group-flag":k(c),onCancel:e,onSubmit:t},null,8,["modelValue","new-group-flag"])])):$("",!0)]),_:1})}}});export{fe as default};
