import{j as D,m as x,c as U,o as c,a as n,F as S,v as R,t as $,b as m,w as t,d as s,r as y,l as T,s as C,n as N,q as d,y as q,k as I,z as M}from"./B-k8Z1tc.js";import{m as z,n as H,o as J,p as K,u as Q}from"./CBhitsNU.js";import{G as W,a as X,U as G}from"./CpBh97f4.js";import{r as Y}from"./DueXm2QC.js";import{i as Z}from"./DeaeknEB.js";const O={class:"table usa-table usa-table--borderless"},ee=n("thead",null,[n("tr",null,[n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Username"),n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Email"),n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Full Name"),n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Disabled"),n("th",{scope:"col",role:"columnheader"},"Actions")])],-1),le={class:"centered-container",style:{"margin-bottom":"1.5em"}},ae=D({__name:"user-list",props:{modelValue:{type:Array,required:!0}},emits:["addUser","editUser","deleteUser"],setup(o,{emit:P}){const i=P,_=o;return(k,l)=>{const V=x("UsaCheckbox"),p=x("UsaButton");return c(),U("table",O,[ee,n("tbody",null,[(c(!0),U(S,null,R(_.modelValue,(w,u)=>(c(),U("tr",{key:u},[n("td",null,$(w.username),1),n("td",null,$(w.email),1),n("td",null,$(w.full_name),1),n("td",null,[n("div",le,[m(V,{modelValue:w.disabled,"onUpdate:modelValue":g=>w.disabled=g,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])]),n("td",null,[m(p,{class:"secondary-button",onClick:g=>i("editUser",w)},{default:t(()=>[s(" Edit ")]),_:2},1032,["onClick"]),m(p,{class:"usa-button usa-button--secondary",onClick:g=>i("deleteUser",w.username)},{default:t(()=>[s(" Delete ")]),_:2},1032,["onClick"])])]))),128))])])}}}),se={key:0},oe={class:"section-header",style:{display:"inline"}},te={key:2},ne={key:1},re={class:"multi-line-checkbox-div"},ue=n("label",{class:"usa-label"},"Groups",-1),de={key:0},me=n("b",null,"create-model",-1),ie={class:"submit-footer"},ce=D({__name:"user-edit",props:{modelValue:{type:Object,required:!0},newUserFlag:{type:Boolean,required:!0,default:!1}},emits:["cancel","submit","updateUserGroups"],async setup(o,{emit:P}){let i,_;const k=P,l=o,V=y(!1),p=y(""),w=y([{value:"admin",text:"admin"},{value:"regular",text:"regular"}]),u=y({username:!1,role:!1,password:!1,confirmPassword:!1}),g=y([]),E=y([]);E.value=([i,_]=T(()=>z()),i=await i,_(),i),E.value&&E.value.forEach(r=>{g.value.push(new W(r.name,r.permissions,!1))}),g.value.forEach(r=>{l.modelValue.groups.find(e=>e.name===r.name)&&(r.selected=!0)}),l.newUserFlag&&(l.modelValue.role="regular");function A(){V.value=!0,l.modelValue.password=""}function B(){V.value=!1,delete l.modelValue.password}function f(r,e){if(r)l.modelValue.groups.push(new X(e.name,e.permissions));else{const h=l.modelValue.groups.find(b=>b.name===e.name);if(h){const b=l.modelValue.groups.indexOf(h);l.modelValue.groups.splice(b,1)}}}async function v(){u.value=Y(u.value);let r=!1;if(l.newUserFlag&&(l.modelValue.username.trim()===""&&(u.value.username=!0,r=!0),(l.modelValue.password==null||l.modelValue.password.trim()==="")&&(u.value.password=!0,r=!0)),V.value&&((l.modelValue.password==null||l.modelValue.password.trim()==="")&&(u.value.password=!0,r=!0),l.modelValue.password!==p.value&&(u.value.confirmPassword=!0,r=!0)),l.modelValue.role.trim()===""&&(u.value.role=!0,r=!0),r){Z();return}k("submit",l.modelValue)}return(r,e)=>{const h=x("UsaButton"),b=x("UsaTextInput"),F=x("UsaCheckbox"),j=x("UsaSelect");return c(),U("div",null,[o.newUserFlag?C("",!0):(c(),U("div",se,[n("h1",oe,$(o.modelValue.username),1),d(V)?C("",!0):(c(),N(h,{key:0,class:"secondary-button sub-header-float-button",onClick:A},{default:t(()=>[s(" Change Password ")]),_:1})),d(V)?(c(),N(h,{key:1,class:"secondary-button sub-header-float-button",onClick:B},{default:t(()=>[s(" Cancel Change ")]),_:1})):C("",!0),d(V)?(c(),U("div",te,[m(b,{modelValue:o.modelValue.password,"onUpdate:modelValue":e[0]||(e[0]=a=>o.modelValue.password=a),error:d(u).password,type:"password"},{label:t(()=>[s(" New Password ")]),"error-message":t(()=>[s(" Password is required ")]),_:1},8,["modelValue","error"]),m(b,{modelValue:d(p),"onUpdate:modelValue":e[1]||(e[1]=a=>q(p)?p.value=a:null),error:d(u).confirmPassword,type:"password"},{label:t(()=>[s(" Confirm New Password ")]),"error-message":t(()=>[s(" Passwords to not match ")]),_:1},8,["modelValue","error"])])):C("",!0)])),o.newUserFlag?(c(),U("div",ne,[m(b,{modelValue:o.modelValue.username,"onUpdate:modelValue":e[2]||(e[2]=a=>o.modelValue.username=a),error:d(u).username},{label:t(()=>[s(" Username ")]),"error-message":t(()=>[s(" Username is required ")]),_:1},8,["modelValue","error"]),m(b,{modelValue:o.modelValue.password,"onUpdate:modelValue":e[3]||(e[3]=a=>o.modelValue.password=a),error:d(u).password,type:"password"},{label:t(()=>[s(" Password ")]),"error-message":t(()=>[s(" Password is required ")]),_:1},8,["modelValue","error"])])):C("",!0),m(b,{modelValue:o.modelValue.email,"onUpdate:modelValue":e[4]||(e[4]=a=>o.modelValue.email=a)},{label:t(()=>[s(" Email ")]),_:1},8,["modelValue"]),m(b,{modelValue:o.modelValue.full_name,"onUpdate:modelValue":e[5]||(e[5]=a=>o.modelValue.full_name=a)},{label:t(()=>[s(" Full Name ")]),_:1},8,["modelValue"]),m(F,{modelValue:o.modelValue.disabled,"onUpdate:modelValue":e[6]||(e[6]=a=>o.modelValue.disabled=a),label:"Disabled"},null,8,["modelValue"]),m(j,{modelValue:o.modelValue.role,"onUpdate:modelValue":e[7]||(e[7]=a=>o.modelValue.role=a),options:d(w),error:d(u).role,onChange:e[8]||(e[8]=a=>d(u).role=!1)},{label:t(()=>[s(" Role ")]),"error-message":t(()=>[s(" A role must be selected ")]),_:1},8,["modelValue","options","error"]),n("div",re,[ue,o.newUserFlag?(c(),U("div",de,[s(" User will automatically be added to the "),me,s(" group upon submission. ")])):C("",!0),(c(!0),U(S,null,R(d(g),a=>(c(),U("span",{key:a.name,class:"multiple-per-line-checkbox"},[m(F,{modelValue:a.selected,"onUpdate:modelValue":[L=>a.selected=L,L=>f(a.selected,a)]},{default:t(()=>[s($(a.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))]),n("div",ie,[m(h,{class:"primary-button",onClick:e[9]||(e[9]=a=>k("cancel"))},{default:t(()=>[s(" Cancel ")]),_:1}),m(h,{class:"primary-button",onClick:v},{default:t(()=>[s(" Save ")]),_:1})])])}}}),fe=n("title",null,"Manage Users",-1),Ve={key:0},pe={key:1},_e=D({__name:"manage-users",setup(o){const P=I("user"),i=y(!1),_=y(!1),k=y([]),l=y(new G);V(),p();async function V(){const f=await H();f&&(k.value=f)}function p(){l.value=new G}function w(){p(),i.value=!0,_.value=!0}function u(f){l.value=f,i.value=!0,_.value=!1}async function g(f){if(P.value===f){alert("Cannot delete the active user.");return}if(!confirm("Are you sure you want to delete user, "+f+"?"))return;await J(f)&&V()}function E(){i.value&&A()}function A(){confirm("Are you sure you want to cancel? All changes will be lost.")&&(i.value=!1,p())}async function B(f){let v=!0;_.value?await K(f)&&(v=!1):await Q(f)&&(v=!1),v||(V(),p(),i.value=!1)}return(f,v)=>{const r=x("UsaButton"),e=ae,h=ce,b=M;return c(),N(b,{name:"base-layout",onNav:E},{"page-title":t(()=>[s("Manage Users")]),default:t(()=>[fe,d(i)?C("",!0):(c(),U("div",Ve,[m(r,{class:"secondary-button sub-header-float-button",onClick:w},{default:t(()=>[s(" Add User ")]),_:1}),m(e,{modelValue:d(k),"onUpdate:modelValue":v[0]||(v[0]=F=>q(k)?k.value=F:null),onEditUser:u,onDeleteUser:g},null,8,["modelValue"])])),d(i)?(c(),U("div",pe,[m(h,{modelValue:d(l),"onUpdate:modelValue":v[1]||(v[1]=F=>q(l)?l.value=F:null),"new-user-flag":d(_),onCancel:A,onSubmit:B},null,8,["modelValue","new-user-flag"])])):C("",!0)]),_:1})}}});export{_e as default};
