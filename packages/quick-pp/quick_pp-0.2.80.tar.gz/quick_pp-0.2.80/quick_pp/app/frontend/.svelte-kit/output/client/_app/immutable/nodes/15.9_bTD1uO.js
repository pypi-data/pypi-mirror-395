const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/HHMWGB-5.js","../chunks/CqkleIqs.js"])))=>i.map(i=>d[i]);
import{f as P,a as v,t as ce,c as Je}from"../chunks/DzJWYvWT.js";import"../chunks/CDFnLX1k.js";import{a as Pe}from"../chunks/B8lXtDag.js";import{p as we,s as l,l as O,g as e,$ as h,a as Ke,c as b,b as Ne,m as u,d as g,r as f,af as U,ao as Ze,_ as d,n as Ge,y as E,f as Qe}from"../chunks/B_idv_Bi.js";import{i as Me}from"../chunks/BB0Jw3vZ.js";import{_ as Xe}from"../chunks/PPVm8Dsz.js";import{s as ee}from"../chunks/aZZtfabf.js";import{i as W}from"../chunks/CES9meuh.js";import{e as et,i as tt}from"../chunks/CizqEEQF.js";import{r as _e,a as at,b as rt}from"../chunks/BzZ_A8--.js";import{a as it,b as ot}from"../chunks/BMvMhH3M.js";import{p as xe,b as st}from"../chunks/D5_Bn7R5.js";import{B as ye}from"../chunks/DgWdy5DX.js";import{w as Ee,e as lt,d as nt}from"../chunks/Mv797lCI.js";import{D as ct}from"../chunks/BjC9EeZr.js";import{P as dt}from"../chunks/BYv_GcAz.js";import"../chunks/pot6Uotm.js";const mt=()=>({title:"Permeability",subtitle:"Permeability estimations for the selected well"}),Ot=Object.freeze(Object.defineProperty({__proto__:null,load:mt},Symbol.toStringTag,{value:"Module"}));var pt=P("<option> </option>"),vt=P('<div><label class="text-xs" for="swirr-input">Swirr (irreducible water saturation)</label> <input id="swirr-input" class="input" type="number" step="0.01" min="0" max="1"/></div>'),ut=P('<div class="flex items-end"><div class="text-xs text-muted-foreground">Requires: VCLAY, VSILT, PHIT</div></div>'),ft=P('<div class="text-sm text-red-500 mb-2"> </div>'),ht=P('<div class="w-full h-[260px]"></div>'),bt=P('<div class="flex items-center justify-center h-full text-sm text-gray-500">No permeability data to display. Compute permeability to see the plot.</div>'),gt=P("<div><strong>Calculated Perm:</strong> </div>"),_t=P("<div><strong>Calculated Perm:</strong> No data</div>"),xt=P('<div><strong>Core Perm (CPERM):</strong> <span class="inline-block w-2 h-2 bg-red-600 rounded-full"></span> </div>'),yt=P('<div class="text-gray-500">No core permeability data (CPERM) found</div>'),Pt=P('<div class="bg-panel rounded p-3"><div class="grid grid-cols-2 gap-2 mb-3"><div><label class="text-xs" for="perm-method">Permeability method</label> <select id="perm-method" class="input"></select></div> <!></div> <!> <div class="space-y-3"><div><div class="font-medium text-sm mb-1">Permeability</div> <div class="bg-surface rounded p-2"><!> <!> <div class="flex items-center ml-2"><input type="checkbox" id="depth-matching" class="mr-2"/> <label for="depth-matching">Depth Matching</label></div> <div class="h-[260px] w-full overflow-hidden"><!></div></div></div> <div class="text-xs text-muted-foreground space-y-1"><!> <!></div></div></div>'),wt=P('<div class="text-sm">Select a well to view permeability tools.</div>'),Nt=P('<div class="ws-permeability"><div class="mb-2"><div class="font-semibold">Permeability</div> <div class="text-sm text-muted-foreground">Permeability estimation tools.</div></div> <!> <!></div>');function Mt(te,Y){we(Y,!1);const k=u(),$=u();let T=xe(Y,"projectId",8),w=xe(Y,"wellName",8);const Z="http://localhost:6312";let F=u({enabled:!1,minDepth:null,maxDepth:null}),B=u({enabled:!1,zones:[]}),A=u([]),C=u(!1),S=u(null),J=u(!1),ae=null,I=u("choo"),G=u(.05),H=u(!1),re=u([]),Q=u([]),_=u([]),R=u([]),ie=null,L=u(null);const oe=[{value:"choo",label:"Choo",requires:["vclay","vsilt","phit"]},{value:"timur",label:"Timur",requires:["phit","swirr"]},{value:"tixier",label:"Tixier",requires:["phit","swirr"]},{value:"coates",label:"Coates",requires:["phit","swirr"]},{value:"kozeny_carman",label:"Kozeny-Carman",requires:["phit","swirr"]}];async function Ce(){if(!(!T()||!w())){l(C,!0),l(S,null);try{const t=await fetch(`${Z}/quick_pp/database/projects/${T()}/wells/${encodeURIComponent(String(w()))}/merged`);if(!t.ok)throw new Error(await t.text());const o=await t.json(),n=o&&o.data?o.data:o;if(!Array.isArray(n))throw new Error("Unexpected data format from backend");l(re,n)}catch(t){console.warn("Failed to load well data",t),l(S,String(t?.message??t))}finally{l(C,!1)}}}function Re(){const t=oe.find(r=>r.value===e(I));if(!t)return[];const o=e(A),n=[];for(const r of o){const c={};let x=!0;for(const p of t.requires){let s;if(p==="swirr"?s=e(G):p==="vclay"?s=Number(r.vclay??r.VCLAY??r.Vclay??NaN):p==="vsilt"?s=Number(r.vsilt??r.VSILT??r.Vsilt??NaN):p==="phit"?s=Number(r.phit??r.PHIT??r.Phit??NaN):s=Number(r[p]??r[p.toUpperCase()]??NaN),isNaN(s)){x=!1;break}c[p]=s}x&&n.push(c)}return n}function De(){const t=e(A),o=[];for(const n of t){const r=Number(n.depth??n.DEPTH??NaN),c=Number(n.cperm??n.CPERM??n.Cperm??n.KPERM??n.kperm??NaN);!isNaN(r)&&!isNaN(c)&&c>0&&o.push({depth:r,CPERM:c})}return o.sort((n,r)=>n.depth-r.depth)}async function ke(){const t=Re();if(!t.length){l(S,`No valid data available for ${e(I)} permeability calculation`);return}l(C,!0),l(S,null);try{const o=await fetch(`${Z}/quick_pp/permeability/${e(I)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:t})});if(!o.ok)throw new Error(await o.text());l(Q,await o.json()),de()}catch(o){console.warn(`${e(I)} permeability error`,o),l(S,String(o?.message??o))}finally{l(C,!1)}}async function $e(){if(!T()||!w()){l(S,"Project and well must be selected before saving");return}if(!e(_)||e(_).length===0){l(S,"No permeability results to save");return}l(J,!0),ae=null,l(S,null);try{const t=e(_).map(x=>({DEPTH:x.depth,PERM:Number(x.PERM)}));if(!t.length)throw new Error("No rows prepared for save");const o={data:t},n=`${Z}/quick_pp/database/projects/${T()}/wells/${encodeURIComponent(String(w()))}/data`,r=await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok)throw new Error(await r.text());const c=await r.json().catch(()=>null);ae=c&&c.message?String(c.message):"Permeability saved";try{window.dispatchEvent(new CustomEvent("qpp:data-updated",{detail:{projectId:T(),wellName:w(),kind:"permeability"}}))}catch{}}catch(t){console.warn("Save permeability error",t),ae=null,l(S,String(t?.message??t))}finally{l(J,!1)}}function Se(){const t=[];if(e(_).forEach(q=>{q.PERM&&q.PERM>0&&t.push(q.PERM)}),e(R).forEach(q=>{q.CPERM&&q.CPERM>0&&t.push(q.CPERM)}),t.length===0)return[.001,1e3];const o=Math.min(...t),n=Math.max(...t),r=Math.log10(o),c=Math.log10(n),x=c-r,p=Math.max(.1,x*.1),s=Math.pow(10,r-p),N=Math.pow(10,c+p);return[s,N]}async function je(){if(!ie){const t=await Xe(()=>import("../chunks/HHMWGB-5.js").then(o=>o.p),__vite__mapDeps([0,1]),import.meta.url);ie=t?.default??t}return ie}function de(){const t=e(A),o=[];let n=0;for(const r of t){const c=Number(r.depth??r.DEPTH??NaN);if(isNaN(c))continue;const x=oe.find(s=>s.value===e(I));if(!x)continue;let p=!0;for(const s of x.requires){let N;if(s==="swirr"?N=e(G):s==="vclay"?N=Number(r.vclay??r.VCLAY??r.Vclay??NaN):s==="vsilt"?N=Number(r.vsilt??r.VSILT??r.Vsilt??NaN):s==="phit"?N=Number(r.phit??r.PHIT??r.Phit??NaN):N=Number(r[s]??r[s.toUpperCase()]??NaN),isNaN(N)){p=!1;break}}if(p){const s=e(Q)[n++]??{PERM:null},N=Math.max(Number(s.PERM??.001),.001);o.push({depth:c,PERM:N})}}o.sort((r,c)=>r.depth-c.depth),l(_,o),l(R,De())}async function Te(){if(!e(L))return;const t=await je();if((!e(k)||e(k).length===0)&&(!e($)||e($).length===0)){try{t.purge(e(L))}catch{}return}const o=[];e(k)&&e(k).length>0&&o.push({x:e(k).map(s=>s.x),y:e(k).map(s=>s.y),name:"PERM (Log)",mode:"lines",line:{color:"#2563eb",width:2},xaxis:"x",yaxis:"y"}),e($)&&e($).length>0&&o.push({x:e($).map(s=>s.x),y:e($).map(s=>s.y),name:"CPERM (Core)",mode:"markers",marker:{color:"#dc2626",size:8,line:{color:"white",width:1}},xaxis:e(H)?"x2":"x",yaxis:"y"});const[n,r]=Se(),c=Math.max(n,1e-12),x=Math.max(r,c*10),p={height:260,margin:{l:60,r:20,t:50,b:80},dragmode:"zoom",xaxis:{title:"Log Depth",titlefont:{color:"#2563eb"},tickfont:{color:"#2563eb"},tickformat:",.0f",side:"bottom"},xaxis2:{title:"Core Depth",titlefont:{color:"#dc2626"},tickfont:{color:"#dc2626"},tickformat:",.0f",overlaying:"x",side:"top",fixedrange:e(H)},yaxis:{title:"Permeability (mD)",type:"log",range:[Math.log10(c),Math.log10(x)]},showlegend:!0,legend:{x:0,y:1,bgcolor:"rgba(255,255,255,0.8)",bordercolor:"rgba(0,0,0,0.2)",borderwidth:1}};try{t.react(e(L),o,p,{responsive:!0})}catch{t.newPlot(e(L),o,p,{responsive:!0})}}const Fe=Ee.subscribe(t=>{t?.depthFilter&&l(F,{...t.depthFilter}),t?.zoneFilter&&l(B,{...t.zoneFilter})});Pe(()=>{Fe()}),O(()=>e(_),()=>{l(k,e(_).map(t=>({x:t.depth,y:t.PERM})))}),O(()=>e(R),()=>{l($,e(R).map(t=>({x:t.depth,y:t.CPERM})))}),O(()=>(e(re),e(F),e(B)),()=>{l(A,(()=>{let t=e(re)||[];return t=lt(t,e(F)),t=nt(t,e(B)),t})())}),O(()=>(e(Q),e(A)),()=>{e(Q)&&e(A)&&de()}),O(()=>(h(T()),h(w())),()=>{T()&&w()&&Ce()}),O(()=>(e(L),e(_),e(R),e(F),e(H)),()=>{e(L)&&(e(_)||e(R)||e(F)||e(H)!==void 0)&&Te()}),Ke(),Me();var se=Nt(),me=b(g(se),2);ct(me,{});var Ie=b(me,2);{var qe=t=>{var o=Pt(),n=g(o),r=g(n),c=b(g(r),2);U(()=>{e(I),Ze(()=>{})}),et(c,5,()=>oe,tt,(i,a)=>{var m=pt(),D=g(m,!0);f(m);var j={};U(()=>{ee(D,(e(a),d(()=>e(a).label))),j!==(j=(e(a),d(()=>e(a).value)))&&(m.value=(m.__value=(e(a),d(()=>e(a).value)))??"")}),v(i,m)}),f(c),f(r);var x=b(r,2);{var p=i=>{var a=vt(),m=b(g(a),2);_e(m),f(a),ot(m,()=>e(G),D=>l(G,D)),v(i,a)},s=i=>{var a=ut();v(i,a)};W(x,i=>{e(I)!=="choo"?i(p):i(s,!1)})}f(n);var N=b(n,2);{var q=i=>{var a=ft(),m=g(a);f(a),U(()=>ee(m,`Error: ${e(S)??""}`)),v(i,a)};W(N,i=>{e(S)&&i(q)})}var pe=b(N,2),le=g(pe),ve=b(g(le),2),ue=g(ve);{let i=E(()=>e(C)?"opacity:0.5; pointer-events:none;":"");ye(ue,{class:"btn btn-primary",onclick:ke,get disabled(){return e(C)},get style(){return e(i)},children:(a,m)=>{Ge();var D=ce("Estimate Permeability");v(a,D)},$$slots:{default:!0}})}var fe=b(ue,2);{let i=E(()=>e(C)||e(J)),a=E(()=>e(C)||e(J)?"opacity:0.5; pointer-events:none;":"");ye(fe,{class:"btn ml-2 bg-emerald-700",onclick:$e,get disabled(){return e(i)},get style(){return e(a)},children:(m,D)=>{var j=Je(),V=Qe(j);{var K=y=>{var z=ce("Saving...");v(y,z)},M=y=>{var z=ce("Save Permeability");v(y,z)};W(V,y=>{e(J)?y(K):y(M,!1)})}v(m,j)},$$slots:{default:!0}})}var ne=b(fe,2),X=g(ne);_e(X);var Ae=b(X,2);f(ne);var he=b(ne,2),Le=g(he);{var ze=i=>{var a=ht();st(a,m=>l(L,m),()=>e(L)),v(i,a)},We=i=>{var a=bt();v(i,a)};W(Le,i=>{e(_),e(R),d(()=>e(_).length>0||e(R).length>0)?i(ze):i(We,!1)})}f(he),f(ve),f(le);var be=b(le,2),ge=g(be);{var He=i=>{const a=E(()=>(e(_),d(()=>e(_).map(M=>M.PERM)))),m=E(()=>(h(e(a)),d(()=>e(a).reduce((M,y)=>M+y,0)/e(a).length))),D=E(()=>(h(e(a)),d(()=>Math.min(...e(a))))),j=E(()=>(h(e(a)),d(()=>Math.max(...e(a)))));var V=gt(),K=b(g(V));f(V),U((M,y,z)=>ee(K,` Avg: ${M??""} mD | Min: ${y??""} mD | Max: ${z??""} mD | Count: ${h(e(a)),d(()=>e(a).length)??""}`),[()=>(h(e(m)),d(()=>e(m).toFixed(2))),()=>(h(e(D)),d(()=>e(D).toFixed(3))),()=>(h(e(j)),d(()=>e(j).toFixed(1)))]),v(i,V)},Oe=i=>{var a=_t();v(i,a)};W(ge,i=>{e(_),d(()=>e(_).length>0)?i(He):i(Oe,!1)})}var Ue=b(ge,2);{var Ye=i=>{const a=E(()=>(e(R),d(()=>e(R).map(M=>M.CPERM)))),m=E(()=>(h(e(a)),d(()=>e(a).reduce((M,y)=>M+y,0)/e(a).length))),D=E(()=>(h(e(a)),d(()=>Math.min(...e(a))))),j=E(()=>(h(e(a)),d(()=>Math.max(...e(a)))));var V=xt(),K=b(g(V),3);f(V),U((M,y,z)=>ee(K,` Avg: ${M??""} mD | Min: ${y??""} mD | Max: ${z??""} mD | Count: ${h(e(a)),d(()=>e(a).length)??""}`),[()=>(h(e(m)),d(()=>e(m).toFixed(2))),()=>(h(e(D)),d(()=>e(D).toFixed(3))),()=>(h(e(j)),d(()=>e(j).toFixed(1)))]),v(i,V)},Be=i=>{var a=yt();v(i,a)};W(Ue,i=>{e(R),d(()=>e(R).length>0)?i(Ye):i(Be,!1)})}f(be),f(pe),f(o),U(()=>{X.disabled=e(C),at(Ae,1,`text-sm cursor-pointer ${e(C)?"opacity-50":""}`)}),rt(c,()=>e(I),i=>l(I,i)),it(X,()=>e(H),i=>l(H,i)),v(t,o)},Ve=t=>{var o=wt();v(t,o)};W(Ie,t=>{w()?t(qe):t(Ve,!1)})}f(se),v(te,se),Ne()}var Et=P('<div slot="left"><!></div>');function Ut(te,Y){we(Y,!1);let k=u(null),$=u(null);const T=Ee.subscribe(w=>{l(k,w?.project??null),l($,w?.selectedWell??null)});Pe(()=>T()),Me(),dt(te,{get selectedWell(){return e($)},get project(){return e(k)},$$slots:{left:(w,Z)=>{var F=Et(),B=g(F);{let A=E(()=>e(k)?.project_id??""),C=E(()=>e($)?.name??"");Mt(B,{get projectId(){return e(A)},get wellName(){return e(C)}})}f(F),v(w,F)}}}),Ne()}export{Ut as component,Ot as universal};
