const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/HHMWGB-5.js","../chunks/CqkleIqs.js"])))=>i.map(i=>d[i]);
import{f as M,a as b,t as bt,c as xt}from"../chunks/DzJWYvWT.js";import"../chunks/CDFnLX1k.js";import{a as Dt}from"../chunks/B8lXtDag.js";import{p as qt,s as r,l as St,g as t,$ as u,a as he,c as p,b as Ot,m as g,d as h,r as _,af as Z,ao as _e,n as we,y as $,f as Tt,_ as c}from"../chunks/B_idv_Bi.js";import{i as It}from"../chunks/BB0Jw3vZ.js";import{_ as ge}from"../chunks/PPVm8Dsz.js";import{s as tt}from"../chunks/aZZtfabf.js";import{i as J}from"../chunks/CES9meuh.js";import{r as lt,b as ye}from"../chunks/BzZ_A8--.js";import{b as ct}from"../chunks/BMvMhH3M.js";import{p as Ct,b as Ne}from"../chunks/D5_Bn7R5.js";import{B as Ft}from"../chunks/DgWdy5DX.js";import{w as Ht,e as be,d as xe}from"../chunks/Mv797lCI.js";import{D as Se}from"../chunks/BjC9EeZr.js";import{P as Te}from"../chunks/BYv_GcAz.js";import"../chunks/pot6Uotm.js";const We=()=>({title:"Water Saturation",subtitle:"Saturation estimations for the selected well"}),sa=Object.freeze(Object.defineProperty({__proto__:null,load:We},Symbol.toStringTag,{value:"Module"}));var Pe=M('<div class="text-xs text-green-600 ml-3"> </div>'),$e=M('<div class="text-sm text-red-500 mb-2"> </div>'),Ae=M('<div class="text-sm"> </div>'),Re=M('<div class="text-sm text-gray-500">No temp gradient computed</div>'),Me=M('<div class="text-sm"> </div>'),je=M('<div class="text-sm text-gray-500">No Rw computed</div>'),ke=M("<div><strong>Archie SWT:</strong> </div>"),Ee=M("<div><strong>Archie SWT:</strong> No data</div>"),Ce=M("<div><strong>Waxman-Smits SWT:</strong> </div>"),Fe=M("<div><strong>Waxman-Smits SWT:</strong> No data</div>"),De=M('<div class="bg-panel rounded p-3"><div class="grid grid-cols-2 gap-2 mb-3"><div><label class="text-sm" for="meas-system">Measurement system</label> <select id="meas-system" class="input"><option>Metric</option><option>Imperial</option></select></div> <div><label class="text-sm" for="water-salinity">Water salinity</label> <input id="water-salinity" type="number" class="input"/></div> <div><label class="text-sm" for="rho-clay">Clay density (rho_clay)</label> <input id="rho-clay" type="number" class="input"/></div> <div><label class="text-sm" for="cec-clay">Clay CEC (cec_clay)</label> <input id="cec-clay" type="number" class="input"/></div> <div><label class="text-sm" for="m-param">Archie/Waxman m parameter</label> <input id="m-param" type="number" class="input"/></div></div> <div class="mb-3 flex gap-2 items-center"><!> <!> <!></div> <!> <div class="space-y-3"><div><div class="font-medium text-sm mb-1">Temp Gradient</div> <!></div> <div><div class="font-medium text-sm mb-1">Estimated Rw</div> <!></div> <div><div class="font-medium text-sm mb-1">Saturation Plot (Archie vs Waxman-Smits)</div> <div class="bg-surface rounded p-2"><div class="h-[220px] w-full overflow-hidden"><div class="w-full h-[220px]"></div></div></div> <div class="text-xs text-muted-foreground-foreground space-y-1 mt-3"><!> <!></div></div></div></div>'),qe=M('<div class="text-sm">Select a well to view water saturation tools.</div>'),Oe=M('<div class="ws-saturation"><div class="mb-2"><div class="font-semibold">Water Saturation</div> <div class="text-sm text-muted-foreground">Water saturation calculations and displays.</div></div> <!> <!></div>');function Ie(dt,et){qt(et,!1);let D=Ct(et,"projectId",8),E=Ct(et,"wellName",8);const I="http://localhost:6312";let H=g({enabled:!1,minDepth:null,maxDepth:null}),nt=g({enabled:!1,zones:[]}),z=g([]),K=g("metric"),at=g(35e3),rt=g(2.58),mt=g(.9),ut=g(2),A=g(!1),w=g(null),vt=g([]),q=g([]),R=g([]),U=g([]),Q=g([]),V=g([]),G=g([]),pt=null,L=g(null),st=g(!1),ot=g(null);async function Vt(){if(!(!D()||!E())){r(A,!0),r(w,null);try{const s=await fetch(`${I}/quick_pp/database/projects/${D()}/wells/${encodeURIComponent(String(E()))}/merged`);if(!s.ok)throw new Error(await s.text());const i=await s.json(),l=i&&i.data?i.data:i;if(!Array.isArray(l))throw new Error("Unexpected data format from backend");r(vt,l)}catch(s){console.warn("Failed to load well data",s),r(w,String(s?.message??s))}finally{r(A,!1)}}}function Jt(){const s=t(z),i=[];for(const l of s){const x=l.tvdss??l.TVDSS??l.tvd??l.TVD??l.depth??l.DEPTH??NaN,a=Number(x);isNaN(a)||i.push({tvdss:a})}return i}async function zt(){const s=Jt();if(!s.length){r(w,"No TVD/DEPTH values found in well data");return}r(A,!0),r(w,null),r(q,[]),r(R,[]);try{const i={meas_system:t(K),data:s},l=await fetch(`${I}/quick_pp/saturation/temp_grad`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error(await l.text());const x=await l.json(),a=Array.isArray(x)?x.map(y=>Number(y.TEMP_GRAD??y.temp_grad??y.value??NaN)):[];r(q,a);const m={water_salinity:Number(t(at)),data:a.map(y=>({temp_grad:y}))},N=await fetch(`${I}/quick_pp/saturation/rw`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});if(!N.ok)throw new Error(await N.text());const f=await N.json();r(R,Array.isArray(f)?f.map(y=>Number(y.RW??y.rw??NaN)):[])}catch(i){console.warn("TempGrad/Rw error",i),r(w,String(i?.message??i))}finally{r(A,!1)}}async function Gt(){r(q,[]),r(R,[]),r(U,[]),r(Q,[]),r(w,null),r(A,!0);try{if(await zt(),t(w)||(await Lt(),t(w)))return;await Bt()}catch(s){console.warn("Estimate Water Saturation error",s),r(w,String(s?.message??s))}finally{r(A,!1)}}async function Lt(){if(!t(R)||t(R).length===0){r(w,"Please compute Rw first");return}const s=t(z),i=[],l=[];let x=0;for(const a of s){const m=Number(a.depth??a.DEPTH??NaN),N=Number(a.rt??a.RT??a.Rt??a.res??a.RES??NaN),f=Number(a.phit??a.PHIT??a.Phit??NaN);if(isNaN(N)||isNaN(f))continue;const y=t(R)[x++]??NaN;isNaN(y)||(i.push({rt:N,rw:y,phit:f}),l.push(m))}if(!i.length){r(w,"No RT/PHIT rows available for Archie");return}r(A,!0),r(w,null),r(U,[]);try{const a={data:i},m=await fetch(`${I}/quick_pp/saturation/archie`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!m.ok)throw new Error(await m.text());const N=await m.json();r(U,Array.isArray(N)?N.map(f=>Number(f.SWT??f.swt??NaN)):[]),r(V,t(U).map((f,y)=>({depth:l[y],SWT:f})).filter(f=>!isNaN(Number(f.depth))))}catch(a){console.warn("Archie error",a),r(w,String(a?.message??a))}finally{r(A,!1)}}async function Bt(){if(!t(R)||t(R).length===0||!t(q)||t(q).length===0){r(w,"Please compute Temp Grad and Rw first");return}const s=[],i=[],l=[],x=t(z);for(const n of x){const d=Number(n.vcld??n.VCLD??n.vclay??n.VCLAY??NaN),v=Number(n.phit??n.PHIT??n.Phit??NaN);!isNaN(d)&&!isNaN(v)&&s.push({vcld:d,phit:v})}for(let n=0;n<t(q).length;n++){const d=t(q)[n],v=t(R)[n];!isNaN(Number(d))&&!isNaN(Number(v))&&i.push({temp_grad:d,rw:v})}let a=[];if(s.length)try{const n={rho_clay:Number(t(rt)),cec_clay:Number(t(mt)),data:s},d=await fetch(`${I}/quick_pp/saturation/estimate_qv`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!d.ok)throw new Error(await d.text());const v=await d.json();a=Array.isArray(v)?v.map(S=>Number(S.QV??S.qv??NaN)):[]}catch(n){console.warn("Qv error",n)}let m=[];if(i.length)try{const n={data:i},d=await fetch(`${I}/quick_pp/saturation/b_waxman_smits`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!d.ok)throw new Error(await d.text());const v=await d.json();m=Array.isArray(v)?v.map(S=>Number(S.B??S.b??NaN)):[]}catch(n){console.warn("B estimation error",n)}let N=0,f=0,y=0;const B=[];for(const n of x){const d=Number(n.depth??n.DEPTH??NaN),v=Number(n.rt??n.RT??n.res??n.RES??NaN),S=Number(n.phit??n.PHIT??n.Phit??NaN);if(isNaN(v)||isNaN(S))continue;const Y=t(R)[y++]??NaN,X=a[N++]??NaN,it=m[f++]??NaN;isNaN(Y)||isNaN(X)||isNaN(it)||(l.push({rt:v,rw:Y,phit:S,qv:X,b:it,m:Number(t(ut))}),B.push(d))}if(!l.length){r(w,"Insufficient data to run Waxman-Smits (need rt, phit, rw, qv, b)");return}r(A,!0),r(w,null),r(Q,[]);try{const n={data:l},d=await fetch(`${I}/quick_pp/saturation/waxman_smits`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!d.ok)throw new Error(await d.text());const v=await d.json();r(Q,Array.isArray(v)?v.map(S=>Number(S.SWT??S.swt??NaN)):[]),r(G,t(Q).map((S,Y)=>({depth:B[Y],SWT:S})).filter(S=>!isNaN(Number(S.depth))))}catch(n){console.warn("Waxman-Smits error",n),r(w,String(n?.message??n))}finally{r(A,!1)}}async function Ut(){if(!pt){const s=await ge(()=>import("../chunks/HHMWGB-5.js").then(i=>i.p),__vite__mapDeps([0,1]),import.meta.url);pt=s?.default??s}return pt}async function Qt(){if(!t(L))return;const s=await Ut(),i=[];if(t(V)&&t(V).length>0&&(i.push({x:t(V).map(a=>Number(a.depth)),y:t(V).map(a=>a.SWT),name:"Archie SWT",mode:"lines",line:{color:"#2563eb"}}),i.push({x:[Math.min(...t(V).map(a=>Number(a.depth))),Math.max(...t(V).map(a=>Number(a.depth)))],y:[1,1],mode:"lines",line:{color:"black",width:1,dash:"dash"},showlegend:!1})),t(G)&&t(G).length>0&&i.push({x:t(G).map(a=>Number(a.depth)),y:t(G).map(a=>a.SWT),name:"Waxman-Smits SWT",mode:"lines",line:{color:"#dc2626"}}),i.length===0){try{s.purge(t(L))}catch{}return}const x={height:220,margin:{l:60,r:20,t:20,b:40},dragmode:"zoom",xaxis:{title:"Depth"},yaxis:{title:"SWT (fraction)",range:[0,1.5],tickformat:".2f",fixedrange:!0},showlegend:!0,legend:{...{x:1,y:1,xanchor:"right",yanchor:"top"},bgcolor:"rgba(255,255,255,0.75)",borderwidth:1}};try{s.react(t(L),i,x,{responsive:!0})}catch{s.newPlot(t(L),i,x,{responsive:!0})}}async function Yt(){if(!D()||!E()){r(w,"Project and well must be selected before saving");return}const s=new Map;for(const a of t(V)){const m=Number(a.depth);isNaN(m)||s.set(m,Number(a.SWT))}const i=new Map;for(const a of t(G)){const m=Number(a.depth);isNaN(m)||i.set(m,Number(a.SWT))}const l=Array.from(new Set([...s.keys(),...i.keys()])).sort((a,m)=>a-m);if(!l.length){r(w,"No saturation results to save");return}const x=l.map(a=>{const m={DEPTH:a};return s.has(a)&&(m.SWT_ARCHIE=s.get(a)),i.has(a)&&(m.SWT=i.get(a)),m});r(st,!0),r(ot,null),r(w,null);try{const a={data:x},m=`${I}/quick_pp/database/projects/${D()}/wells/${encodeURIComponent(String(E()))}/data`,N=await fetch(m,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!N.ok)throw new Error(await N.text());const f=await N.json().catch(()=>null);r(ot,f&&f.message?String(f.message):"Saturation results saved");try{window.dispatchEvent(new CustomEvent("qpp:data-updated",{detail:{projectId:D(),wellName:E(),kind:"saturation"}}))}catch{}}catch(a){console.warn("Save saturation error",a),r(ot,null),r(w,String(a?.message??a))}finally{r(st,!1)}}function Wt(s){const i=s.filter(d=>!isNaN(d)),l=i.length;if(l===0)return null;const a=i.reduce((d,v)=>d+v,0)/l,m=Math.min(...i),N=Math.max(...i),f=i.slice().sort((d,v)=>d-v),y=(f[Math.floor((l-1)/2)]+f[Math.ceil((l-1)/2)])/2,B=i.reduce((d,v)=>d+Math.pow(v-a,2),0)/l,n=Math.sqrt(B);return{count:l,mean:a,min:m,max:N,median:y,std:n}}const Zt=Ht.subscribe(s=>{s?.depthFilter&&r(H,{...s.depthFilter}),s?.zoneFilter&&r(nt,{...s.zoneFilter})});Dt(()=>{Zt()}),St(()=>(t(L),t(V),t(G),t(H)),()=>{t(L)&&(t(V)?.length>0||t(G)?.length>0||t(H))&&Qt()}),St(()=>(t(vt),t(H),t(nt)),()=>{r(z,(()=>{let s=t(vt)||[];return s=be(s,t(H)),s=xe(s,t(nt)),s})())}),St(()=>(u(D()),u(E())),()=>{D()&&E()&&Vt()}),he(),It();var ft=Oe(),Pt=p(h(ft),2);Se(Pt,{});var Kt=p(Pt,2);{var Xt=s=>{var i=De(),l=h(i),x=h(l),a=p(h(x),2);Z(()=>{t(K),_e(()=>{})});var m=h(a);m.value=m.__value="metric";var N=p(m);N.value=N.__value="imperial",_(a),_(x);var f=p(x,2),y=p(h(f),2);lt(y),_(f);var B=p(f,2),n=p(h(B),2);lt(n),_(B);var d=p(B,2),v=p(h(d),2);lt(v),_(d);var S=p(d,2),Y=p(h(S),2);lt(Y),_(S),_(l);var X=p(l,2),it=h(X);{let o=$(()=>t(A)?"opacity:0.5; pointer-events:none;":"");Ft(it,{class:"btn btn-primary",onclick:Gt,get disabled(){return t(A)},get style(){return t(o)},children:(e,T)=>{we();var C=bt("Estimate Water Saturation");b(e,C)},$$slots:{default:!0}})}var $t=p(it,2);{let o=$(()=>t(A)||t(st)),e=$(()=>t(A)||t(st)?"opacity:0.5; pointer-events:none;":"");Ft($t,{class:"btn ml-2 bg-emerald-700",onclick:Yt,get disabled(){return t(o)},get style(){return t(e)},children:(T,C)=>{var F=xt(),P=Tt(F);{var j=W=>{var O=bt("Saving...");b(W,O)},k=W=>{var O=bt("Save Saturation");b(W,O)};J(P,W=>{t(st)?W(j):W(k,!1)})}b(T,F)},$$slots:{default:!0}})}var ee=p($t,2);{var ae=o=>{var e=Pe(),T=h(e,!0);_(e),Z(()=>tt(T,t(ot))),b(o,e)};J(ee,o=>{t(ot)&&o(ae)})}_(X);var At=p(X,2);{var re=o=>{var e=$e(),T=h(e);_(e),Z(()=>tt(T,`Error: ${t(w)??""}`)),b(o,e)};J(At,o=>{t(w)&&o(re)})}var Rt=p(At,2),ht=h(Rt),se=p(h(ht),2);{var oe=o=>{const e=$(()=>(t(q),c(()=>Wt(t(q)))));var T=xt(),C=Tt(T);{var F=P=>{var j=Ae(),k=h(j);_(j),Z((W,O,gt,yt,Nt)=>tt(k,`Avg: ${W??""} | Min: ${O??""} | Max: ${gt??""} | Median: ${yt??""} | Std: ${Nt??""} | Count: ${u(t(e)),c(()=>t(e).count)??""}`),[()=>(u(t(e)),c(()=>t(e).mean.toFixed(2))),()=>(u(t(e)),c(()=>t(e).min.toFixed(2))),()=>(u(t(e)),c(()=>t(e).max.toFixed(2))),()=>(u(t(e)),c(()=>t(e).median.toFixed(2))),()=>(u(t(e)),c(()=>t(e).std.toFixed(2)))]),b(P,j)};J(C,P=>{t(e)&&P(F)})}b(o,T)},ie=o=>{var e=Re();b(o,e)};J(se,o=>{t(q),c(()=>t(q).length)?o(oe):o(ie,!1)})}_(ht);var _t=p(ht,2),ne=p(h(_t),2);{var le=o=>{const e=$(()=>(t(R),c(()=>Wt(t(R)))));var T=xt(),C=Tt(T);{var F=P=>{var j=Me(),k=h(j);_(j),Z((W,O,gt,yt,Nt)=>tt(k,`Avg: ${W??""} | Min: ${O??""} | Max: ${gt??""} | Median: ${yt??""} | Std: ${Nt??""} | Count: ${u(t(e)),c(()=>t(e).count)??""}`),[()=>(u(t(e)),c(()=>t(e).mean.toFixed(3))),()=>(u(t(e)),c(()=>t(e).min.toFixed(3))),()=>(u(t(e)),c(()=>t(e).max.toFixed(3))),()=>(u(t(e)),c(()=>t(e).median.toFixed(3))),()=>(u(t(e)),c(()=>t(e).std.toFixed(3)))]),b(P,j)};J(C,P=>{t(e)&&P(F)})}b(o,T)},ce=o=>{var e=je();b(o,e)};J(ne,o=>{t(R),c(()=>t(R).length)?o(le):o(ce,!1)})}_(_t);var Mt=p(_t,2),wt=p(h(Mt),2),jt=h(wt),de=h(jt);Ne(de,o=>r(L,o),()=>t(L)),_(jt),_(wt);var kt=p(wt,2),Et=h(kt);{var me=o=>{const e=$(()=>t(U)),T=$(()=>(u(t(e)),c(()=>t(e).reduce((k,W)=>k+W,0)/t(e).length))),C=$(()=>(u(t(e)),c(()=>Math.min(...t(e))))),F=$(()=>(u(t(e)),c(()=>Math.max(...t(e)))));var P=ke(),j=p(h(P));_(P),Z((k,W,O)=>tt(j,` Avg: ${k??""} | Min: ${W??""} | Max: ${O??""} | Count: ${u(t(e)),c(()=>t(e).length)??""}`),[()=>(u(t(T)),c(()=>t(T).toFixed(2))),()=>(u(t(C)),c(()=>t(C).toFixed(2))),()=>(u(t(F)),c(()=>t(F).toFixed(2)))]),b(o,P)},ue=o=>{var e=Ee();b(o,e)};J(Et,o=>{t(U),c(()=>t(U).length>0)?o(me):o(ue,!1)})}var ve=p(Et,2);{var pe=o=>{const e=$(()=>t(Q)),T=$(()=>(u(t(e)),c(()=>t(e).reduce((k,W)=>k+W,0)/t(e).length))),C=$(()=>(u(t(e)),c(()=>Math.min(...t(e))))),F=$(()=>(u(t(e)),c(()=>Math.max(...t(e)))));var P=Ce(),j=p(h(P));_(P),Z((k,W,O)=>tt(j,` Avg: ${k??""} | Min: ${W??""} | Max: ${O??""} | Count: ${u(t(e)),c(()=>t(e).length)??""}`),[()=>(u(t(T)),c(()=>t(T).toFixed(2))),()=>(u(t(C)),c(()=>t(C).toFixed(2))),()=>(u(t(F)),c(()=>t(F).toFixed(2)))]),b(o,P)},fe=o=>{var e=Fe();b(o,e)};J(ve,o=>{t(Q),c(()=>t(Q).length>0)?o(pe):o(fe,!1)})}_(kt),_(Mt),_(Rt),_(i),ye(a,()=>t(K),o=>r(K,o)),ct(y,()=>t(at),o=>r(at,o)),ct(n,()=>t(rt),o=>r(rt,o)),ct(v,()=>t(mt),o=>r(mt,o)),ct(Y,()=>t(ut),o=>r(ut,o)),b(s,i)},te=s=>{var i=qe();b(s,i)};J(Kt,s=>{E()?s(Xt):s(te,!1)})}_(ft),b(dt,ft),Ot()}var He=M('<div slot="left"><!></div>');function oa(dt,et){qt(et,!1);let D=g(null),E=g(null);const I=Ht.subscribe(H=>{r(D,H?.project??null),r(E,H?.selectedWell??null)});Dt(()=>I()),It(),Te(dt,{get selectedWell(){return t(E)},get project(){return t(D)},$$slots:{left:(H,nt)=>{var z=He(),K=h(z);{let at=$(()=>t(D)?.project_id??""),rt=$(()=>t(E)?.name??"");Ie(K,{get projectId(){return t(at)},get wellName(){return t(rt)}})}_(z),b(H,z)}}}),Ot()}export{oa as component,sa as universal};
