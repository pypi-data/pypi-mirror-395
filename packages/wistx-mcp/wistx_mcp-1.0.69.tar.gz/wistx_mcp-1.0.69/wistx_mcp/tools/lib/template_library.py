"""Template library for common compliance standards."""

import logging
from typing import Any

from wistx_mcp.models.report_template import ReportTemplate, TemplateEngine, OutputFormat

logger = logging.getLogger(__name__)


class TemplateLibrary:
    """Library of built-in report templates for common compliance standards."""

    @staticmethod
    def get_pci_dss_template() -> dict[str, Any]:
        """Get PCI-DSS compliance report template.

        Returns:
            Template dictionary
        """
        template_content = """# PCI-DSS Compliance Report: {{ subject }}

**Generated**: {{ generated_at }}
**Assessment Period**: {{ assessment_period }}

## Executive Summary

This report assesses compliance with the Payment Card Industry Data Security Standard (PCI-DSS) for {{ subject }}.

**Overall Compliance Status**: {{ compliance_status }}

### Key Findings

- **Total Requirements**: {{ total_requirements }}
- **Compliant Requirements**: {{ compliant_requirements }}
- **Non-Compliant Requirements**: {{ non_compliant_requirements }}
- **Compliance Score**: {{ compliance_score }}%

## Scope

### Resources Assessed

{% for resource in resources %}
- **{{ resource.type }}**: {{ resource.name }}
{% endfor %}

### Assessment Period

- **Start Date**: {{ assessment_start }}
- **End Date**: {{ assessment_end }}

## Resource Compliance Summary

{% if resource_compliance_summary %}
{% for resource_summary in resource_compliance_summary %}
### {{ resource_summary.name }} ({{ resource_summary.type }})

**Total Controls**: {{ resource_summary.total_controls }}
- **CRITICAL**: {{ resource_summary.critical_controls }}
- **HIGH**: {{ resource_summary.high_controls }}
- **MEDIUM**: {{ resource_summary.medium_controls }}
- **LOW**: {{ resource_summary.low_controls }}

**Applicable Controls**:
{% for control in resource_summary.controls %}
- **{{ control.control_id }}** ({{ control.severity }}): {{ control.title }}
{% endfor %}

---
{% endfor %}
{% endif %}

## Compliance Requirements

{% for requirement in requirements %}
### Requirement {{ requirement.number }}: {{ requirement.title }}

**Status**: {{ requirement.status }}
**Severity**: {{ requirement.severity }}

**Description**: {{ requirement.description }}

{% if requirement.applies_to_resources %}
**Applies To Resources**:
{% for resource in requirement.applies_to_resources %}
- **{{ resource.type }}**: {{ resource.name }} (Status: {{ resource.status }})
{% endfor %}
{% endif %}

{% if requirement.findings %}
**Findings**:
{% for finding in requirement.findings %}
- {{ finding }}
{% endfor %}
{% endif %}

{% if requirement.remediation %}
**Remediation**: {{ requirement.remediation }}
{% endif %}

---
{% endfor %}

{% for requirement in requirements %}
### Requirement {{ requirement.number }}: {{ requirement.title }}

**Status**: {{ requirement.status }}
**Severity**: {{ requirement.severity }}

**Description**: {{ requirement.description }}

{% if requirement.findings %}
**Findings**:
{% for finding in requirement.findings %}
- {{ finding }}
{% endfor %}
{% endif %}

{% if requirement.remediation %}
**Remediation**: {{ requirement.remediation }}
{% endif %}

---
{% endfor %}

## Recommendations

{% for recommendation in recommendations %}
- {{ recommendation }}
{% endfor %}

## Next Steps

1. Address non-compliant requirements
2. Implement remediation measures
3. Schedule follow-up assessment
4. Update security policies and procedures

---

**Report Generated By**: {{ generator_name }}
**Report Version**: {{ report_version }}
"""

        return {
            "name": "PCI-DSS Compliance Report Template",
            "description": "Standard template for PCI-DSS compliance reports",
            "template_content": template_content,
            "document_type": "compliance_report",
            "compliance_standards": ["PCI-DSS"],
            "resource_types": ["RDS", "S3", "EC2", "Lambda", "VPC"],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML, OutputFormat.PDF],
            "variables": {
                "subject": {"type": "string", "required": True},
                "generated_at": {"type": "string", "required": True},
                "assessment_period": {"type": "string", "required": True},
                "compliance_status": {"type": "string", "required": True},
                "total_requirements": {"type": "integer", "required": True},
                "compliant_requirements": {"type": "integer", "required": True},
                "non_compliant_requirements": {"type": "integer", "required": True},
                "compliance_score": {"type": "float", "required": True},
                "resources": {"type": "array", "required": True},
                "assessment_start": {"type": "string", "required": True},
                "assessment_end": {"type": "string", "required": True},
                "requirements": {"type": "array", "required": True},
                "recommendations": {"type": "array", "required": True},
                "generator_name": {"type": "string", "required": False},
                "report_version": {"type": "string", "required": False},
            },
            "sections": [
                "executive_summary",
                "scope",
                "compliance_requirements",
                "recommendations",
                "next_steps",
            ],
        }

    @staticmethod
    def get_hipaa_template() -> dict[str, Any]:
        """Get HIPAA compliance report template.

        Returns:
            Template dictionary
        """
        template_content = """# HIPAA Compliance Report: {{ subject }}

**Generated**: {{ generated_at }}

## Executive Summary

This report assesses compliance with the Health Insurance Portability and Accountability Act (HIPAA) for {{ subject }}.

**Overall Compliance Status**: {{ compliance_status }}

### Key Findings

- **Total Safeguards**: {{ total_safeguards }}
- **Compliant Safeguards**: {{ compliant_safeguards }}
- **Non-Compliant Safeguards**: {{ non_compliant_safeguards }}

## Administrative Safeguards

{% for safeguard in administrative_safeguards %}
### {{ safeguard.title }}

**Status**: {{ safeguard.status }}
**Description**: {{ safeguard.description }}

{% if safeguard.findings %}
**Findings**: {{ safeguard.findings }}
{% endif %}

---
{% endfor %}

## Physical Safeguards

{% for safeguard in physical_safeguards %}
### {{ safeguard.title }}

**Status**: {{ safeguard.status }}
**Description**: {{ safeguard.description }}

---
{% endfor %}

## Technical Safeguards

{% for safeguard in technical_safeguards %}
### {{ safeguard.title }}

**Status**: {{ safeguard.status }}
**Description**: {{ safeguard.description }}

---
{% endfor %}

## Recommendations

{% for recommendation in recommendations %}
- {{ recommendation }}
{% endfor %}
"""

        return {
            "name": "HIPAA Compliance Report Template",
            "description": "Standard template for HIPAA compliance reports",
            "template_content": template_content,
            "document_type": "compliance_report",
            "compliance_standards": ["HIPAA"],
            "resource_types": ["RDS", "S3", "EC2", "Lambda"],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML, OutputFormat.PDF],
            "variables": {
                "subject": {"type": "string", "required": True},
                "generated_at": {"type": "string", "required": True},
                "compliance_status": {"type": "string", "required": True},
                "total_safeguards": {"type": "integer", "required": True},
                "compliant_safeguards": {"type": "integer", "required": True},
                "non_compliant_safeguards": {"type": "integer", "required": True},
                "administrative_safeguards": {"type": "array", "required": True},
                "physical_safeguards": {"type": "array", "required": True},
                "technical_safeguards": {"type": "array", "required": True},
                "recommendations": {"type": "array", "required": True},
            },
            "sections": [
                "executive_summary",
                "administrative_safeguards",
                "physical_safeguards",
                "technical_safeguards",
                "recommendations",
            ],
        }

    @staticmethod
    def get_soc2_template() -> dict[str, Any]:
        """Get SOC 2 compliance report template.

        Returns:
            Template dictionary
        """
        template_content = """# SOC 2 Compliance Report: {{ subject }}

**Generated**: {{ generated_at }}
**Trust Services Criteria**: {{ trust_services_criteria }}

## Executive Summary

This report assesses compliance with SOC 2 Trust Services Criteria for {{ subject }}.

**Overall Compliance Status**: {{ compliance_status }}

## Trust Services Criteria Assessment

{% for criterion in trust_criteria %}
### {{ criterion.name }}

**Status**: {{ criterion.status }}
**Description**: {{ criterion.description }}

{% if criterion.controls %}
**Controls**:
{% for control in criterion.controls %}
- **{{ control.name }}**: {{ control.status }}
  - {{ control.description }}
{% endfor %}
{% endif %}

---
{% endfor %}

## Recommendations

{% for recommendation in recommendations %}
- {{ recommendation }}
{% endfor %}
"""

        return {
            "name": "SOC 2 Compliance Report Template",
            "description": "Standard template for SOC 2 compliance reports",
            "template_content": template_content,
            "document_type": "compliance_report",
            "compliance_standards": ["SOC2"],
            "resource_types": ["RDS", "S3", "EC2", "Lambda", "EKS"],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML, OutputFormat.PDF],
            "variables": {
                "subject": {"type": "string", "required": True},
                "generated_at": {"type": "string", "required": True},
                "trust_services_criteria": {"type": "string", "required": True},
                "compliance_status": {"type": "string", "required": True},
                "trust_criteria": {"type": "array", "required": True},
                "recommendations": {"type": "array", "required": True},
            },
            "sections": [
                "executive_summary",
                "trust_services_criteria_assessment",
                "recommendations",
            ],
        }

    @staticmethod
    def get_iso27001_template() -> dict[str, Any]:
        """Get ISO 27001 compliance report template.

        Returns:
            Template dictionary for ISO 27001 Information Security Management System
        """
        template_content = """# ISO 27001 Compliance Report: {{ subject }}

**Generated**: {{ generated_at }}
**Standard**: ISO/IEC 27001:2022
**Scope**: {{ scope }}

## Executive Summary

This report assesses compliance with ISO/IEC 27001:2022 Information Security Management System (ISMS) requirements for {{ subject }}.

**Overall Compliance Status**: {{ compliance_status }}
**ISMS Maturity Level**: {{ maturity_level }}

## Annex A Control Assessment

{% for domain in control_domains %}
### {{ domain.id }} - {{ domain.name }}

**Domain Status**: {{ domain.status }}

{% for control in domain.controls %}
#### {{ control.id }}: {{ control.name }}

- **Objective**: {{ control.objective }}
- **Implementation Status**: {{ control.status }}
- **Evidence**: {{ control.evidence }}
{% if control.gaps %}
- **Gaps Identified**: {{ control.gaps }}
{% endif %}

{% endfor %}
---
{% endfor %}

## Statement of Applicability (SoA) Summary

| Control Category | Total Controls | Implemented | Partially | Not Implemented | Not Applicable |
|-----------------|----------------|-------------|-----------|-----------------|----------------|
{% for category in soa_summary %}
| {{ category.name }} | {{ category.total }} | {{ category.implemented }} | {{ category.partial }} | {{ category.not_implemented }} | {{ category.not_applicable }} |
{% endfor %}

## Risk Treatment Plan

{% for risk in risk_treatment %}
- **{{ risk.id }}**: {{ risk.description }}
  - Treatment: {{ risk.treatment }}
  - Owner: {{ risk.owner }}
  - Target Date: {{ risk.target_date }}
{% endfor %}

## Certification Readiness

**Readiness Score**: {{ readiness_score }}%
**Recommended Actions**:
{% for action in recommended_actions %}
- {{ action }}
{% endfor %}
"""

        return {
            "name": "ISO 27001 Compliance Report Template",
            "description": "Template for ISO/IEC 27001:2022 ISMS compliance assessment",
            "template_content": template_content,
            "document_type": "compliance_report",
            "compliance_standards": ["ISO-27001"],
            "resource_types": ["RDS", "S3", "EC2", "Lambda", "EKS", "VPC", "IAM"],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML, OutputFormat.PDF],
            "variables": {
                "subject": {"type": "string", "required": True},
                "generated_at": {"type": "string", "required": True},
                "scope": {"type": "string", "required": True},
                "compliance_status": {"type": "string", "required": True},
                "maturity_level": {"type": "string", "required": True},
                "control_domains": {"type": "array", "required": True},
                "soa_summary": {"type": "array", "required": True},
                "risk_treatment": {"type": "array", "required": True},
                "readiness_score": {"type": "number", "required": True},
                "recommended_actions": {"type": "array", "required": True},
            },
            "sections": [
                "executive_summary",
                "annex_a_control_assessment",
                "statement_of_applicability",
                "risk_treatment_plan",
                "certification_readiness",
            ],
        }

    @staticmethod
    def get_nist80053_template() -> dict[str, Any]:
        """Get NIST 800-53 compliance report template.

        Returns:
            Template dictionary for NIST 800-53 Security and Privacy Controls
        """
        template_content = """# NIST 800-53 Compliance Report: {{ subject }}

**Generated**: {{ generated_at }}
**Framework**: NIST SP 800-53 Rev. 5
**Baseline**: {{ baseline_level }}
**System Categorization**: {{ system_categorization }}

## Executive Summary

This report assesses compliance with NIST SP 800-53 Rev. 5 Security and Privacy Controls for {{ subject }}.

**Overall Compliance Status**: {{ compliance_status }}
**Controls Assessed**: {{ total_controls }}
**Implementation Rate**: {{ implementation_rate }}%

## Control Family Assessment

{% for family in control_families %}
### {{ family.id }} - {{ family.name }}

**Family Status**: {{ family.status }} | **Priority**: {{ family.priority }}

{% for control in family.controls %}
#### {{ control.id }}: {{ control.name }}

- **Control Enhancement**: {{ control.enhancement }}
- **Implementation Status**: {{ control.status }}
- **Responsible Party**: {{ control.responsible_party }}
{% if control.assessment_findings %}
- **Assessment Findings**: {{ control.assessment_findings }}
{% endif %}

{% endfor %}
---
{% endfor %}

## Security Control Baseline Summary

| Control Family | Low | Moderate | High | Implemented |
|---------------|-----|----------|------|-------------|
{% for baseline in baseline_summary %}
| {{ baseline.family }} | {{ baseline.low }} | {{ baseline.moderate }} | {{ baseline.high }} | {{ baseline.implemented }} |
{% endfor %}

## Plan of Action and Milestones (POA&M)

{% for poam in poam_items %}
### {{ poam.id }}: {{ poam.weakness }}

- **Control**: {{ poam.control_id }}
- **Severity**: {{ poam.severity }}
- **Scheduled Completion**: {{ poam.scheduled_completion }}
- **Milestone**: {{ poam.milestone }}
- **Status**: {{ poam.status }}
{% endfor %}

## Authorization Recommendation

**Recommendation**: {{ authorization_recommendation }}
**Risk Level**: {{ overall_risk_level }}
"""

        return {
            "name": "NIST 800-53 Compliance Report Template",
            "description": "Template for NIST SP 800-53 Rev. 5 security control assessment",
            "template_content": template_content,
            "document_type": "compliance_report",
            "compliance_standards": ["NIST-800-53"],
            "resource_types": ["RDS", "S3", "EC2", "Lambda", "EKS", "VPC", "IAM"],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML, OutputFormat.PDF],
            "variables": {
                "subject": {"type": "string", "required": True},
                "generated_at": {"type": "string", "required": True},
                "baseline_level": {"type": "string", "required": True},
                "system_categorization": {"type": "string", "required": True},
                "compliance_status": {"type": "string", "required": True},
                "total_controls": {"type": "number", "required": True},
                "implementation_rate": {"type": "number", "required": True},
                "control_families": {"type": "array", "required": True},
                "baseline_summary": {"type": "array", "required": True},
                "poam_items": {"type": "array", "required": True},
                "authorization_recommendation": {"type": "string", "required": True},
                "overall_risk_level": {"type": "string", "required": True},
            },
            "sections": [
                "executive_summary",
                "control_family_assessment",
                "baseline_summary",
                "poam",
                "authorization_recommendation",
            ],
        }

    @staticmethod
    def get_gdpr_template() -> dict[str, Any]:
        """Get GDPR compliance report template.

        Returns:
            Template dictionary for EU General Data Protection Regulation
        """
        template_content = """# GDPR Compliance Report: {{ subject }}

**Generated**: {{ generated_at }}
**Regulation**: EU General Data Protection Regulation (GDPR)
**Data Controller**: {{ data_controller }}
**DPO Contact**: {{ dpo_contact }}

## Executive Summary

This report assesses compliance with the EU General Data Protection Regulation (GDPR) for {{ subject }}.

**Overall Compliance Status**: {{ compliance_status }}
**Data Processing Activities**: {{ processing_activities_count }}

## Lawful Basis Assessment

{% for basis in lawful_bases %}
### {{ basis.activity }}: {{ basis.legal_basis }}

- **Data Categories**: {{ basis.data_categories }}
- **Data Subjects**: {{ basis.data_subjects }}
- **Purpose**: {{ basis.purpose }}
- **Retention Period**: {{ basis.retention_period }}
{% if basis.consent_mechanism %}
- **Consent Mechanism**: {{ basis.consent_mechanism }}
{% endif %}

{% endfor %}

## Data Subject Rights Implementation

| Right | Article | Implemented | Mechanism | Response Time |
|-------|---------|-------------|-----------|---------------|
{% for right in data_subject_rights %}
| {{ right.name }} | {{ right.article }} | {{ right.implemented }} | {{ right.mechanism }} | {{ right.response_time }} |
{% endfor %}

## Technical and Organizational Measures (Article 32)

{% for measure in security_measures %}
### {{ measure.category }}

- **Implementation**: {{ measure.implementation }}
- **Status**: {{ measure.status }}
- **Evidence**: {{ measure.evidence }}
{% endfor %}

## Data Protection Impact Assessments (DPIA)

{% for dpia in dpias %}
### {{ dpia.processing_activity }}

- **Risk Level**: {{ dpia.risk_level }}
- **DPIA Required**: {{ dpia.required }}
- **Status**: {{ dpia.status }}
{% if dpia.findings %}
- **Key Findings**: {{ dpia.findings }}
{% endif %}
{% endfor %}

## Cross-Border Data Transfers

{% for transfer in data_transfers %}
- **Destination**: {{ transfer.destination }}
- **Transfer Mechanism**: {{ transfer.mechanism }}
- **Adequacy Decision**: {{ transfer.adequacy }}
{% endfor %}

## Records of Processing Activities (Article 30)

**Total Activities Documented**: {{ ropa_count }}
**Last Updated**: {{ ropa_last_updated }}

## Recommendations

{% for recommendation in recommendations %}
- **{{ recommendation.priority }}**: {{ recommendation.action }}
{% endfor %}
"""

        return {
            "name": "GDPR Compliance Report Template",
            "description": "Template for EU GDPR compliance assessment",
            "template_content": template_content,
            "document_type": "compliance_report",
            "compliance_standards": ["GDPR"],
            "resource_types": ["RDS", "S3", "DynamoDB", "Lambda", "API Gateway"],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML, OutputFormat.PDF],
            "variables": {
                "subject": {"type": "string", "required": True},
                "generated_at": {"type": "string", "required": True},
                "data_controller": {"type": "string", "required": True},
                "dpo_contact": {"type": "string", "required": True},
                "compliance_status": {"type": "string", "required": True},
                "processing_activities_count": {"type": "number", "required": True},
                "lawful_bases": {"type": "array", "required": True},
                "data_subject_rights": {"type": "array", "required": True},
                "security_measures": {"type": "array", "required": True},
                "dpias": {"type": "array", "required": True},
                "data_transfers": {"type": "array", "required": True},
                "ropa_count": {"type": "number", "required": True},
                "ropa_last_updated": {"type": "string", "required": True},
                "recommendations": {"type": "array", "required": True},
            },
            "sections": [
                "executive_summary",
                "lawful_basis_assessment",
                "data_subject_rights",
                "security_measures",
                "dpia",
                "cross_border_transfers",
                "ropa",
                "recommendations",
            ],
        }

    @staticmethod
    def get_fedramp_template() -> dict[str, Any]:
        """Get FedRAMP compliance report template.

        Returns:
            Template dictionary for Federal Risk and Authorization Management Program
        """
        template_content = """# FedRAMP Compliance Report: {{ subject }}

**Generated**: {{ generated_at }}
**Authorization Level**: {{ authorization_level }}
**CSP Name**: {{ csp_name }}
**System Name**: {{ system_name }}

## Executive Summary

This report assesses compliance with the Federal Risk and Authorization Management Program (FedRAMP) for {{ subject }}.

**Overall Compliance Status**: {{ compliance_status }}
**Impact Level**: {{ impact_level }}
**Authorization Status**: {{ authorization_status }}

## System Security Plan (SSP) Summary

- **System Boundary**: {{ system_boundary }}
- **Data Types**: {{ data_types }}
- **User Types**: {{ user_types }}
- **Interconnections**: {{ interconnections_count }}

## Control Implementation Summary

| Control Family | Total | Implemented | Planned | Not Applicable |
|---------------|-------|-------------|---------|----------------|
{% for family in control_summary %}
| {{ family.name }} | {{ family.total }} | {{ family.implemented }} | {{ family.planned }} | {{ family.not_applicable }} |
{% endfor %}

## Security Assessment Results

**3PAO**: {{ tpao_name }}
**Assessment Date**: {{ assessment_date }}

{% for finding in assessment_findings %}
### {{ finding.id }}: {{ finding.title }}

- **Control**: {{ finding.control_id }}
- **Risk Level**: {{ finding.risk_level }}
- **Status**: {{ finding.status }}
- **Remediation**: {{ finding.remediation }}
{% endfor %}

## Plan of Action and Milestones (POA&M)

| ID | Weakness | Risk | Scheduled Completion | Status |
|----|----------|------|---------------------|--------|
{% for poam in poam_items %}
| {{ poam.id }} | {{ poam.weakness }} | {{ poam.risk }} | {{ poam.scheduled }} | {{ poam.status }} |
{% endfor %}

## Continuous Monitoring

- **ConMon Status**: {{ conmon_status }}
- **Last Scan Date**: {{ last_scan_date }}
- **Vulnerability Summary**: {{ vuln_summary }}
- **Next Assessment**: {{ next_assessment }}

## Authorization Recommendation

**JAB/Agency Recommendation**: {{ authorization_recommendation }}
**ATO Expiration**: {{ ato_expiration }}
"""

        return {
            "name": "FedRAMP Compliance Report Template",
            "description": "Template for FedRAMP authorization assessment",
            "template_content": template_content,
            "document_type": "compliance_report",
            "compliance_standards": ["FedRAMP"],
            "resource_types": ["EC2", "S3", "RDS", "VPC", "IAM", "CloudTrail", "CloudWatch"],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML, OutputFormat.PDF],
            "variables": {
                "subject": {"type": "string", "required": True},
                "generated_at": {"type": "string", "required": True},
                "authorization_level": {"type": "string", "required": True},
                "csp_name": {"type": "string", "required": True},
                "system_name": {"type": "string", "required": True},
                "compliance_status": {"type": "string", "required": True},
                "impact_level": {"type": "string", "required": True},
                "authorization_status": {"type": "string", "required": True},
                "system_boundary": {"type": "string", "required": True},
                "data_types": {"type": "string", "required": True},
                "user_types": {"type": "string", "required": True},
                "interconnections_count": {"type": "number", "required": True},
                "control_summary": {"type": "array", "required": True},
                "tpao_name": {"type": "string", "required": True},
                "assessment_date": {"type": "string", "required": True},
                "assessment_findings": {"type": "array", "required": True},
                "poam_items": {"type": "array", "required": True},
                "conmon_status": {"type": "string", "required": True},
                "last_scan_date": {"type": "string", "required": True},
                "vuln_summary": {"type": "string", "required": True},
                "next_assessment": {"type": "string", "required": True},
                "authorization_recommendation": {"type": "string", "required": True},
                "ato_expiration": {"type": "string", "required": True},
            },
            "sections": [
                "executive_summary",
                "ssp_summary",
                "control_implementation",
                "assessment_results",
                "poam",
                "continuous_monitoring",
                "authorization_recommendation",
            ],
        }

    @staticmethod
    def get_cis_template() -> dict[str, Any]:
        """Get CIS Benchmarks compliance report template.

        Returns:
            Template dictionary for CIS Benchmarks assessment
        """
        template_content = """# CIS Benchmarks Compliance Report: {{ subject }}

**Generated**: {{ generated_at }}
**Benchmark**: {{ benchmark_name }}
**Version**: {{ benchmark_version }}
**Profile Level**: {{ profile_level }}

## Executive Summary

This report assesses compliance with CIS Benchmarks for {{ subject }}.

**Overall Compliance Score**: {{ compliance_score }}%
**Controls Passed**: {{ controls_passed }}/{{ total_controls }}
**Profile**: {{ profile_level }}

## Benchmark Assessment Summary

| Section | Total | Passed | Failed | Manual | Score |
|---------|-------|--------|--------|--------|-------|
{% for section in sections %}
| {{ section.name }} | {{ section.total }} | {{ section.passed }} | {{ section.failed }} | {{ section.manual }} | {{ section.score }}% |
{% endfor %}

## Control Assessment Details

{% for section in section_details %}
### {{ section.id }} - {{ section.name }}

{% for control in section.controls %}
#### {{ control.id }}: {{ control.title }}

- **Profile Level**: {{ control.profile }}
- **Status**: {{ control.status }}
- **Assessment Method**: {{ control.assessment_method }}
{% if control.current_value %}
- **Current Value**: `{{ control.current_value }}`
- **Expected Value**: `{{ control.expected_value }}`
{% endif %}
{% if control.remediation %}
- **Remediation**: {{ control.remediation }}
{% endif %}

{% endfor %}
---
{% endfor %}

## Failed Controls Summary

{% for control in failed_controls %}
- **{{ control.id }}**: {{ control.title }}
  - Severity: {{ control.severity }}
  - Impact: {{ control.impact }}
{% endfor %}

## Hardening Recommendations

{% for rec in recommendations %}
### {{ rec.priority }}: {{ rec.title }}

{{ rec.description }}

**Effort**: {{ rec.effort }} | **Impact**: {{ rec.impact }}
{% endfor %}
"""

        return {
            "name": "CIS Benchmarks Compliance Report Template",
            "description": "Template for CIS Benchmarks security assessment",
            "template_content": template_content,
            "document_type": "compliance_report",
            "compliance_standards": ["CIS"],
            "resource_types": ["EC2", "S3", "IAM", "VPC", "RDS", "EKS", "Lambda"],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML, OutputFormat.PDF],
            "variables": {
                "subject": {"type": "string", "required": True},
                "generated_at": {"type": "string", "required": True},
                "benchmark_name": {"type": "string", "required": True},
                "benchmark_version": {"type": "string", "required": True},
                "profile_level": {"type": "string", "required": True},
                "compliance_score": {"type": "number", "required": True},
                "controls_passed": {"type": "number", "required": True},
                "total_controls": {"type": "number", "required": True},
                "sections": {"type": "array", "required": True},
                "section_details": {"type": "array", "required": True},
                "failed_controls": {"type": "array", "required": True},
                "recommendations": {"type": "array", "required": True},
            },
            "sections": [
                "executive_summary",
                "benchmark_summary",
                "control_assessment",
                "failed_controls",
                "recommendations",
            ],
        }

    @staticmethod
    def get_ccpa_template() -> dict[str, Any]:
        """Get CCPA compliance report template.

        Returns:
            Template dictionary for California Consumer Privacy Act
        """
        template_content = """# CCPA Compliance Report: {{ subject }}

**Generated**: {{ generated_at }}
**Regulation**: California Consumer Privacy Act (CCPA/CPRA)
**Business Name**: {{ business_name }}
**Threshold Status**: {{ threshold_status }}

## Executive Summary

This report assesses compliance with the California Consumer Privacy Act (CCPA) and California Privacy Rights Act (CPRA) for {{ subject }}.

**Overall Compliance Status**: {{ compliance_status }}
**California Consumers Affected**: {{ ca_consumers_count }}

## Applicability Assessment

- **Annual Gross Revenue**: {{ annual_revenue }}
- **Personal Information Records**: {{ pi_records }}
- **Revenue from Selling PI**: {{ pi_revenue_percentage }}%
- **CCPA Applicable**: {{ ccpa_applicable }}

## Consumer Rights Implementation

| Right | Section | Implemented | Verification Method | Response Time |
|-------|---------|-------------|---------------------|---------------|
{% for right in consumer_rights %}
| {{ right.name }} | {{ right.section }} | {{ right.implemented }} | {{ right.verification }} | {{ right.response_time }} |
{% endfor %}

## Privacy Notice Requirements

{% for notice in privacy_notices %}
### {{ notice.type }}

- **Location**: {{ notice.location }}
- **Last Updated**: {{ notice.last_updated }}
- **Required Elements**: {{ notice.required_elements_met }}/{{ notice.total_required }}
{% if notice.missing_elements %}
- **Missing**: {{ notice.missing_elements }}
{% endif %}
{% endfor %}

## Do Not Sell/Share Implementation

- **Opt-Out Link Visible**: {{ opt_out_visible }}
- **GPC Signal Honored**: {{ gpc_honored }}
- **Service Provider Agreements**: {{ sp_agreements_count }} reviewed
- **Third Party Sales**: {{ third_party_sales }}

## Data Inventory

| Category | Data Elements | Purpose | Retention | Shared With |
|----------|--------------|---------|-----------|-------------|
{% for category in data_inventory %}
| {{ category.name }} | {{ category.elements }} | {{ category.purpose }} | {{ category.retention }} | {{ category.shared_with }} |
{% endfor %}

## Financial Incentive Programs

{% for program in financial_incentives %}
- **{{ program.name }}**: {{ program.description }}
  - Opt-in Required: {{ program.opt_in }}
  - Value Calculation: {{ program.value_calculation }}
{% endfor %}

## Recommendations

{% for rec in recommendations %}
- **{{ rec.priority }}**: {{ rec.action }}
{% endfor %}
"""

        return {
            "name": "CCPA Compliance Report Template",
            "description": "Template for CCPA/CPRA privacy compliance assessment",
            "template_content": template_content,
            "document_type": "compliance_report",
            "compliance_standards": ["CCPA"],
            "resource_types": ["RDS", "S3", "DynamoDB", "Lambda", "API Gateway"],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML, OutputFormat.PDF],
            "variables": {
                "subject": {"type": "string", "required": True},
                "generated_at": {"type": "string", "required": True},
                "business_name": {"type": "string", "required": True},
                "threshold_status": {"type": "string", "required": True},
                "compliance_status": {"type": "string", "required": True},
                "ca_consumers_count": {"type": "string", "required": True},
                "annual_revenue": {"type": "string", "required": True},
                "pi_records": {"type": "string", "required": True},
                "pi_revenue_percentage": {"type": "number", "required": True},
                "ccpa_applicable": {"type": "string", "required": True},
                "consumer_rights": {"type": "array", "required": True},
                "privacy_notices": {"type": "array", "required": True},
                "opt_out_visible": {"type": "string", "required": True},
                "gpc_honored": {"type": "string", "required": True},
                "sp_agreements_count": {"type": "number", "required": True},
                "third_party_sales": {"type": "string", "required": True},
                "data_inventory": {"type": "array", "required": True},
                "financial_incentives": {"type": "array", "required": True},
                "recommendations": {"type": "array", "required": True},
            },
            "sections": [
                "executive_summary",
                "applicability",
                "consumer_rights",
                "privacy_notices",
                "do_not_sell",
                "data_inventory",
                "financial_incentives",
                "recommendations",
            ],
        }

    @staticmethod
    def get_sox_template() -> dict[str, Any]:
        """Get SOX compliance report template.

        Returns:
            Template dictionary for Sarbanes-Oxley Act compliance
        """
        template_content = """# SOX Compliance Report: {{ subject }}

**Generated**: {{ generated_at }}
**Regulation**: Sarbanes-Oxley Act (SOX)
**Fiscal Year**: {{ fiscal_year }}
**Company**: {{ company_name }}

## Executive Summary

This report assesses compliance with Sarbanes-Oxley Act requirements for {{ subject }}.

**Overall Compliance Status**: {{ compliance_status }}
**Material Weaknesses**: {{ material_weaknesses_count }}
**Significant Deficiencies**: {{ significant_deficiencies_count }}

## Section 302 - Corporate Responsibility

### CEO/CFO Certifications

- **Financial Statement Review**: {{ fs_review_status }}
- **Internal Controls Statement**: {{ ic_statement_status }}
- **Disclosure Controls**: {{ disclosure_controls_status }}
- **Fraud Controls**: {{ fraud_controls_status }}

## Section 404 - Internal Controls Assessment

### Control Environment

{% for control in control_environment %}
#### {{ control.id }}: {{ control.name }}

- **Type**: {{ control.type }}
- **Frequency**: {{ control.frequency }}
- **Control Owner**: {{ control.owner }}
- **Testing Status**: {{ control.testing_status }}
- **Operating Effectiveness**: {{ control.effectiveness }}
{% if control.deficiency %}
- **Deficiency**: {{ control.deficiency }}
{% endif %}
{% endfor %}

### IT General Controls (ITGCs)

| Domain | Controls | Tested | Effective | Deficiencies |
|--------|----------|--------|-----------|--------------|
{% for itgc in itgc_summary %}
| {{ itgc.domain }} | {{ itgc.controls }} | {{ itgc.tested }} | {{ itgc.effective }} | {{ itgc.deficiencies }} |
{% endfor %}

### Key Financial Applications

{% for app in financial_applications %}
- **{{ app.name }}**: {{ app.status }}
  - SOD Controls: {{ app.sod_status }}
  - Change Management: {{ app.change_mgmt_status }}
  - Access Controls: {{ app.access_controls_status }}
{% endfor %}

## Deficiencies Summary

{% for deficiency in deficiencies %}
### {{ deficiency.id }}: {{ deficiency.title }}

- **Classification**: {{ deficiency.classification }}
- **Process**: {{ deficiency.process }}
- **Root Cause**: {{ deficiency.root_cause }}
- **Remediation Plan**: {{ deficiency.remediation }}
- **Target Date**: {{ deficiency.target_date }}
{% endfor %}

## Management's Assessment

**Assessment Conclusion**: {{ management_conclusion }}
**Basis for Conclusion**: {{ conclusion_basis }}

## Auditor's Opinion

**External Auditor**: {{ external_auditor }}
**Opinion Type**: {{ opinion_type }}
**Opinion Date**: {{ opinion_date }}
"""

        return {
            "name": "SOX Compliance Report Template",
            "description": "Template for Sarbanes-Oxley Act compliance assessment",
            "template_content": template_content,
            "document_type": "compliance_report",
            "compliance_standards": ["SOX"],
            "resource_types": ["RDS", "S3", "Lambda", "IAM", "CloudTrail"],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML, OutputFormat.PDF],
            "variables": {
                "subject": {"type": "string", "required": True},
                "generated_at": {"type": "string", "required": True},
                "fiscal_year": {"type": "string", "required": True},
                "company_name": {"type": "string", "required": True},
                "compliance_status": {"type": "string", "required": True},
                "material_weaknesses_count": {"type": "number", "required": True},
                "significant_deficiencies_count": {"type": "number", "required": True},
                "fs_review_status": {"type": "string", "required": True},
                "ic_statement_status": {"type": "string", "required": True},
                "disclosure_controls_status": {"type": "string", "required": True},
                "fraud_controls_status": {"type": "string", "required": True},
                "control_environment": {"type": "array", "required": True},
                "itgc_summary": {"type": "array", "required": True},
                "financial_applications": {"type": "array", "required": True},
                "deficiencies": {"type": "array", "required": True},
                "management_conclusion": {"type": "string", "required": True},
                "conclusion_basis": {"type": "string", "required": True},
                "external_auditor": {"type": "string", "required": True},
                "opinion_type": {"type": "string", "required": True},
                "opinion_date": {"type": "string", "required": True},
            },
            "sections": [
                "executive_summary",
                "section_302",
                "section_404",
                "itgc",
                "financial_applications",
                "deficiencies",
                "management_assessment",
                "auditor_opinion",
            ],
        }

    @staticmethod
    def get_glba_template() -> dict[str, Any]:
        """Get GLBA compliance report template.

        Returns:
            Template dictionary for Gramm-Leach-Bliley Act compliance
        """
        template_content = """# GLBA Compliance Report: {{ subject }}

**Generated**: {{ generated_at }}
**Regulation**: Gramm-Leach-Bliley Act (GLBA)
**Institution Name**: {{ institution_name }}
**Institution Type**: {{ institution_type }}

## Executive Summary

This report assesses compliance with the Gramm-Leach-Bliley Act (GLBA) for {{ subject }}.

**Overall Compliance Status**: {{ compliance_status }}
**Safeguards Rule Compliance**: {{ safeguards_status }}
**Privacy Rule Compliance**: {{ privacy_status }}

## Financial Privacy Rule (Regulation P)

### Privacy Notice Assessment

| Notice Type | Provided | Timing | Content Complete |
|-------------|----------|--------|------------------|
{% for notice in privacy_notices %}
| {{ notice.type }} | {{ notice.provided }} | {{ notice.timing }} | {{ notice.complete }} |
{% endfor %}

### Information Sharing Practices

{% for practice in sharing_practices %}
- **{{ practice.category }}**: {{ practice.description }}
  - Opt-Out Provided: {{ practice.opt_out }}
  - Consumer Response Rate: {{ practice.response_rate }}
{% endfor %}

## Safeguards Rule Assessment

### Written Information Security Program (WISP)

- **Program Documented**: {{ wisp_documented }}
- **Last Reviewed**: {{ wisp_last_review }}
- **Board Approved**: {{ wisp_board_approved }}

### Designated Coordinator

- **Name**: {{ coordinator_name }}
- **Title**: {{ coordinator_title }}
- **Qualifications**: {{ coordinator_qualifications }}

### Risk Assessment

{% for risk in risk_assessments %}
#### {{ risk.area }}

- **Threats Identified**: {{ risk.threats }}
- **Safeguards Implemented**: {{ risk.safeguards }}
- **Residual Risk**: {{ risk.residual }}
{% endfor %}

### Safeguards Implementation

| Safeguard Category | Implemented | Tested | Effective |
|-------------------|-------------|--------|-----------|
{% for safeguard in safeguards %}
| {{ safeguard.category }} | {{ safeguard.implemented }} | {{ safeguard.tested }} | {{ safeguard.effective }} |
{% endfor %}

### Service Provider Oversight

- **Total Service Providers**: {{ sp_total }}
- **With Safeguard Contracts**: {{ sp_with_contracts }}
- **Assessed This Year**: {{ sp_assessed }}

{% for provider in key_service_providers %}
- **{{ provider.name }}**: {{ provider.service }}
  - Contract Status: {{ provider.contract_status }}
  - Last Assessment: {{ provider.last_assessment }}
{% endfor %}

### Employee Training

- **Training Program**: {{ training_program_status }}
- **Last Training Date**: {{ last_training_date }}
- **Completion Rate**: {{ training_completion_rate }}%

## Pretexting Protection

- **Pretexting Policies**: {{ pretexting_policies }}
- **Verification Procedures**: {{ verification_procedures }}
- **Incident Response**: {{ pretexting_incident_response }}

## Recommendations

{% for rec in recommendations %}
- **{{ rec.priority }}**: {{ rec.action }}
{% endfor %}
"""

        return {
            "name": "GLBA Compliance Report Template",
            "description": "Template for Gramm-Leach-Bliley Act compliance assessment",
            "template_content": template_content,
            "document_type": "compliance_report",
            "compliance_standards": ["GLBA"],
            "resource_types": ["RDS", "S3", "Lambda", "IAM", "KMS", "CloudTrail"],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML, OutputFormat.PDF],
            "variables": {
                "subject": {"type": "string", "required": True},
                "generated_at": {"type": "string", "required": True},
                "institution_name": {"type": "string", "required": True},
                "institution_type": {"type": "string", "required": True},
                "compliance_status": {"type": "string", "required": True},
                "safeguards_status": {"type": "string", "required": True},
                "privacy_status": {"type": "string", "required": True},
                "privacy_notices": {"type": "array", "required": True},
                "sharing_practices": {"type": "array", "required": True},
                "wisp_documented": {"type": "string", "required": True},
                "wisp_last_review": {"type": "string", "required": True},
                "wisp_board_approved": {"type": "string", "required": True},
                "coordinator_name": {"type": "string", "required": True},
                "coordinator_title": {"type": "string", "required": True},
                "coordinator_qualifications": {"type": "string", "required": True},
                "risk_assessments": {"type": "array", "required": True},
                "safeguards": {"type": "array", "required": True},
                "sp_total": {"type": "number", "required": True},
                "sp_with_contracts": {"type": "number", "required": True},
                "sp_assessed": {"type": "number", "required": True},
                "key_service_providers": {"type": "array", "required": True},
                "training_program_status": {"type": "string", "required": True},
                "last_training_date": {"type": "string", "required": True},
                "training_completion_rate": {"type": "number", "required": True},
                "pretexting_policies": {"type": "string", "required": True},
                "verification_procedures": {"type": "string", "required": True},
                "pretexting_incident_response": {"type": "string", "required": True},
                "recommendations": {"type": "array", "required": True},
            },
            "sections": [
                "executive_summary",
                "privacy_rule",
                "safeguards_rule",
                "wisp",
                "risk_assessment",
                "safeguards",
                "service_providers",
                "training",
                "pretexting",
                "recommendations",
            ],
        }

    @staticmethod
    def get_all_templates() -> dict[str, dict[str, Any]]:
        """Get all built-in templates.

        Returns:
            Dictionary mapping template names to template dictionaries
        """
        return {
            "pci_dss": TemplateLibrary.get_pci_dss_template(),
            "hipaa": TemplateLibrary.get_hipaa_template(),
            "soc2": TemplateLibrary.get_soc2_template(),
            "iso27001": TemplateLibrary.get_iso27001_template(),
            "nist80053": TemplateLibrary.get_nist80053_template(),
            "gdpr": TemplateLibrary.get_gdpr_template(),
            "fedramp": TemplateLibrary.get_fedramp_template(),
            "cis": TemplateLibrary.get_cis_template(),
            "ccpa": TemplateLibrary.get_ccpa_template(),
            "sox": TemplateLibrary.get_sox_template(),
            "glba": TemplateLibrary.get_glba_template(),
            "executive_summary": TemplateLibrary.get_executive_summary_template(),
            "audit_package": TemplateLibrary.get_audit_package_template(),
            "trust_center": TemplateLibrary.get_trust_center_template(),
        }

    @staticmethod
    def get_executive_summary_template() -> dict[str, Any]:
        """Get Executive Summary compliance report template.

        This template is designed for C-suite and board-level stakeholders,
        focusing on strategic insights, risk posture, and business impact.

        Returns:
            Template dictionary
        """
        template_content = """# Executive Compliance Summary: {{ subject }}

**Report Date**: {{ generated_at }}
**Assessment Period**: {{ assessment_period }}
**Prepared For**: {{ prepared_for }}

---

## Strategic Overview

{{ executive_overview }}

## Compliance Posture at a Glance

| Metric | Value | Trend |
|--------|-------|-------|
| **Overall Compliance Score** | {{ overall_score }}% | {{ score_trend }} |
| **Risk-Adjusted Score** | {{ risk_adjusted_score }}% | {{ risk_trend }} |
| **Critical Findings** | {{ critical_count }} | {{ critical_trend }} |
| **Frameworks Covered** | {{ frameworks_count }} | - |

## Framework Compliance Status

{% for framework in framework_summary %}
### {{ framework.name }}

**Score**: {{ framework.score }}% | **Status**: {{ framework.status }}

{% if framework.key_gaps %}
**Key Gaps**: {{ framework.key_gaps }}
{% endif %}

---
{% endfor %}

## Risk Heat Map

| Category | Critical | High | Medium | Low |
|----------|----------|------|--------|-----|
{% for category in risk_categories %}
| {{ category.name }} | {{ category.critical }} | {{ category.high }} | {{ category.medium }} | {{ category.low }} |
{% endfor %}

## Business Impact Assessment

### Regulatory Exposure
{{ regulatory_exposure }}

### Customer Trust Impact
{{ customer_trust_impact }}

### Operational Risk
{{ operational_risk }}

## Key Recommendations

{% for rec in key_recommendations %}
{{ loop.index }}. **{{ rec.title }}**
   - Priority: {{ rec.priority }}
   - Impact: {{ rec.impact }}
   - Timeline: {{ rec.timeline }}

{% endfor %}

## Next Steps

{% for step in next_steps %}
- {{ step }}
{% endfor %}

---

*This executive summary is auto-generated by WISTX. For detailed control-level findings, request the Internal Assessment Report.*

**Report Version**: {{ report_version }}
**Evidence Hash**: {{ evidence_hash }}
"""
        return {
            "name": "Executive Summary Template",
            "description": "Board-level compliance summary with strategic insights and risk posture",
            "template_content": template_content,
            "document_type": "compliance_report",
            "report_variant": "executive_summary",
            "compliance_standards": [],  # Framework-agnostic
            "resource_types": [],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML, OutputFormat.PDF],
            "variables": {
                "subject": {"type": "string", "required": True},
                "generated_at": {"type": "string", "required": True},
                "assessment_period": {"type": "string", "required": True},
                "prepared_for": {"type": "string", "required": False, "default": "Executive Leadership"},
                "executive_overview": {"type": "string", "required": True},
                "overall_score": {"type": "float", "required": True},
                "risk_adjusted_score": {"type": "float", "required": True},
                "score_trend": {"type": "string", "required": False, "default": ""},
                "risk_trend": {"type": "string", "required": False, "default": ""},
                "critical_count": {"type": "integer", "required": True},
                "critical_trend": {"type": "string", "required": False, "default": ""},
                "frameworks_count": {"type": "integer", "required": True},
                "framework_summary": {"type": "array", "required": True},
                "risk_categories": {"type": "array", "required": True},
                "regulatory_exposure": {"type": "string", "required": True},
                "customer_trust_impact": {"type": "string", "required": True},
                "operational_risk": {"type": "string", "required": True},
                "key_recommendations": {"type": "array", "required": True},
                "next_steps": {"type": "array", "required": True},
                "report_version": {"type": "string", "required": False, "default": "1.0"},
                "evidence_hash": {"type": "string", "required": True},
            },
            "sections": [
                "strategic_overview",
                "compliance_posture",
                "framework_status",
                "risk_heat_map",
                "business_impact",
                "key_recommendations",
                "next_steps",
            ],
        }

    @staticmethod
    def get_audit_package_template() -> dict[str, Any]:
        """Get Audit Package template for external auditors.

        This template follows SOC 2 Type II report format and includes:
        - System description
        - Control testing procedures
        - Evidence artifacts with integrity hashes
        - Exception tracking
        - Management representations

        Returns:
            Template dictionary
        """
        template_content = """# Audit Evidence Package: {{ subject }}

**Engagement**: {{ engagement_type }}
**Period**: {{ assessment_period_start }} to {{ assessment_period_end }}
**Prepared**: {{ generated_at }}

---

## Section I: System Description

### Organization Overview
{{ organization_overview }}

### System Boundaries
{{ system_boundaries }}

### Infrastructure Components
{% for component in infrastructure_components %}
- **{{ component.name }}** ({{ component.type }}): {{ component.description }}
{% endfor %}

### Data Flow
{{ data_flow_description }}

---

## Section II: Control Environment

### Applicable Trust Services Criteria
{% for criteria in trust_services_criteria %}
- **{{ criteria.id }}**: {{ criteria.name }} ({{ criteria.category }})
{% endfor %}

### Control Objectives and Activities

{% for control in controls %}
### {{ control.control_id }}: {{ control.title }}

**Objective**: {{ control.objective }}
**Category**: {{ control.category }}
**Severity**: {{ control.severity }}

**Control Activity**:
{{ control.description }}

**Testing Procedure**:
{{ control.testing_procedure }}

**Evidence Artifacts**:
{% for evidence in control.evidence_artifacts %}
- {{ evidence.name }} (Hash: `{{ evidence.hash }}`)
  - Type: {{ evidence.type }}
  - Collected: {{ evidence.collected_at }}
{% endfor %}

**Test Result**: {{ control.test_result }}

{% if control.exceptions %}
**Exceptions Noted**:
{% for exception in control.exceptions %}
- {{ exception.description }}
  - Management Response: {{ exception.management_response }}
  - Remediation Status: {{ exception.remediation_status }}
{% endfor %}
{% endif %}

---
{% endfor %}

## Section III: Complementary User Entity Controls (CUECs)

{% for cuec in cuecs %}
- **{{ cuec.id }}**: {{ cuec.description }}
{% endfor %}

## Section IV: Subservice Organizations

{% for subservice in subservice_organizations %}
### {{ subservice.name }}
- **Services Provided**: {{ subservice.services }}
- **Carve-out/Inclusive**: {{ subservice.method }}
- **SOC Report Available**: {{ subservice.soc_report_available }}
{% endfor %}

## Section V: Evidence Integrity

| Artifact ID | Type | Hash (SHA-256) | Verified |
|-------------|------|----------------|----------|
{% for artifact in evidence_artifacts %}
| {{ artifact.id }} | {{ artifact.type }} | `{{ artifact.hash[:16] }}...` | {{ artifact.verified }} |
{% endfor %}

**Master Evidence Hash**: `{{ master_evidence_hash }}`

---

## Appendix A: Sampling Methodology

{{ sampling_methodology }}

## Appendix B: Management Representations

{{ management_representations }}

---

*This audit package was generated by WISTX Context Augmentation Platform.*
*Package Version*: {{ package_version }}
"""
        return {
            "name": "Audit Package Template",
            "description": "SOC 2 Type II format audit evidence package for external auditors",
            "template_content": template_content,
            "document_type": "compliance_report",
            "report_variant": "audit_package",
            "compliance_standards": ["SOC2", "ISO-27001"],
            "resource_types": [],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML, OutputFormat.PDF, OutputFormat.DOCX],
            "variables": {
                "subject": {"type": "string", "required": True},
                "engagement_type": {"type": "string", "required": True, "default": "SOC 2 Type II"},
                "assessment_period_start": {"type": "string", "required": True},
                "assessment_period_end": {"type": "string", "required": True},
                "generated_at": {"type": "string", "required": True},
                "organization_overview": {"type": "string", "required": True},
                "system_boundaries": {"type": "string", "required": True},
                "infrastructure_components": {"type": "array", "required": True},
                "data_flow_description": {"type": "string", "required": True},
                "trust_services_criteria": {"type": "array", "required": True},
                "controls": {"type": "array", "required": True},
                "cuecs": {"type": "array", "required": False, "default": []},
                "subservice_organizations": {"type": "array", "required": False, "default": []},
                "evidence_artifacts": {"type": "array", "required": True},
                "master_evidence_hash": {"type": "string", "required": True},
                "sampling_methodology": {"type": "string", "required": True},
                "management_representations": {"type": "string", "required": True},
                "package_version": {"type": "string", "required": False, "default": "1.0"},
            },
            "sections": [
                "system_description",
                "control_environment",
                "cuecs",
                "subservice_organizations",
                "evidence_integrity",
                "sampling_methodology",
                "management_representations",
            ],
        }

    @staticmethod
    def get_trust_center_template() -> dict[str, Any]:
        """Get Trust Center template for public-facing compliance portal.

        This template is designed for customer-facing Trust Centers that:
        - Showcase compliance certifications and audit reports
        - Provide security documentation for sales enablement
        - Answer common security questionnaire questions
        - Build customer trust through transparency

        Returns:
            Template dictionary
        """
        template_content = """# {{ organization_name }} Trust Center

*Last Updated: {{ last_updated }}*

---

## Our Commitment to Security

{{ security_commitment }}

---

## Compliance Certifications

{% for cert in certifications %}
### {{ cert.name }}

| Attribute | Details |
|-----------|---------|
| **Status** | {{ cert.status }} |
| **Scope** | {{ cert.scope }} |
| **Audit Firm** | {{ cert.auditor }} |
| **Report Date** | {{ cert.report_date }} |
| **Valid Until** | {{ cert.valid_until }} |

{% if cert.download_available %}
 [Request {{ cert.name }} Report]({{ cert.request_link }})
{% endif %}

---
{% endfor %}

## Security Overview

### Infrastructure Security
{{ infrastructure_security }}

### Data Protection
{{ data_protection }}

### Access Control
{{ access_control }}

### Incident Response
{{ incident_response }}

---

## Security Controls Summary

| Control Category | Status | Controls Implemented |
|------------------|--------|---------------------|
{% for category in control_categories %}
| {{ category.name }} | {{ category.status }} | {{ category.controls_count }} |
{% endfor %}

---

## Compliance Scorecard

| Framework | Score | Last Assessed |
|-----------|-------|---------------|
{% for framework in framework_scores %}
| {{ framework.name }} | {{ framework.score }}% | {{ framework.assessed_date }} |
{% endfor %}

---

## Subprocessors & Third Parties

We maintain a list of subprocessors who may process customer data:

{% for subprocessor in subprocessors %}
| {{ subprocessor.name }} | {{ subprocessor.service }} | {{ subprocessor.location }} |
{% endfor %}

---

## Frequently Asked Questions

{% for faq in faqs %}
### {{ faq.question }}

{{ faq.answer }}

---
{% endfor %}

## Request Documentation

To request compliance documentation or schedule a security review:

- **Email**: {{ security_email }}
- **Portal**: {{ security_portal_url }}

---

## Contact Security Team

For security inquiries or to report vulnerabilities:

- **Security Email**: {{ security_email }}
- **Bug Bounty**: {{ bug_bounty_url }}

---

* {{ current_year }} {{ organization_name }}. This Trust Center is auto-generated by WISTX.*
"""
        return {
            "name": "Trust Center Template",
            "description": "Public-facing compliance portal for customer trust enablement",
            "template_content": template_content,
            "document_type": "compliance_report",
            "report_variant": "trust_center",
            "compliance_standards": [],  # Framework-agnostic
            "resource_types": [],
            "template_engine": TemplateEngine.JINJA2,
            "output_formats": [OutputFormat.MARKDOWN, OutputFormat.HTML],
            "variables": {
                "organization_name": {"type": "string", "required": True},
                "last_updated": {"type": "string", "required": True},
                "security_commitment": {"type": "string", "required": True},
                "certifications": {"type": "array", "required": True},
                "infrastructure_security": {"type": "string", "required": True},
                "data_protection": {"type": "string", "required": True},
                "access_control": {"type": "string", "required": True},
                "incident_response": {"type": "string", "required": True},
                "control_categories": {"type": "array", "required": True},
                "framework_scores": {"type": "array", "required": True},
                "subprocessors": {"type": "array", "required": False, "default": []},
                "faqs": {"type": "array", "required": False, "default": []},
                "security_email": {"type": "string", "required": True},
                "security_portal_url": {"type": "string", "required": False},
                "bug_bounty_url": {"type": "string", "required": False},
                "current_year": {"type": "string", "required": True},
            },
            "sections": [
                "security_commitment",
                "certifications",
                "security_overview",
                "controls_summary",
                "compliance_scorecard",
                "subprocessors",
                "faqs",
                "contact",
            ],
        }

