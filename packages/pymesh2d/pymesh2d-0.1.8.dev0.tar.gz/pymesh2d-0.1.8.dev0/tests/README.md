# Tests for pymesh2d

This directory contains unit tests for the pymesh2d package, based on the `tridemo.py` examples.

## Structure

- `test_helpers.py`: Helper functions for saving/loading reference data and comparing meshes
- `test_tridemo.py`: Unit tests for all demo functions (0-10)
- `generate_references.py`: Script to generate reference data files from current implementation
- `reference_data/`: Directory containing ASCII reference files (generated by `generate_references.py`)

## Usage

### 1. Generate Reference Data

First, generate the reference data files from the current implementation:

```bash
cd /home/etienne/pymesh2d_1/pymesh2d
python tests/generate_references.py
```

This will create reference files in `tests/reference_data/` for all demos:
- `demo0_vert_1.txt`, `demo0_tria_1.txt` (first output of demo 0)
- `demo0_vert_2.txt`, `demo0_tria_2.txt` (second output of demo 0)
- `demo1_vert_1.txt`, `demo1_tria_1.txt` (first output of demo 1)
- etc.

### 2. Run Tests

Run all tests:

```bash
python -m pytest tests/test_tridemo.py -v
```

Or using unittest:

```bash
python -m unittest tests.test_tridemo -v
```

Run a specific test:

```bash
python -m pytest tests/test_tridemo.py::TestTridemo::test_demo0_1 -v
```

## Reference Data Format

Reference files are stored as ASCII text files:

- **Vertex files** (`*_vert*.txt`): One vertex per line, with x and y coordinates separated by spaces
- **Triangle files** (`*_tria*.txt`): One triangle per line, with three vertex indices separated by spaces

Example:
```
# demo0_vert_1.txt
0.000000000000000e+00 0.000000000000000e+00
9.000000000000000e+00 0.000000000000000e+00
...

# demo0_tria_1.txt
0 1 4
1 2 5
...
```

## Test Comparison

The tests compare:
1. **Vertex count**: Number of vertices must match
2. **Triangle count**: Number of triangles must match
3. **Vertex coordinates**: Must match within tolerance (rtol=1e-10, atol=1e-12)
4. **Triangle connectivity**: Triangle indices must match (after remapping vertex indices)

The comparison handles:
- Different vertex ordering (vertices are sorted by coordinates)
- Different triangle ordering (triangles are sorted by indices)

## Updating Reference Data

If the implementation changes and you want to update the reference data:

1. Run `generate_references.py` again
2. Review the changes in `reference_data/`
3. Commit the updated reference files if the changes are expected

## Notes

- Tests are deterministic and should produce identical results on all platforms
- Reference data is generated from the current implementation, so initial generation should pass all tests
- If tests fail, check the error message to see which aspect differs (vertex count, coordinates, or connectivity)


