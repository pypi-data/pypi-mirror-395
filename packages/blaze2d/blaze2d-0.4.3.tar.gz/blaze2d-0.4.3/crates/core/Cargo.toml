[package]
name = "mpb2d-core"
version = "0.1.0"
edition.workspace = true
rust-version.workspace = true
license.workspace = true
authors.workspace = true

[features]
default = ["native-linalg", "std-time"]

# Use faer for dense linear algebra (GEMM, eigensolvers).
# This is the high-performance native path using optimized BLAS.
# NOT compatible with WASM due to faer's thread pool and atomic dependencies.
native-linalg = ["dep:faer"]

# Use nalgebra for dense linear algebra (GEMM, eigensolvers).
# This is the portable WASM-compatible path with no threading dependencies.
# Slower than faer but works everywhere including wasm32-unknown-unknown.
wasm-linalg = ["dep:nalgebra"]

# Use batched GPU-optimized operations (gram_matrix, linear_combinations).
# This feature is automatically enabled by the CUDA backend.
cuda = []

# Enable profiling instrumentation. When disabled (default), profiling calls
# are no-ops with zero runtime overhead.
profiling = []

# Enable std::time::Instant for timing. Disable for WASM builds.
# When disabled, timing functions return dummy values.
std-time = []

[dependencies]
num-complex.workspace = true
serde.workspace = true
serde_json.workspace = true
thiserror.workspace = true
log.workspace = true

# Dense linear algebra backends (mutually exclusive for WASM vs native)
faer = { workspace = true, optional = true }
nalgebra = { version = "0.33", features = ["serde-serialize"], optional = true }

[dev-dependencies]
criterion.workspace = true
mpb2d-backend-cpu = { path = "../backend-cpu" }
toml.workspace = true
