server {
  server_name www.YOURDOMAIN.com;
  return 301 https://YOURDOMAIN.com$request_uri;
}

# server {
#   listen 80 deferred;
#   server_name YOURDOMAIN.com;

#   location /.well-known {
#     alias /var/www/[[app_name]]/.well-known;
#   }

#   return 301 https://YOURDOMAIN.com$request_uri;
# }

server {
  listen 80;
  # listen 443 ssl http2;

  # ssl_certificate /etc/letsencrypt/live/YOURDOMAIN.com/fullchain.pem;
  # ssl_certificate_key /etc/letsencrypt/live/YOURDOMAIN.com/privkey.pem;
  # ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

  server_name YOURDOMAIN.com;
  root /var/www/[[app_name]];

  client_max_body_size 1M;
  keepalive_timeout 5;
  access_log /var/www/[[app_name]]/log/access.log;
  error_log /var/www/[[app_name]]/log/error.log;

  location /.well-known {
    alias /var/www/[[app_name]]/.well-known;
  }

  # Regular expression location block for hashed filenames
  location ~* "^\/static\/(.*)-[a-z0-9]{12,}\.([a-z0-9]+)$" {
    # Rewrite to the base file name without the hash
    rewrite "^\/static\/(.*)-[a-f0-9]{12,}\.([a-z0-9]+)$" /static/$1.$2 break;

    # Try to serve the rewritten file; return 404 if not found
    try_files $uri =404;
  }

  # General handler for all other static files
  location /static/ {
    alias /var/www/[[app_name]]/static;
  }

  location / {
    include uwsgi_params;
    uwsgi_pass unix:/var/www/[[app_name]]/uwsgi.sock;
  }

  error_page 500 502 503 504 /500.html;
  location = /500.html {
    root /var/www/[[app_name]]/static;
  }
}
