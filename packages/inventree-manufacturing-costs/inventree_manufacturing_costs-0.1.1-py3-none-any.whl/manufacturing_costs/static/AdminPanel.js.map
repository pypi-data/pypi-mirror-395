{"version":3,"file":"AdminPanel.js","sources":["../../frontend/src/AdminPanel.tsx"],"sourcesContent":["// Import for type checking\nimport {\n  AddItemButton,\n  apiUrl,\n  checkPluginVersion,\n  formatCurrencyValue,\n  type InvenTreePluginContext,\n  RowActions,\n  RowDeleteAction,\n  RowDuplicateAction,\n  RowEditAction,\n  SearchInput\n} from '@inventreedb/ui';\nimport { ActionIcon, Alert, Group, Stack, Text, Tooltip } from '@mantine/core';\nimport {\n  IconExclamationCircle,\n  IconInfoCircle,\n  IconRefresh\n} from '@tabler/icons-react';\nimport { useQuery } from '@tanstack/react-query';\nimport { DataTable } from 'mantine-datatable';\n\nimport { useCallback, useMemo, useState } from 'react';\n\nexport function ManufacturingCostsAdminPanel({\n  context\n}: {\n  context: InvenTreePluginContext;\n}) {\n  const [searchTerm, setSearchTerm] = useState<string>('');\n\n  const RATE_URL: string = '/plugin/manufacturing-costs/rate/';\n\n  // Fetch manufacturing rates from the API\n  const dataQuery = useQuery(\n    {\n      queryKey: ['manufacturing-rate', searchTerm],\n      queryFn: async () => {\n        return context?.api\n          ?.get(RATE_URL, {\n            params: {\n              search: searchTerm\n            }\n          })\n          .then((response: any) => response.data);\n      }\n    },\n    context.queryClient\n  );\n\n  const rateFields: any = useMemo(() => {\n    return {\n      name: {},\n      description: {},\n      price: {},\n      price_currency: {},\n      units: {}\n    };\n  }, []);\n\n  // Record which is selected in the table\n  const [selectedRecord, setSelectedRecord] = useState<any>(null);\n\n  // Modal form to create a new rate\n  const createRateForm = context.forms.create({\n    url: apiUrl(RATE_URL),\n    title: 'Add Rate',\n    fields: rateFields,\n    successMessage: 'Rate created',\n    onFormSuccess: () => {\n      dataQuery.refetch();\n    }\n  });\n\n  // Modal form to edit the selected rate\n  const editRateForm = context.forms.edit({\n    url: apiUrl(RATE_URL, selectedRecord?.pk),\n    title: 'Edit Rate',\n    fields: rateFields,\n    successMessage: 'Rate updated',\n    onFormSuccess: () => {\n      dataQuery.refetch();\n    }\n  });\n\n  // Modal form to delete the selected rate\n  const deleteRateForm = context.forms.delete({\n    url: apiUrl(RATE_URL, selectedRecord?.pk),\n    title: 'Delete Rate',\n    successMessage: 'Rate deleted',\n    onFormSuccess: () => {\n      dataQuery.refetch();\n    }\n  });\n\n  // Modal form to duplicate the selected rate\n  const duplicateRateForm = context.forms.create({\n    url: apiUrl(RATE_URL),\n    title: 'Add Rate',\n    fields: rateFields,\n    initialData: {\n      ...selectedRecord\n    },\n    successMessage: 'Rate created',\n    onFormSuccess: () => {\n      dataQuery.refetch();\n    }\n  });\n\n  // Render the actions available for a given row in the table\n  const rowActions = useCallback((record: any) => {\n    return [\n      RowEditAction({\n        onClick: () => {\n          setSelectedRecord(record);\n          editRateForm?.open();\n        }\n      }),\n      RowDuplicateAction({\n        onClick: () => {\n          setSelectedRecord(record);\n          duplicateRateForm?.open();\n        }\n      }),\n      RowDeleteAction({\n        onClick: () => {\n          setSelectedRecord(record);\n          deleteRateForm?.open();\n        }\n      })\n    ];\n  }, []);\n\n  const dataColumns: any[] = useMemo(() => {\n    return [\n      {\n        accessor: 'name',\n        sortable: true\n      },\n      {\n        accessor: 'description'\n      },\n      {\n        accessor: 'price',\n        title: 'Rate',\n        sortable: true,\n        render: (record: any) => {\n          return (\n            <Group gap='sm'>\n              <Text>\n                {formatCurrencyValue(record.price, {\n                  currency: record.price_currency\n                })}\n              </Text>\n              {record.units && <Text size='xs'>[{record.units}]</Text>}\n            </Group>\n          );\n        }\n      },\n      {\n        accessor: '---',\n        title: ' ',\n        width: 50,\n        resizable: false,\n        sortable: false,\n        render: (record: any, index: number) => (\n          <RowActions actions={rowActions(record)} index={index} />\n        )\n      }\n    ];\n  }, []);\n\n  return (\n    <>\n      {createRateForm?.modal}\n      {editRateForm?.modal}\n      {duplicateRateForm?.modal}\n      {deleteRateForm?.modal}\n      <Stack gap='xs'>\n        <Alert\n          color='blue'\n          icon={<IconInfoCircle />}\n          title={'Manufacturing Rates'}\n        >\n          Predefined rates for different manufaucturing processes. These can be\n          referenced to assign manufaucturing costs to parts.\n        </Alert>\n        {dataQuery.isError && (\n          <Alert\n            color='red'\n            title='Error Fetching Data'\n            icon={<IconExclamationCircle />}\n          >\n            {dataQuery.error instanceof Error\n              ? dataQuery.error.message\n              : 'An error occurred while fetching data from the server.'}\n          </Alert>\n        )}\n        <Group justify='space-between'>\n          <Group gap='xs'>\n            <AddItemButton\n              tooltip='Add new rate'\n              onClick={() => {\n                createRateForm?.open();\n              }}\n            />\n          </Group>\n          <Group gap='xs'>\n            <SearchInput\n              searchCallback={(value: string) => {\n                setSearchTerm(value);\n              }}\n            />\n            <Tooltip label='Refresh data' position='top-end'>\n              <ActionIcon\n                variant='transparent'\n                onClick={() => {\n                  dataQuery.refetch();\n                }}\n              >\n                <IconRefresh />\n              </ActionIcon>\n            </Tooltip>\n          </Group>\n        </Group>\n        <DataTable\n          minHeight={250}\n          withTableBorder\n          withColumnBorders\n          idAccessor={'pk'}\n          noRecordsText='No manufacturing rates found'\n          records={dataQuery.data || []}\n          fetching={dataQuery.isFetching || dataQuery.isLoading}\n          columns={dataColumns}\n          pinLastColumn\n        />\n      </Stack>\n    </>\n  );\n}\n\n// This is the function which is called by InvenTree to render the actual panel component\nexport function renderAdminPanel(context: InvenTreePluginContext) {\n  checkPluginVersion(context);\n\n  return <ManufacturingCostsAdminPanel context={context} />;\n}\n"],"names":["DataTable"],"mappings":"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"}