# komitto(コミット)

`git diff`の情報から、セマンティックなコミットメッセージプロンプトを生成するためのCLIツールです。生成されたプロンプトは自動的にクリップボードにコピーされ、LLMに貼り付けることで、コミットメッセージを作成できます。

## 主な機能

- ステージングされた変更（`git diff --staged`）を解析
- 変更内容をLLMが理解しやすいXML形式に変換
- コミットメッセージ生成用のシステムプロンプトと結合
- 生成された最終的なプロンプトをクリップボードにコピー
- 変更に関する追加のコンテキスト（補足情報）をコマンドライン引数で付与する機能

## インストール

```bash
pip install komitto
```

もし開発用にインストールする場合は、以下のコマンドを使用してください。

```bash
pip install -e .
```

## 使い方

1.  リポジトリで変更を行い、`git add`でファイルをステージングします。

    ```bash
    git add <変更したファイル>
    ```

2.  `komitto`コマンドを実行します。

    ```bash
    komitto
    ```

3.  `✅ プロンプトをクリップボードにコピーしました！` と表示されたら、お使いのLLMのインターフェースにプロンプトを貼り付けてください。

### 追加コンテキストを渡す

変更の意図や特記事項など、プロンプトに含めたい補足情報がある場合は、引数として渡すことができます。

```bash
komitto "この変更は緊急のバグ修正です"
```

## 設定ファイルによるカスタマイズ

以下のコマンドを実行することで、カレントディレクトリに設定ファイルの雛形（`komitto.toml`）を生成できます。

```bash
komitto init
```

プロンプトの内容は、TOML形式の設定ファイルを作成することでカスタマイズ可能です。
以下の順序で設定ファイルを探索し、見つかった設定がデフォルト設定を上書きします（後勝ち）。

1.  **OSごとのユーザー設定ディレクトリ**（グローバル設定）
    *   **Windows**: `%APPDATA%\komitto\config.toml`
        *   例: `C:\Users\<User>\AppData\Roaming\komitto\config.toml`
    *   **macOS**: `~/Library/Application Support/komitto/config.toml`
    *   **Linux**: `~/.config/komitto/config.toml`
2.  **カレントディレクトリ**（プロジェクト固有設定）
    *   `./komitto.toml`

### 設定ファイル (`komitto.toml` / `config.toml`) の記述例

```toml
[prompt]
# システムプロンプトの上書き
# """ で囲むことで改行を含めたテキストを記述できます
system = """
あなたは関西弁の陽気なエンジニアです。
コミットメッセージもノリよく生成してください。

形式:
<Type>: <Emoji> <Title>
...
"""
```

## 仕組み

1.  `git diff --staged` を実行し、ステージングされたファイルの差分を取得します。
2.  差分情報を、ファイルパス、関数/クラス名、変更の種類（追加、修正、削除）などを含む構造化されたXML形式に変換します。
3.  あらかじめ定義されたシステムプロンプト、ユーザーが指定した追加コンテキスト、XML形式の差分情報を結合して、最終的なプロンプTプを生成します。
4.  生成されたプロンプトをクリップボードにコピーします。