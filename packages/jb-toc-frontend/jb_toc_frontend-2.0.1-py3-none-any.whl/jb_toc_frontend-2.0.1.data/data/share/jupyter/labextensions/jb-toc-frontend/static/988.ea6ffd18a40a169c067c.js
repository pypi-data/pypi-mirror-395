"use strict";(self.webpackChunkjb_toc_frontend=self.webpackChunkjb_toc_frontend||[]).push([[988],{988:(t,n,e)=>{e.r(n),e.d(n,{default:()=>R,getJupyterAppInstance:()=>M});var o={};e.r(o),e.d(o,{getJBook1Config:()=>h,jBook1TOCToHtml:()=>b});var r={};e.r(r),e.d(r,{getHtmlBottom:()=>$,getHtmlTop:()=>m,mystTOCToHtml:()=>y});var i=e(495),a=e(247),c=e(70),s=e(555),l=e(596),u=e(603),p=e(366),f=e.n(p),d=e(769);async function h(t){try{const e=await v(t);if("string"==typeof e){const t=d.load(e);if((n=t)&&"object"==typeof n&&"string"==typeof n.title&&"string"==typeof n.author){return{title:t.title||"Untitled Jupyter Book",author:t.author||"Anonymous"}}console.error("Error: Misconfigured Jupyter Book config.")}}catch(t){console.error("Error reading or parsing config:",t)}var n;return{title:null,author:null}}async function g(t,n,e=1){async function o(t){const o=C(t,`${n}`);let i;return"string"==typeof o&&r.add(E(o)),"string"==typeof o&&(i=A(o)),`<button class="jp-Button toc-button tb-level${e}" data-file-path="${S(encodeURI(String(o)))}">${i}</button>`}n&&"/"!==n.slice(-1)&&(n+="/");const r=new Set,i=[];for(const a of t)if(a.sections&&a.file){const t=a.file.split("/");t.pop();const o=t.join("/"),c=C(a.file,`${n}${o}`);let s;"string"==typeof c&&(s=await _(c)),s||(s=a.file),s=j(String(s)),i.push(`\n        <div class="toc-row">\n            <button type="button" class="jp-Button toc-button \n              tb-level${e}" \n              data-file-path="${S(encodeURI(String(c)))}"\n              >${j(String(s))}</button>\n            <button type="button" class="jp-Button toc-chevron"><i class="fa fa-chevron-down "></i></button>\n        </div>\n        <div class="toc-children" hidden>\n        `);const l=await g(a.sections,n,e+=1);l.paths.forEach((t=>r.add(t))),i.push(l.html),e-=1,i.push("</div>")}else if(a.file)i.push(await o(a.file));else if(a.url){const t=String(S(encodeURI(a.url)));i.push(`<button class="jp-Button toc-button toc-link tb-level${e}">\n        <a class="toc-link tb-level${e}" \n        href="${S(encodeURI(String(t)))}" \n        target="_blank" \n        rel="noopener noreferrer" \n        >${j(String(a.title))}</a></button>`)}else if(a.glob){const t=await L(`${n}${a.glob}`);for(const e of t){const t=e.replace(`${n}`,"");i.push(await o(t))}}return{html:i.join(""),paths:Array.from(r)}}async function b(t,n){const e=new Set,o=[];if(o.push("\n<ul>"),t.parts)for(const r of t.parts){o.push(`\n<p class="caption" role="heading"><span class="caption-text"><b>\n${j(String(r.caption))}\n</b></span>\n</p>`);const t=await g(r.chapters,n);o.push(`\n${t.html}`),t.paths.forEach((t=>e.add(t)))}else if(t.chapters){const r=await g(t.chapters,n);o.push(`\n${r}`),r.paths.forEach((t=>e.add(t)))}return o.push("\n</ul>"),{html:o.join(""),paths:Array.from(e)}}async function y(t,n,e=1){async function o(t,o=!1){const r=C(t,n);a.add(String(r));const i=`sec-${Math.random().toString(36).slice(2)}`,c=A(r),s=B(r);let l;return l=o?`<div class="toc-row">\n        <button\n          type="button"\n          class="jp-Button toc-button tb-level${e} toc-file"\n          data-file-path="${r}"\n          aria-label="Open ${s}"\n        ><b>${c}</b></button>\n\n        <button\n          type="button"\n          class="jp-Button toc-chevron"\n          aria-expanded="false"\n          aria-controls="${i}"\n          aria-label="Toggle section for ${s}"\n        ><i class="fa fa-chevron-down"></i></button>\n      </div>\n      <div id="${i}" class="toc-children" hidden>\n    `:`<button\n        class="jp-Button toc-button tb-level${e}"\n        data-file-path="${r}"\n        aria-label="Open ${s}"\n      >\n        ${c}\n      </button>`,l}async function r(t,n){const o=`sec-${Math.random().toString(36).slice(2)}`;return`\n      <div class="toc-row">\n        <p class="caption tb-level${e}" role="heading" aria-level="${e}">\n          <b>${t}</b>\n        </p>\n        <button\n          type="button"\n          class="jp-Button toc-chevron"\n          aria-expanded="false"\n          aria-controls="${o}"\n          aria-label="Toggle section for ${n}"\n        ><i class="fa fa-chevron-down"></i>\n        </button>\n      </div>\n      <div id="${o}" class="toc-children" hidden>\n    `}async function i(t,n,o){return`\n    <div class="toc-row">\n      <a\n        class="jp-Button toc-button toc-link tb-level${e}"\n        href="${o}"\n        target="_blank"\n        rel="noopener noreferrer"\n        aria-label="Open external link to ${n}"\n      >\n        ${t}\n      </a>\n    </div>\n    `}n&&"/"!==n.slice(-1)&&(n+="/");const a=new Set,c=[];for(const s of t){const t=s.title?j(String(s.title)):"",l=s.title?S(String(s.title)):"",u=s.url?S(encodeURI(String(s.url))):"";if((s.title||s.file)&&s.children){s.file?c.push(await o(s.file,!0)):s.title&&c.push(await r(t,l));const i=await y(s.children,n,e+1);i.paths.forEach((t=>a.add(t))),c.push(i.html),c.push("</div>")}else if(s.file)c.push(await o(s.file));else if(s.url&&s.title)c.push(await i(t,l,u));else if(s.glob){const t=await L(`${n}${s.glob}`);for(const e of t){const t=e.replace(`${n}`,"");c.push(await o(t))}}}return{html:c.join(""),paths:Array.from(a)}}async function m(t,n){let e=`<div class="jbook-toc" data-toc-dir="${n}">`;return t.title&&(e+=`<p id="toc-title">${j(String(t.title))}</p>`),t.subtitle&&(e+=`<p id="toc-subtitle">${j(String(t.subtitle))}</p>`),e+='<br><hr class="toc-hr">',e}async function $(t){let n='<br><hr class="toc-hr"><br>';if(Array.isArray(t.authors)&&t.authors.length){const e=t.authors.filter((t=>t&&t.name)).map((t=>j(String(t.name))));e.length&&(n+=`<p id="toc-author">${1===e.length?"Author:":"Authors:"} ${e.join(", ")}</p>`)}if((t.github||t.license||t.doi)&&(n+='<div class="badges">'),t.github&&(n+=function(t){let n,e;const o=String(t).trim();if(o.startsWith("http://")||o.startsWith("https://")){n=o;const t=o.match(/github\.com\/([^/]+\/[^/]+)/);e=t?t[1]:o}else e=o,n=`https://github.com/${o}`;const r=S(encodeURI(e));return`\n      <a\n        href="${n}"\n        target="_blank"\n        rel="noopener noreferrer"\n        class="toc-link github-link"\n        aria-label="Open GitHub repository ${r} (opens in a new tab)"\n      >\n        <img\n          src="https://img.shields.io/badge/GitHub-5c5c5c?logo=github"\n          alt="GitHub badge for ${r}"\n          loading="lazy"\n        >\n      </a>\n    `}(t.github)),t.license){const e=String(t.license);n+=`\n      <a\n        href="https://opensource.org/licenses/${e}"\n        target="_blank"\n        rel="noopener noreferrer"\n        class="toc-link badge-link"\n        aria-label="Open ${e} license text (opens in a new tab)"\n      >\n        <img\n          src="https://img.shields.io/static/v1?label=License&message=${encodeURIComponent(e)}&color=0A84FF"\n          alt="License: ${e}"\n          loading="lazy"\n        >\n      </a>\n    `}return t.doi&&(n+=function(t){if(!t)return"";const n=(t=String(t).trim()).match(/10\.\S+/);return n&&(t=n[0]),`\n  <a\n    href="https://doi.org/${t}"\n    target="_blank"\n    rel="noopener noreferrer"\n    class="toc-link badge-link"\n    aria-label="Open DOI ${t} (opens in a new tab)"\n  >\n    <img\n      src="https://img.shields.io/static/v1?label=DOI&message=${encodeURIComponent(t)}&color=0A84FF"\n      alt="DOI: ${t}"\n      loading="lazy"\n    >\n  </a>`}(t.doi)),(t.github||t.license||t.doi)&&(n+="</div>"),t.copyright&&(n+=`\n      <p style="padding-left: 15px">Copyright © ${j(String(t.copyright))}</p>\n    `),n}const w={findConfigInParents:async function(t){const n=["myst.yml","_toc.yml"];for(const e of n){const n=t.split("/");let o=0;for(;o<1;){const t=n.join("/"),r=await k(t);for(const t of Object.values(r.content)){const n=t;if(n.path.endsWith(e))return n.path}0===n.length?o+=1:n.pop()}}return null},getFileContents:v,applyTitles:function(t,n){for(const[e,o]of Object.entries(n)){const n=j(String(o)),r=S(String(o));t=J(t,A(e),n),t=J(t,B(e),r)}return t},fetchTitlesBackend:async function(t){const n=l.ServerConnection.makeSettings(),e=u.URLExt.join(n.baseUrl,"jbtoc","titles"),o=await l.ServerConnection.makeRequest(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paths:t})},n);if(!o.ok)throw new Error(`${o.status} ${o.statusText}`);const r=await o.json(),i={};for(const[t,n]of Object.entries(r.titles))i[t]=n;return i},fetchTitlesFrontend:async function(t){const n={};for(const e of t)try{let t=await _(String(e));t||(t=F(e)),n[e]=String(t)}catch{n[e]=F(e)}return n},yamlLoad:d.load,ls:k,jb1:o,jb2:r};async function v(t){try{const n=M(),e=await n.serviceManager.contents.get(t,{content:!0});if("notebook"===e.type||"file"===e.type)return e.content;throw new Error(`Unsupported file type: ${e.type}`)}catch(n){throw console.error(`Failed to get file contents for ${t}:`,n),n}}async function k(t){""===t&&(t="/");try{const n=M();return await n.serviceManager.contents.get(t,{content:!0})}catch(t){return console.error("Error listing directory contents:",t),null}}function j(t){return null===t?"":String(t).replaceAll(/&/g,"&amp;").replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;")}function S(t){return null===t?"":j(String(t)).replaceAll(/"/g,"&quot;").replaceAll(/'/g,"&#39;")}function T(t){return encodeURIComponent(t)}function A(t){return`[[TITLE_HTML::${T(t)}]]`}function B(t){return`[[TITLE_ATTR::${T(t)}]]`}function E(t){return t.replace(/\\/g,"/").replace(/\/+/g,"/")}function C(t,n){return E((n.endsWith("/")?n:n+"/")+t)}function O(t){return t&&"object"==typeof t&&Array.isArray(t.cells)}function I(t){return Array.isArray(t)?t.join(""):t}async function _(t){const n=/^(#{1,6})\s+(.+?)\s*#*\s*$/,e=function(t){const n=/\.([^./\\]+)$/.exec(t);return n?"."+n[1]:""}(t);if(".ipynb"===e)try{const e=await v(t);if(O(e))for(const t of e.cells){if("markdown"!==t.cell_type)continue;const e=I(t.source);for(const t of e.split("\n")){const e=t.match(n);if(e)return e[2]}}}catch(t){console.error("Error reading or parsing notebook:",t)}else if(".md"===e)try{const e=await v(t);if(!O(e))for(const t of e.split("\n")){const e=t.match(n);if(e)return e[2]}}catch(t){console.error("Error reading or parsing Markdown:",t)}return null}async function L(t){const{serviceManager:n}=M(),e=n.contents;if(!/[*?[\]{}()!+@]/.test(t))try{const n=await e.get(t,{content:!1});if("file"===n.type)return[E(n.path)]}catch{return[]}const o=E(f().scan(t).base??""),r=function(t){return!t.includes("**")&&!/[\\/]/.test(t)}(t),i=f()(t,{basename:r,dot:!0}),a=[];return r?await async function(t){const n=await e.get(t||"",{content:!0});if("directory"===n.type&&Array.isArray(n.content))for(const t of n.content){if("file"!==t.type)continue;const n=t.name??t.path.split("/").pop()??"";i(n)&&a.push(E(t.path))}}(o):await async function t(n){const o=await e.get(n||"",{content:!0});if("directory"===o.type&&Array.isArray(o.content)){for(const n of o.content)if("directory"===n.type)await t(n.path);else if("file"===n.type||"notebook"===n.type){const t=E(n.path);i(t)&&a.push(t)}}else if("file"===o.type||"notebook"===o.type){const t=E(o.path);i(t)&&a.push(t)}}(o||""),a}function J(t,n,e){return t.split(n).join(e)}function F(t){return t.split("/").pop()??t}let H=null;function M(t){if(!H&&t&&(H=t),!H)throw new Error("App instance has not been initialized yet");return H}const R={id:"jb-toc:plugin",description:"A JupyterLab extension that mimics jupyter-book chapter navigation on an un-built, cloned jupyter book in JupyterLab.",autoStart:!0,requires:[i.ILabShell,s.IFileBrowserFactory,c.IDocumentManager],activate:async(t,n,e,o)=>{M(t),console.log("JupyterLab extension jb-toc is activated!");const r=new a.Widget;r.id="@jupyterlab-sidepanel/jb-toc",r.title.iconClass="jbook-icon jp-SideBar-tabIcon",r.title.className="jbook-tab",r.title.caption="Jupyter-Book Table of Contents";const i=document.createElement("p");r.node.appendChild(i),r.activate=async()=>{const t=e.tracker.currentWidget;t?console.debug("Active file browser widget found."):console.debug("File browser widget is null.");try{const n=t?.model.path;if("string"==typeof n){const t=await async function(t){const n=await w.findConfigInParents(t);let e,o=null,r=null;if(n){const t=n.endsWith("myst.yml"),i=n.split("/");if(i.pop(),r=i.join("/"),!t){const t=await w.ls(r),n="_config.yml";for(const e of Object.values(t.content)){const t=e;if(t.name===n){o=t.path;break}}}if(!t&&null!=r&&o)try{const t=await w.getFileContents(n);if("string"==typeof t){const n=w.yamlLoad(t),i=await w.jb1.getJBook1Config(o),{html:a,paths:c}=await w.jb1.jBook1TOCToHtml(n,r);let s;try{s=await w.fetchTitlesBackend(c)}catch{s=await w.fetchTitlesFrontend(c)}const l=w.applyTitles(a,s);e=`\n          <div class="jbook-toc" data-toc-dir="${r}">\n            <p id="toc-title">${j(String(i.title))}</p>\n            <p id="toc-author">Author: ${j(String(i.author))}</p>\n            ${l}\n          </div>\n          `}else console.error("Error: Misconfigured Jupyter Book _toc.yml.")}catch(t){console.error("Error reading or parsing _toc.yml:",t)}else if(t&&null!=r)try{const t=await v(n);if("string"==typeof t){const n=w.yamlLoad(t).project,o=await w.jb2.getHtmlTop(n,r),{html:i,paths:a}=await w.jb2.mystTOCToHtml(n.toc,r);let c;try{c=await w.fetchTitlesBackend(a)}catch{c=await w.fetchTitlesFrontend(a)}e=`\n            ${o}\n            <ul>${w.applyTitles(i,c)}</ul>\n            </div>\n            ${await w.jb2.getHtmlBottom(n)}\n            `}else console.error("Error: Misconfigured Jupyter Book _toc.yml.")}catch(t){console.error("Error reading or parsing _toc.yml:",t)}}else e=`\n      <p id="toc-title">Not a Jupyter-Book</p>\n      <p id="toc-author">Could not find a "_toc.yml", "_config.yml", or "myst.yml in or above the current directory:</p>\n      <p id="toc-author">${j(t)}</p>\n      <p id="toc-author">Please navigate to a Jupyter-Book directory to view its Table of Contents</p>\n      `;if("string"==typeof e)return console.debug(e),e;{let t="";try{t=JSON.stringify(e,null,2)}catch{t=String(e)}const n=e instanceof Error&&e.stack||"object"==typeof e&&"stack"in(e??{})?e.stack:"";return`\n      <div class="jbook-toc-error" style="color: red; font-family: monospace; white-space: pre-wrap; padding: 1em;">\n        <b>⚠️ TOC generation error:</b>\n        <hr>\n        ${j(t+(n?`\n\n${n}`:""))}\n      </div>\n    `}}(n);i.innerHTML=t}!function(t,n){document.querySelectorAll(".toc-button").forEach((e=>{e.addEventListener("click",(o=>{if(!t)return void console.error("File browser not found");const r=e.closest(".jbook-toc");if(!r)return void console.error("jbook-toc div not found");if("string"!=typeof r.getAttribute("data-toc-dir"))return void console.error("data-toc-dir attribute loaded");if("string"!=typeof t.model.path)return void console.error(`Invalid path: The current path is either not set or not a string. Path: ${t.model.path}`);console.debug(`Current directory: ${t.model.path}`);const i=e.getAttribute("data-file-path");"string"==typeof i&&(i.includes(".md")?n.openOrReveal(i,"Markdown Preview"):n.openOrReveal(i))}))}))}(t,o),document.querySelectorAll(".toc-chevron").forEach((t=>{const n=t;n.addEventListener("click",(t=>{!function(t){const n=t.parentElement?.nextElementSibling;if(!n)return;const e=n.hidden;n.hidden=!e,t.setAttribute("aria-expanded",String(!e)),t.innerHTML=e?'<i class="fa fa-chevron-up toc-chevron"></i>':'<i class="fa fa-chevron-down toc-chevron"></i>'}(n)}))}))}catch(t){console.error(`jb_toc error: ${t}`)}},n.add(r,"left",{rank:400}),r.activate()}}}}]);