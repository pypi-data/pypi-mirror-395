[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "hil-testbench"
version = "0.1.3"
description = "Hardware-in-Loop testbench framework with concurrent task execution, structured logging, and live metrics."
readme = "README.md"
license = "MIT"
requires-python = ">=3.9"
authors = [
    {name = "HIL Testbench Contributors", email = "noreply@example.com"}
]
maintainers = [
    {name = "HIL Testbench Maintainers", email = "noreply@example.com"}
]
keywords = ["hardware-in-loop", "hil", "testbench", "automation", "ssh", "tasks", "monitoring", "concurrent"]
classifiers = [
    "Development Status :: 3 - Alpha",
    "Intended Audience :: Developers",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
]
dependencies = [
    "paramiko>=3.0.0",
    'pywinpty>=2.0.0; sys_platform == "win32"',
    "rich>=13.0.0",
    "psutil>=5.9.0",
    "PyYAML>=6.0.0",
    "pint>=0.22",
    "networkx>=3.0",
    "simpleeval>=0.9.13",
]

[project.optional-dependencies]
dev = [
    "ruff>=0.1.0",
    "pytest>=7.4.0",
    "pytest-cov>=4.1.0",
    "pytest-mock>=3.12.0",
    "hypothesis>=6.92.0",
    "simpleeval>=0.9.10",
    "pycg>=0.0.8",
    "numpy>=1.26.0",
    "matplotlib>=3.8.0",
    "tox>=4.0.0",
]
maintainer = [
    "detect-secrets>=1.5.0",
    "build>=1.0.0",
    "interrogate>=1.7.0",
    "pre-commit>=3.5.0",
    "twine>=4.0.0",
    "pytest-testmon>=2.1.0",
]

[project.scripts]
hil-testbench = "run_tasks:main"

[tool.hatch.build]
only-include = [
    "hil_testbench",
    "run_tasks.py",
    "README.md",
    "LICENSE",
]
no-vcs = true
exclude = [
    ".gitignore",
    "/.gitignore",
    "*/.gitignore",
    "*.gitignore",
    "hil_testbench/tools/yaml_options_report.py",
]

[tool.hatch.build.targets.wheel]
packages = ["hil_testbench", "run_tasks.py"]
exclude = [
    "simulators",
    "experiments",
    ".tox",
]

[tool.hatch.build.targets.sdist]
# Restrict contents to project sources and top-level metadata only (no dotfiles).
include = [
    "hil_testbench",
    "run_tasks.py",
    "README.md",
    "LICENSE",
]
exclude = [
    ".gitignore",
    "**/.gitignore",
    "hil_testbench/tools/yaml_options_report.py",
]


# ===================================================================
#                  REMAINING CONFIG (unchanged)
# ===================================================================

[tool.pytest.ini_options]
testpaths = [
    "tests/unit",
    "tests/smoke",
    "tests/integration",
    "tests/streaming",
    "tests/iperf",
    "tests/ssh"
]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
norecursedirs = ["tests/remote"]
addopts = [
    "-ra",
    "--strict-markers",
    "--strict-config",
    "--showlocals",
    "-s",
    "--tb=auto",
    "--disable-warnings",
    "--cov=hil_testbench",
    "--cov-report=term",
    "--cov-report=xml",
]
markers = [
    "unit",
    "smoke",
    "integration",
    "streaming",
    "iperf",
    "ssh",
    "regression",
    "slow",
]

filterwarnings = [
    "ignore::DeprecationWarning",
    "ignore::ResourceWarning",
    "ignore::pytest.PytestUnraisableExceptionWarning",
]

[tool.coverage.run]
relative_files = true
source = ["hil_testbench"]
omit = [
    "*/tests/*",
    "*/test_*.py",
    "*/experiments/*",
]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "raise AssertionError",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "if TYPE_CHECKING:",
    "@abstractmethod",
]

[tool.ruff]
line-length = 100
target-version = "py311"
extend-exclude = [
    ".tox",
    "simulators",
    "experiments",
]

[tool.ruff.lint]
select = ["E", "F", "W", "I", "B", "UP", "SIM", "PL", "C90"]
ignore = [
    "E501",
    "C901",
    "PLR0911",
    "PLR0912",
    "PLR0913",
    "PLR0915",
    "PLR2004",
    "SIM102",
    "PLC0415",
    "F841",
    "E402",
    "E741",
    "B017",
    "E721",
    "PLW0603",
    "SIM105",
    "SIM222",
]
per-file-ignores = {"tests/**/*.py" = ["E402"]}

[tool.ruff.lint.mccabe]
max-complexity = 10

[tool.ruff.lint.pylint]
max-args = 5
max-branches = 12
max-returns = 6
max-statements = 50

[tool.interrogate]
ignore-init-module = true
ignore-magic = true
ignore-semiprivate = true
ignore-private = true
style = "google"
fail-under = 0
verbose = 0
exclude = ["tests", "docs", "docs-internal", "tasks", "scripts", "tools", ".tox"]
