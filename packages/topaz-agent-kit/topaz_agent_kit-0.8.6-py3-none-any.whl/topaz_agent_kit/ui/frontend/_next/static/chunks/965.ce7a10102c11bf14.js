"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[965],{98965:function(e,t,a){a.r(t),a.d(t,{UniversalPreviewModal:function(){return b}});var s=a(57437),r=a(2265),l=a(90027),n=a(67601),i=a(81917),d=a(69419),c=a(26178),o=a(43237),x=a(42926),m=a(69843),h=a(38891),g=a(75858),p=a(12914),u=a(34140),y=a(28768),j=a(65623);function b(e){let{document:t,isOpen:a,onClose:b,apiBase:f,citationContext:v,mode:k,uploadFile:N,uploadPreviewUrl:w,uploadPreviewText:D,isUploadLoading:C}=e,[z,L]=(0,r.useState)("preview"),[F,P]=(0,r.useState)(null),[S,E]=(0,r.useState)(null),[U,M]=(0,r.useState)(!1),[R,B]=(0,r.useState)(null),[Z,O]=(0,r.useState)(!1),[W,T]=(0,r.useState)(!1);(0,r.useEffect)(()=>{O(!0)},[]),(0,r.useEffect)(()=>{if(!a||!Z)return;let e=e=>{"Escape"===e.key&&b()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,b,Z]),(0,r.useEffect)(()=>{("library"===k||"citation"===k)&&"preview"===z&&t&&t.hasStorage&&A()},[z,t,k]),(0,r.useEffect)(()=>{v&&"preview"===z&&d.k.info("Citation context updated:",v)},[v,z]);let A=async()=>{if(t&&t.hasStorage){console.log("\uD83D\uDD0D FRONTEND: loadPreview called for document:",t.id,"citationContext:",v),M(!0),B(null),P(null),E(null);try{let e="".concat(f,"/api/documents/").concat(t.id,"/file"),a=!1;if(v&&v.text&&"pdf"===t.type){let s=new URLSearchParams({text:v.text,color:"yellow"});v.page&&s.append("page",v.page.toString()),s.append("_t",Date.now().toString()),e="".concat(f,"/api/documents/").concat(t.id,"/highlighted?").concat(s),a=!0,console.log("\uD83D\uDD0D FRONTEND: Loading highlighted PDF for citation:",{documentId:t.id,text:v.text,page:v.page,apiUrl:e}),d.k.info("Loading highlighted PDF for citation:",{documentId:t.id,text:v.text,page:v.page})}console.log("\uD83D\uDD0D FRONTEND: Making fetch request to:",e);let s=await fetch(e,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(console.log("\uD83D\uDD0D FRONTEND: Fetch response status:",s.status,s.statusText),!s.ok)throw Error("Failed to load file: ".concat(s.statusText));let r=await s.blob(),l=["jpg","jpeg","png","gif","bmp","tiff","tif","webp"].includes(t.type),n="pdf"===t.type,i=["md","markdown","csv","json","txt","tsv","log","html","htm"].includes(t.type);if(l||n){let e=URL.createObjectURL(r);P(e),T(a)}else if(i){let e=await r.text();E(e)}else{let e=URL.createObjectURL(r);P(e)}}catch(e){d.k.error("Error loading preview:",e),B(e instanceof Error?e.message:"Failed to load preview")}finally{M(!1)}}};if((0,r.useEffect)(()=>()=>{F&&URL.revokeObjectURL(F)},[F]),!a||!Z)return null;let I="upload"===k?N:t,H="upload"===k?w:F,Q="upload"===k?D:S,V="upload"===k?C:U;if(!I)return null;let _=e=>{var t;switch(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase()){case"pdf":case"txt":case"md":case"json":case"csv":default:return"\uD83D\uDCC4";case"doc":case"docx":return"\uD83D\uDCDD";case"xls":case"xlsx":return"\uD83D\uDCCA";case"ppt":case"pptx":return"\uD83D\uDCCB";case"jpg":case"jpeg":case"png":case"gif":case"webp":return"\uD83D\uDDBC️";case"mp4":case"avi":case"mov":return"\uD83C\uDFA5";case"mp3":case"wav":case"flac":return"\uD83C\uDFB5";case"zip":case"rar":case"7z":return"\uD83D\uDCE6"}},G=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},q=e=>{try{return new Date(e).toLocaleString()}catch(t){return e}};return(0,s.jsx)("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 p-4",onClick:b,children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl max-w-7xl w-full max-h-[95vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex items-start space-x-3 flex-1 min-w-0",children:[(0,s.jsx)("span",{className:"text-2xl flex-shrink-0",children:_(I.name)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 truncate",children:I.name}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400",children:[(0,s.jsx)("span",{children:G(I.size)}),"upload"!==k&&t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{children:q(t.uploadDate)})]}),v&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:"•"}),(0,s.jsxs)("span",{className:"text-blue-600 dark:text-blue-400",children:["Page ",v.page]})]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 flex-shrink-0 ml-4",children:[(H||"upload"!==k&&t)&&(0,s.jsxs)("button",{onClick:async()=>{try{if("upload"===k&&H){let e=document.createElement("a");e.href=H,e.download=I.name,document.body.appendChild(e),e.click(),document.body.removeChild(e)}else if("upload"!==k&&t){let e=await fetch("".concat(f,"/api/documents/").concat(t.id,"/file"));if(e.ok){let a=await e.blob(),s=URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download=t.name,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}}}catch(e){d.k.error("Error downloading file:",e)}},className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download File"]}),(0,s.jsx)("button",{onClick:b,className:"h-8 w-8 flex items-center justify-center text-gray-700 dark:text-gray-200 bg-white/80 dark:bg-zinc-800/80 hover:bg-white dark:hover:bg-zinc-800 rounded-full border border-gray-200 dark:border-gray-700 shadow-sm transition-colors",title:"Close",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),v&&v.text&&(0,s.jsxs)("div",{className:"text-sm text-blue-600 dark:text-blue-400 italic break-words",children:['"',v.text,'"']})]}),("library"===k||"citation"===k)&&(0,s.jsxs)("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("button",{onClick:()=>L("preview"),className:"flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors ".concat("preview"===z?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,s.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Preview"]}),(0,s.jsxs)("button",{onClick:()=>L("analysis"),className:"flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors ".concat("analysis"===z?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),"Analysis"]}),(0,s.jsxs)("button",{onClick:()=>L("metadata"),className:"flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors ".concat("metadata"===z?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"),children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Metadata"]})]}),(0,s.jsxs)("div",{className:"p-4 overflow-auto max-h-[calc(95vh-140px)]",children:["preview"===z&&(()=>{var e,t;if(V)return(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"text-gray-600 dark:text-gray-400",children:"Loading preview..."})});if(R)return(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsxs)("div",{className:"text-red-600 dark:text-red-400 text-center",children:[(0,s.jsx)("div",{className:"text-4xl mb-2",children:"⚠️"}),(0,s.jsx)("div",{className:"text-sm",children:R})]})});if(!H&&!Q)return(0,s.jsxs)("div",{className:"p-8 bg-zinc-50 dark:bg-zinc-800/50 rounded-lg text-center",children:[(0,s.jsx)("span",{className:"text-4xl mb-4 block",children:"\uD83D\uDCC4"}),(0,s.jsx)("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Preview not available"})]});let a="pdf"===I.type||I.name.toLowerCase().endsWith(".pdf"),r=["jpg","jpeg","png","gif","bmp","tiff","tif","webp"].includes(I.type||(null===(e=I.name.split(".").pop())||void 0===e?void 0:e.toLowerCase())||"");if(a&&H){console.log("PDF Preview - Citation Context:",v);let e=H;return v&&v.page?console.log("PDF Preview - Using page navigation:",e="".concat(H,"#page=").concat(v.page)):W?console.log("PDF Preview - Using highlighted PDF:",e):console.log("PDF Preview - Using regular PDF:",e),console.log("PDF Preview - Final URL:",e),(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)("iframe",{src:e,className:"w-full h-[70vh] border border-gray-200 dark:border-gray-700 rounded-lg"})})}return r&&H?(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("img",{src:H,alt:"Preview of ".concat(I.name),className:"max-h-[70vh] max-w-full rounded-lg border border-zinc-200 dark:border-zinc-700 shadow-lg"})}):Q?I.name.toLowerCase().endsWith(".md")||I.name.toLowerCase().endsWith(".markdown")?(0,s.jsx)("div",{className:"overflow-auto rounded-md p-3 bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 prose prose-sm max-w-none dark:prose-invert max-h-96",children:(0,s.jsx)(l.UG,{remarkPlugins:[n.Z],rehypePlugins:[[i.Z,{languages:{javascript:c.Z,typescript:o.Z,json:x.Z,python:m.Z,bash:h.Z,shell:g.Z,yaml:p.Z,markdown:u.Z,xml:y.Z,html:y.Z,css:j.Z},ignoreMissing:!0}]],children:Q})}):(0,s.jsx)("div",{className:"overflow-auto rounded-md p-3 bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 max-h-96",children:(0,s.jsx)("pre",{className:"text-sm text-zinc-800 dark:text-zinc-200 whitespace-pre-wrap",children:Q})}):(0,s.jsxs)("div",{className:"p-8 bg-zinc-50 dark:bg-zinc-800/50 rounded-lg text-center",children:[(0,s.jsx)("span",{className:"text-4xl mb-4 block",children:_(I.name)}),(0,s.jsxs)("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-4",children:["Preview not available for"," ",(null===(t=I.type)||void 0===t?void 0:t.toUpperCase())||"this file type"]}),H&&(0,s.jsxs)("a",{href:H,download:I.name,className:"inline-flex items-center gap-2 px-4 py-2 bg-[hsl(var(--accent))] text-white rounded-lg hover:opacity-90 transition-opacity",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download File"]})]})})(),"analysis"===z&&("upload"!==k&&t?(0,s.jsxs)("div",{className:"space-y-6",children:[t.summary&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Summary"}),(0,s.jsx)("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:(0,s.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed",children:t.summary})})]}),t.topics&&t.topics.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Topics Found"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:t.topics.map((e,t)=>(0,s.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 rounded-full text-sm",children:e},t))})]}),t.exampleQuestions&&t.exampleQuestions.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Example Questions"}),(0,s.jsx)("div",{className:"space-y-2",children:t.exampleQuestions.map((e,t)=>(0,s.jsx)("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border-l-4 border-blue-500",children:(0,s.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:e})},t))})]}),!t.summary&&(!t.topics||0===t.topics.length)&&(!t.exampleQuestions||0===t.exampleQuestions.length)&&(0,s.jsxs)("div",{className:"p-8 bg-zinc-50 dark:bg-zinc-800/50 rounded-lg text-center",children:[(0,s.jsx)("span",{className:"text-4xl mb-4 block",children:"\uD83D\uDCCA"}),(0,s.jsx)("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"No analysis data available"})]})]}):(0,s.jsxs)("div",{className:"p-8 bg-zinc-50 dark:bg-zinc-800/50 rounded-lg text-center",children:[(0,s.jsx)("span",{className:"text-4xl mb-4 block",children:"\uD83D\uDCCA"}),(0,s.jsx)("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Analysis not available for upload preview"})]})),"metadata"===z&&("upload"===k?(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"File Name"}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:I.name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"File Size"}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:G(I.size)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"File Type"}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:I.type||"Unknown"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Last Modified"}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:q("upload"===k&&N?new Date(N.lastModified).toISOString():new Date().toISOString())})]})]})}):t?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"File Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"File ID"}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t.id})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"File Type"}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t.type})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"File Size"}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:G(t.size)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Upload Date"}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:q(t.uploadDate)})]}),t.fileHash&&(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"File Hash"}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 font-mono",children:t.fileHash})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Processing Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Chunks Created"}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t.chunksCount||0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Storage Status"}),(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(t.hasStorage?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400"),children:t.hasStorage?"Available":"Not Available"})]})]})]})]}):null)]})]})})}}}]);