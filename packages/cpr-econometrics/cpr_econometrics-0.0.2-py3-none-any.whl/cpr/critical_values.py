"""
Critical values for CT and PU tests for Cointegrating Polynomial Regressions.

This module contains pre-computed critical values based on Monte Carlo simulations
as presented in Wagner (2023), "Residual-based cointegration and non-cointegration
tests for cointegrating polynomial regressions", Empirical Economics, 65:1-31.

The critical values are organized by:
- d: deterministic specification (-1: none, 0: intercept, 1: intercept + trend)
- m: number of integrated regressors (1-4)
- p: highest power of the regressor entering with powers (1-4)

Percentile vector: [0.01, 0.025, 0.05, 0.1, 0.5, 0.9, 0.95, 0.975, 0.99]

Author: Dr Merwan Roudane
Email: merwanroudane920@gmail.com
"""

from typing import Dict, List, Optional, Tuple
import numpy as np

# Percentile indices
PERCENTILES = np.array([0.01, 0.025, 0.05, 0.1, 0.5, 0.9, 0.95, 0.975, 0.99])

# CT Test Critical Values (Null: Cointegration)
# H0: Cointegration (KPSS-Shin type test)
# Reject H0 if test statistic > critical value (upper tail)
CT_CRITICAL_VALUES: Dict[str, List[float]] = {
    "CT_d_0_m_1_p_1": [0.02056792382307772, 0.02465088748215614, 0.02916017663214545, 0.03573323415646992, 0.08324301605538945, 0.2324815744726059, 0.3163535432072107, 0.4084379954030375, 0.5494726483066066],
    "CT_d_0_m_1_p_2": [0.01879925362135678, 0.02240143320219408, 0.02633577319256316, 0.03208712187775282, 0.07422383271386807, 0.2132822767758706, 0.2926555331989051, 0.3786462018792071, 0.5044477684037733],
    "CT_d_0_m_1_p_3": [0.01771934665819858, 0.02103822486782851, 0.02457980992418016, 0.02992060640444607, 0.06992818697898716, 0.2043771835315612, 0.280705873358065, 0.3651008039676579, 0.4903593250785521],
    "CT_d_0_m_1_p_4": [0.01689689837305397, 0.02002053380528839, 0.0233613281557644, 0.02859436111372606, 0.06727034326318407, 0.1986739276097174, 0.2742734581200464, 0.3571054921874188, 0.4767068061370862],
    "CT_d_0_m_2_p_1": [0.01791965325491076, 0.02108220490474499, 0.0246838676771889, 0.02968236720120756, 0.06330143535468202, 0.1614777768800982, 0.2193771974361483, 0.2853362869488824, 0.3844237883185102],
    "CT_d_0_m_2_p_2": [0.01649896832357979, 0.01941004836738208, 0.0223949943272369, 0.02687740016422963, 0.05696967189883355, 0.1479476077179705, 0.2006329973341462, 0.2631237565172097, 0.3585919484808028],
    "CT_d_0_m_2_p_3": [0.01553400206972192, 0.01820815107713816, 0.02112700694077005, 0.02527022393400612, 0.05350225504520484, 0.1407591100889342, 0.191387484250292, 0.2531824336143706, 0.3483752274322306],
    "CT_d_0_m_2_p_4": [0.01486547314836389, 0.01739980713199572, 0.02016659166464763, 0.02426154528348597, 0.05147418034604033, 0.1365532186932031, 0.1864441371601809, 0.2476269271152448, 0.3390843558220819],
    "CT_d_0_m_3_p_1": [0.01578784551561312, 0.01844509508187437, 0.02127708882261135, 0.02520634678212254, 0.05075938133039368, 0.1204172639102623, 0.1588300881530219, 0.2062390343743019, 0.2770235909283995],
    "CT_d_0_m_3_p_2": [0.01462713748853333, 0.01703138458882851, 0.0196587867130646, 0.02320234912865269, 0.04590281655472774, 0.1095019867925554, 0.1457395535154477, 0.1906143844047024, 0.2593127333861669],
    "CT_d_0_m_3_p_3": [0.01395810242607737, 0.01622736068569084, 0.01858175188654928, 0.02198754351772483, 0.04325022065611792, 0.1041238584017964, 0.1391316726576751, 0.1818720643007529, 0.2476504784194398],
    "CT_d_0_m_3_p_4": [0.01340375515565762, 0.01560956236966274, 0.01786375267575618, 0.02109440407109068, 0.04168846653019932, 0.1011716984018894, 0.1357313131749555, 0.1774095150337547, 0.242473983277232],
    "CT_d_0_m_4_p_1": [0.01428460276476033, 0.01654866149113834, 0.0189113585574371, 0.0222360907227805, 0.04223693284519386, 0.09448315101366386, 0.122108800982991, 0.1537458815603148, 0.2026724944998958],
    "CT_d_0_m_4_p_2": [0.01333306604162357, 0.01547387369944181, 0.01754997232894652, 0.02053510309557493, 0.03855088799949861, 0.08583274446350386, 0.1107719493055737, 0.1400023392551582, 0.187577573790356],
    "CT_d_0_m_4_p_3": [0.01277085356846994, 0.01470649761954175, 0.01670287560455563, 0.01951416581558792, 0.03652043490428579, 0.08150947083814661, 0.1057726956529426, 0.134052495954631, 0.1801866009905143],
    "CT_d_0_m_4_p_4": [0.01229158818348579, 0.01421792041543035, 0.01611986420326535, 0.01877345254028966, 0.03517209268363938, 0.07869553719277939, 0.102795910585778, 0.1316204029300807, 0.1761720533399916],
    "CT_d_1_m_1_p_1": [0.0155080260577039, 0.01801847831231826, 0.02061333647508186, 0.02434024079084887, 0.04670264827841292, 0.0976979940546595, 0.1211577376649245, 0.1450466444221897, 0.1785661643951179],
    "CT_d_1_m_1_p_2": [0.01438737802450177, 0.01653974417727798, 0.01888535026197586, 0.02214434128033257, 0.04155989925228838, 0.08583126994582629, 0.1062884554260597, 0.1280018583143903, 0.1568132581021117],
    "CT_d_1_m_1_p_3": [0.01365294035282368, 0.01571212332701165, 0.01788659100348059, 0.02089903174548078, 0.03913660428510163, 0.08116483911694045, 0.1010367660748337, 0.1221241861325217, 0.1501348023630975],
    "CT_d_1_m_1_p_4": [0.01308882687759439, 0.01508806092624418, 0.01717616677416928, 0.02005225407029423, 0.03756614686453601, 0.07840398310109223, 0.09766157755368353, 0.1179840412232745, 0.1455290858442051],
    "CT_d_1_m_2_p_1": [0.0140359575714272, 0.01621692604009754, 0.01846451036782478, 0.02160514917066458, 0.0400790459241426, 0.08187965930678259, 0.1013563683173474, 0.1214858688925867, 0.1494628694914512],
    "CT_d_1_m_2_p_2": [0.01314570001527106, 0.01505307163594455, 0.01708076666869497, 0.01983568072125021, 0.03620413283578254, 0.07260081089531567, 0.09001618235889192, 0.1080179398770009, 0.133413847142304],
    "CT_d_1_m_2_p_3": [0.01250559508559086, 0.01429848352939675, 0.01616851012449082, 0.01882874666345252, 0.03411632148479255, 0.06872164346692425, 0.0852387752853129, 0.1028750849972719, 0.1277932572529579],
    "CT_d_1_m_2_p_4": [0.01201550500059809, 0.01375508695527893, 0.01554420648624383, 0.01807101711978525, 0.03277259526052757, 0.06629162180203015, 0.08224097461418284, 0.09974491889484413, 0.1243829225835329],
    "CT_d_1_m_3_p_1": [0.01288475906953315, 0.01473627368886211, 0.01669326799611957, 0.0193377198502338, 0.03479206386801868, 0.06887136662738899, 0.08507353602299367, 0.1021734607484522, 0.1270233052541787],
    "CT_d_1_m_3_p_2": [0.01205641422073825, 0.0137524430863608, 0.01553606037583148, 0.01794426619976155, 0.03168071622718045, 0.06151636479618631, 0.0754357946807741, 0.09047849094098664, 0.1122789626548194],
    "CT_d_1_m_3_p_3": [0.01154347344857038, 0.01315633249933434, 0.01477479836759724, 0.01704915908216367, 0.02995117447043865, 0.0583391598280177, 0.07175544767461016, 0.08644251882943205, 0.1068182210142409],
    "CT_d_1_m_3_p_4": [0.01121921590244601, 0.01270575061509775, 0.01426899607317868, 0.01644685557204072, 0.02882775941371102, 0.05642934411337351, 0.06958034736894644, 0.08381287155022847, 0.1038889412208132],
    "CT_d_1_m_4_p_1": [0.01192763537967667, 0.01361377094983505, 0.01531140646093598, 0.01760678522902632, 0.03075199659842116, 0.05912078917359363, 0.07274803376631755, 0.08771698061040467, 0.1087719863424282],
    "CT_d_1_m_4_p_2": [0.01125123789544795, 0.01276762926244612, 0.0143245129070296, 0.0164361526617345, 0.02819357530237406, 0.05339277660288115, 0.06530848023416078, 0.07853436476220589, 0.09691638001073943],
    "CT_d_1_m_4_p_3": [0.0108530547692921, 0.01224507568661727, 0.0137015691511817, 0.01565848138208904, 0.02675862125788436, 0.05079042694418819, 0.06228207873234626, 0.07451348218079827, 0.09249852936031365],
    "CT_d_1_m_4_p_4": [0.01046558947386458, 0.01184216251630077, 0.01323120984556195, 0.01510429504796398, 0.02577449989356317, 0.04904182837120311, 0.05996311876505591, 0.07175844328951758, 0.08867416004874298],
    "CT_d_MIN1_m1_p_1": [0.02827623893821946, 0.03536095977837203, 0.04379213691103463, 0.05758245268522862, 0.2016210279874378, 0.8575426192325417, 1.20865644814999, 1.600464861010274, 2.141252288336149],
    "CT_d_MIN1_m1_p_2": [0.02473944468839311, 0.03108287716943775, 0.03794428533211536, 0.04924392542453314, 0.1591029215369624, 0.6639031994131795, 0.9464641706818336, 1.264940333090286, 1.711932361267792],
    "CT_d_MIN1_m1_p_3": [0.0229405141559128, 0.02818731438188235, 0.03457052999271358, 0.04423339664622793, 0.1381528026031286, 0.5605302171848241, 0.8039386098790946, 1.079243258088916, 1.473120048853716],
    "CT_d_MIN1_m1_p_4": [0.02160660502770943, 0.02657842292646762, 0.03224455680143341, 0.04126713739075429, 0.1262129706752865, 0.4961981684728685, 0.7079208583918191, 0.9385767172979003, 1.275291502514158],
    "CT_d_MIN1_m2_p_1": [0.0238942686589793, 0.02964329937063147, 0.03610905874934474, 0.04652265707697024, 0.1495589452649617, 0.6256897599538094, 0.8939277745087594, 1.189001282502405, 1.615711335214907],
    "CT_d_MIN1_m2_p_2": [0.02170029762444812, 0.02646247606046482, 0.03179722821548922, 0.04048924138888154, 0.1231541598039889, 0.5045752772395096, 0.7252692096136497, 0.9711021151148415, 1.346323474908378],
    "CT_d_MIN1_m2_p_3": [0.02015034289801246, 0.02437222963944177, 0.02919572750897152, 0.03703751105694693, 0.1084851154763157, 0.4421952968598041, 0.6384070554103789, 0.8546029875215949, 1.17692605803724],
    "CT_d_MIN1_m2_p_4": [0.01885756433387898, 0.02313324039151605, 0.0276375715537085, 0.03491358924008234, 0.09953382497712866, 0.4002247207472571, 0.5724874799747867, 0.765179077733773, 1.055429672105206],
    "CT_d_MIN1_m3_p_1": [0.02083351640476378, 0.02539719215791269, 0.03047750786234713, 0.03858852730033265, 0.1173542389316495, 0.472169438770147, 0.6780443009852068, 0.9002774328956673, 1.23609290184938],
    "CT_d_MIN1_m3_p_2": [0.01904306317331378, 0.02302091233447195, 0.02754147496197011, 0.03447048027758273, 0.09887105793647659, 0.3919766673062123, 0.5617147340754489, 0.7588763157947011, 1.043271012665429],
    "CT_d_MIN1_m3_p_3": [0.01783664191204603, 0.02140347772960642, 0.02549271963391907, 0.03174367715877729, 0.08850863665475703, 0.3498532102666477, 0.5039001799655138, 0.6808660110885582, 0.9435349676012001],
    "CT_d_MIN1_m3_p_4": [0.01702949746050846, 0.02036782131539024, 0.02420712895722113, 0.02998568962497188, 0.08226971102958623, 0.3207253829028385, 0.461347087203927, 0.6185229895563319, 0.8738181589969871],
    "CT_d_MIN1_m4_p_1": [0.01837512924373801, 0.02224699187871702, 0.02653156121695351, 0.03334716586829256, 0.09604270438384686, 0.3754390984106267, 0.5326996698703015, 0.7092768673024875, 0.9688200893946163],
    "CT_d_MIN1_m4_p_2": [0.01702504521884795, 0.02040245899387201, 0.02430443197860744, 0.03019950338232037, 0.08291781574353996, 0.3173410850985505, 0.4483059726254745, 0.6049760469001151, 0.8326035564531811],
    "CT_d_MIN1_m4_p_3": [0.01606600941323249, 0.01926072992917047, 0.02276680351416325, 0.0280065900021293, 0.07478799819556275, 0.2843784324480858, 0.4089015001337576, 0.549383293272117, 0.753955661126497],
    "CT_d_MIN1_m4_p_4": [0.01537821058654688, 0.01829043441184488, 0.02156292281136277, 0.02646099411051777, 0.06982462582667795, 0.2636419893685882, 0.378809978295748, 0.5054928590270494, 0.6929935202590418],
}

# PU Test Critical Values (Null: No Cointegration)
# H0: Spurious regression / No cointegration (Phillips-Ouliaris type)
# Reject H0 if test statistic > critical value (upper tail)
PU_CRITICAL_VALUES: Dict[str, List[float]] = {
    "PU_d_0_m_1_p_1": [1.882499937585448, 2.475231916943531, 3.179045332564682, 4.311631387546473, 11.96960228761167, 27.77892816145555, 34.09703379553024, 40.14736646973793, 48.03478123456876],
    "PU_d_0_m_1_p_2": [2.026259373301962, 2.64601462954902, 3.431066294747096, 4.694357056957609, 13.43696955617953, 30.98253924229075, 37.87475517642149, 44.43248470733145, 52.94784857075556],
    "PU_d_0_m_1_p_3": [2.099071961134038, 2.754898259179066, 3.572352540924678, 4.890670093880416, 14.27966030779483, 33.1537985024373, 40.43696676682092, 47.47759570076783, 56.12298638144296],
    "PU_d_0_m_1_p_4": [2.144165488949347, 2.818085445926261, 3.667199476115708, 5.025606032979009, 14.8495452420692, 34.71771710014963, 42.42543925311394, 49.79570721133383, 58.78882318738263],
    "PU_d_0_m_2_p_1": [2.581572968486881, 3.498372591124679, 4.58439576323307, 6.15753419700135, 15.76558411852349, 33.84948428586193, 40.90392209659058, 47.67708192878052, 55.79960962394327],
    "PU_d_0_m_2_p_2": [2.786751917495254, 3.792536903918538, 5.018915807414055, 6.760052634986468, 17.61292281600591, 37.27683093053823, 44.79160101086445, 51.84105938287113, 60.60539570189891],
    "PU_d_0_m_2_p_3": [2.873744778449934, 3.953603399254672, 5.240956890194061, 7.098434722234646, 18.70542267697255, 39.67625680572178, 47.70207827233582, 54.92065818431272, 63.8283058737868],
    "PU_d_0_m_2_p_4": [2.946667262401094, 4.043021619615831, 5.385205400699162, 7.309631856277119, 19.45433963496065, 41.4570995662834, 49.66283494364134, 57.29633787736984, 66.69610310585738],
    "PU_d_0_m_3_p_1": [3.682786142833775, 4.914305169917288, 6.292296653662086, 8.262153127559206, 19.67941151862006, 39.52474073101097, 46.89200946282308, 53.84270194677741, 63.17058174278989],
    "PU_d_0_m_3_p_2": [3.987438634874981, 5.341249876551831, 6.881057898405195, 9.105518686225956, 21.71371751877789, 43.08627009862985, 50.91644221882318, 58.10999771287307, 67.83415060763249],
    "PU_d_0_m_3_p_3": [4.143774103437503, 5.575765670470416, 7.19042203361139, 9.554223064847058, 23.0130649321159, 45.5699842577629, 53.63964764336589, 61.3097606440115, 71.14782413507763],
    "PU_d_0_m_3_p_4": [4.270276041528504, 5.728784438116732, 7.392169986806199, 9.855537081136518, 23.92097350414718, 47.46618663770211, 55.86917599066715, 63.83567098991168, 73.93766985402081],
    "PU_d_0_m_4_p_1": [4.918606439308174, 6.493747463812977, 8.224468972595169, 10.62479347985826, 23.57289552309916, 45.16688632694942, 52.99498615796814, 60.25699101805247, 69.95229166470926],
    "PU_d_0_m_4_p_2": [5.318790623828896, 7.123715071012359, 9.06055699215621, 11.68764015101196, 25.84050790097934, 48.73910935877864, 56.92444655137675, 64.94504171418026, 74.38936336194989],
    "PU_d_0_m_4_p_3": [5.557877289152626, 7.469710816399481, 9.498807880621863, 12.26947266180956, 27.33175324293495, 51.37814216811716, 59.99154925283472, 68.03690746569595, 78.35666278593254],
    "PU_d_0_m_4_p_4": [5.683748615855976, 7.654529541292879, 9.797859742014104, 12.65599874550365, 28.35728692156546, 53.37021957567629, 62.17429712826514, 70.40369101138251, 81.1152845336433],
    "PU_d_1_m_1_p_1": [5.516346391948592, 6.802259607232868, 8.192782178891173, 10.15151904962466, 21.43318072654806, 41.13153495107404, 48.56395513176425, 55.32907458832227, 64.46303899796929],
    "PU_d_1_m_1_p_2": [6.280123912958905, 7.752072769910852, 9.336522932742819, 11.58263228865103, 24.08192540965143, 45.23729268976643, 52.95181044105902, 60.32064282500815, 69.47058808119741],
    "PU_d_1_m_1_p_3": [6.557617881447265, 8.118177709287369, 9.81204692721518, 12.25922393362993, 25.55267182099244, 47.92519672341596, 55.92644145664932, 63.59797606346454, 73.30738096415909],
    "PU_d_1_m_1_p_4": [6.73535029548124, 8.383276894066505, 10.15006833389631, 12.71021416186235, 26.62096573500015, 50.01427684168662, 58.27906900065073, 66.04700040621623, 76.12637297612757],
    "PU_d_1_m_2_p_1": [6.544413369813812, 8.196773072894009, 9.837650650828724, 12.15788130502182, 25.04455379071826, 46.39668125182887, 54.26958661293958, 61.80348227049035, 71.49864501167421],
    "PU_d_1_m_2_p_2": [7.463571110493297, 9.246260154771756, 11.16004916706096, 13.75057175290935, 27.80020846112259, 50.42420694399436, 58.66725913866517, 66.38472191939523, 76.36745975607384],
    "PU_d_1_m_2_p_3": [7.798597637598878, 9.701226986741938, 11.68994180326278, 14.49388515644401, 29.45148356077844, 53.36317956013909, 61.84378630130338, 69.85482288291209, 79.93884142771154],
    "PU_d_1_m_2_p_4": [8.050589471743907, 10.05505396700691, 12.09660543752007, 15.03678570139457, 30.65212624224626, 55.39044400235098, 64.384124299302, 72.57864449108914, 82.62721524315761],
    "PU_d_1_m_3_p_1": [7.855627934266504, 9.783904340469288, 11.77273167290594, 14.5466965652468, 28.80124949792384, 51.71619380407528, 59.87431927296021, 67.58522396435923, 77.26377510203442],
    "PU_d_1_m_3_p_2": [8.85610866898533, 11.01874706063103, 13.18090474206091, 16.23109491033133, 31.66901812624927, 55.63683951585686, 64.25646157332216, 72.25362329179605, 82.47735109559927],
    "PU_d_1_m_3_p_3": [9.252877905895152, 11.56709725447448, 13.91940510594346, 17.16434429885524, 33.41996058166831, 58.44192338140805, 67.32719971830115, 75.53420166139988, 86.60346162546939],
    "PU_d_1_m_3_p_4": [9.535180590996537, 11.92487765291098, 14.42252987695046, 17.79652711212716, 34.70566731237989, 60.6408499639457, 69.76756441450567, 78.15902592159853, 89.63867219597928],
    "PU_d_1_m_4_p_1": [9.191454344614808, 11.401089942698, 13.70044259623392, 16.83826304437877, 32.48192118900012, 56.80461981309436, 65.32399394872481, 73.24460201755508, 83.55020545022833],
    "PU_d_1_m_4_p_2": [10.3518906645926, 12.73932314744644, 15.22533537003526, 18.64476683857552, 35.34867236755694, 60.89185700900691, 69.89283607168073, 78.24591558414212, 89.02332114503224],
    "PU_d_1_m_4_p_3": [10.85773289424015, 13.40665237599865, 16.07109272355315, 19.67152902098941, 37.27519843969966, 63.91134227365861, 73.03919331012547, 81.61911030502118, 92.44382980280136],
    "PU_d_1_m_4_p_4": [11.21342202923926, 13.86342955537533, 16.60477351604415, 20.37383156232569, 38.65323472139553, 66.15056980338596, 75.55621324702476, 84.44006900777497, 95.65022834463875],
    "PU_d_MIN1_m1_p_1": [0.5844927244472804, 0.8326050258687271, 1.165347966040261, 1.766453772202252, 7.229156664205592, 20.50395670086267, 26.11959425621969, 31.65264077030223, 39.04032616420591],
    "PU_d_MIN1_m1_p_2": [0.8033262394763565, 1.126063867604842, 1.546458708476967, 2.288931388746666, 8.957651912745531, 24.50437201555388, 30.87544646350799, 36.98618345968528, 44.86187550260252],
    "PU_d_MIN1_m1_p_3": [0.9509483085706806, 1.336158011770335, 1.834996615993185, 2.690351850725035, 10.0724287871917, 27.0793803079026, 33.85960756217187, 40.5754747038345, 48.9770507018702],
    "PU_d_MIN1_m1_p_4": [1.079140053461977, 1.507858456574989, 2.054626303844794, 3.006402580412359, 10.86628503012798, 28.88014654037947, 36.18056714920501, 43.20610925679325, 51.80405022442759],
    "PU_d_MIN1_m2_p_1": [1.062306013883698, 1.604802973069037, 2.298469200961652, 3.443374188273747, 11.22031539333376, 27.24993725829047, 33.51219677544309, 39.81555016210778, 47.73408153656163],
    "PU_d_MIN1_m2_p_2": [1.340372270709104, 1.974257767149315, 2.790217784529129, 4.147533727568113, 13.29517137225611, 31.16990233586332, 38.03631773163201, 44.87160898511775, 53.22644064641601],
    "PU_d_MIN1_m2_p_3": [1.575492537948846, 2.292837533855396, 3.175338783155074, 4.641231467354918, 14.59584707366169, 33.82257898571991, 41.22162887760914, 48.37401807098058, 57.01024234694017],
    "PU_d_MIN1_m2_p_4": [1.733901953718047, 2.498077655764004, 3.470272872661274, 5.015880614651444, 15.52520274690811, 35.82401359796987, 43.64275853280451, 51.04641337468866, 59.95098559557164],
    "PU_d_MIN1_m3_p_1": [1.899140780539793, 2.808694367518194, 3.907300830432876, 5.478813895509526, 15.26634112242204, 33.35443914625714, 40.32132802914055, 47.03898359511122, 55.69477216847483],
    "PU_d_MIN1_m3_p_2": [2.261906922306965, 3.340653026808762, 4.574431863623435, 6.389082073402556, 17.54052675298741, 37.36044783816451, 44.74090616549473, 51.65031114412164, 60.93165835770328],
    "PU_d_MIN1_m3_p_3": [2.531978490265519, 3.720083733296716, 5.026235406282889, 6.952460898360179, 18.98653859614306, 40.09453519566864, 47.82026950783646, 55.22595566272133, 64.87981232474867],
    "PU_d_MIN1_m3_p_4": [2.767664491402295, 4.008294942787907, 5.360045293555596, 7.394351315861529, 20.03525724524044, 42.10770109640377, 50.30663049525595, 57.86136852885052, 67.73637863640467],
    "PU_d_MIN1_m4_p_1": [3.065272328756952, 4.319259755755328, 5.72714572677334, 7.810661396181103, 19.19635810704214, 39.05500997115648, 46.59911694419849, 53.62581374729901, 62.52839675105327],
    "PU_d_MIN1_m4_p_2": [3.501756133834823, 4.98686143988409, 6.642714535534358, 8.971854289040536, 21.69285324862144, 43.11436851571835, 51.00964757949137, 58.70393517466559, 68.03975966284908],
    "PU_d_MIN1_m4_p_3": [3.816501668714709, 5.445827697140178, 7.179909025056194, 9.635360191763002, 23.32040162831384, 45.95773624130684, 54.19440087411578, 61.99626160772328, 71.79955496204273],
    "PU_d_MIN1_m4_p_4": [4.1028524328481, 5.75033909435192, 7.585643673111426, 10.14739438585429, 24.4741403648446, 48.03325457581432, 56.62953960735123, 64.64508330900254, 74.75732872297571],
}


def get_ct_critical_value(d: int, m: int, p: int, alpha: float) -> float:
    """
    Get the critical value for the CT test.
    
    Parameters
    ----------
    d : int
        Deterministic specification:
        -1: no deterministics
         0: intercept only
         1: intercept and linear trend
    m : int
        Number of integrated regressors (1-4)
    p : int
        Highest power of the regressor entering with powers (1-4)
    alpha : float
        Significance level (0.01, 0.025, 0.05, 0.1)
    
    Returns
    -------
    float
        Critical value for the test
        
    Raises
    ------
    ValueError
        If parameters are out of valid range or alpha not supported
    
    Notes
    -----
    The CT test is a KPSS-Shin type test with H0: cointegration.
    Reject H0 if test statistic > critical value.
    """
    # Validate inputs
    if d not in [-1, 0, 1]:
        raise ValueError(f"d must be -1, 0, or 1, got {d}")
    if m < 1 or m > 4:
        raise ValueError(f"m must be between 1 and 4, got {m}")
    if p < 1 or p > 4:
        raise ValueError(f"p must be between 1 and 4, got {p}")
    
    # Map alpha to index
    alpha_mapping = {0.1: 5, 0.05: 6, 0.025: 7, 0.01: 8}
    if alpha not in alpha_mapping:
        raise ValueError(f"alpha must be one of {list(alpha_mapping.keys())}, got {alpha}")
    
    # Construct key
    if d == -1:
        key = f"CT_d_MIN1_m{m}_p_{p}"
    else:
        key = f"CT_d_{d}_m_{m}_p_{p}"
    
    if key not in CT_CRITICAL_VALUES:
        raise ValueError(f"Critical values not available for d={d}, m={m}, p={p}")
    
    return CT_CRITICAL_VALUES[key][alpha_mapping[alpha]]


def get_pu_critical_value(d: int, m: int, p: int, alpha: float) -> float:
    """
    Get the critical value for the PU test.
    
    Parameters
    ----------
    d : int
        Deterministic specification:
        -1: no deterministics
         0: intercept only
         1: intercept and linear trend
    m : int
        Number of integrated regressors (1-4)
    p : int
        Highest power of the regressor entering with powers (1-4)
    alpha : float
        Significance level (0.01, 0.025, 0.05, 0.1)
    
    Returns
    -------
    float
        Critical value for the test
        
    Raises
    ------
    ValueError
        If parameters are out of valid range or alpha not supported
    
    Notes
    -----
    The PU test is a Phillips-Ouliaris type test with H0: no cointegration.
    Reject H0 if test statistic > critical value.
    """
    # Validate inputs
    if d not in [-1, 0, 1]:
        raise ValueError(f"d must be -1, 0, or 1, got {d}")
    if m < 1 or m > 4:
        raise ValueError(f"m must be between 1 and 4, got {m}")
    if p < 1 or p > 4:
        raise ValueError(f"p must be between 1 and 4, got {p}")
    
    # Map alpha to index
    alpha_mapping = {0.1: 5, 0.05: 6, 0.025: 7, 0.01: 8}
    if alpha not in alpha_mapping:
        raise ValueError(f"alpha must be one of {list(alpha_mapping.keys())}, got {alpha}")
    
    # Construct key
    if d == -1:
        key = f"PU_d_MIN1_m{m}_p_{p}"
    else:
        key = f"PU_d_{d}_m_{m}_p_{p}"
    
    if key not in PU_CRITICAL_VALUES:
        raise ValueError(f"Critical values not available for d={d}, m={m}, p={p}")
    
    return PU_CRITICAL_VALUES[key][alpha_mapping[alpha]]


def get_all_critical_values(test: str, d: int, m: int, p: int) -> np.ndarray:
    """
    Get all critical values for the specified test configuration.
    
    Parameters
    ----------
    test : str
        'CT' for cointegration test, 'PU' for non-cointegration test
    d : int
        Deterministic specification (-1, 0, or 1)
    m : int
        Number of integrated regressors (1-4)
    p : int
        Highest power (1-4)
    
    Returns
    -------
    np.ndarray
        Array of critical values at percentiles [0.01, 0.025, 0.05, 0.1, 0.5, 0.9, 0.95, 0.975, 0.99]
    """
    if test.upper() == 'CT':
        if d == -1:
            key = f"CT_d_MIN1_m{m}_p_{p}"
        else:
            key = f"CT_d_{d}_m_{m}_p_{p}"
        return np.array(CT_CRITICAL_VALUES[key])
    elif test.upper() == 'PU':
        if d == -1:
            key = f"PU_d_MIN1_m{m}_p_{p}"
        else:
            key = f"PU_d_{d}_m_{m}_p_{p}"
        return np.array(PU_CRITICAL_VALUES[key])
    else:
        raise ValueError(f"test must be 'CT' or 'PU', got {test}")


def get_p_value(test: str, d: int, m: int, p: int, statistic: float) -> float:
    """
    Compute approximate p-value by interpolation.
    
    Parameters
    ----------
    test : str
        'CT' or 'PU'
    d : int
        Deterministic specification
    m : int
        Number of integrated regressors
    p : int
        Highest power
    statistic : float
        Test statistic value
    
    Returns
    -------
    float
        Approximate p-value (interpolated from critical value table)
    """
    critvals = get_all_critical_values(test, d, m, p)
    
    # For CT test: larger values -> smaller p-values (upper tail)
    # For PU test: larger values -> smaller p-values (upper tail)
    # Percentiles represent P(X <= critval)
    # p-value = 1 - percentile for upper tail tests
    
    if statistic <= critvals[0]:
        return 1 - PERCENTILES[0]  # p > 0.99
    elif statistic >= critvals[-1]:
        return 1 - PERCENTILES[-1]  # p < 0.01
    else:
        # Interpolate
        idx = np.searchsorted(critvals, statistic)
        # Linear interpolation
        x0, x1 = critvals[idx-1], critvals[idx]
        y0, y1 = 1 - PERCENTILES[idx-1], 1 - PERCENTILES[idx]
        p_val = y0 + (y1 - y0) * (statistic - x0) / (x1 - x0)
        return p_val
