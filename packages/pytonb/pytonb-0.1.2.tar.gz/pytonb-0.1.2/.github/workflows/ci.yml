  name: ci

  on: [push, pull_request, workflow_dispatch]

  permissions:
    contents: write       # badge commits
    id-token: write       # PyPI trusted publisher (optional)
    packages: read        # check if version already on PyPI before publishing

  jobs:
    ci:
      uses: k4144/actions/.github/workflows/project-ci.yml@main
      with:
        python-version: "3.13"
        package-name: "pytonb"
        publish-on: "main"
        run-bandit: true           # toggle security scan
        badge-commit-message: "chore: refresh badges"

    publish:
      needs: ci
      if: needs.ci.outputs.should_publish == 'true'
      runs-on: ubuntu-latest
      environment: pypi
      permissions:
        contents: read
        id-token: write
      steps:
        - name: Download distribution artifact
          uses: actions/download-artifact@v4
          with:
            name: ${{ needs.ci.outputs.dist_artifact }}
            path: dist

        - name: Publish to PyPI 
          uses: pypa/gh-action-pypi-publish@release/v1
          with:
            # user and password can be commented out if a trusted publisher is set on pypi
            user: __token__
            password: ${{ secrets.PYPI_API_TOKEN }}
            packages-dir: dist/