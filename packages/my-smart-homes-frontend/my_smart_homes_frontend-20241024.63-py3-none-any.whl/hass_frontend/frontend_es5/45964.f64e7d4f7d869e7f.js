"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["45964"],{37382:function(t,e,i){i.d(e,{D:function(){return r}});var n=i(10416),s=i.n(n);const r=t=>s()(t,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:!0})},63002:function(t,e,i){i.a(t,async function(t,n){try{i.d(e,{$3:function(){return v},$O:function(){return T},$j:function(){return m},ED:function(){return o},JE:function(){return x},OQ:function(){return O},PU:function(){return j},Ph:function(){return f},Uf:function(){return $},W1:function(){return y},Wr:function(){return _},Z:function(){return d},gF:function(){return p},iY:function(){return b},jU:function(){return c},nN:function(){return E},p3:function(){return l},pJ:function(){return g},r_:function(){return u},sz:function(){return h}});i(79827),i(35748),i(65315),i(59023),i(95013);var s=i(72652),r=i(50654),a=t([r]);r=(a.then?(await a)():a)[0];var o=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const c=59509==i.j?["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"]:null,u=["L","gal","ft³","m³","CCF","MCF"],d=t=>t.sendMessagePromise({type:"recorder/info"}),l=(t,e)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:e}),_=(t,e)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:e}),h=(t,e,i,n,s="hour",r,a)=>t.callWS({type:"recorder/statistics_during_period",start_time:e.toISOString(),end_time:null==i?void 0:i.toISOString(),statistic_ids:n,period:s,units:r,types:a}),g=(t,e,i,n)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:e,units:n,fixed_period:i.fixed_period?{start_time:i.fixed_period.start instanceof Date?i.fixed_period.start.toISOString():i.fixed_period.start,end_time:i.fixed_period.end instanceof Date?i.fixed_period.end.toISOString():i.fixed_period.end}:void 0,calendar:i.calendar?Object.assign(Object.assign({},"week"===i.calendar.period?{first_weekday:(0,r.D)(t.locale).substring(0,3)}:{}),i.calendar):void 0,rolling_window:i.rolling_window}),f=t=>t.callWS({type:"recorder/validate_statistics"}),y=(t,e,i,n)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:e,unit_of_measurement:i,unit_class:n}),v=(t,e)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:e}),m=t=>{let e=null;if(!t)return null;for(const i of t)null!==i.change&&void 0!==i.change&&(null===e?e=i.change:e+=i.change);return e},p=(t,e)=>{let i=null;for(const n of e){if(!(n in t))continue;const e=m(t[n]);null!==e&&(null===i?i=e:i+=e)}return i},b=(t,e)=>t.some(t=>void 0!==t[e]&&null!==t[e]),S=["mean","min","max"],w=["sum","state","change"],E=(t,e)=>!(!S.includes(e)||0===t.mean_type)||!(!w.includes(e)||!t.has_sum),$=(t,e,i,n,s)=>{const r=new Date(i).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:e,start_time:r,adjustment:n,adjustment_unit_of_measurement:s})},T=(t,e,i)=>{const n=t.states[e];return n?(0,s.u)(n):(null==i?void 0:i.name)||e},x=(t,e,i)=>{let n;var s;e&&(n=null===(s=t.states[e])||void 0===s?void 0:s.attributes.unit_of_measurement);return void 0===n?null==i?void 0:i.statistics_unit_of_measurement:n},O=t=>t.includes(":"),j=t=>t.callWS({type:"recorder/update_statistics_issues"});n()}catch(c){n(c)}})},36886:function(t,e,i){i.a(t,async function(t,n){try{i.d(e,{Gs:function(){return w},JR:function(){return O},RR:function(){return x},TI:function(){return E},od:function(){return $},ok:function(){return j}});i(91949),i(35748),i(99342),i(35058),i(41846),i(65315),i(837),i(22416),i(37089),i(88238),i(34536),i(16257),i(20152),i(44711),i(72108),i(77030),i(95013);var s=i(4494),r=i(41484),a=i(4681),o=i(77415),c=i(40391),u=i(23336),d=i(99904),l=i(83466),_=i(9151),h=i(70162),g=i(91927),f=i(49418),y=i(8868),v=i(46089),m=i(65380),p=i(37382),b=t([v,m,y]);function w(t,e){let i=new Date(e);return t>2&&0===i.getHours()&&(i=(0,s.O)(i,1)),i.setMinutes(0,0,0),t>35&&i.setDate(1),t>2&&i.setHours(0),i.getTime()}function E(t){return t>35?"month":t>2?"day":"hour"}function $(t,e,i,n,s,a,o,c){const u=(0,r.c)(e,t),d=void 0!==a&&void 0!==o,l=d&&t.getFullYear()!==a.getFullYear();return{xAxis:{type:"time",min:t,max:w(u,e)},yAxis:{type:"value",name:s,nameGap:2,nameTextStyle:{align:"left"},axisLabel:{formatter:t=>(0,y.ZV)(Math.abs(t),i)},splitLine:{show:!0}},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0},tooltip:{trigger:"axis",formatter:t=>{if(Array.isArray(t)){const e=[],r=[];return t.forEach(t=>{var i;null!==(i=t.seriesId)&&void 0!==i&&i.startsWith("compare-")?r.push(t):e.push(t)}),[e,r].map(t=>T(t,i,n,u,d,l,s,c)).filter(Boolean).join("<br><br>")}return T([t],i,n,u,d,l,s,c)}}}}function T(t,e,i,n,s,r,o,c){var u,d,l,_;if(null===(u=t[0])||void 0===u||!u.value)return"";const h=new Date(null!==(d=null===(l=t[0].value)||void 0===l?void 0:l[2])&&void 0!==d?d:null===(_=t[0].value)||void 0===_?void 0:_[0]);let g;n>=89?g=`${(0,v.fr)(h,e,i)}`:n>0?g=`${(r?v.kz:v.sl)(h,e,i)}`:(g=`${s?`${(r?v.kz:v.sl)(h,e,i)}: `:""}${(0,m.fU)(h,e,i)}`,"bar"===t[0].componentSubType&&(g+=` – ${(0,m.fU)((0,a.L)(h,1),e,i)}`));const f=`<h4 style="text-align: center; margin: 0;">${g}</h4>`;let b=0,S=0,w=0,E=0;const $=t.map(t=>{var i;const n=null===(i=t.value)||void 0===i?void 0:i[1],s=(0,y.ZV)(n,e,n<.1?{maximumFractionDigits:3}:void 0);return"0"!==s&&("bar"===t.componentSubType&&(n>0?(b+=n,S++):(w+=n,E++)),`${t.marker} ${(0,p.D)(t.seriesName)}: <div style="direction:ltr; display: inline;">${s} ${o}</div>`)}).filter(Boolean);let T="";return 0!==b&&S>1&&c&&(T+=`<br><b>${c(b)}</b>`),0!==w&&E>1&&c&&(T+=`<br><b>${c(w)}</b>`),$.length>0?`${f}${$.join("<br>")}${T}`:""}function x(t){Array.from(new Set(t.map(t=>t.data.map(t=>Number(t[0]))).flat())).sort((t,e)=>t-e).forEach((e,i)=>{const n={},s={};for(let l=t.length-1;l>=0;l--){var r,a,o,c,u;const _=t[l].data[i],h=_&&"object"==typeof _&&"value"in _?_:{value:_},g=null===(r=h.value)||void 0===r?void 0:r[0],f=null!==(a=t[l].stack)&&void 0!==a?a:"";var d;if(void 0!==g)if(Number(g)!==e)null===(d=t[l].data)||void 0===d||d.splice(i,0,{value:[e,0],itemStyle:{borderWidth:0}});else 0===(null===(o=h.value)||void 0===o?void 0:o[1])?t[l].data[i]=Object.assign(Object.assign({},h),{},{itemStyle:Object.assign(Object.assign({},h.itemStyle),{},{borderWidth:0})}):!n[f]&&(null===(c=h.value)||void 0===c?void 0:c[1])>0?(t[l].data[i]=Object.assign(Object.assign({},h),{},{itemStyle:Object.assign(Object.assign({},h.itemStyle),{},{borderRadius:[4,4,0,0]})}),n[f]=!0):!s[f]&&(null===(u=h.value)||void 0===u?void 0:u[1])<0&&(t[l].data[i]=Object.assign(Object.assign({},h),{},{itemStyle:Object.assign(Object.assign({},h.itemStyle),{},{borderRadius:[0,0,4,4]})}),s[f]=!0)}})}function O(t){return Array.from(new Set(t.map(t=>t.data.map(t=>Number(t[0]))).flat())).sort((t,e)=>t-e).forEach((e,i)=>{for(let r=t.length-1;r>=0;r--){var n;const a=t[r].data[i],o=null===(n=(a&&"object"==typeof a&&"value"in a?a:{value:a}).value)||void 0===n?void 0:n[0];var s;if(void 0!==o)if(Number(o)!==e)null===(s=t[r].data)||void 0===s||s.splice(i,0,[e,0])}}),t}function j(t,e){if(!e)return t=>t;const i=(0,o.V)(t,e);if(0!==i&&t.getTime()===(0,c.D)(t).getTime())return t=>(0,u.e)(t,i);const n=(0,d.W)(t,e);if(0!==n&&t.getTime()===(0,l.w)(t).getTime())return t=>(0,_.P)(t,n);const s=(0,r.c)(t,e);if(0!==s&&t.getTime()===(0,h.o)(t).getTime())return t=>(0,g.f)(t,s);const a=t.getTime()-e.getTime();return t=>(0,f.A)(t,a)}[v,m,y]=b.then?(await b)():b,n()}catch(S){n(S)}})},73097:function(t,e,i){i.a(t,async function(t,n){try{i.r(e),i.d(e,{DEFAULT_DAYS_TO_SHOW:function(){return w},HuiStatisticsGraphCard:function(){return E}});i(46852),i(35748),i(65315),i(84136),i(22416),i(37089),i(5934),i(95013);var s=i(69868),r=i(41484),a=i(4494),o=i(84922),c=i(11991),u=i(75907),d=(i(70490),i(43716)),l=i(63002),_=i(87916),h=i(44630),g=i(8510),f=i(38177),y=i(36886),v=t([d,y,l]);[d,y,l]=v.then?(await v)():v;let m,p,b,S=t=>t;const w=30;class E extends o.WF{static async getConfigElement(){return await Promise.all([i.e("42153"),i.e("30199"),i.e("70184"),i.e("36791"),i.e("61717"),i.e("55038"),i.e("68041"),i.e("70756"),i.e("37271")]).then(i.bind(i,39788)),document.createElement("hui-statistics-graph-card-editor")}static getStubConfig(t,e,i){const n=(0,h.B)(t,1,e,i,["sensor"],t=>"state_class"in t.attributes);return{type:"statistics-graph",entities:n.length?[n[0]]:[]}}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeEnergy(),this._interval&&(clearInterval(this._interval),this._interval=void 0)}connectedCallback(){var t;super.connectedCallback(),this.hasUpdated&&(null!==(t=this._config)&&void 0!==t&&t.energy_date_selection?this._subscribeEnergy():void 0===this._interval&&this._setFetchStatisticsTimer(!0))}_subscribeEnergy(){var t;this._energySub||(this._energySub=(0,d.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(t=>{this._energyStart=t.start,this._energyEnd=t.end,this._getStatistics()}))}_unsubscribeEnergy(){this._energySub&&(this._energySub(),this._energySub=void 0),this._energyStart=void 0,this._energyEnd=void 0}getCardSize(){var t,e,i;return 5+(null!==(t=this._config)&&void 0!==t&&t.title?2:0)+(null!==(e=this._config)&&void 0!==e&&e.hide_legend?0:(null===(i=this._entities)||void 0===i?void 0:i.length)||0)}getGridOptions(){return{columns:12,min_columns:6,min_rows:3}}setConfig(t){if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");this._entities=t.entities?(0,f.L)(t.entities,!1):[],this._entityIds=this._entities.map(t=>t.entity),"string"==typeof t.stat_types?this._statTypes=[t.stat_types]:t.stat_types?this._statTypes=t.stat_types:this._statTypes=["change","state","sum","min","max","mean"],this._config=t,this._computeNames()}_computeNames(){this.hass&&this._config&&(this._names={},this._entities.forEach(t=>{const e=this.hass.states[t.entity];this._names[t.entity]=(0,_.v)(this.hass,e,t.name)||t.entity}))}shouldUpdate(t){return(0,g.pY)(this,t)||t.size>1||!t.has("hass")}willUpdate(t){if(super.willUpdate(t),!this._config||!t.has("_config"))return;const e=t.get("_config");if(this.hass){if(this._config.energy_date_selection&&!this._energySub)return void this._subscribeEnergy();if(!this._config.energy_date_selection&&this._energySub)return this._unsubscribeEnergy(),void this._setFetchStatisticsTimer();this._config.energy_date_selection&&this._energySub&&t.has("_config")&&(null==e?void 0:e.collection_key)!==this._config.collection_key&&(this._unsubscribeEnergy(),this._subscribeEnergy())}t.has("hass")&&this._computeNames(),t.has("_config")&&(null==e?void 0:e.entities)!==this._config.entities?this._setFetchStatisticsTimer(!0):!t.has("_config")||(null==e?void 0:e.stat_types)===this._config.stat_types&&(null==e?void 0:e.days_to_show)===this._config.days_to_show&&(null==e?void 0:e.period)===this._config.period&&(null==e?void 0:e.unit)===this._config.unit||this._setFetchStatisticsTimer()}async _setFetchStatisticsTimer(t=!1){var e;clearInterval(this._interval),this._interval=0,t&&await this._getStatisticsMetaData(this._entityIds),await this._getStatistics(),null!==(e=this._config)&&void 0!==e&&e.energy_date_selection||(this._interval=window.setInterval(()=>this._getStatistics(),this._intervalTimeout))}get _period(){var t,e;return null!==(t=null===(e=this._config)||void 0===e?void 0:e.period)&&void 0!==t?t:this._energyStart&&this._energyEnd?(0,y.TI)((0,r.c)(this._energyEnd,this._energyStart)):void 0}render(){var t,e;if(!this.hass||!this._config)return o.s6;const i="number"==typeof(null===(t=this._config.grid_options)||void 0===t?void 0:t.rows);return(0,o.qy)(m||(m=S` <ha-card> ${0} <div class="content ${0}"> <statistics-chart .hass="${0}" .isLoadingData="${0}" .statisticsData="${0}" .metadata="${0}" .period="${0}" .chartType="${0}" .statTypes="${0}" .names="${0}" .unit="${0}" .minYAxis="${0}" .maxYAxis="${0}" .startTime="${0}" .endTime="${0}" .fitYData="${0}" .hideLegend="${0}" .logarithmicScale="${0}" .daysToShow="${0}" .height="${0}" .expandLegend="${0}"></statistics-chart> </div> </ha-card> `),this._config.title?(0,o.qy)(p||(p=S`<h1 class="card-header">${0}</h1>`),this._config.title):o.s6,(0,u.H)({"has-header":!!this._config.title,"has-rows":!(null===(e=this._config.grid_options)||void 0===e||!e.rows)}),this.hass,!this._statistics,this._statistics,this._metadata,this._period,this._config.chart_type||"line",this._statTypes,this._names,this._unit,this._config.min_y_axis,this._config.max_y_axis,this._energyStart,this._energyEnd&&this._energyStart?(0,y.Gs)((0,r.c)(this._energyEnd,this._energyStart),this._energyEnd):void 0,this._config.fit_y_data||!1,this._config.hide_legend||!1,this._config.logarithmic_scale||!1,this._energyStart&&this._energyEnd?(0,r.c)(this._energyEnd,this._energyStart):this._config.days_to_show||w,i?"100%":void 0,this._config.expand_legend)}get _intervalTimeout(){var t;return 1e3*("5minute"===(null===(t=this._config)||void 0===t?void 0:t.period)?5:60)*60}async _getStatisticsMetaData(t){const e=await(0,l.Wr)(this.hass,t),i={};e.forEach(t=>{i[t.statistic_id]=t}),this._metadata=i}async _getStatistics(){var t;const e=null!==(t=this._energyStart)&&void 0!==t?t:(0,a.O)(new Date,24*(this._config.days_to_show||w)+1),i=this._energyEnd;try{let t;if(this._config.unit&&this._metadata){const e=Object.values(this._metadata).find(t=>(0,l.JE)(this.hass,null==t?void 0:t.statistic_id,t)===this._config.unit);e&&(t=e.unit_class,this._unit=this._config.unit)}if(!t&&this._metadata){const e=this._metadata[this._entityIds[0]];t=null==e?void 0:e.unit_class,this._unit=t&&(0,l.JE)(this.hass,e.statistic_id,e)||void 0}const n=t?{[t]:this._unit}:void 0,s=await(0,l.sz)(this.hass,e,i,this._entityIds,this._period,n,this._statTypes);this._statistics={},this._entities.forEach(t=>{const e=t.entity;e in s&&(this._statistics[e]=s[e])})}catch(n){this._statistics=void 0}}constructor(...t){super(...t),this._entities=[],this._entityIds=[],this._names={}}}E.styles=(0,o.AH)(b||(b=S`ha-card{display:flex;flex-direction:column;height:100%}.card-header{padding-bottom:0}.content{padding:16px;flex:1}.has-header{padding-top:0}statistics-chart{height:100%}.has-rows{--chart-max-height:100%}`)),(0,s.__decorate)([(0,c.MZ)({attribute:!1})],E.prototype,"hass",void 0),(0,s.__decorate)([(0,c.wk)()],E.prototype,"_config",void 0),(0,s.__decorate)([(0,c.wk)()],E.prototype,"_statistics",void 0),(0,s.__decorate)([(0,c.wk)()],E.prototype,"_metadata",void 0),(0,s.__decorate)([(0,c.wk)()],E.prototype,"_unit",void 0),(0,s.__decorate)([(0,c.wk)()],E.prototype,"_energyStart",void 0),(0,s.__decorate)([(0,c.wk)()],E.prototype,"_energyEnd",void 0),E=(0,s.__decorate)([(0,c.EM)("hui-statistics-graph-card")],E),n()}catch(m){n(m)}})},74879:function(t,e,i){var n=i(87642),s=i(36196),r=i(48630),a=i(85456),o=TypeError,c=Object.defineProperty,u=s.self!==s;try{if(a){var d=Object.getOwnPropertyDescriptor(s,"self");!u&&d&&d.get&&d.enumerable||r(s,"self",{get:function(){return s},set:function(t){if(this!==s)throw new o("Illegal invocation");c(s,"self",{value:t,writable:!0,configurable:!0,enumerable:!0})},configurable:!0,enumerable:!0})}else n({global:!0,simple:!0,forced:u},{self:s})}catch(l){}},23336:function(t,e,i){i.d(e,{e:function(){return s}});var n=i(9151);function s(t,e,i){return(0,n.P)(t,12*e,i)}},77415:function(t,e,i){i.d(e,{V:function(){return a}});i(35748),i(95013);var n=i(90298),s=i(38227);function r(t,e,i){const[s,r]=(0,n.x)(null==i?void 0:i.in,t,e);return s.getFullYear()-r.getFullYear()}function a(t,e,i){const[a,o]=(0,n.x)(null==i?void 0:i.in,t,e),c=(0,s.z)(a,o),u=Math.abs(r(a,o));a.setFullYear(1584),o.setFullYear(1584);const d=c*(u-+((0,s.z)(a,o)===-c));return 0===d?0:d}}}]);
//# sourceMappingURL=45964.f64e7d4f7d869e7f.js.map