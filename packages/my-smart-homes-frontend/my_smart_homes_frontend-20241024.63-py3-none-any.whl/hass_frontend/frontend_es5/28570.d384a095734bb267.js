"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["28570"],{52609:function(t,a,e){e.a(t,async function(t,s){try{e.r(a),e.d(a,{HuiPowerSourcesGraphCard:function(){return z}});e(35748),e(99342),e(9724),e(65315),e(22416),e(37089),e(48169),e(59023),e(5934),e(95013);var r=e(69868),o=e(56590),i=e(76174),n=e(30765),c=e(84922),h=e(11991),l=e(75907),d=e(65940),p=e(90641),_=e(68717),g=(e(70490),e(43716)),u=e(40328),y=e(8510),f=e(36886),v=e(83510),b=t([_,g,f]);[_,g,f]=b.then?(await b)():b;let m,w,$,k,S=t=>t;class z extends((0,u.E)(c.WF)){hassSubscribe(){var t;return[(0,g.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(t=>this._getStatistics(t))]}getCardSize(){return 3}setConfig(t){this._config=t}shouldUpdate(t){return(0,y.xP)(this,t)||t.size>1||!t.has("hass")}render(){return this.hass&&this._config?(0,c.qy)(m||(m=S` <ha-card> ${0} <div class="content ${0}"> <ha-chart-base .hass="${0}" .data="${0}" .options="${0}"></ha-chart-base> ${0} </div> </ha-card> `),this._config.title?(0,c.qy)(w||(w=S`<h1 class="card-header">${0}</h1>`),this._config.title):"",(0,l.H)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.some(t=>t.data.length)?c.s6:(0,c.qy)($||($=S`<div class="no-data"> ${0} </div>`),(0,o.c)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):c.s6}async _getStatistics(t){var a;const e=[],s={solar:{stats:[],color:"--energy-solar-color",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.solar")},grid:{stats:[],color:"--energy-grid-consumption-color",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.grid")},battery:{stats:[],color:"--energy-battery-out-color",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.battery")}},r=getComputedStyle(this);for(const i of t.prefs.energy_sources)"solar"!==i.type?"battery"!==i.type?"grid"===i.type&&i.power&&s.grid.stats.push(...i.power.map(t=>t.stat_rate)):i.stat_rate&&s.battery.stats.push(i.stat_rate):i.stat_rate&&s.solar.stats.push(i.stat_rate);const o={type:"line",smooth:.4,smoothMonotone:"x",lineStyle:{width:1}};Object.keys(s).forEach((a,i)=>{if(s[a].stats.length){const n=r.getPropertyValue(s[a].color),c=(0,v.xp)(n),{positive:h,negative:l}=this._processData(s[a].stats.map(a=>{var e;return null!==(e=t.stats[a])&&void 0!==e?e:[]}));e.push(Object.assign(Object.assign({},o),{},{id:a,name:s[a].name,color:n,stack:"positive",areaStyle:{color:new p.fA.LinearGradient(0,0,0,1,[{offset:0,color:`rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.75)`},{offset:1,color:`rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.25)`}])},data:h,z:3-i})),"solar"!==a&&e.push(Object.assign(Object.assign({},o),{},{id:`${a}-negative`,name:s[a].name,color:n,stack:"negative",areaStyle:{color:new p.fA.LinearGradient(0,1,0,0,[{offset:0,color:`rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.75)`},{offset:1,color:`rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.25)`}])},data:l,z:4-i}))}}),this._start=t.start,this._end=t.end||(0,i.o)(),this._chartData=(0,f.JR)(e);const n=[];null===(a=this._chartData[0])||void 0===a||a.data.forEach((t,a)=>{const e="object"==typeof t&&"value"in t?t.value[0]:t[0];n[a]=[e,0],this._chartData.forEach(t=>{const e="object"==typeof t.data[a]&&"value"in t.data[a]?t.data[a].value[1]:t.data[a][1];n[a][1]+=e})}),this._chartData.push(Object.assign(Object.assign({},o),{},{id:"usage",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.usage"),color:r.getPropertyValue("--primary-color"),lineStyle:{width:2},data:n,z:5}))}_processData(t){const a={};t.forEach(t=>{t.forEach(t=>{var e;if(null==t.mean)return;const s=(t.start+t.end)/2;a[s]=[...null!==(e=a[s])&&void 0!==e?e:[],t.mean]})});const e=[],s=[];return Object.entries(a).forEach(([t,a])=>{const r=Number(t),o=a.reduce((t,a)=>t+a,0)/a.length;e.push([r,Math.max(0,o)]),s.push([r,Math.min(0,o)])}),{positive:e,negative:s}}constructor(...t){super(...t),this._chartData=[],this._start=(0,n.R)(),this._end=(0,i.o)(),this.hassSubscribeRequiredHostProps=["_config"],this._createOptions=(0,d.A)((t,a,e,s,r,o)=>(0,f.od)(t,a,e,s,"kW",r,o))}}z.styles=(0,c.AH)(k||(k=S`ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:var(--ha-space-4)}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:var(--ha-space-8);margin-inline-start:var(--ha-space-8);margin-inline-end:initial;box-sizing:border-box}`)),(0,r.__decorate)([(0,h.MZ)({attribute:!1})],z.prototype,"hass",void 0),(0,r.__decorate)([(0,h.wk)()],z.prototype,"_config",void 0),(0,r.__decorate)([(0,h.wk)()],z.prototype,"_chartData",void 0),(0,r.__decorate)([(0,h.wk)()],z.prototype,"_start",void 0),(0,r.__decorate)([(0,h.wk)()],z.prototype,"_end",void 0),(0,r.__decorate)([(0,h.wk)()],z.prototype,"_compareStart",void 0),(0,r.__decorate)([(0,h.wk)()],z.prototype,"_compareEnd",void 0),z=(0,r.__decorate)([(0,h.EM)("hui-power-sources-graph-card")],z),s()}catch(m){s(m)}})}}]);
//# sourceMappingURL=28570.d384a095734bb267.js.map